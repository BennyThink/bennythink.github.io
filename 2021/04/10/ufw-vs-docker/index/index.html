<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>æˆ‘çš„ufwæ€ä¹ˆåˆä¸å¥½ç”¨äº†ï¼Ÿä½¿ç”¨dockeræ—¶å¦‚ä½•æ‹’ç»écloudflareè®¿é—® | åœŸè±†ä¸å¥½åƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘æƒ³è®©æˆ‘çš„ç½‘ç«™çš„80å’Œ443ç«¯å£åªæ¥å—cloudflareçš„è®¿é—®ï¼Œç›´æ¥è®¿é—®ä¼šè¢«æ‹’ç»ã€‚ å—¨ï¼Œè¿™è¿˜ä¸ç®€å•å˜›ï¼å…ˆç»™å…¥ç½‘åŠ è§„åˆ™ï¼Œå½“ç„¶è¦è®°å¾—å…ˆåŠ sshçš„è§„åˆ™ï¼Œç„¶åå†ç»™policyè®¾ç½®æˆDROPï¼Œå¤šå¤§ç‚¹äº‹ï¼ iptables -I INPUT -p tcp â€“dport 22 -j ACCEPTiptables -I INPUT -s 192.168.7.67 -p tcp â€“dport 80">
<meta property="og:type" content="article">
<meta property="og:title" content="æˆ‘çš„ufwæ€ä¹ˆåˆä¸å¥½ç”¨äº†ï¼Ÿä½¿ç”¨dockeræ—¶å¦‚ä½•æ‹’ç»écloudflareè®¿é—®">
<meta property="og:url" content="http://example.com/2021/04/10/ufw-vs-docker/index/index.html">
<meta property="og:site_name" content="åœŸè±†ä¸å¥½åƒ">
<meta property="og:description" content="äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘æƒ³è®©æˆ‘çš„ç½‘ç«™çš„80å’Œ443ç«¯å£åªæ¥å—cloudflareçš„è®¿é—®ï¼Œç›´æ¥è®¿é—®ä¼šè¢«æ‹’ç»ã€‚ å—¨ï¼Œè¿™è¿˜ä¸ç®€å•å˜›ï¼å…ˆç»™å…¥ç½‘åŠ è§„åˆ™ï¼Œå½“ç„¶è¦è®°å¾—å…ˆåŠ sshçš„è§„åˆ™ï¼Œç„¶åå†ç»™policyè®¾ç½®æˆDROPï¼Œå¤šå¤§ç‚¹äº‹ï¼ iptables -I INPUT -p tcp â€“dport 22 -j ACCEPTiptables -I INPUT -s 192.168.7.67 -p tcp â€“dport 80">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/2021041016413552.png">
<meta property="og:image" content="http://example.com/images/2021041016413957.png">
<meta property="article:published_time" content="2021-04-10T00:00:00.000Z">
<meta property="article:modified_time" content="2023-05-15T18:16:51.121Z">
<meta property="article:author" content="Bennyå°åœŸè±†">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/2021041016413552.png">
  
    <link rel="alternate" href="/atom.xml" title="åœŸè±†ä¸å¥½åƒ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">åœŸè±†ä¸å¥½åƒ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-ufw-vs-docker/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/10/ufw-vs-docker/index/" class="article-date">
  <time class="dt-published" datetime="2021-04-10T00:00:00.000Z" itemprop="datePublished">2021-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      æˆ‘çš„ufwæ€ä¹ˆåˆä¸å¥½ç”¨äº†ï¼Ÿä½¿ç”¨dockeræ—¶å¦‚ä½•æ‹’ç»écloudflareè®¿é—®
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘æƒ³è®©æˆ‘çš„ç½‘ç«™çš„80å’Œ443ç«¯å£åªæ¥å—cloudflareçš„è®¿é—®ï¼Œç›´æ¥è®¿é—®ä¼šè¢«æ‹’ç»ã€‚</p>
<p>å—¨ï¼Œè¿™è¿˜ä¸ç®€å•å˜›ï¼å…ˆç»™å…¥ç½‘åŠ è§„åˆ™ï¼Œå½“ç„¶è¦è®°å¾—å…ˆåŠ sshçš„è§„åˆ™ï¼Œç„¶åå†ç»™policyè®¾ç½®æˆDROPï¼Œå¤šå¤§ç‚¹äº‹ï¼</p>
<p>iptables -I INPUT -p tcp â€“dport 22 -j ACCEPT<br>iptables -I INPUT -s 192.168.7.67 -p tcp â€“dport 80 -j ACCEPT<br>iptables -P INPUT DROP</p>
<p>æŸ¥çœ‹ä¸‹INPUTçš„è§„åˆ™ç¡®å®šä¸€ä¸‹æ²¡é—®é¢˜</p>
<p>[~] iptables -L INPUT<br>Chain INPUT (policy DROP)<br>target prot opt source destination<br>ACCEPT tcp â€“ 192.168.7.67 anywhere tcp dpt:http<br>ACCEPT tcp â€“ anywhere anywhere tcp dpt:ssh</p>
<p>å—¯ï¼Œæ²¡é—®é¢˜ï¼</p>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æ²¡é—®é¢˜çš„â€¦â€¦ä½†æ˜¯å¦‚æœä½ çš„åº”ç”¨æ˜¯ç”¨dockerèµ·çš„ï¼Œæ¯”å¦‚è¯´</p>
<p>docker run -d -p 80:80 nginx</p>
<p>é‚£ä¹ˆä½ ä¼šæƒŠå–œçš„å‘ç°ï¼Œè¿™è§„åˆ™å¥½åƒæ²¡ç”¨â€¦â€¦80ç«¯å£è¿˜æ˜¯èƒ½å¤Ÿä»é192.168.7.67ä»¥å¤–çš„IPè®¿é—®ã€‚</p>
<p>é‚£ä¸Šufwï¼</p>
<p>ufw allow ssh<br>ufw allow proto tcp from 192.168.7.67 to any port 80,443<br>ufw enable</p>
<p>å—¯â€¦â€¦è¿˜æ˜¯æ²¡ç”¨ï¼Œæ¯•ç«Ÿufwå…¶å®ä¹Ÿæ˜¯åœ¨æ“ä½œiptablesçš„å˜›ã€‚</p>
<p>å—¯ï¼Œå› ä¸ºdockerçš„è¯ï¼Œä¼šæ–°å»ºä¸€ä¸ªDOCKERçš„é“¾ï¼Œå¦‚æœå®¹å™¨ä½¿ç”¨<code>-p</code>ç»‘å®šäº†ç«¯å£ï¼Œé‚£ä¹ˆdokerä¼šè‡ªåŠ¨å»ä¿®æ”¹å¯¹åº”çš„iptablesè§„åˆ™ã€‚</p>
<p>æ‰€ä»¥ä»ç°è±¡ä¸Šæ¥çœ‹å°±æ˜¯dockeråœ¨ä½ çš„é˜²ç«å¢™ä¸Šæ‰“äº†ä¸€ä¸ªæ´â€¦â€¦</p>
<hr>
<p><img src="/images/2021041016413552.png"></p>
<h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>å…¶å®æˆ‘çš„éœ€æ±‚å¾ˆç®€å•ï¼Œécloudflare IPæ— æ³•è®¿é—®80&#x2F;443ã€‚é¢å¤–çš„ï¼Œæˆ‘è¿˜éœ€è¦å¼€æ”¾UDPçš„80å’Œ443ï¼Œwireguardåœ¨ç”¨çš„ã€‚22ä¹Ÿæ˜¯è¦çš„ï¼Œä¹Ÿå°±é¡ºä¾¿å¼€äº†UDP 22å¤‡ç”¨å§ã€‚å½“ç„¶ï¼Œä»¥ä¸Šéœ€æ±‚åŒ…æ¶µIPv4å’ŒIPv6ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæˆ‘æƒ³åˆ°äº†è¿™æ ·å‡ ç§æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>åœ¨å‚å•†é˜²ç«å¢™åšé…ç½®</li>
<li>nginxé…ç½®allow denyè§„åˆ™</li>
<li>å®¿ä¸»æœºnginxåšproxyï¼Œå°†docker çš„ç«¯å£ç»‘å®šåˆ°127.0.0.1</li>
<li>è®©dockerè‡£æœäºufwâ€¦â€¦</li>
</ol>
<h2 id="å‚å•†é˜²ç«å¢™é…ç½®"><a href="#å‚å•†é˜²ç«å¢™é…ç½®" class="headerlink" title="å‚å•†é˜²ç«å¢™é…ç½®"></a>å‚å•†é˜²ç«å¢™é…ç½®</h2><p>è¿™æ˜¯æœ€ç®€å•ä¹Ÿçš„æ–¹æ¡ˆäº†ï¼Œæœ‰äº›VPSå‚å•†æä¾›ä¸€ä¸ªé˜²ç«å¢™é…ç½®ï¼Œæœ‰çš„ä¹Ÿç§°ä¸ºå®‰å…¨ç»„ï¼Œç„¶åç»‘å®šåˆ°è‡ªå·±çš„æœºå™¨å°±å¥½äº†ï¼Œå°±æ˜¯cloudflareçš„IPæœ‰ç‚¹å¤šâ€¦â€¦æ”¹èµ·æ¥éº»çƒ¦äº†ç‚¹â€¦â€¦</p>
<p>æ¯”å¦‚vultrçš„é˜²ç«å¢™æ˜¯è¿™æ ·çš„ï¼Œè‡ªå·±æ”¹æ”¹å°±å·®ä¸å¤šäº†ã€‚</p>
<p><img src="/images/2021041016413957.png"></p>
<h2 id="nginxé…ç½®allow-denyè§„åˆ™"><a href="#nginxé…ç½®allow-denyè§„åˆ™" class="headerlink" title="nginxé…ç½®allow denyè§„åˆ™"></a>nginxé…ç½®allow denyè§„åˆ™</h2><p>ä»¥ä¸‹å‡æ˜¯é…ç½®å®¹å™¨ä¸­çš„nginx</p>
<h3 id="ä¸€èˆ¬æƒ…å†µ"><a href="#ä¸€èˆ¬æƒ…å†µ" class="headerlink" title="ä¸€èˆ¬æƒ…å†µ"></a>ä¸€èˆ¬æƒ…å†µ</h3><p>è¿™ä¸ªå…¶å®å¾ˆç®€å•çš„å•¦ï¼Œè‡ªå·±è¡¥å…¨ä¸‹IP</p>
<p># <a target="_blank" rel="noopener" href="https://www.cloudflare.com/ips">https://www.cloudflare.com/ips</a></p>
<h1 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h1><p>allow 103.21.244.0&#x2F;22;</p>
<h1 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h1><p>allow 2400:cb00::&#x2F;32;<br>deny all; # deny all remaining ips</p>
<h3 id="å¯ç”¨set-real-ip-from"><a href="#å¯ç”¨set-real-ip-from" class="headerlink" title="å¯ç”¨set_real_ip_from"></a>å¯ç”¨set_real_ip_from</h3><p>å¦‚æœä½ å¯ç”¨äº†<code>set_real_ip_from</code>ï¼Œé‚£ä¹ˆå¦‚æœåƒä¸Šé¢é‚£æ ·æ“ä½œï¼Œé‚£å°±å…¨éƒ¨éƒ½403å•¦ï¼</p>
<p>æ­£ç¡®çš„æ“ä½œå§¿åŠ¿æ˜¯è¿™æ ·çš„â€¦â€¦</p>
<p>geo $realip_remote_addr $cloudflare_ip {<br>    default 0;</p>
<pre><code>103.21.244.0/22 1;
2a06:98c0::/29 1;
</code></pre>
<p>}</p>
<p>ç„¶ååœ¨å¯¹åº”çš„serveræ®µä¸­ï¼š</p>
<p>if ($cloudflare_ip !&#x3D; 1) {<br>    return 403;<br>}</p>
<p>å—¯ï¼Œè¿™æ ·å°±å¯ä»¥äº†ï¼</p>
<h2 id="å®¿ä¸»æœºnginxåšproxy"><a href="#å®¿ä¸»æœºnginxåšproxy" class="headerlink" title="å®¿ä¸»æœºnginxåšproxy"></a>å®¿ä¸»æœºnginxåšproxy</h2><p>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ï¼Œå°†dockerçš„ç«¯å£ç»‘å®šåˆ°127.0.0.1ï¼Œç„¶åå®¿ä¸»æœºå®‰è£…nginxåšproxy_passï¼Œä¹‹åé…ç½®å®¿ä¸»æœºçš„nginx allow denyæˆ–è€…iptablesã€‚è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥çš„ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°±ä¸å¤šè¯´å•¦ï½ğŸ¤£</p>
<h2 id="è®©dockerè‡£æœäºufw"><a href="#è®©dockerè‡£æœäºufw" class="headerlink" title="è®©dockerè‡£æœäºufw"></a>è®©dockerè‡£æœäºufw</h2><p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åŒæ—¶è¦ä¿è¯ï¼šå®¹å™¨äº’é€šã€å¹¶ä¸”é€šå¤–ç½‘ã€‚å½“ç„¶ï¼Œç¦ç”¨dockerçš„iptablesåŠŸèƒ½ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œå’±å°±æƒ³èƒ½ä¸èƒ½è®©è¿™äºŒäººå’Œè°å…±å¤„â€¦â€¦</p>
<p>æ“ä½œèµ·æ¥å…¶å®å¾ˆç®€å•ã€‚ä¸è¿‡å…ˆè¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚è¯´æ¢å¤dockerçš„iptablesåŠŸèƒ½ï¼Œæ¸…é™¤INPUTä¸­çš„å¯èƒ½å†²çªçš„è§„åˆ™â€¦â€¦ç„¶åï¼š</p>
<h3 id="ä¿®æ”¹ufwé…ç½®"><a href="#ä¿®æ”¹ufwé…ç½®" class="headerlink" title="ä¿®æ”¹ufwé…ç½®"></a>ä¿®æ”¹ufwé…ç½®</h3><p>ä¿®æ”¹ <code>/etc/ufw/after.rule</code>s æœ€ååŠ ä¸Šå¦‚ä¸‹è§„åˆ™</p>
<p># BEGIN UFW AND DOCKER</p>
<h1 id="BEGIN-UFW-AND-DOCKER"><a href="#BEGIN-UFW-AND-DOCKER" class="headerlink" title="BEGIN UFW AND DOCKER"></a>BEGIN UFW AND DOCKER</h1><p>*filter<br>:ufw-user-forward - [0:0]<br>:ufw-docker-logging-deny - [0:0]<br>:DOCKER-USER - [0:0]<br>-A DOCKER-USER -j ufw-user-forward</p>
<p>-A DOCKER-USER -j RETURN -s 10.0.0.0&#x2F;8<br>-A DOCKER-USER -j RETURN -s 172.16.0.0&#x2F;12<br>-A DOCKER-USER -j RETURN -s 192.168.0.0&#x2F;16</p>
<p>-A DOCKER-USER -p udp -m udp â€“sport 53 â€“dport 1024:65535 -j RETURN</p>
<p>-A DOCKER-USER -j ufw-docker-logging-deny -p tcp -m tcp â€“tcp-flags FIN,SYN,RST,ACK SYN -d 192.168.0.0&#x2F;16<br>-A DOCKER-USER -j ufw-docker-logging-deny -p tcp -m tcp â€“tcp-flags FIN,SYN,RST,ACK SYN -d 10.0.0.0&#x2F;8<br>-A DOCKER-USER -j ufw-docker-logging-deny -p tcp -m tcp â€“tcp-flags FIN,SYN,RST,ACK SYN -d 172.16.0.0&#x2F;12<br>-A DOCKER-USER -j ufw-docker-logging-deny -p udp -m udp â€“dport 0:32767 -d 192.168.0.0&#x2F;16<br>-A DOCKER-USER -j ufw-docker-logging-deny -p udp -m udp â€“dport 0:32767 -d 10.0.0.0&#x2F;8<br>-A DOCKER-USER -j ufw-docker-logging-deny -p udp -m udp â€“dport 0:32767 -d 172.16.0.0&#x2F;12</p>
<p>-A DOCKER-USER -j RETURN</p>
<p>-A ufw-docker-logging-deny -m limit â€“limit 3&#x2F;min â€“limit-burst 10 -j LOG â€“log-prefix â€œ[UFW DOCKER BLOCK] â€œ<br>-A ufw-docker-logging-deny -j DROP</p>
<p>COMMIT</p>
<h1 id="END-UFW-AND-DOCKER"><a href="#END-UFW-AND-DOCKER" class="headerlink" title="END UFW AND DOCKER"></a>END UFW AND DOCKER</h1><h3 id="é‡å¯ufw"><a href="#é‡å¯ufw" class="headerlink" title="é‡å¯ufw"></a>é‡å¯ufw</h3><p>systemctl restart ufw</p>
<h3 id="æ·»åŠ è§„åˆ™"><a href="#æ·»åŠ è§„åˆ™" class="headerlink" title="æ·»åŠ è§„åˆ™"></a>æ·»åŠ è§„åˆ™</h3><p>å¼€å§‹æ„‰å¿«çš„æ·»åŠ è§„åˆ™å§</p>
<p>ufw allow 22<br>ufw allow proto udp to any port 80,443</p>
<p>for i in `curl <a target="_blank" rel="noopener" href="https://www.cloudflare.com/ips-v4/%60">https://www.cloudflare.com/ips-v4\`</a>; do ufw route allow proto tcp from $i to any port 80,443; done<br>for i in `curl <a target="_blank" rel="noopener" href="https://www.cloudflare.com/ips-v6/%60">https://www.cloudflare.com/ips-v6\`</a>; do ufw route allow proto tcp from $i to any port 80,443; done</p>
<p>ufw enabler</p>
<p>å¦‚æœä½ æƒ³é¢å¤–çš„æ·»åŠ ä¸€äº›IPçš„è¯ï¼Œé‚£å°±ä¾æ ·ç”»è‘«èŠ¦ï¼š</p>
<p>ufw route allow proto tcp from 1.1.1.1 to any port 80,443;</p>
<p>å¥½çš„ï¼è®¾ç½®å®Œæˆï¼æ‰¾å°æœºå™¨æ”¹hosts ä¹‹åç”¨curlè¯•è¯•å§ï¼</p>
<h3 id="æˆ‘è­¦å‘Šä½ ä»¬â€¦â€¦"><a href="#æˆ‘è­¦å‘Šä½ ä»¬â€¦â€¦" class="headerlink" title="æˆ‘è­¦å‘Šä½ ä»¬â€¦â€¦"></a>æˆ‘è­¦å‘Šä½ ä»¬â€¦â€¦</h3><p>å¦‚æœä½ çš„æœåŠ¡å™¨ä¹Ÿå¼€å¯äº†WireGuardï¼Œå¹¶ä¸”æ˜¯ä½¿ç”¨äº†WireGuardçš„è½¬å‘åŠŸèƒ½çš„ï¼Œé‚£ä¹ˆè¯·è®°å¾—å¼€ufw forwardã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>æˆ‘æœ‰ABCä¸‰å°æœåŠ¡å™¨ï¼ŒBæ˜¯WireGuardâ€œæœåŠ¡å™¨â€ï¼ŒAå’ŒCéƒ½è¿æ¥åˆ°äº†Bã€‚å¦‚æœAæƒ³è¦è®¿é—®Cä¸Šçš„sshï¼Œæˆ–è€…åè¿‡æ¥ï¼Œé‚£ä¹ˆå°±è¦å¼€forwardï¼Œå¦åˆ™ä¼šä¸é€šå“¦ã€‚</p>
<p>å½“ç„¶å•¦ï¼Œå‰ææ˜¯è¦å…ˆå¼€<code>net.ipv4.ip_forward=1</code>ä»¥åŠ<code>net.ipv6.conf.all.forwarding = 1</code>ï¼Œå¦åˆ™æœ‰æ²¡æœ‰ufwï¼ŒACéƒ½ä¸é€šçš„å“¦ã€‚</p>
<p>vim &#x2F;etc&#x2F;defaut&#x2F;ufw<br>DEFAULT_FORWARD_POLICY&#x3D;â€ACCEPTâ€</p>
<h1 id="æˆ–è€…ä¸‹é¢è¿™ä¸ªä¹Ÿå¯"><a href="#æˆ–è€…ä¸‹é¢è¿™ä¸ªä¹Ÿå¯" class="headerlink" title="æˆ–è€…ä¸‹é¢è¿™ä¸ªä¹Ÿå¯"></a>æˆ–è€…ä¸‹é¢è¿™ä¸ªä¹Ÿå¯</h1><p>ufw default allow routed</p>
<h1 id="ä¹Ÿè¦è®°å¾—æ”¾è¡Œå“¦"><a href="#ä¹Ÿè¦è®°å¾—æ”¾è¡Œå“¦" class="headerlink" title="ä¹Ÿè¦è®°å¾—æ”¾è¡Œå“¦"></a>ä¹Ÿè¦è®°å¾—æ”¾è¡Œå“¦</h1><p>ufw allow from 192.168.6.0&#x2F;24 to 192.168.6.1</p>
<p>å¦‚æœä½ çš„å®¹å™¨éœ€è¦è®¿é—®å®¿ä¸»æœºï¼Œè¿˜è¦è®°å¾—è¿™æ ·åŠ ä¸€è¡Œ</p>
<p>ufw allow from 172.16.0.0&#x2F;12 to 172.17.0.1</p>
<h3 id="ç¦ç”¨ufw"><a href="#ç¦ç”¨ufw" class="headerlink" title="ç¦ç”¨ufw"></a>ç¦ç”¨ufw</h3><p>å¦‚æœæ­¤æ—¶ä½ æ˜¯ç”¨ufw disableæ¥ç¦ç”¨ufwï¼Œä¼šå‘ç°å®¹å™¨æ— æ³•åœ¨å¤–éƒ¨è®¿é—®ã€‚æ­¤æ—¶éœ€è¦è¿™ä¹ˆåšï¼š</p>
<p>sudo iptables -I DOCKER-USER 1 -j RETURN</p>
<p>è¿™æ ·å¯ä»¥æš‚æ—¶bypassæ‰ufwè§„åˆ™äº†ã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è§„åˆ™</p>
<p>sudo iptables -n -L DOCKER-USER</p>
<p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤åˆ é™¤è§„åˆ™ï¼Œä¸è¿‡è¿™ä¸ªæ—¶å€™å°±è®°å¾—è¦<code>ufw enable</code>å“¦</p>
<p>sudo iptables -D DOCKER-USER 1</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>ufw-dockerï¼š <a target="_blank" rel="noopener" href="https://github.com/chaifeng/ufw-docker">https://github.com/chaifeng/ufw-docker</a></p>
<p>è®© docker å‘ UFW ä½å¤´ï¼š <a target="_blank" rel="noopener" href="https://keng42.com/blog/article/docker-ufw/">https://keng42.com/blog/article/docker-ufw/</a></p>
<p>after.rules not reloaded unless rebootï¼š <a target="_blank" rel="noopener" href="https://github.com/chaifeng/ufw-docker/issues/40">https://github.com/chaifeng/ufw-docker/issues/40</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/10/ufw-vs-docker/index/" data-id="clhp7rtmv00aps2qre4ce61qr" data-title="æˆ‘çš„ufwæ€ä¹ˆåˆä¸å¥½ç”¨äº†ï¼Ÿä½¿ç”¨dockeræ—¶å¦‚ä½•æ‹’ç»écloudflareè®¿é—®" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/17/argo-tunnel/index/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Cloudflare Argo Tunnel å°è¯•ï¼šæˆ‘ç»ˆäºå¯ä»¥ç”¨æ ‘è“æ´¾åšç½‘ç«™å•¦
        
      </div>
    </a>
  
  
    <a href="/2021/02/10/docker-scale/index/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ä½¿ç”¨docker scaleæ—¶é‡åˆ°çš„ä¸€ç‚¹å°é—®é¢˜</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/12/aca-php/index/">ç”¨ Azure Container Apps è¿è¡ŒPHPç½‘ç«™</a>
          </li>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps è¿æ¥åˆ°è™šæ‹Ÿæœºå¹¶é…ç½®CPUè‡ªåŠ¨ç¼©æ”¾</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">ä½¿ç”¨ Cloudflare Workerè·å–å›¾ç‰‡å…ƒæ•°æ®</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">å°† Cloudflare Workers è¿ç§»åˆ° Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-apiæ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ ClickHouse ä½œä¸ºæ—¥å¿—ç³»ç»Ÿ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Bennyå°åœŸè±†<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>