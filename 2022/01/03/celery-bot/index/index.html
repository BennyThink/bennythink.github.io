<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>åˆ†å¸ƒå¼Telegram Bot | åœŸè±†ä¸å¥½åƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="è‡ªå·±å†™ä¸€ä¸ªTelegram Botæ˜¯éå¸¸ç®€å•çš„ï¼Œæ— è®ºæ˜¯ä½¿ç”¨HTTP APIè¿˜æ˜¯MTProtoåè®®ã€‚ æœ€ç®€å•çš„echo botå¤§æ¦‚æ˜¯ä¸‹é¢çš„è¿™ç§æ ·å­ import loggingimport time from telebot import apihelperimport telebot logging.basicConfig(level&#x3D;logging.INFO) bot &#x3D; t">
<meta property="og:type" content="article">
<meta property="og:title" content="åˆ†å¸ƒå¼Telegram Bot">
<meta property="og:url" content="http://example.com/2022/01/03/celery-bot/index/index.html">
<meta property="og:site_name" content="åœŸè±†ä¸å¥½åƒ">
<meta property="og:description" content="è‡ªå·±å†™ä¸€ä¸ªTelegram Botæ˜¯éå¸¸ç®€å•çš„ï¼Œæ— è®ºæ˜¯ä½¿ç”¨HTTP APIè¿˜æ˜¯MTProtoåè®®ã€‚ æœ€ç®€å•çš„echo botå¤§æ¦‚æ˜¯ä¸‹é¢çš„è¿™ç§æ ·å­ import loggingimport time from telebot import apihelperimport telebot logging.basicConfig(level&#x3D;logging.INFO) bot &#x3D; t">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/2022010320464319.png">
<meta property="og:image" content="http://example.com/images/2022010320470988.png">
<meta property="og:image" content="http://example.com/images/2022010320471782.png">
<meta property="og:image" content="http://example.com/images/2022010320471965.png">
<meta property="og:image" content="http://example.com/images/2022010320472117.jpeg">
<meta property="og:image" content="http://example.com/images/2022010320472226.png">
<meta property="og:image" content="http://example.com/images/202201032109099.jpeg">
<meta property="og:image" content="http://example.com/images/2022010320472376.jpeg">
<meta property="og:image" content="http://example.com/images/2022010320472569.jpeg">
<meta property="article:published_time" content="2022-01-03T00:00:00.000Z">
<meta property="article:modified_time" content="2023-05-15T18:16:51.573Z">
<meta property="article:author" content="Bennyå°åœŸè±†">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/2022010320464319.png">
  
    <link rel="alternate" href="/atom.xml" title="åœŸè±†ä¸å¥½åƒ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">åœŸè±†ä¸å¥½åƒ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-celery-bot/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/03/celery-bot/index/" class="article-date">
  <time class="dt-published" datetime="2022-01-03T00:00:00.000Z" itemprop="datePublished">2022-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      åˆ†å¸ƒå¼Telegram Bot
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è‡ªå·±å†™ä¸€ä¸ªTelegram Botæ˜¯éå¸¸ç®€å•çš„ï¼Œæ— è®ºæ˜¯ä½¿ç”¨HTTP APIè¿˜æ˜¯MTProtoåè®®ã€‚</p>
<p>æœ€ç®€å•çš„echo botå¤§æ¦‚æ˜¯ä¸‹é¢çš„è¿™ç§æ ·å­</p>
<p>import logging<br>import time</p>
<p>from telebot import apihelper<br>import telebot</p>
<p>logging.basicConfig(level&#x3D;logging.INFO)</p>
<p>bot &#x3D; telebot.TeleBot(â€œ3XIâ€)<br>apihelper.proxy &#x3D; {â€˜httpsâ€™: â€˜socks5h:&#x2F;&#x2F;127.0.0.1:1086â€™}</p>
<p>@bot.message_handler(commands&#x3D;[â€˜startâ€™, â€˜helpâ€™])<br>def send_welcome(message):<br>    logging.info(â€œReceived messageâ€)<br>    bot.reply_to(message, â€œHowdy, how are you doing?â€)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    bot.polling()</p>
<p><img src="/images/2022010320464319.png"></p>
<p>å¾ˆæ£’æ˜¯ä¸æ˜¯ï¼</p>
<p>å½“ä½ çš„botå¼€å§‹æœ‰æ›´å¤šçš„ä¸šåŠ¡ï¼Œæ¯”å¦‚è¯´æŸ¥è¯¢æ•°æ®åº“ï¼Œå»è®¿é—®å…¶ä»–ç½‘ç«™ç„¶åè§£æï¼Œä½ å°±ä¼šå‘ç°è¿™ä¸ªbotä¼¼ä¹æœ‰ç‚¹åŠ›ä¸ä»å¿ƒï¼Œæ‰€æœ‰çš„å“åº”éƒ½æ…¢äº†ä¸€æ‹ã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼Œè¿™ä¸ªbotæ¯æ¬¡éƒ½è¦å»è®¿é—®å¦å¤–ä¸€ä¸ªç½‘ç«™ï¼Œç„¶åè¿”å›ï¼Œå¯æƒœçš„æ˜¯è¿™ä¸ªç½‘ç«™å“åº”å¤ªæ…¢äº†ï¼Œè¦5ç§’æ‰èƒ½è¿”å›</p>
<p>@bot.message_handler(commands&#x3D;[â€˜startâ€™])<br>def send_welcome(message):<br>    logging.info(â€œReceived start messageâ€)<br>    text &#x3D; requests.get(â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/%22).text">http://127.0.0.1:5000/&quot;).text</a><br>    bot.reply_to(message, text)</p>
<p>@bot.message_handler(commands&#x3D;[â€˜helpâ€™])<br>def send_help(message):<br>    logging.info(â€œReceived help messageâ€)<br>    bot.reply_to(message, â€œhelpâ€)</p>
<p>æ­¤æ—¶ä½ å°±ä¼šæƒŠå¥‡åœ°å‘ç°ï¼Œæ‰€æœ‰å…¶ä»–çš„æ“ä½œéƒ½è¢«é˜»å¡äº†ï¼Œç›´åˆ°startç»“æŸã€‚</p>
<p><img src="/images/2022010320470988.png"></p>
<p>è¿™è¦æ€ä¹ˆåŠå‘¢ï¼Ÿä¸€å®šæ˜¯æœ‰åŠæ³•çš„å¯¹å§</p>
<h2 id="å¢å¤§threadæ•°é‡"><a href="#å¢å¤§threadæ•°é‡" class="headerlink" title="å¢å¤§threadæ•°é‡"></a>å¢å¤§threadæ•°é‡</h2><p>æ— è®ºæ˜¯pyrogramè¿˜æ˜¯pytelegrambotapiï¼Œéƒ½æœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹æ•°é‡ã€‚</p>
<p>å¯¹äºpytelegrambotapiæ¥è¯´ï¼Œå‚æ•°æ˜¯<code>num_threads=2</code>ï¼Œæ„é€ botçš„æ—¶å€™å°±å¯ä»¥æŒ‡å®šï¼›</p>
<p>å¯¹äºpyrogramæ¥è¯´ï¼Œå‚æ•°æ˜¯<code>workers: int = Scaffold.WORKERS</code>ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯<code>min(32, os.cpu_count() + 4)</code>ã€‚</p>
<p>é‚£ä¹ˆåªè¦æˆ‘ä»¬åœ¨ä¸€å®šèŒƒå›´å†…å¢åŠ è¿™ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆå°±åº”è¯¥åœ¨ä¸€å®šç¨‹åº¦å†…ä¸ä¼šååº”è¿Ÿé’å¤ªå¤šã€‚æ¯”å¦‚è¯´ï¼š</p>
<p>bot &#x3D; telebot.TeleBot(â€œtokenâ€, num_threads&#x3D;100)</p>
<p>æ˜¯è¿™ä¸ªé“ç†çš„ï¼</p>
<h2 id="ä½¿ç”¨async"><a href="#ä½¿ç”¨async" class="headerlink" title="ä½¿ç”¨async"></a>ä½¿ç”¨async</h2><p>ä½¿ç”¨asyncä¹Ÿå¯ä»¥æ°åˆ°å¥½å¤„çš„è§£å†³æˆ‘ä»¬ä»¥ä¸Šé˜»å¡çš„é—®é¢˜ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨<code>AsyncTeleBot</code></p>
<p>from telebot.async_telebot import AsyncTeleBot<br>bot &#x3D; AsyncTeleBot(â€œTOKENâ€)</p>
<p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¸èƒ½ç›´æ¥ç”¨requestsäº†ï¼Œå› ä¸ºrequestsæ˜¯syncçš„ï¼Œç®€å•èµ·è§æˆ‘ä»¬è¿™ç”¨aiohttpä½œä¸ºæ¼”ç¤ºä¾‹å­</p>
<p>@bot.message_handler(commands&#x3D;[â€˜startâ€™])<br>async def send_welcome(message):<br>    logging.info(â€œReceived start messageâ€)<br>    async with aiohttp.ClientSession() as session:<br>        async with session.get(â€˜<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>â€˜) as response:<br>            html &#x3D; await response.text()<br>    await bot.reply_to(message, html)</p>
<p>@bot.message_handler(commands&#x3D;[â€˜helpâ€™])<br>async def send_help(message):<br>    logging.info(â€œReceived help messageâ€)<br>    await bot.reply_to(message, â€œhelpâ€)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    asyncio.run(bot.polling())</p>
<p>å—¯ï¼Œä¸ä¼šé˜»å¡çš„ã€‚</p>
<p><img src="/images/2022010320471782.png"></p>
<p>è¿™ç§åšæ³•ä¹Ÿæ˜¯ä¸€ç§å¾ˆæµè¡Œçš„åŠæ³•ï¼Œä½†æ˜¯æˆ‘ä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢ã€‚ä¸€ä¸ªæ˜¯å› ä¸ºèœï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å› ä¸ºå¾ˆå¤šåº“éƒ½æ˜¯éasyncçš„ï¼Œåˆ‡æ¢è¿‡å»éš¾åº¦å¯èƒ½æ¯”è¾ƒå¤§ã€‚å°½ç®¡ä¹Ÿæœ‰äº›monkey patchå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰è¿™ç§åšæ³•å¤ªè¿‡äºé­”æ³•ã€‚</p>
<h2 id="æ›´å¤æ‚çš„åœºæ™¯"><a href="#æ›´å¤æ‚çš„åœºæ™¯" class="headerlink" title="æ›´å¤æ‚çš„åœºæ™¯"></a>æ›´å¤æ‚çš„åœºæ™¯</h2><p>é€šå¸¸æ¥è¯´ï¼Œç®€å•åŠ å¤§çº¿ç¨‹æ•°é‡æˆ–è€…ç”¨asyncå³å¯è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯æ¯”å¦‚ä½ çš„åœºæ™¯æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚è¯´æ˜¯ä»YouTubeä¸Šä¸‹è½½è§†é¢‘ï¼Œéœ€è¦å ç”¨å¤§é‡çš„å¸¦å®½ï¼Œå³ä½¿çº¿ç¨‹æ•°é‡è¶³å¤Ÿï¼Œé‚£ä¹ˆå¹¶å‘é‡é«˜çš„æ—¶å€™ï¼Œä¸‹è½½é€Ÿåº¦ä¹Ÿä¼šè¢«é™åˆ¶äºæœ¬æœºçš„å¸¦å®½ã€‚</p>
<p>æ—¢ç„¶MTProtoåè®®æœ€é«˜å…è®¸10ä¸ªå®¢æˆ·ç«¯åŒæ—¶åœ¨çº¿ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•åŒæ—¶åœ¨å¤šå°æœºå™¨ä¸Šç™»å½•ï¼Œç„¶ååˆ†å‘ä»»åŠ¡ï¼Œæ¯ä¸ªæœºå™¨æ¥æ”¶åˆ°ä»»åŠ¡ä¹‹ååªè´Ÿè´£å¤„ç†è‡ªå·±çš„ä»»åŠ¡ï¼Œè¿™æ ·æ•´ä½“çš„ååé‡å°±å¯ä»¥éå¸¸å®¹æ˜“çš„æ°´å¹³æ‰©å±•ã€‚</p>
<h2 id="Celery-åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—"><a href="#Celery-åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="Celery - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—"></a>Celery - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</h2><p>Celery æ˜¯ä¸€ä¸ªç®€å•ã€çµæ´»ä¸”å¯é çš„ï¼Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æä¾›ç»´æŠ¤è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„å¿…éœ€å·¥å…·ã€‚</p>
<p>æ²¡é”™çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤šå°æœºå™¨ä¹‹é—´é€šè¿‡<a target="_blank" rel="noopener" href="https://nova.moe/deploy-wireguard-on-ubuntu-bionic/">WireGuardç»„ä¸€ä¸ªå¤§å†…ç½‘</a>ï¼Œç„¶åé€šè¿‡celeryåˆ†å‘ä»»åŠ¡ã€‚</p>
<p>ä½¿ç”¨Celeryéå¸¸ç®€å•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡å¥½brokerï¼Œæ¯”å¦‚è¯´ä½¿ç”¨rediså§ï¼</p>
<p>from celery import Celery<br>app &#x3D; Celery(â€˜helloâ€™, broker&#x3D;â€™redis:&#x2F;&#x2F;localhost:6379&#x2F;0â€™, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€</p>
<p>@app.task<br>def hello():<br>    return â€˜hello worldâ€™</p>
<p>ç„¶åè¿è¡Œworker</p>
<p>celery -A tasks worker â€“loglevel&#x3D;info</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œceleryè¿æ¥åˆ°äº†redisï¼Œ<code>concurrency</code>æ˜¯8ï¼Œä½¿ç”¨<code>prefork</code></p>
<p><img src="/images/2022010320471965.png"></p>
<p>ä¹‹åæˆ‘ä»¬åªè¦ä½¿ç”¨delayæ–¹æ³•æäº¤ä»»åŠ¡å°±å¯ä»¥äº†</p>
<p>&gt; python3 master [bd0f485] deleted untracked<br>Python 3.9.9 (main, Nov 21 2021, 03:22:47)<br>[Clang 12.0.0 (clang-1200.0.32.29)] on darwin<br>Type â€œhelpâ€, â€œcopyrightâ€, â€œcreditsâ€ or â€œlicenseâ€ for more information.</p>
<blockquote>
<blockquote>
<blockquote>
<p>from tasks import add<br>add.delay(8,1)<br>&lt;AsyncResult: cf06f416-bdf7-4ea9-99bc-7ba136329b7f&gt;</p>
</blockquote>
</blockquote>
</blockquote>
<p>celery workerä¼šæ‹¿åˆ°ä»»åŠ¡ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚å¦‚æœæœ‰å¤šä¸ªworkerå¹¶ä¸”å…¨éƒ¨ç©ºé—²ï¼Œé‚£ä¹ˆå¤§å®¶æ‹¿åˆ°ä»»åŠ¡çš„å‡ ç‡æ˜¯å‡ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯round robinã€‚</p>
<h2 id="celery-pyrogram"><a href="#celery-pyrogram" class="headerlink" title="celery+pyrogram"></a>celery+pyrogram</h2><p>å¥½æäº†ï¼Œé‚£å°±è¿™ä¹ˆæï¼Œç”¨pyrogramåªè¦ç¡®ä¿sessionåå­—ä¸åŒï¼Œé‚£ä¹ˆå°±æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯ã€‚</p>
<p>äºæ˜¯ä½ å…´è‡´å‹ƒå‹ƒçš„å†™å¥½äº†ä»£ç </p>
<p># bot.py<br>from pyrogram import filters<br>from client_init import create_app<br>from tasks import send_hello</p>
<p>app &#x3D; create_app()</p>
<p>@app.on_message(filters.command([â€œ&#x2F;startâ€]))<br>def hello(client, message):<br>    send_hello.delay(message.chat.id)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    app.run()</p>
<h1 id="tasks-py"><a href="#tasks-py" class="headerlink" title="tasks.py"></a>tasks.py</h1><p>from celery import Celery<br>from client_init import create_app</p>
<p>app &#x3D; Celery(â€˜tasksâ€™, broker&#x3D;â€™redis:&#x2F;&#x2F;localhost:6379&#x2F;0â€™, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€)<br>tg_client &#x3D; create_app(â€œdevelopmentâ€)<br>tg_client.start()</p>
<p>@app.task<br>def send_hello(user_id):<br>    tg_client.send_message(user_id, â€œHelloâ€)</p>
<p>ç„¶åå‘é€äº†ä¸€ä¸ª<code>/start</code>ï¼Œå¥‡è¿¹å¹¶æ²¡æœ‰å‘ç”Ÿã€‚äº‹å®å°±åƒç¤¾ä¼šä¸»ä¹‰é“æ‹³ä¸€æ ·ï¼Œæ€»ä¼šæŠŠä½ çš„è„¸æ‰“å¾—å•ªå•ªä½œå“ã€‚</p>
<p><img src="/images/2022010320472117.jpeg"></p>
<p>è¡Œå§ï¼Œè¿™æ˜¯macOS&#x2F;Python.org&#x2F;Celeryçš„é”…ï¼ŒçŒœæµ‹æ˜¯å’Œsubprocessåœ¨ä¸åŒå¹³å°ä¸Šçš„å®ç°æœ‰å…³ã€‚å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯preforkæ¨¡å¼ã€‚</p>
<p>é‚£æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬æ¢åˆ°Linuxè¯•ä¸€ä¸‹çœ‹çœ‹</p>
<p>è™½ç„¶æ²¡æœ‰æŠ¥é”™äº†ï¼Œä½†æ˜¯ä¸ºä½•æ”¶åˆ°äº†æ¶ˆæ¯å´æ²¡æœ‰æ‰§è¡Œï¼Ÿæˆ–è€…è¯´æ‰§è¡Œå¡ä½äº†ï¼Ÿå¤šæ‰“ç‚¹logè¯•è¯•çœ‹ï¼Ÿ</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    print(tg_client.get_me())<br>    tg_client.send_message(user_id, â€œHelloâ€)<br>    logging.info(â€œfinish tasksâ€)</p>
<p><img src="/images/2022010320472226.png"></p>
<p>ä¸ºä»€ä¹ˆï¼Ÿ</p>
<h2 id="ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ</h2><p>celeryé»˜è®¤æ˜¯preforkæ¨¡å¼ï¼Œæ„å‘³celeryä¼šforkå‡ºæ¥ä¸€å †å­è¿›ç¨‹æ¥å¹²æ´»ï¼Œç„¶åè‡ªå·±æˆä¸ºåŒ…å·¥å¤´ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æ—¥å¿—ä¸­çœ‹åˆ° ForkPoolWorker-xçš„æ‰§è¡Œæ—¥å¿—çš„åŸå› ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æ˜¯åœ¨file-levelå®šä¹‰çš„<code>tg_client</code>ï¼Œè€Œæ‰§è¡Œä»»åŠ¡çš„workeråœ¨æ”¶åˆ°ä¸‹è½½è¯·æ±‚æ—¶è¦å»è®¿é—®<code>tg_client</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚å†åŠ ä¸Špyrogramæ˜¯å¼‚æ­¥åº“ã€‚æ‰€ä»¥é—®é¢˜å°±æ›´ä¸¥é‡äº†</p>
<p>è§£å†³æ–¹æ¡ˆä¹‹ä¸€æ˜¯ï¼Œæˆ‘ä»¬åœ¨tasksä¸­ä½¿ç”¨<code>with</code>ï¼Œè¿™æ ·ç›¸å½“äºæ¯æ¬¡tasksæ‰§è¡Œéƒ½è¦ç»å†å®Œæˆçš„è¿æ¥æ­¥éª¤ï¼Œå°±å¥½åƒå¼€æœº-å¹²æ´»-å…³æœºä¸€æ ·ã€‚</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    with create_app(â€œdevelopmentâ€) as tg_client:<br>        print(tg_client.get_me())<br>        tg_client.send_message(user_id, â€œHelloâ€)<br>    logging.info(â€œfinish tasksâ€)</p>
<p>ç¬¬ä¸€æ¬¡ä¼šæ¯”è¾ƒæ…¢ï¼Œåç»­ä¼šä½¿ç”¨åˆ°sessionæ–‡ä»¶ï¼Œèƒ½ç¨å¾®å¿«ä¸€ç‚¹ã€‚</p>
<p>å¦‚æœçªç„¶æ¥äº†10ä¸ªå¹¶å‘çš„ä»»åŠ¡â€¦â€¦ğŸ’£é‚£è¿™å°±å®Œè›‹å•¦</p>
<h2 id="soloæ¨¡å¼"><a href="#soloæ¨¡å¼" class="headerlink" title="soloæ¨¡å¼"></a>soloæ¨¡å¼</h2><p>celery workeré™¤äº†preforkæ¨¡å¼ï¼Œè¿˜æœ‰geventã€eventletã€threadså’Œsoloè¿™å››ç§ã€‚<a target="_blank" rel="noopener" href="https://blog.csdn.net/cnweike/article/details/105840936">å®ƒä»¬çš„åŒºåˆ«</a>å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p>1. preforkï¼ˆé»˜è®¤ï¼‰ï¼šworkerä¼šå¼€å¯å¤šä¸ªè¿›ç¨‹æ¥æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡å®ä¾‹ï¼ˆtask instanceï¼‰ï¼Œé€‚åˆäºCPUå¯†é›†å‹åº”ç”¨ï¼›è¿™ä¼šå¼€å¯ä¸€ä¸ªworkerä¸»è¿›ç¨‹ï¼Œå’Œä¸€ç»„å·¥ä½œè¿›ç¨‹ï¼ˆå¦‚æœå¹¶è¡Œåº¦è®¾ç½®ä¸º2ï¼Œå½“ä½¿ç”¨ps -ef | grep celeryçš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°3ä¸ªè¿›ç¨‹ï¼Œå¤šå‡ºæ¥çš„ä¸€ä¸ªå°±æ˜¯ä¸»è¿›ç¨‹ï¼‰ã€‚</p>
<p>celery -A djangogo worker -P prefork -c 2</p>
<p>2. eventletï¼šé€‚ç”¨äºI&#x2F;Oå¯†é›†å‹åº”ç”¨ï¼›åº•å±‚ä½¿ç”¨epollæˆ–è€…libeventæ¥é©±åŠ¨å¤šè·¯å¤ç”¨ã€‚è¦æ³¨æ„ä¸è¦åœ¨è¿™æ ·çš„workerä¸­è¿è¡ŒCPUå¯†é›†å‹çš„ä»»åŠ¡å®ä¾‹ã€‚</p>
<p>celery -A djangogo worker -P eventlet -c 20000</p>
<p>3. geventï¼šç±»ä¼¼äºeventletï¼ŒåŸºäºlibevæˆ–è€…libuväº‹ä»¶å¾ªç¯ã€‚</p>
<p>celery -A djangogo worker -P gevent -c 20000</p>
<p>4.soloï¼šæ¥æ”¶æ§åˆ¶æŒ‡ä»¤åŒè¿è¡Œä»»åŠ¡å®ä¾‹åœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œæ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡å®ä¾‹æ‰§è¡Œæ—¶é—´è¾ƒé•¿ä¼šé˜»å¡æ§åˆ¶æŒ‡ä»¤è¯·æ±‚çš„å“åº”ï¼Œå®¢æˆ·ç«¯éœ€è¦é€‚åº¦å¢åŠ è¶…æ—¶æ—¶é—´è®¾ç½®ã€‚ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰</p>
<p>5. threadsï¼šä»»åŠ¡å®ä¾‹åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™é‡Œçš„çº¿ç¨‹å°±æ˜¯æˆ‘ä»¬é€šå¸¸è®¤çŸ¥ä¸Šçš„çº¿ç¨‹ï¼Œçº¿ç¨‹ç»´æŠ¤é€šå¸¸è¦æ˜æ˜¾å¤§äºåç¨‹ï¼Œæ‰€ä»¥å¹¶è¡Œåº¦çš„è®¾ç½®ä¹Ÿéœ€è¦è€ƒè™‘åˆ°ç»´æŠ¤çš„ä»£ä»·ã€‚</p>
<p>é‚£ä¹ˆç”¨soloæ¨¡å¼ä¼¼ä¹å¯è¡Œ</p>
<p>tg_client &#x3D; create_app(â€œdevelopmentâ€)<br>tg_client.start()</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    # with create_app(â€œdevelopmentâ€) as tg_client:<br>    text &#x3D; requests.get(â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:5000" ).text">http://127.0.0.1:5000&quot;).text</a><br>    tg_client.send_message(user_id, text)<br>    logging.info(â€œfinish tasksâ€)</p>
<h1 id="run-celery"><a href="#run-celery" class="headerlink" title="run celery"></a>run celery</h1><p>celery -A tasks worker â€“loglevel&#x3D;info â€“pool&#x3D;solo</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2022/01/202201032109099.jpeg"><img src="/images/202201032109099.jpeg"></a></p>
<p>è¿™æ ·å½“ç„¶ä¹Ÿè¡Œï¼Œä½†æ˜¯ä¸€ä¸ªå¾ˆä¸¥è‚ƒçš„é—®é¢˜å°±æ˜¯ï¼Œsoloæƒ…å†µä¸‹å¦‚æœå‡½æ•°æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¼šä½¿å¾—åç»­tasksè¢«é˜»å¡ï¼Œä¹Ÿå°±æ˜¯è¯´soloä¸‹concurrencyæ˜¯æ²¡æœ‰ç”¨çš„ã€‚è¿™â€¦â€¦</p>
<h2 id="threadsæ¨¡å¼"><a href="#threadsæ¨¡å¼" class="headerlink" title="threadsæ¨¡å¼"></a>threadsæ¨¡å¼</h2><p>é‚£ä¹ˆç”¨threadsæ¨¡å¼å¦‚ä½•ï¼Ÿåæ­£å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿåªæ˜¯ç½‘ç»œç›¸å…³çš„æ“ä½œï¼Œä¸å¤ªæ¶‰åŠåˆ°è®¡ç®—ã€‚</p>
<p>celery -A tasks worker â€“loglevel&#x3D;info â€“pool&#x3D;threads â€“concurrency&#x3D;20</p>
<p>æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œè™½ç„¶å¯ä»¥å¹¶å‘ï¼Œä½†æ˜¯ä¼¼ä¹åˆåƒpreforkæ¨¡å¼ä¸€æ ·ï¼Œå¡ä½äº†â€¦â€¦</p>
<p>æ ¹æœ¬åŸå› æ˜¯celery tasksæ˜¯é˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œè€Œpyrogramä½œä¸ºå¼‚æ­¥åº“<strong>æ˜¯è¦ä¾èµ–ä¸»çº¿ç¨‹çš„</strong>ã€‚</p>
<p>ä½†æ˜¯æ”¹æ”¹è¿˜èƒ½æŠ¢æ•‘ä¸€ä¸‹</p>
<h3 id="å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram-1-xç‰ˆæœ¬çš„è¯"><a href="#å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram-1-xç‰ˆæœ¬çš„è¯" class="headerlink" title="å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram 1.xç‰ˆæœ¬çš„è¯"></a>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram 1.xç‰ˆæœ¬çš„è¯</h3><p>from pyrogram import idle</p>
<p>logging.basicConfig(level&#x3D;logging.INFO)<br>app &#x3D; Celery(â€˜tasksâ€™, broker&#x3D;â€™redis:&#x2F;&#x2F;host.docker.internal:6379&#x2F;0â€™, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€)<br>tg_client &#x3D; create_app(â€œdevelopmentâ€)</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    # with create_app(â€œdevelopmentâ€) as tg_client:<br>    text &#x3D; requests.get(â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:5000" ).text">http://127.0.0.1:5000&quot;).text</a><br>    tg_client.send_message(user_id, text)<br>    logging.info(â€œfinish tasksâ€)</p>
<p>def run_celery():<br>    argv &#x3D; [â€œ-Aâ€, â€œtasksâ€, â€˜workerâ€™, â€˜â€“loglevel&#x3D;infoâ€™, â€œâ€“pool&#x3D;threadsâ€, â€œâ€“concurrency&#x3D;200â€]<br>    app.worker_main(argv)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    tg_client.start()<br>    threading.Thread(target&#x3D;run_celery, daemon&#x3D;True).start()<br>    idle()<br>    tg_client.stop()</p>
<h1 id="run-celery-1"><a href="#run-celery-1" class="headerlink" title="run celery"></a>run celery</h1><p>python3 tasks.py</p>
<p>è¿™æ ·å°±å¯ä»¥é¡ºåˆ©æ”¶å‘æ¶ˆæ¯å•¦ğŸ˜„</p>
<h2 id="å…¶ä»–æ¨¡å¼"><a href="#å…¶ä»–æ¨¡å¼" class="headerlink" title="å…¶ä»–æ¨¡å¼"></a>å…¶ä»–æ¨¡å¼</h2><p>è‡³äºgeventã€eventletï¼Œåæ­£æˆ‘æ˜¯æ²¡æå‡ºæ¥â€¦â€¦</p>
<h2 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h2><h3 id="ç›‘æ§worker"><a href="#ç›‘æ§worker" class="headerlink" title="ç›‘æ§worker"></a>ç›‘æ§worker</h3><p>åœ¨æœ‰äº†workeråï¼Œæ€»æƒ³åšä¸€äº›ç›‘æ§ä»€ä¹ˆçš„ï¼Œcelery floweræ­£å¥½æ˜¯å¹²è¿™ä»¶äº‹æƒ…çš„</p>
<p>celery -A tasks worker â€“loglevel&#x3D;info</p>
<p>ç”±äºæˆ‘ä»¬çš„tg_clientæ˜¯file-levelï¼Œå¹¶ä¸”ç”±äºflowerå’Œæœ€æ–°ç‰ˆæœ¬çš„celeryä¼¼ä¹æœ‰äº›å…¼å®¹æ€§é—®é¢˜ï¼Œæ²¡åŠæ³•ä¸ç”¨-Aå–§åš£ã€‚å› æ­¤ä¸ºäº†é¿å…æµªè´¹ä¸€ä¸ªclientå¹¶åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¼„ä¸€ä¸ªdummy tasks</p>
<p># flower_tasks.py<br>app &#x3D; Celery(â€˜tasksâ€™, broker&#x3D;BROKER, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€)</p>
<p>ç„¶å</p>
<p>celery -A flower_tasks flower</p>
<p>ç”šè‡³å¯ä»¥æ ¹æ®ä¸ªäººæƒ…å†µä½¿ç”¨<code>--persistent</code>ã€<code>basic auth</code>ä¹‹ç±»çš„ã€‚çœ‹çœ‹è¿™æ•ˆæœï¼ˆ</p>
<p><img src="/images/2022010320472376.jpeg" alt="å›¾åƒ"></p>
<p>è¿˜å¯ä»¥çœ‹åˆ°å“ªäº›ä»»åŠ¡æ˜¯å¤±è´¥çš„ï¼Œä¿®å¤äº†å¥½å‡ ä¸ªbug</p>
<p><img src="/images/2022010320472569.jpeg" alt="å›¾åƒ"></p>
<h3 id="æŒç»­éƒ¨ç½²"><a href="#æŒç»­éƒ¨ç½²" class="headerlink" title="æŒç»­éƒ¨ç½²"></a>æŒç»­éƒ¨ç½²</h3><p>workerè¿™ä¹ˆå¤šï¼Œæ¯æ¬¡æ›´æ–°éƒ½è¦sshä¸Šå»å¾ˆéº»çƒ¦ï¼Œå³ä½¿æ˜¯ç”¨äº†<code>docker-compose</code>ä¹Ÿä¸€æ ·ã€‚æ–¹æ³•ä¹‹ä¸€æ˜¯ç”¨ansibleï¼Œæ–¹æ³•ä¹‹äºŒæ˜¯ç”¨GitHub Actionsã€‚</p>
<p>æˆ‘çš„ç”¨æ³•æ˜¯åœ¨Github Actionsä¸Šsshåˆ°æœºå™¨ï¼Œç„¶åæ‰§è¡Œæˆ‘å†™å¥½çš„<code>Makefile</code>ã€‚<code>Makefile</code>çš„å†…å®¹å¤§æ¦‚å°±æ˜¯<code>docker pull docker-compose up -d</code>ä¹‹ç±»çš„å•¦ã€‚</p>
<p>å¯ä»¥å‚è€ƒè¿™é‡Œ <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/upgrade.yml">https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/upgrade.yml</a></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¤§æ¦‚æœ‰ä¸‰ç§å¯è¡Œçš„æ–¹æ³•ï¼Œä»¥<code>tg_client.get_me()</code>å’Œæˆ‘çš„æ…¢é€Ÿæ¢¯å­ä¸ºä¾‹ï¼š</p>
<ol>
<li>prefork+withï¼Œæ¯æ¬¡éƒ½è¦å¼€æœº-å¹²æ´»-å…³æœºã€‚ç¬¬ä¸€æ¬¡ä¼šæ¯”è¾ƒæ…¢å¤§æ¦‚15-20ç§’ï¼Œåç»­ä¼šå¿«ä¸€ç‚¹ã€‚å‚è€ƒæ—¶é—´2-3s</li>
<li>soloæ¨¡å¼ï¼Œåªèƒ½å¤„ç†ä¸€ä¸ªï¼Œæ¯æ¬¡å¤„ç†å‚è€ƒæ—¶é—´0.5sæˆ–æ›´ä½</li>
<li>threadsæ¨¡å¼ï¼Œåªè¦ä¸æ¶‰åŠåˆ°å¤§é‡è®¡ç®—é‚£ä¹ˆé—®é¢˜å°±ä¸å¤§ï¼Œé‚£ä¹ˆæ¯æ¬¡å¤„ç†å‚è€ƒæ—¶é—´ä¸º0.5sæˆ–æ›´ä½</li>
</ol>
<h2 id="æœ€åâ€¦â€¦"><a href="#æœ€åâ€¦â€¦" class="headerlink" title="æœ€åâ€¦â€¦"></a>æœ€åâ€¦â€¦</h2><p>æ¬¢è¿æµé‡å¤ªå¤šçš„ç›†å‹æ¥è·Ÿæˆ‘ä¸€èµ·åšworkerï¼åé¢æœ‰é™é€Ÿæ¥ï¼</p>
<p>ä¹Ÿå¸Œæœ›æœ‰äººèƒ½å¤Ÿå¸®æˆ‘è§£å†³preforkä¸‹çš„é‚£ä¸ªé—®é¢˜â€¦â€¦ğŸŒš ğŸŒš</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://github.com/pyrogram/pyrogram/issues/480">https://github.com/pyrogram/pyrogram/issues/480</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cnweike/article/details/105840936">https://blog.csdn.net/cnweike/article/details/105840936</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ytdlbot">https://github.com/tgbot-collection/ytdlbot</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/03/celery-bot/index/" data-id="clhp7rtev0015s2qraooceimd" data-title="åˆ†å¸ƒå¼Telegram Bot" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/01/08/actions-celery/index/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ä½¿ç”¨GitHub Actionsè·‘Celery worker
        
      </div>
    </a>
  
  
    <a href="/2021/12/25/docker-windows-container/index/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ä½¿ç”¨Dockerè·‘Windowsï¼</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/12/aca-php/index/">ç”¨ Azure Container Apps è¿è¡ŒPHPç½‘ç«™</a>
          </li>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps è¿æ¥åˆ°è™šæ‹Ÿæœºå¹¶é…ç½®CPUè‡ªåŠ¨ç¼©æ”¾</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">ä½¿ç”¨ Cloudflare Workerè·å–å›¾ç‰‡å…ƒæ•°æ®</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">å°† Cloudflare Workers è¿ç§»åˆ° Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-apiæ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ ClickHouse ä½œä¸ºæ—¥å¿—ç³»ç»Ÿ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Bennyå°åœŸè±†<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>