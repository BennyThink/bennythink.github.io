<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-r7000-ng386/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/27/r7000-ng386/index/" class="article-date">
  <time class="dt-published" datetime="2021-06-27T00:00:00.000Z" itemprop="datePublished">2021-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/27/r7000-ng386/index/">NETGEAR R7000升级NG386踩坑笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一直以来，我的NETGEAR R700使用的是Legacy的380固件，反正也能用，不差什么。但是一直都有一个很严重的问题，就是会panic然后自己重启。最频繁的情况下可能每开机几分钟就重启一次。</p>
<p>经过我的测试，发现这种情况会在大流量BT时比较频繁出现，Xbox下载游戏就从来不会。如果此时我在路由器上抓包，那么出现的概率似乎就更高了。</p>
<p>今天实在忍不了了，就想着升级一波吧。主要参考了这篇教程：</p>
<p><a target="_blank" rel="noopener" href="https://koolshare.cn/thread-193031-1-1.html">https://koolshare.cn/thread-193031-1-1.html</a></p>
<p>反正没少踩坑。</p>
<p><img src="/images/202106272044406.png"></p>
<h2 id="改cfe的mac地址"><a href="#改cfe的mac地址" class="headerlink" title="改cfe的mac地址"></a>改cfe的mac地址</h2><p>我有点没咋看明白他的意思，但是我猜测了一下，应该是去找原来路由器的eth0和eth1的mac地址，最后+4应该是把mac地址最后一位运算一下，比如最后一位是F3，那么就写F7.好歹我也曾是Enginerring - Network，这点问题还能难得倒我？</p>
<p>至少我是这么搞的……然后刷进去了。</p>
<p>在CFEEDIT里可以看到有这样的IP，记住啦</p>
<p>lan_ipaddr&#x3D;192.168.1.1<br>lan_netmask&#x3D;255.255.255.0</p>
<h2 id="无法进入miniWeb-Server"><a href="#无法进入miniWeb-Server" class="headerlink" title="无法进入miniWeb Server"></a>无法进入miniWeb Server</h2><p>连网线，改IP。这个IP其实就应该是上面CFE的那个IP</p>
<p>手动设定IP为192.168.1.11，ping 192.168.1.1，然后我ping通了，但是网页打不开。都快把人家屁股捅漏了，也打不开。各种尝试都不行。我都上nmap扫端口了。😠</p>
<p>后来实在没办法，Boot Camp启动到Windows，竟然打开了！我也不知道这是因为啥……有毒吧。🤬</p>
<p>miniWeb Server比较慢，上传固件也很慢，慢慢等就好了</p>
<h2 id="Wi-Fi重启自动关闭"><a href="#Wi-Fi重启自动关闭" class="headerlink" title="Wi-Fi重启自动关闭"></a>Wi-Fi重启自动关闭</h2><p>新的固件成功启动了，但是发现没Wi-Fi……在网上搜到可以在无线网络-专业设置里启用。但是每次重启之后又自动关闭了，我也不能每次都这么插网线搞啊。万一我不在家它自己重启了叫我怎么插网线啊🤬</p>
<p>后来找到个帖子： <a target="_blank" rel="noopener" href="https://koolshare.cn/thread-109794-1-1.html">https://koolshare.cn/thread-109794-1-1.html</a></p>
<p>算是解决了吧。似乎sleep没那么必要……，反正就放着吧也不差20秒，不想测试了。</p>
<p>benny@router:&#x2F;tmp&#x2F;home&#x2F;root# cat &#x2F;jffs&#x2F;scripts&#x2F;init-start<br>#!&#x2F;bin&#x2F;sh<br>sleep 20<br>nvram set wl0_radio&#x3D;1<br>nvram set wl1_radio&#x3D;1<br>nvram commit</p>
<p>service restart_wireless</p>
<h2 id="梯子始终是❌"><a href="#梯子始终是❌" class="headerlink" title="梯子始终是❌"></a>梯子始终是❌</h2><p>用的是这个项目 <a target="_blank" rel="noopener" href="https://github.com/hq450/fancyss">https://github.com/hq450/fancyss</a></p>
<p>下载地址在这里</p>
<p><a target="_blank" rel="noopener" href="https://github.com/hq450/fancyss_history_package/tree/master/fancyss_arm384">https://github.com/hq450/fancyss_history_package&#x2F;tree&#x2F;master&#x2F;fancyss_arm384</a></p>
<p>离线安装前先把koolshare傻逼非法关键词的功能干了。</p>
<p>但是配置完依旧是❌。后来发现它是用的httping做检测，那会不会是httping有问题？</p>
<p>benny@router:&#x2F;tmp&#x2F;home&#x2F;root# .&#x2F;httping<br>.&#x2F;httping: can’t load library ‘libssl.so.1.0.0’</p>
<p>果然🤔🤬🤦‍♀️</p>
<p>去<a target="_blank" rel="noopener" href="https://firmware.koolshare.cn/binary/httping/">这里</a>下载替换一个就好了</p>
<p>cd &#x2F;koolshare&#x2F;bin<br>wget <a target="_blank" rel="noopener" href="http://firmware.koolshare.cn/binary/httping/armv7/httping">http://firmware.koolshare.cn/binary/httping/armv7/httping</a><br>chmod +x httping</p>
<p>但是我好像harpoxy下还是各种❌，先跑单个节点算了吧。又不是不能用</p>
<h2 id="htop问题"><a href="#htop问题" class="headerlink" title="htop问题"></a>htop问题</h2><p>在刚刚那看到了htop，就想顺便也用上算了。</p>
<p>Error opening terminal: xterm-256color</p>
<p>🤨</p>
<p>查了一下，似乎export一下就可以了</p>
<p>export TERM&#x3D;xterm-256color</p>
<p>那我也不能每次运行时都export啊，这玩意它也没有zsh更没有oh-my-zsh，这让我这个记忆退化的老年痴呆怎么办。找环境变量文件呗，<code>/etc/profile, /etc/environment, /tmp/etc</code>….</p>
<p>真棒<code>/etc/profile</code>无权限写，因为这个文件系统是RO的。</p>
<p>后来发现是这个文件……<code>/jffs/configs/profile.add</code></p>
<h2 id="指示灯太闪"><a href="#指示灯太闪" class="headerlink" title="指示灯太闪"></a>指示灯太闪</h2><p>我一直不太喜欢指示灯，费我电不说，还闪瞎我狗眼。在设置里可以关掉。但是重启了之后又回来了……懒得研究太多了，反正这几行能管用</p>
<p>#!&#x2F;bin&#x2F;sh<br>nvram set led_disable&#x3D;1<br>nvram commit<br>service restart_leds</p>
<p>不过灯还是好多，之前是只有电源灯在亮，现在只是关掉了LAN 1234.啊算了就这样吧。哪天心情不好了拿黑胶带给它贴上。</p>
<p>加到启动项<code>/jffs/scripts/services-start</code> 好像不太好用，估计是时机不对。不管了手动执行算了吧。</p>
<h2 id="自定义启动项"><a href="#自定义启动项" class="headerlink" title="自定义启动项"></a>自定义启动项</h2><p>我的路由器上跑了一个自定义的网络相关的小程序，用Go写的，交叉编译成了armv7l的二进制，这次没想到加到<code>/jffs/scripts/services-start</code>里管用了。看来以后不用手动检查了。</p>
<p>nohup &#x2F;jffs&#x2F;xxx&amp;</p>
<p>管它优雅不优雅的，能跑就行。用奶子走路又怎么了啊！</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/06/2021062720570093.gif"><img src="/images/2021062720570093.gif"></a></p>
<h2 id="IP与mac地址绑定"><a href="#IP与mac地址绑定" class="headerlink" title="IP与mac地址绑定"></a>IP与mac地址绑定</h2><p>我的那个程序是写死了IP地址的，刷了固件之后原来的绑定全丢了。懒得再重新编译，直接重新绑定然后重启下设备就好了。</p>
<p>这个很好办了，WebUI上点点就好了。顺便把搜索域改成lan，我的那个程序也是写死了搜索域。别黑我了，今天就流行写死。</p>
<p><img src="/images/2021062720444046.png"></p>
<h2 id="日志系统"><a href="#日志系统" class="headerlink" title="日志系统"></a>日志系统</h2><p>为了更好的弄明白为什么它会自动重启，我觉得我需要把log保存起来。庆幸的是在固件的设置中可以找到远程记录服务器。那么我们只要配置一个syslog server就可以了。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/06/2021062812333552.png"><img src="/images/2021062812333552.png"></a></p>
<p>这方面的选择其实挺多的，VMware vRealize Log Insights，logstash+kibana+elastic search，loki，甚至SolarisWinds也有一个kiwi log server，这些都支持syslog。但是他们的缺点就是配置起来太麻烦！我的需求太简单了，能把syslog收下来存起来方便以后看，更好的话提供一个web界面省的我每次ssh打命令那就更好了。</p>
<p>简单的说，大部分发行版都有rsyslog这个东西，简单配置一下就可以拿来收日志了，可以参考这篇 <a target="_blank" rel="noopener" href="https://leeyr.com/330.html">https://leeyr.com/330.html</a></p>
<p>有能力的也可以手写，比如<a target="_blank" rel="noopener" href="https://github.com/mcuadros/go-syslog">go-syslog</a>这个库，很简单，注意logformat是RFC3164</p>
<p>package main</p>
<p>import (<br>   “fmt”<br>   “gopkg.in&#x2F;mcuadros&#x2F;go-syslog.v2”<br>)<br>func main() {<br>   channel :&#x3D; make(syslog.LogPartsChannel)<br>   handler :&#x3D; syslog.NewChannelHandler(channel)</p>
<p>   server :&#x3D; syslog.NewServer()<br>   server.SetFormat(syslog.RFC3164)<br>   server.SetHandler(handler)<br>   server.ListenUDP(“0.0.0.0:514”)<br>   server.Boot()</p>
<p>   go func(channel syslog.LogPartsChannel) {<br>      for logParts :&#x3D; range channel {<br>         fmt.Println(logParts)<br>      }<br>   }(channel)</p>
<p>   server.Wait()<br>}</p>
<p>用起来是这样滴</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/06/2021062812365940.png"><img src="/images/2021062812365940.png"></a></p>
<p>后来在GitHub上找到一个简单的工具<a target="_blank" rel="noopener" href="https://github.com/pierredavidbelanger/raftman">raftman</a>，自带了一个简单的UI，用SQLite存数据。</p>
<p>由于我们要用RFC3164的格式，因此稍微改下它的<code>Dockerfile</code></p>
<p>ENTRYPOINT [“&#x2F;usr&#x2F;local&#x2F;bin&#x2F;raftman”, “-frontend”, “syslog+udp:&#x2F;&#x2F;:514?format&#x3D;RFC3164”, “-frontend”, “ui+http:&#x2F;&#x2F;:8282&#x2F;“]</p>
<p>然后build</p>
<p>docker build -t raftman .</p>
<p>然后再起飞</p>
<p>docker run -d –restart&#x3D;always –name raftman \<br>-v &#x2F;tmp:&#x2F;var&#x2F;lib&#x2F;raftman \<br>-p 514:514&#x2F;udp \<br>-p 5514:5514 \<br>-p 8181:8181 \<br>-p 8282:8282 \<br>raftman</p>
<p>好的没问题。打开<a href="http://ip:8282就有了。">http://ip:8282就有了。</a></p>
<p>我知道我穿越了8个小时，我也不知道为啥，懒得去看代码啦。能用就行！</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/06/2021062812385946.png"><img src="/images/2021062812385946.png"></a></p>
<p>啊知道怎么fix这个啦，暴力点 <code>frontend/static/ui/index.js</code></p>
<p>var tsFormatter &#x3D; function (s) {<br>d &#x3D; new Date(s);<br>d.setHours(d.getHours() - 8);<br>return tsFormat(d);<br>};</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>差不多就踩了这么多坑，主要还是进miniweb浪费了太多时间，也不知道用Windows好了是不是偶然。</p>
<p>似乎可以直接升级AC68U的固件？我懒得折腾了。😠💢</p>
<p>感觉这个koolshare改的可能还会有各种bug，再不行我就换回原版……感觉还是padavan省心啊，但是MT7620似乎性能总是差了那么点。</p>
<p>好心累！本应该看洛基的，我却折腾了一下午这玩意……</p>
<p>本来人家心情就不好，还踩了这么多坑……怎么不坑底躺平得了呢。😫😖</p>
<p><strong>本文由暴躁Benny狂暴且抑郁地创作</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/27/r7000-ng386/index/" data-id="clhp7rtig0079s2qr14631dao" data-title="NETGEAR R7000升级NG386踩坑笔记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-encounter/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/22/encounter/index/" class="article-date">
  <time class="dt-published" datetime="2021-06-22T00:00:00.000Z" itemprop="datePublished">2021-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/22/encounter/index/">遇见</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前段时间的端午节假期，心情非常差劲。于是我便一个人出去散步，放松一下心情顺便当作锻炼身体了。在经过家附近的商场时，安慕希在促销，挺热闹的，我就过去围观了一会。</p>
<p>在人群中我看到了一个穿着白色连衣裙的女孩，看起来应该是工作人员。黑色的长长的头发，很优雅很有气质，是我喜欢的类型呀。于是我就在旁边装作路过的路人，默默地看了一晚上。</p>
<p>第二天下午，我又路过了那个商场，同样看到了她。于是我就坐在旁边，从下午呆到了晚上。心情还是像第一天假期那样差劲，不过在外面总比在家里发呆好，再加上这边有养眼的姑娘，那就更好了呀。</p>
<p>我在想，这个工作应该很辛苦吧，要一直站着，还要端着盘子去问经过的路人要不要品尝一下。我在旁边坐着都觉得很累，更何况是站着一直在忙呢。</p>
<p>期间看到姑娘在时不时的放松一下自己，一定很累，很饿吧，八点钟了还没办法去吃饭。尽管穿着运动鞋，腿也一定酸酸的。</p>
<p>那时，我在想，要不然我去搭讪吧，可是我又从来没这样做过，不知道该怎么说，被拒绝了怎么办。</p>
<p>那晚，她就站在我身边，被台上的表演逗笑了。就这样犹豫着过了第二天。</p>
<p>第三天，有一点下雨。我趁着雨停去看了，那个姑娘已经不在了。下午和晚上又分别去了一次，也没有看到她。</p>
<p>她应该是兼职吧，三天的假期，两天时间用来兼职，一天休息。真的很辛苦啊。</p>
<p>第四天，工作日，同样在下雨。雨停了之后我去看了一下，舞台已经撤走了，什么都没有了，一点痕迹都没有留下来。</p>
<p>第五天，第六天……</p>
<p>我猜，已经不会再见到这个姑娘了吧。我不知道她的名字，没有她的联系方式，甚至连她是做什么的都不知道。在这座2500万人的城市里，我再也见不到她了。</p>
<p>就算运气好真的见到了，那又能怎样。我真的能鼓起勇气去做什么吗？还是不要再抱有任何希望了。</p>
<p>希望对我而言，到最后，就是绝望。</p>
<p>「喜欢的人是不可能的，想要的东西是拿不到的，未来是看不见的。」</p>
<p>究竟要说多少次才能让自己记住这句话。明明已经知道结果了，就不要再挣扎了，不要再做无所谓的努力然后自我感动了。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/03/2018030604125565.jpeg"><img src="/images/2018030604125565.jpeg" alt="平匡与实栗"></a></p>
<p><strong>我才是那个每天都处在充满希望和坠入堕落里来回转换的人。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/22/encounter/index/" data-id="clhp7rtfu0028s2qr8aov6c7x" data-title="遇见" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-dockerhub-submodule/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/19/dockerhub-submodule/index/" class="article-date">
  <time class="dt-published" datetime="2021-06-19T00:00:00.000Z" itemprop="datePublished">2021-06-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/19/dockerhub-submodule/index/">Docker Hub与submodule踩坑小记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>大家都懂，使用 Docker分发应用是非常舒服畅快的事情！通常来说，如果我们在GitHub开源代码，通常也就会选择Docker Hub来构建镜像。当然啦，用GitHub Action，或者自己构建再提交也是一种办法哦。</p>
<p>怎么写Dockerfile，比如不同层级的RUN，正确应用multi stage build，那是另外一个话题啦。今天来说说在为 yyetsweb构建docker image的时候，我踩到的坑……</p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>说到环境变量，首先我们要区分一下运行时环境变量和构建时环境变量。</p>
<h3 id="运行时环境变量"><a href="#运行时环境变量" class="headerlink" title="运行时环境变量"></a>运行时环境变量</h3><p>我们在Dockerfile中使用 <code>ENV</code>定义的变量就可以算运行时环境变量啦，比如说这样：</p>
<p>ENV TZ&#x3D;Asia&#x2F;Shanghai</p>
<p>这个<code>TZ</code>变量会被容器中的程序直接读取使用。</p>
<h3 id="构建时环境变量"><a href="#构建时环境变量" class="headerlink" title="构建时环境变量"></a>构建时环境变量</h3><p>在构建时会被读取使用的变量，比如说在Docker Hub会有这样的设置：</p>
<p><img src="/images/2021061914224777.png"></p>
<p>那么这个变量就是可以在Dockerfile里使用：</p>
<p>RUN echo $REACT_APP_DOMAIN</p>
<p>使用的啦。</p>
<h2 id="我的使用"><a href="#我的使用" class="headerlink" title="我的使用"></a>我的使用</h2><p>因为前端的SPA应用要在构建时使用一些环境变量，所以我就在 Docker Hub的设置中加了这几个，但是似乎并没有生效。不知道为什么会这样，考虑到构建时会读取项目根目录下的 <code>.env</code>文件，那不如应用一下Docker Hub的hooks吧！</p>
<p>Docker Hub的build hooks一共有这么几种：</p>
<ul>
<li>hooks&#x2F;post_checkout</li>
<li>hooks&#x2F;pre_build</li>
<li>hooks&#x2F;post_build</li>
<li>hooks&#x2F;pre_test</li>
<li>hooks&#x2F;post_test</li>
<li>hooks&#x2F;pre_push (only used when executing a build rule or automated build )</li>
<li>hooks&#x2F;post_push (only used when executing a build rule or automated build )</li>
</ul>
<p>每一个hook都可以包含docker命令和各种bash命令。那对于我的场景来说， 创建一个<code>pre_build</code>就可以啦</p>
<p>#!&#x2F;bin&#x2F;bash<br>cat &lt;&lt; EOF &gt;&gt; YYeTsFE&#x2F;.env<br>SENTRY_ORG&#x3D;$SENTRY_ORG<br>SENTRY_PROJECT&#x3D;$SENTRY_PROJECT<br>SENTRY_AUTH_TOKEN&#x3D;$SENTRY_AUTH_TOKEN</p>
<p>REACT_APP_SENTRY_DSN&#x3D;$REACT_APP_SENTRY_DSN<br>REACT_APP_DOMAIN&#x3D;$REACT_APP_DOMAIN<br>REACT_APP_GA&#x3D;$REACT_APP_GA</p>
<h1 id="sourcemap"><a href="#sourcemap" class="headerlink" title="sourcemap"></a>sourcemap</h1><p>GENERATE_SOURCEMAP&#x3D;$GENERATE_SOURCEMAP<br>EOF</p>
<p>完美！</p>
<h2 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h2><p>使用git submodule继承其他项目是非常理想的一种开发方式。我们可以控制submodule跟踪到上游的哪一个commit，需要更新时只需要一个 <code>git submodule update --remote</code>，然后再把hash commit就可以啦。</p>
<p>Docker Hub在build时会自动clone相应的submodule，因此常规情况下来讲，大部分情况下都是可以顺利构建的。只不过有几点需要注意：</p>
<ol>
<li>docker hub执行的是shallow copy，因此只有最新的commit和对应的branch会被拉下来，因此如果你的build脚本是依赖了git branch和不同的commit，那会失败的哦。这个时候要用hooks来解决</li>
<li>private submodule需要一些额外设置，可以参考官网文档来解决</li>
<li>在module里执行git相关的命令，很有可能失败的哦（这可能是Docker Hub的bug，也有可能是git版本的问题）。</li>
</ol>
<p>我要详细的说下第三点🤣</p>
<p>在我的构建脚本中，我用了<code>git rev-parse --short HEAD</code> 来获取submodule的hash，然后把这个hash作为tag推送到sentry上。但是在构建日志中发现了这种错误：</p>
<p>-–&gt; Running in 4c09a0ea3725</p>
<p>yarn run v1.22.5</p>
<p>$ (export REACT_APP_SENTRY_RELEASE&#x3D;$(git rev-parse –short HEAD); react-scripts build &amp;&amp; node scripts&#x2F;sentry.js)</p>
<p>[91mfatal: not a git repository: &#x2F;src&#x2F;bt57w8kzzcjnpmscaemsqqq&#x2F;.git&#x2F;modules&#x2F;YYeTsFE</p>
<p>然而在本地完全是无法复现的，整个目录树如下，我保证Docker Hub在build时也有同样的结构：</p>
<p>$ tree -L 2 -a</p>
<p>|– .dockerignore<br>|– .git<br>| |– HEAD<br>| |– branches<br>| |– config<br>| |– description<br>| |– hooks<br>| |– index<br>| |– info<br>| |– logs<br>| |– modules<br>| |– objects<br>| |– packed-refs<br>| `– refs<br>|– .gitattributes<br>|– .gitignore<br>|– .gitmodules<br>|– .travis.yml<br>|– Dockerfile<br>|– Makefile<br>|– README.md<br>|– YYeTsFE<br>| |– .env.example<br>| |– .git<br>| |– .gitignore<br>| |– .sentryclirc<br>| |– README.md<br>| |– package.json<br>| |– public<br>| |– scripts<br>| |– src<br>| |– tsconfig.json<br>| `– yarn.lock</p>
<p>submodule也有.git，项目根目录也有.git，为什么就会失败呢？进行了无数次尝试，让Docker Hub一晚上疯狂构建😂</p>
<p>后来研究了一下，submodule的.git其实是一个到父目录<code>.git/modules/ModuleName</code>的引用。</p>
<p>~&#x2F;PycharmProjects&#x2F;YYeTsBot&#x2F;YYeTsFE (60c497b*) [02:06:51]<br>benny$ cat .git<br>gitdir: ..&#x2F;.git&#x2F;modules&#x2F;YYeTsFE</p>
<p>然而在 Docker Hub上，这个目录是绝对路径，并且是host的路径🤦‍♂️：</p>
<p>gitdir: &#x2F;src&#x2F;brp47ykf7wlmztspk2mtpl8&#x2F;.git&#x2F;modules&#x2F;YYeTsFE</p>
<p>这不报错就怪了。</p>
<p>解决方法也很简单，在hook中改掉<code>.git</code>文件，或者在Dockerfile中改掉，考虑到无法定位到问题究竟是出在Docker Hub还是git，我就选择在Dockerfile中搞啦</p>
<p>RUN echo “gitdir: ..&#x2F;.git&#x2F;modules&#x2F;YYeTsFE” &gt; .git</p>
<p>就这么一行代码，花了我两三个小时🌚🌚🤬</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>Docker Hub build hooks: <a target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/builds/advanced/">https://docs.docker.com/docker-hub/builds/advanced/</a></p>
<p>YYeTsBot: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot">https://github.com/tgbot-collection/YYeTsBot</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/19/dockerhub-submodule/index/" data-id="clhp7rtfx002as2qrcidr0r1z" data-title="Docker Hub与submodule踩坑小记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-pyinstaller-static-files/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/17/pyinstaller-static-files/index/" class="article-date">
  <time class="dt-published" datetime="2021-06-17T00:00:00.000Z" itemprop="datePublished">2021-06-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/17/pyinstaller-static-files/index/">使用pyinstaller嵌入静态资源</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在使用Go时，我经常会羡慕Go的出色的静态编译能力，更具体的说，纯Go写的程序会编译成一个零依赖的二进制文件，同时也可以非常轻松的做到交叉编译。甚至是，我可以把一些资源文件也编译到这个文件中。比如在 <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/DailyGakki">DailyGakki</a> 中，我便通过go-bindata把图片塞到了二进制文件中。暂且不提这样对文件大小、对性能有什么影响，只有一个文件就能过实现全部功能，是不是听起来很棒。</p>
<p>那么python能做到这点吗？当然也是能的啦，只是不是原生支持的啦。Python有一个东西叫做 pyinstaller，它会把python运行时的东西都打包起来，比如我们有这样一个程序<code>test.py</code>：</p>
<p>import time</p>
<p>def main():<br>    print(“Hello world at “, time.asctime())</p>
<p>if __name__ &#x3D;&#x3D; ‘__main__‘:<br>    main()</p>
<p>要打包成一个文件，就会用到<code>-F</code>参数：</p>
<p>pyinstaller -F test.py</p>
<p>pyinstaller 会生成一个<code>spec</code>文件，然后会在<code>dist</code>目录下生成一个<code>test</code>（对应windows就是<code>test.exe</code>），直接运行这个exe就好了。把这个exe拷贝到同平台其他电脑上，也是可以运行的。</p>
<p>当然，需要注意的是，别看这里也直接生成了二进制文件，但是这个二进制文件并不是加密的哦，用一些工具可以很容易的找到源代码的。</p>
<h2 id="ModuleNotFoundError"><a href="#ModuleNotFoundError" class="headerlink" title="ModuleNotFoundError"></a>ModuleNotFoundError</h2><p>由于Python是动态语言，我们可能会在运行时使用<code>importlib</code>或者<code>__import__</code>来import一些模块，花式操作。比如有如下代码：</p>
<p># test_lib.py<br>def even():<br>    print(0, 2, 4, 6, 8)</p>
<p>def odd():<br>    print(1, 3, 5, 7, 9)</p>
<h1 id="test-py"><a href="#test-py" class="headerlink" title="test.py"></a>test.py</h1><p>import time<br>import importlib</p>
<p>def main():<br>    module &#x3D; importlib.import_module(“test_lib”)<br>    if time.localtime().tm_sec % 2 &#x3D;&#x3D; 0:<br>        func_name &#x3D; “even”<br>    else:<br>        func_name &#x3D; “odd”</p>
<pre><code>fun = getattr(module, func\_name)
fun()
</code></pre>
<p>if __name__ &#x3D;&#x3D; ‘__main__‘:<br>    main()</p>
<p>没问题吧，动态导入module嘛，常规操作</p>
<p>❯ python3 test.py ⏎<br>1 3 5 7 9</p>
<p>当我们使用pyinstaller时是会无报错完成的，但是当我们运行时：</p>
<p>❯ dist&#x2F;test<br>Traceback (most recent call last):<br>File “test.py”, line 26, in <module><br>main()<br>File “test.py”, line 15, in main<br>module &#x3D; importlib.import_module(“test_lib”)<br>File “importlib&#x2F;__init__.py”, line 127, in import_module<br>File “&lt;frozen importlib._bootstrap&gt;”, line 1030, in _gcd_import<br>File “&lt;frozen importlib._bootstrap&gt;”, line 1007, in _find_and_load<br>File “&lt;frozen importlib._bootstrap&gt;”, line 984, in _find_and_load_unlocked<br>ModuleNotFoundError: No module named ‘test_lib’<br>[91513] Failed to execute script test</module></p>
<p>我们会发现无法执行</p>
<p>其实原因很简单啦。pyinstaller在build binary时，会有一个analysis的步骤去分析都有哪些module，使用<code>__import__</code>和<code>importlib</code>，甚至是<code>exec</code>、<code>eval</code>的都是无法被检测到的，所以在运行时就会报错啦。想要解决也很简单，<code>hidden-imports</code> 即可：</p>
<p>pyinstaller -F –hidden-import&#x3D;test_lib test.py</p>
<p>❯ dist&#x2F;test<br>1 3 5 7 9</p>
<p>这时就会发现没问题啦。</p>
<p>当然啦，这个参数也可以写在那个spec中的，后面会介绍的哦。</p>
<h2 id="嵌入资源文件"><a href="#嵌入资源文件" class="headerlink" title="嵌入资源文件"></a>嵌入资源文件</h2><p>如果我想把一些资源文件，比如html、css，甚至是sqlite嵌入到这个binary中，该怎么做呢？</p>
<p>pyinstaller提供了一个叫做 data 的东西，可以用于嵌入任何东西哦。当然了你要是把一段电影放进去，那咱也没什么意见，就运行时慢呗，毕竟还是要解压缩的。</p>
<p>考虑如下代码，<code>text.txt</code>是同级目录的一个普通文本文件</p>
<p>with open(“text.txt”) as f:<br>    text &#x3D; f.read()</p>
<p>print(text)</p>
<p>❯ .&#x2F;test_bin<br>Traceback (most recent call last):<br>File “test_bin.py”, line 10, in <module><br>FileNotFoundError: [Errno 2] No such file or directory: ‘text.txt’<br>[98107] Failed to execute script test_bin</module></p>
<p>我们会发现，哎呀，文件不在，找不到～</p>
<p>那么一种方法是，binary同级目录塞一个<code>text.txt</code>，这个方法就很简单了。另外一种做法是我们把这个txt塞进binary里！</p>
<p>命令行参数使用 <code>--add-data</code>，同时我们需要小改一下代码来使用绝对路径</p>
<p>import os</p>
<p>root_path &#x3D; os.path.dirname(__file__)<br>file_path &#x3D; os.path.join(root_path, “text.txt”)<br>with open(file_path) as f:<br>    text &#x3D; f.read()</p>
<p>print(text)</p>
<h1 id="然后这样哦"><a href="#然后这样哦" class="headerlink" title="然后这样哦"></a>然后这样哦</h1><p>pyinstaller -F –add-data “text.txt:.” test_bin.py</p>
<p><code>--add-data</code>的参数格式是 <code>src:dst</code>，<code>.</code>的含义是与py文件同级，如果你的脚本是打开的<code>test/test.txt</code>，那么就要 <code>test/test.txt:test/</code>哦。</p>
<p>benny@BennyのMBP:~&#x2F;PycharmProjects&#x2F;untitled&#x2F;dist $ .&#x2F;test_bin<br>this is a text file 1234</p>
<p>没问题哦。当然啦，只要你想玩，可以用<code>*</code>做通配符的哦。</p>
<h2 id="spec文件"><a href="#spec文件" class="headerlink" title="spec文件"></a>spec文件</h2><p>虽然说，在命令行中加参数总是能够解决我们的问题，但是这样每次输入长长的命令也真的是太累啦。有没有更简单的方法呢？当然有啦。比如你看是不是有一个test.spec?每次在你运行 <code>pyinstaller xxx.py</code> 时都会生成一个这样的文件。在这个spec中会有datas和hidenimport的选项，那就简单啦！</p>
<p>a &#x3D; Analysis([‘test.py’],<br>pathex&#x3D;[‘&#x2F;Users&#x2F;benny&#x2F;PycharmProjects&#x2F;untitled’],<br>binaries&#x3D;[],<br>datas&#x3D;[<br>(‘text.txt’, ‘.’),<br>],<br>hiddenimports&#x3D;[“test_lib”],<br>hookspath&#x3D;[],<br>runtime_hooks&#x3D;[],<br>excludes&#x3D;[],<br>win_no_prefer_redirects&#x3D;False,<br>win_private_assemblies&#x3D;False,<br>cipher&#x3D;block_cipher,<br>noarchive&#x3D;False)</p>
<p>[v_blue]吐槽一下，data不是datum的复数形式嘛，这个datas是什么鬼哟哈哈哈[&#x2F;v_blue] 没问题，让我们重新运行一次！请记得要用这个spec文件而不是py文件哦。</p>
<p>pyinstaller -F test.spec</p>
<p>❯ .&#x2F;test<br>0 2 4 6 8<br>this is a text file 1234</p>
<p>[benny@BennyのMBP] ~&#x2F;PycharmProjects&#x2F;untitled&#x2F;dist<br>❯ .&#x2F;test<br>1 3 5 7 9<br>this is a text file 1234</p>
<p>一点问题都没有呐！这个data我们也可以弄得很复杂，比如这样的</p>
<p>[<br>  ( ‘src&#x2F;README.txt’, ‘.’ ),<br>  ( ‘&#x2F;mygame&#x2F;data’, ‘data’ ),<br>  ( ‘&#x2F;mygame&#x2F;sfx&#x2F;*.mp3’, ‘sfx’ )<br>]</p>
<h2 id="一些后话"><a href="#一些后话" class="headerlink" title="一些后话"></a>一些后话</h2><p>我们可以用datas选项嵌入文件，我们其实也可以用binaries选项嵌入一些dll&#x2F;so&#x2F;dylib文件。比如说，我可以用msf那一套生成一个反弹的dll，然后……</p>
<p>binaries&#x3D;[ ( ‘reverse_shell.dll’, ‘.’ ) ]</p>
<p>🤣🤣🤣🤣</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>我的YYeTsWeb就使用这种方式嵌入了很多html&#x2F;css&#x2F;js，以及SQLite数据库。也就是只要下载回来这个文件，双击一下，你的本地就可以有一个能够运行的yyets啦！别怪我没说，运行陌生的exe文件是很危险的，说不准就有人丢了一个奇怪的dll文件进去。不过我没有这么做啦，信不信由你好了。</p>
<p>yyetsweb依赖一些环境变量，所以直接双击<code>start_windows.bat</code>就好了；macOS用户可以用<code>start_unix.sh</code>。至于Linux用户，你都用Linux了，还用得着我弄的小白一键启动？自己搞去。</p>
<p><img src="/images/2021061722350131.jpeg"></p>
<p>这个exe可能启动会比较慢，boostrap过程解压缩比较耗时，毕竟是会冒出来一个几百兆的SQLite文件呢。macOS上由于<a target="_blank" rel="noopener" href="https://support.apple.com/en-us/HT202491">GateKeeper</a>机制的存在，估计就更慢了吧🙄️</p>
<p>运行效果，偷懒，我就直接用了旧版页面，没有把新版也搞过来。</p>
<p><img src="/images/2021061722350312.jpeg"></p>
<p>资源页面也是旧版的</p>
<p><img src="/images/2021061722350345.jpeg"></p>
<p>反正怎么说，可以离线使用了，哪天万一网站挂了，手里有这个文件也不慌呀～</p>
<p>下载地址可以看 <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/releases/tag/2021-06-17">GitHub Release</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>Using Spec Files <a target="_blank" rel="noopener" href="https://pyinstaller.readthedocs.io/en/stable/spec-files.html">https://pyinstaller.readthedocs.io/en/stable/spec-files.html</a></p>
<p>When Things Go Wrong <a target="_blank" rel="noopener" href="https://pyinstaller.readthedocs.io/en/stable/when-things-go-wrong.html">https://pyinstaller.readthedocs.io/en/stable/when-things-go-wrong.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/17/pyinstaller-static-files/index/" data-id="clhp7rti8006vs2qrcp3678bk" data-title="使用pyinstaller嵌入静态资源" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-aeru/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/05/aeru/index/" class="article-date">
  <time class="dt-published" datetime="2021-06-05T00:00:00.000Z" itemprop="datePublished">2021-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/05/aeru/index/">また会える</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在椅子上坐了半个多小时，也不知道想要写点什么，但是又总觉得要写点什么，明明脑海里有万千思绪，但是却不知道该从何下笔。几年之前也有过类似的感觉，但是完全不记得后来是怎么好起来的。</p>
<p>不过既然如此，既然已经在这坐了半个多小时，那也就把自己最近的所思所想全部记录下来吧。没有逻辑就没有逻辑吧，想到哪说哪。说到底，这个博客只是我个人的一个小天地，是用来为我自己做记录的，我只是觉得差不多到了阶段性记录的时候。</p>
<p>首先呢，我觉得要先从自身的身心状态说起。到上海已经一年多了，也同样给自己独居生活增加了一年。</p>
<p>上海这座城市，怎么说呢，我很喜欢呀，我喜欢这种繁华，当然最主要的还是在上海收入比较高，也在做着自己擅长的工作。在上海我几乎没有朋友，所有的朋友还都是在来到上海之前认识的。我从未想过去交朋友，因为我很慢热，不太喜欢认识新的人，对于我而言亲密关系的建立也是很困难的事情，因此也不可能喜欢上谁。这应该算是一种社交恐惧吧。</p>
<p>我现在大概处于一种“低欲望”的生活状态，每个月的支出中，房租水电占据了一半，剩下几乎就是日常吃喝和超市了。即使是去超市，我买的东西也是非常固定的，我一定会买牛奶，一定会买酸奶，然后再买点应季水果，休闲零食也几乎只会有瓜子。</p>
<p>在正常没有意外的情况下，我的支出比例差不多就是这样固定，当然有时会有意外情况的。比如每年4月我会支出$199，用于续费JetBrains全家桶；每年总有一段时间是要买机票的，说不准还会被航空公司当天取消航班，然后只能加钱买当天机票；说不准改天手机丢了坏了，总是要花钱买新的。</p>
<p>说到支出，那就一定要提到收入。我的收入嘛，绝大部分还是要靠工资的。还有一小部分是靠着善良网友的捐赠，感谢你们的支持呀，我会继续把人人影视的遗产维护下去的。</p>
<p>我似乎已经没什么太大的物质欲望了。我对吃的不感兴趣，每天只要能填饱肚子能够让我生存下去就好；我对电子产品也没什么兴趣了，什么都有，也不需要买新的；我对买游戏也没兴趣，这要多亏了Xbox Game Pass Ultimate，玩游戏还是有些兴趣的；天呐我都不买衣服鞋子了。感觉对什么都提不起兴趣，也就对IT，还保持着一些兴趣和热枕吧。</p>
<p>最近是不是有一个词“躺平”特别火？我这算不算也躺平了？没有任何购买消费欲望，不买车，不结婚，不买房，也不生娃。躺平可能更有点像破罐子破摔的样子，也许我这更像是“断舍离”，斩断对物质生活过多的欲望，过着简单清爽的生活。</p>
<p>甚至在每次买计划之外的东西的时候，我都在想，我真的需要这个东西吗，这个东西适合我吗？假如给我等值的钱，和这个东西，我选择哪个？</p>
<p>其实呀我也想买车，这样我的活动半径就会扩大很大，我可以不用去哪全靠自行车和公共交通了，尽管买个代步车买菜车对于我来说还是没问题的，但是现阶段觉得这暂时没太大用处；我也想结婚呀，可是老婆已经嫁给了星野源，可是谁愿意嫁给我呀；我也想买房呀，有属于自己的真正的住处是很好的一件事情，可是……这个我是真的买不起呀，想想自己背负着几百万的贷款，还要维持收入几十年不变低，每天只有十元零花钱，哎。</p>
<p>所以这些都不要想了啦。低欲望不是没有欲望，有时那些“小确幸”也足够满足欲望了。吃饱了就可以很幸福，所以吃什么都可以哦。努力把工作做好，领到薪水，就像这样。</p>
<p>本来还想着有空去豆瓣躺平小组看看，这下可好，没得看了。「我们不解决问题，我们只解决提出问题的人」</p>
<blockquote>
<p>感觉就像是，「你看着身边的人都在往一个方向走，自己却站在原地，甚至要走反方向。你看着身边的人都在做某件事情，可是你却没有做这件事情的想法，甚至都不做。就会觉得，孤独，觉得自己好像被世界遗弃了一样格格不入。更重要的是，其他人走一个方向，是充满信心的走下去的，是有目标的。但是像我这种留在原地，甚至反方向，其实并不知道接下来要去向何处。感觉身边的人都找到了自己的方向，但是我却不知道自己的方向是什么，或者明知道自己的方向是什么，但是眼前隔了几座山，感到力不从心」</p>
<p>这一切，只要安慰自己「孤独是生而为人的宿命」就好了</p>
<p>我一个人也可以活的很好，我就是不想顺流而下。</p>
<p>我是明明有药可救的，可是我却选择放弃治疗。</p>
<p>只要我把我家里的钱拿上，再加上自己的积蓄，买房这件事情，问题应该不算很大</p>
<p>所以你看我这就是分明有药可救，但是却自己内心放弃治疗了</p>
<p>可能是吧，如果家里一个孩子还好，我能更心安理得一些，但是两个孩子，就真的非常不想花父母的钱了。</p>
<p>而且我妈明确的和我说过“这钱就是留着给你买房首付的”</p>
<p>就是不心安理得啊。家里俩孩子，父母一辈子的财产却只给男孩，我觉得这样对女孩不公平。</p>
<p>只是因为她是女孩，比我大，并且已经嫁出去了，这些钱我就可以心安理得的拿着用吗？</p>
<p>这是一方面原因。另一个原因是，我可能有些要强吧。好不容易获得了经济独立，不想再次涉及这些。虽说我的家庭非常和睦，不存在“生活在父母的阴影下”，但是我就是觉得这样会让我心理很不是滋味。我父母的钱是我父母的钱，不是我的钱</p>
<p>就像很多人毕业时会毕业游（那时候我还好，有一些积蓄了，已经经济独立半年了），我只能感叹：其他人都在毕业游，我却只能为生活奔波</p>
<p>我觉得这样子对女孩子很不公平</p>
<p>总结下来，我太要强了，或者说太傻了</p>
<p>反正就是你看，我觉得我和一些“主流价值观”格格不入，我不知道这是因为中国文化的原因，还是怎么的，就总感觉自己是个freak啊</p>
<p>对于我来说，“传统文化 传统习俗”等等并不是可以让我奉行的理由。</p>
<p> </p>
<p>【你真的会觉得是自己太怪了 而不是别人的想法观念有问题嘛？】</p>
<p>我不知道，想法和观念这种东西，我觉得没有对错之分吧。</p>
<p>【有啊比如重男轻女】</p>
<p>大部分情况下来说是这样的吧，不过我觉得这个有点更倾向于观点了。其实我一直在非常努力的区分“事实和观点”，我一直觉得“事实与观点”中，事实是客观的，观点是因人而异的。对于我来说我的观点是“我认为xxx是不妥的”，但是对于支持者来说就不是了。当然有些观点可能也许会变成事实，比如“日心说”</p>
<p>当然了，你不要理解错了，我可没有一个字说我喜欢男孩不喜欢女孩。我是支持性别平等的哦。</p>
<p>当然，我也没有为“重男轻女”辩护，实际上我也是不喜欢并反感这种传统思想的，实际上很多传统思想什么的我都不喜欢</p>
<p>【如果年轻人都能像你这样想 我们的压力就不会这么大了把】</p>
<p>那么子弹就不够用了</p>
<p>你想，既然能轻轻松松的活着，为什么非要让自己活得这么累呢？即使自我感觉良好，感觉自己是更具有包容性的，那又能怎么样啊🤦‍♀️「想这么多不累吗，为什么不西瓜可乐」</p>
<p>所以可能你更能理解我为什么想要去新的环境了吧</p>
<p>我无法改变这些，那我只好换个环境了</p>
<p>【咱俩是不是聊的太深刻了】</p>
<p>还不够深刻。在微信上很多话题我都是避而不谈的，但是我很讨厌这样的自己，我很讨厌自我审查，可是我又不得不这么做。你看，「最终还是活成了自己讨厌的样子」</p>
<p>我们的生活就好比种地，大家都在种水稻（结婚买房子），但是有的人种的是苹果，乍一看有点突兀，他们会怀疑自己是不是走的不对，其实只要产出的东西是有价值的，最后都能满足自己，所以和别人不一样也没关系，重要的是结果是不是自己想要的。</p>
<p>2020-11-02</p>
</blockquote>
<p> </p>
<hr>
<p> </p>
<p><img src="/images/2021060512110440.jpeg" alt="《逃避可耻却有用》新春SP"></p>
<p>我们还会再见面吗？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/05/aeru/index/" data-id="clhp7rtdv0007s2qr596vc43o" data-title="また会える" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-argo-tunnel/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/argo-tunnel/index/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T00:00:00.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cloudflare/">cloudflare</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/argo-tunnel/index/">Cloudflare Argo Tunnel 小试：我终于可以用树莓派做网站啦</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p> </p>
<p>之前，如果想用树莓派之类的设备去做网站，方法一是需要想办法弄到一个公网IP，无论是直接从运营商要，还是在阿里云、腾讯云上做frps之类的内网穿透，都挺麻烦的；方法二是如果有IPv6，那么就去做v6only的解析，并且这个IPv6的地址还可能会经常变，这样就会使得网站可用性变得非常差，并且v4用户就惨了。</p>
<p>现今，Cloudflare Argo Tunnel已经免费开放啦。这个东西有什么用呢？简单的来说就是在任何可以访问cloudflare的机器和cloudflare中搭建一个安全的加密隧道，然后这个隧道可以用来承载很多不同种类型的流量，比如说http（会被自动换成https），tcp，ssh，smb，rdp，甚至是unix套接字都可以哦。</p>
<p>也就是说，只要你在家里的机器上一顿操作，那么你家里的机器就可以通过cloudflare的网络来达到全球可以访问的目的了。听起来是不是很棒！</p>
<p>总结下来这样做大概有这几步：</p>
<ol>
<li>注册cloudflare账号</li>
<li>（可选）把域名的ns改成cloudflare</li>
<li>安装cloudflared并登录</li>
<li>创建argo tunnel</li>
<li>创建dns记录</li>
<li>配置tunnel</li>
<li>运行</li>
</ol>
<p>本文以Raspberry Pi 3 + Ubuntu 20.04为例</p>
<h2 id="注册cloudflare账号"><a href="#注册cloudflare账号" class="headerlink" title="注册cloudflare账号"></a>注册cloudflare账号</h2><p>略……</p>
<h2 id="把域名的ns改成cloudflare"><a href="#把域名的ns改成cloudflare" class="headerlink" title="把域名的ns改成cloudflare"></a>把域名的ns改成cloudflare</h2><p>这一步是可选的，Argo Tunnel会提供一个默认的域名，当然如果能用自己的域名就更好啦。</p>
<h2 id="安装cloudflared并登录"><a href="#安装cloudflared并登录" class="headerlink" title="安装cloudflared并登录"></a>安装cloudflared并登录</h2><p>具体的话，可以参考<a target="_blank" rel="noopener" href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup">这篇官方文档</a>。我的树莓派是aarch64的架构，也就是arm64.</p>
<p>wget -O cloudflared <a target="_blank" rel="noopener" href="https://github.com/cloudflare/cloudflared/releases/download/2021.4.0/cloudflared-linux-arm64">https://github.com/cloudflare/cloudflared/releases/download/2021.4.0/cloudflared-linux-arm64</a><br>chmod +x cloudflared<br>sudo cp cloudflared &#x2F;usr&#x2F;loca&#x2F;bin&#x2F;</p>
<p>然后就可以开始登录啦！</p>
<p>cloudflared tunnel login</p>
<p>然后再打开的页面中选择你的域名～Pi 那边大概会有如下输出：</p>
<blockquote>
<p>You have successfully logged in.</p>
<p>If you wish to copy your credentials to a server, they have been saved to:</p>
<p>&#x2F;home&#x2F;benny&#x2F;.cloudflared&#x2F;cert.pem</p>
</blockquote>
<h2 id="创建argo-tunnel"><a href="#创建argo-tunnel" class="headerlink" title="创建argo tunnel"></a>创建argo tunnel</h2><p>cloudflared tunnel create <NAME></NAME></p>
<p>这条命令会输出一个tunnle UUID</p>
<p>name可以自己随便取一个，比如说Pi啦～Yui啦～随便的啦</p>
<p>想要查看tunnel列表，可以使用 <code>cloudflared tunnel list</code></p>
<p>很明显，想要删除，那就delete啦 <code>cloudflared tunnel delete pi</code></p>
<h2 id="创建DNS记录"><a href="#创建DNS记录" class="headerlink" title="创建DNS记录"></a>创建DNS记录</h2><p>有两种办法，一种是去cloudflare dashboard中创建一条道<code>id. cfargotunnel.com</code>的CNAME解析，另外一种是使用cli命令～</p>
<p>那比如说我要创建一个abcd.dmesg.app，那么就可以这样做</p>
<p>cloudflared tunnel route dns <UUID or name> abcd.dmesg.com</UUID></p>
<p>或者在网页上这样添加，结果是一样滴</p>
<p><img src="/images/2021041713264377.png"></p>
<p>此时如果你访问abcd.dmesg.app，会看到1033错误的哦，因为我们的tunnel还没有运行。</p>
<h2 id="配置tunnel"><a href="#配置tunnel" class="headerlink" title="配置tunnel"></a>配置tunnel</h2><p>那么接下来就需要在树莓派上配置如何tunnel了，一个最简单的例子是这样的：</p>
<p>tunnel: pi<br>credentials-file: &#x2F;home&#x2F;benny&#x2F;.cloudflared&#x2F;af4d19d0-7fb1-40ea-88b7-97036c026ca4.json</p>
<p>ingress:</p>
<ul>
<li>hostname: pi.dmesg.app<br>service: <a target="_blank" rel="noopener" href="http://localhost:8000/">http://localhost:8000</a></li>
<li>service: http_status:404</li>
</ul>
<p>其中hostname就是上面的那个域名，service表示我们要承载什么流量，如果想要承载ssh，那么就<code>service: ssh://localhost:22</code>就好了。</p>
<p>最开始的uuid同样可以替换成tunnel name</p>
<p>然后我们……</p>
<p>cloudflared tunnel –config ~&#x2F;tunnel.yml run</p>
<p>如果不想写这种配置文件，那么可以一条cli解决</p>
<p>cloudflared tunnel run –url localhost:8000 <NAME or uuid></NAME></p>
<p>看到一大串输出，没有报错，那我们的tunnel就成功了。当然树莓派上8000还没有程序在监听，那我们再赶紧开一个吧</p>
<p>docker run -d -p 127.0.0.1:8000:80 nginx:alpine</p>
<p>这个时候打开浏览器刷新一下，你的页面就已经出来啦！</p>
<p><img src="/images/2021041713264488.png"></p>
<h3 id="以服务模式运行"><a href="#以服务模式运行" class="headerlink" title="以服务模式运行"></a>以服务模式运行</h3><p>当然了，咱不能开个screen去运行argo tunnel啊……</p>
<p>那么执行这条命令来安装服务</p>
<p># 需要有～&#x2F;.cloudflared&#x2F;config.yaml<br>sudo cloudflared service install</p>
<h1 id="指定配置文件位置"><a href="#指定配置文件位置" class="headerlink" title="指定配置文件位置"></a>指定配置文件位置</h1><p>cloudflared –config CONFIG-FILE service install</p>
<p>这个时候哪怕重启都不怕啦😨</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://developers.cloudflare.com/cloudflare-one/tutorials/single-command">Create and connect an application with a single command</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.outv.im/2021/cloudflared-tunnel/#%E8%B7%B3%E6%9D%BF%E6%9C%BA%EF%BC%88-bastion%EF%BC%89">用 Cloudflare Tunnel 进行内网穿透 | Re:Linked</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/17/argo-tunnel/index/" data-id="clhp7rtei000ps2qradl41fjl" data-title="Cloudflare Argo Tunnel 小试：我终于可以用树莓派做网站啦" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ufw-vs-docker/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/10/ufw-vs-docker/index/" class="article-date">
  <time class="dt-published" datetime="2021-04-10T00:00:00.000Z" itemprop="datePublished">2021-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/10/ufw-vs-docker/index/">我的ufw怎么又不好用了？使用docker时如何拒绝非cloudflare访问</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>事情是这样的，我想让我的网站的80和443端口只接受cloudflare的访问，直接访问会被拒绝。</p>
<p>嗨，这还不简单嘛！先给入网加规则，当然要记得先加ssh的规则，然后再给policy设置成DROP，多大点事！</p>
<p>iptables -I INPUT -p tcp –dport 22 -j ACCEPT<br>iptables -I INPUT -s 192.168.7.67 -p tcp –dport 80 -j ACCEPT<br>iptables -P INPUT DROP</p>
<p>查看下INPUT的规则确定一下没问题</p>
<p>[~] iptables -L INPUT<br>Chain INPUT (policy DROP)<br>target prot opt source destination<br>ACCEPT tcp – 192.168.7.67 anywhere tcp dpt:http<br>ACCEPT tcp – anywhere anywhere tcp dpt:ssh</p>
<p>嗯，没问题！</p>
<p>大部分情况下，这是没问题的……但是如果你的应用是用docker起的，比如说</p>
<p>docker run -d -p 80:80 nginx</p>
<p>那么你会惊喜的发现，这规则好像没用……80端口还是能够从非192.168.7.67以外的IP访问。</p>
<p>那上ufw！</p>
<p>ufw allow ssh<br>ufw allow proto tcp from 192.168.7.67 to any port 80,443<br>ufw enable</p>
<p>嗯……还是没用，毕竟ufw其实也是在操作iptables的嘛。</p>
<p>嗯，因为docker的话，会新建一个DOCKER的链，如果容器使用<code>-p</code>绑定了端口，那么doker会自动去修改对应的iptables规则。</p>
<p>所以从现象上来看就是docker在你的防火墙上打了一个洞……</p>
<hr>
<p><img src="/images/2021041016413552.png"></p>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>其实我的需求很简单，非cloudflare IP无法访问80&#x2F;443。额外的，我还需要开放UDP的80和443，wireguard在用的。22也是要的，也就顺便开了UDP 22备用吧。当然，以上需求包涵IPv4和IPv6。</p>
<p>具体来说，我想到了这样几种有效的解决方案：</p>
<ol>
<li>在厂商防火墙做配置</li>
<li>nginx配置allow deny规则</li>
<li>宿主机nginx做proxy，将docker 的端口绑定到127.0.0.1</li>
<li>让docker臣服于ufw……</li>
</ol>
<h2 id="厂商防火墙配置"><a href="#厂商防火墙配置" class="headerlink" title="厂商防火墙配置"></a>厂商防火墙配置</h2><p>这是最简单也的方案了，有些VPS厂商提供一个防火墙配置，有的也称为安全组，然后绑定到自己的机器就好了，就是cloudflare的IP有点多……改起来麻烦了点……</p>
<p>比如vultr的防火墙是这样的，自己改改就差不多了。</p>
<p><img src="/images/2021041016413957.png"></p>
<h2 id="nginx配置allow-deny规则"><a href="#nginx配置allow-deny规则" class="headerlink" title="nginx配置allow deny规则"></a>nginx配置allow deny规则</h2><p>以下均是配置容器中的nginx</p>
<h3 id="一般情况"><a href="#一般情况" class="headerlink" title="一般情况"></a>一般情况</h3><p>这个其实很简单的啦，自己补全下IP</p>
<p># <a target="_blank" rel="noopener" href="https://www.cloudflare.com/ips">https://www.cloudflare.com/ips</a></p>
<h1 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h1><p>allow 103.21.244.0&#x2F;22;</p>
<h1 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h1><p>allow 2400:cb00::&#x2F;32;<br>deny all; # deny all remaining ips</p>
<h3 id="启用set-real-ip-from"><a href="#启用set-real-ip-from" class="headerlink" title="启用set_real_ip_from"></a>启用set_real_ip_from</h3><p>如果你启用了<code>set_real_ip_from</code>，那么如果像上面那样操作，那就全部都403啦！</p>
<p>正确的操作姿势是这样的……</p>
<p>geo $realip_remote_addr $cloudflare_ip {<br>    default 0;</p>
<pre><code>103.21.244.0/22 1;
2a06:98c0::/29 1;
</code></pre>
<p>}</p>
<p>然后在对应的server段中：</p>
<p>if ($cloudflare_ip !&#x3D; 1) {<br>    return 403;<br>}</p>
<p>嗯，这样就可以了！</p>
<h2 id="宿主机nginx做proxy"><a href="#宿主机nginx做proxy" class="headerlink" title="宿主机nginx做proxy"></a>宿主机nginx做proxy</h2><p>还有一种方式是，将docker的端口绑定到127.0.0.1，然后宿主机安装nginx做proxy_pass，之后配置宿主机的nginx allow deny或者iptables。这种方式也可以的，比较简单，就不多说啦～🤣</p>
<h2 id="让docker臣服于ufw"><a href="#让docker臣服于ufw" class="headerlink" title="让docker臣服于ufw"></a>让docker臣服于ufw</h2><p>要做到这一点，我们同时要保证：容器互通、并且通外网。当然，禁用docker的iptables功能也是可以的，就是比较麻烦，咱就想能不能让这二人和谐共处……</p>
<p>操作起来其实很简单。不过先要做一些准备工作，比如说恢复docker的iptables功能，清除INPUT中的可能冲突的规则……然后：</p>
<h3 id="修改ufw配置"><a href="#修改ufw配置" class="headerlink" title="修改ufw配置"></a>修改ufw配置</h3><p>修改 <code>/etc/ufw/after.rule</code>s 最后加上如下规则</p>
<p># BEGIN UFW AND DOCKER</p>
<h1 id="BEGIN-UFW-AND-DOCKER"><a href="#BEGIN-UFW-AND-DOCKER" class="headerlink" title="BEGIN UFW AND DOCKER"></a>BEGIN UFW AND DOCKER</h1><p>*filter<br>:ufw-user-forward - [0:0]<br>:ufw-docker-logging-deny - [0:0]<br>:DOCKER-USER - [0:0]<br>-A DOCKER-USER -j ufw-user-forward</p>
<p>-A DOCKER-USER -j RETURN -s 10.0.0.0&#x2F;8<br>-A DOCKER-USER -j RETURN -s 172.16.0.0&#x2F;12<br>-A DOCKER-USER -j RETURN -s 192.168.0.0&#x2F;16</p>
<p>-A DOCKER-USER -p udp -m udp –sport 53 –dport 1024:65535 -j RETURN</p>
<p>-A DOCKER-USER -j ufw-docker-logging-deny -p tcp -m tcp –tcp-flags FIN,SYN,RST,ACK SYN -d 192.168.0.0&#x2F;16<br>-A DOCKER-USER -j ufw-docker-logging-deny -p tcp -m tcp –tcp-flags FIN,SYN,RST,ACK SYN -d 10.0.0.0&#x2F;8<br>-A DOCKER-USER -j ufw-docker-logging-deny -p tcp -m tcp –tcp-flags FIN,SYN,RST,ACK SYN -d 172.16.0.0&#x2F;12<br>-A DOCKER-USER -j ufw-docker-logging-deny -p udp -m udp –dport 0:32767 -d 192.168.0.0&#x2F;16<br>-A DOCKER-USER -j ufw-docker-logging-deny -p udp -m udp –dport 0:32767 -d 10.0.0.0&#x2F;8<br>-A DOCKER-USER -j ufw-docker-logging-deny -p udp -m udp –dport 0:32767 -d 172.16.0.0&#x2F;12</p>
<p>-A DOCKER-USER -j RETURN</p>
<p>-A ufw-docker-logging-deny -m limit –limit 3&#x2F;min –limit-burst 10 -j LOG –log-prefix “[UFW DOCKER BLOCK] “<br>-A ufw-docker-logging-deny -j DROP</p>
<p>COMMIT</p>
<h1 id="END-UFW-AND-DOCKER"><a href="#END-UFW-AND-DOCKER" class="headerlink" title="END UFW AND DOCKER"></a>END UFW AND DOCKER</h1><h3 id="重启ufw"><a href="#重启ufw" class="headerlink" title="重启ufw"></a>重启ufw</h3><p>systemctl restart ufw</p>
<h3 id="添加规则"><a href="#添加规则" class="headerlink" title="添加规则"></a>添加规则</h3><p>开始愉快的添加规则吧</p>
<p>ufw allow 22<br>ufw allow proto udp to any port 80,443</p>
<p>for i in `curl <a target="_blank" rel="noopener" href="https://www.cloudflare.com/ips-v4/%60">https://www.cloudflare.com/ips-v4\`</a>; do ufw route allow proto tcp from $i to any port 80,443; done<br>for i in `curl <a target="_blank" rel="noopener" href="https://www.cloudflare.com/ips-v6/%60">https://www.cloudflare.com/ips-v6\`</a>; do ufw route allow proto tcp from $i to any port 80,443; done</p>
<p>ufw enabler</p>
<p>如果你想额外的添加一些IP的话，那就依样画葫芦：</p>
<p>ufw route allow proto tcp from 1.1.1.1 to any port 80,443;</p>
<p>好的！设置完成！找台机器改hosts 之后用curl试试吧！</p>
<h3 id="我警告你们……"><a href="#我警告你们……" class="headerlink" title="我警告你们……"></a>我警告你们……</h3><p>如果你的服务器也开启了WireGuard，并且是使用了WireGuard的转发功能的，那么请记得开ufw forward。举个例子：</p>
<p>我有ABC三台服务器，B是WireGuard“服务器”，A和C都连接到了B。如果A想要访问C上的ssh，或者反过来，那么就要开forward，否则会不通哦。</p>
<p>当然啦，前提是要先开<code>net.ipv4.ip_forward=1</code>以及<code>net.ipv6.conf.all.forwarding = 1</code>，否则有没有ufw，AC都不通的哦。</p>
<p>vim &#x2F;etc&#x2F;defaut&#x2F;ufw<br>DEFAULT_FORWARD_POLICY&#x3D;”ACCEPT”</p>
<h1 id="或者下面这个也可"><a href="#或者下面这个也可" class="headerlink" title="或者下面这个也可"></a>或者下面这个也可</h1><p>ufw default allow routed</p>
<h1 id="也要记得放行哦"><a href="#也要记得放行哦" class="headerlink" title="也要记得放行哦"></a>也要记得放行哦</h1><p>ufw allow from 192.168.6.0&#x2F;24 to 192.168.6.1</p>
<p>如果你的容器需要访问宿主机，还要记得这样加一行</p>
<p>ufw allow from 172.16.0.0&#x2F;12 to 172.17.0.1</p>
<h3 id="禁用ufw"><a href="#禁用ufw" class="headerlink" title="禁用ufw"></a>禁用ufw</h3><p>如果此时你是用ufw disable来禁用ufw，会发现容器无法在外部访问。此时需要这么做：</p>
<p>sudo iptables -I DOCKER-USER 1 -j RETURN</p>
<p>这样可以暂时bypass掉ufw规则了。</p>
<p>使用如下命令查看规则</p>
<p>sudo iptables -n -L DOCKER-USER</p>
<p>使用这个命令删除规则，不过这个时候就记得要<code>ufw enable</code>哦</p>
<p>sudo iptables -D DOCKER-USER 1</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>ufw-docker： <a target="_blank" rel="noopener" href="https://github.com/chaifeng/ufw-docker">https://github.com/chaifeng/ufw-docker</a></p>
<p>让 docker 向 UFW 低头： <a target="_blank" rel="noopener" href="https://keng42.com/blog/article/docker-ufw/">https://keng42.com/blog/article/docker-ufw/</a></p>
<p>after.rules not reloaded unless reboot： <a target="_blank" rel="noopener" href="https://github.com/chaifeng/ufw-docker/issues/40">https://github.com/chaifeng/ufw-docker/issues/40</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/10/ufw-vs-docker/index/" data-id="clhp7rtmv00aps2qre4ce61qr" data-title="我的ufw怎么又不好用了？使用docker时如何拒绝非cloudflare访问" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-docker-scale/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/10/docker-scale/index/" class="article-date">
  <time class="dt-published" datetime="2021-02-10T00:00:00.000Z" itemprop="datePublished">2021-02-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/10/docker-scale/index/">使用docker scale时遇到的一点小问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天在使用<code>docker-compose</code>时，突然发现有一个command叫做<code>scale</code>，感觉有点像kubernetes的replica，于是试了一下</p>
<p>-&gt; # docker-compose scale yyets-web&#x3D;5<br>WARNING: The scale command is deprecated. Use the up command with the –scale flag instead.<br>Starting websiterunner_yyets-web_1 … done<br>Creating websiterunner_yyets-web_2 … done<br>Creating websiterunner_yyets-web_3 … done<br>Creating websiterunner_yyets-web_4 … done<br>Creating websiterunner_yyets-web_5 … done</p>
<p>果真是这个样子的，那么从其他容器访问这个container，用的是什么负载均衡算法呢？猜测应该是最简单也是最常见的round robin吧？在nginx里<code>ping</code>和<code>curl</code>试了一下，果真是的，每次解析的IP地址都会变化：</p>
<p><img src="/images/2021021017463110.jpeg"></p>
<p>然后看了一下log，发现请求全部落在了1上，而没有平均到其他4个container</p>
<p><img src="/images/2021021017463387.jpeg"></p>
<p>但是我如果在nginx里<code>curl</code>，却可以看到请求是均匀分布在5个container里的。</p>
<p><img src="/images/2021021017463847.jpeg" alt="图像"></p>
<p>什么鬼嘛，怎么会这样，从外部过来的请求不过是经过了nginx proxy_pass，这和我在nginx container里直接<code>curl</code>有什么差别嘛。</p>
<p>后来吃饭的时候想到，难道是因为，我是后scale的，而nginx是早就启动的，所以nginx启动时把配置文件中的域名解析到了一个固定的IP。而我在container中<code>curl</code>每次都是重新解析的，所以每次解析的结果都是round robin的</p>
<p>于是重启了一下nginx</p>
<p>docker-compose restart nginx</p>
<p><img src="/images/2021021017464153.jpeg" alt="图像"></p>
<p>看起来破案了，请求均匀分布到了5个container中。 [v_blue]<a target="_blank" rel="noopener" href="https://twitter.com/dev_techmoe/status/1359372686598766592?s=20">感谢techmoe指出</a>，其实应该不是固定的，文档说nginx默认的resolver是遵循DNS record的TTL值的，对nginx进程reload应该就可以刷新缓存，让nginx重新解析。 [&#x2F;v_blue] 那么问题来了，在单机上scale，是否有必要？</p>
<p>从我个人的角度来讲，意义似乎不太大。我觉得，如果单个容器（进程）存在性能瓶颈，比如说单进程&#x2F;单线程，只能用一个CPU宿主机有恰巧是多核心，多个进程可以明显提升性能，那么scale一下还是可以的。举个例子，万一我傻了吧唧的这么写的代码：</p>
<p>class ResourceHandler(BaseHandler):<br>    executor &#x3D; ThreadPoolExecutor(5)</p>
<pre><code>@run\_on\_executor()....
</code></pre>
<p>那么scale一下，还是有很大希望的。</p>
<p>不过我当然没这么傻，所以这里scale对我可能用处不太大。</p>
<p>当然了，还是用kubernetes最爽:-)可惜俺并不会也没那么多机器去搞:-(</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/10/docker-scale/index/" data-id="clhp7rtf8001qs2qrh4iib315" data-title="使用docker scale时遇到的一点小问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-container-no-network/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/26/container-no-network/index/" class="article-date">
  <time class="dt-published" datetime="2021-01-26T00:00:00.000Z" itemprop="datePublished">2021-01-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/26/container-no-network/index/">什么鬼啊，我的容器怎么无法访问外网了</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>大概几个星期前，在把<a target="_blank" rel="noopener" href="https://t.me/yyets_bot">YYeTs Bot</a>迁移到香港时，发现在容器里竟然无法访问外部网络。</p>
<p>由于之前看到有报道称香港的某些ISP对某域名进行了污染，因此此时就立刻想到了，是不是aws的上游也对 api.telegram.org 进行了污染？</p>
<p>容器里没法<code>curl</code>。<code>apk update</code>了一下，发现竟然无法update，难道是alpine挂了吗？Ubuntu也是，这俩一起炸？概率太低了吧。新加坡的那台机器也是同样的问题，但是日本就没问题。同样都在亚洲，大家有什么差别吗？难道是整个东南亚的海底光缆全炸了？可是没见到有人说东南亚的机房炸了啊，况且就算炸了，那也应该会找别的路由出去啊，就算丢包也不会直接炸光啊。</p>
<p><img src="/images/2021012415374384.jpeg"></p>
<p>就算你是柯蒂斯·李梅，手里有着一百架B-2轰炸机，也不能炸的这么彻底啊。</p>
<p>试了一下，宿主机能够访问啊，那就是没问题的。一定是某些配置不对。重新安装了docker engine，结果也还一样，香港和新加坡的机器就是不好用，但是日本可用。</p>
<hr>
<p>搜了一下，可能是没开<code>ipv4.forward</code>?但是我一般是开启这个的呀，而且我开了啊……</p>
<p>后来在网上翻到这样一篇文章，<a target="_blank" rel="noopener" href="https://pytimer.github.io/2019/11/docker%E5%AE%B9%E5%99%A8%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E5%9B%A0%E6%8E%92%E6%9F%A5/">《Docker容器无法连接外部网络原因排查》</a>，了解到bridge网络docker是通过iptables转发流量的。</p>
<p>此时，我突然意识到，我的这两台服务器似乎都设置了大量的本地端口转发，恰巧也覆盖了80和443这两个端口……把这个规则删掉，重启docker engine。好的，村通网了。</p>
<p>罪魁祸首的这条命令</p>
<p>iptables -t nat -A PREROUTING -p tcp –dport 23:1000 -j REDIRECT –to-ports 16698</p>
<p>事实证明，是我的想象力太丰富了。来一拳就好了。</p>
<p><img src="/images/2021012415374219.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/26/container-no-network/index/" data-id="clhp7rtex001as2qr7bzu7of0" data-title="什么鬼啊，我的容器怎么无法访问外网了" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-no-yyets/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/24/no-yyets/index/" class="article-date">
  <time class="dt-published" datetime="2021-01-24T00:00:00.000Z" itemprop="datePublished">2021-01-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/24/no-yyets/index/">没了人人影视，我们该怎么办？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="太长不看版："><a href="#太长不看版：" class="headerlink" title="太长不看版："></a>太长不看版：</h1><p>我把资源都爬下来了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://t.me/yyets_bot">Telegram Bot</a></li>
<li><a target="_blank" rel="noopener" href="https://yyets.dmesg.app/">资源分享搜索</a></li>
</ul>
<hr>
<p>2021年1月4日，人人影视发布公告称“正在清理内容，所有客户端均无法正常使用”。</p>
<p><img src="/images/202101241458034.png"></p>
<p>过了段时间，网友们发现，本来在资源页面中可以跳转到的分享页面，基本上全部消失了。</p>
<p>不过好在人人影视的分享API还是能够正常使用的，因此<a target="_blank" rel="noopener" href="https://t.me/yyets_bot">我的 bot</a>也还正常。</p>
<p>[v_error] 2021年2月4日：你们都知道了。 [&#x2F;v_error]</p>
<h2 id="归档人人影视"><a href="#归档人人影视" class="headerlink" title="归档人人影视"></a>归档人人影视</h2><p>为了避免出现问题，我便想把整个人人影视的资源都归档出来。简单的观察了一下人人影视的资源格式，如这个URL：<code>http://www.rrys2020.com/resource/40000</code></p>
<p>其实就可以发现，只要resource后的数字从1开始不停地遍历，就可以获取到全部资源了。你看，这就是不使用UUID的结果，被我这种磨人的小妖精发现了吧！</p>
<p>[v_blue]（关于使用UUID还是自增主键，可以看看这篇<a target="_blank" rel="noopener" href="https://nova.moe/laravel-use-uuid-as-primary-key-with-custom-authentication-fields/">《Laravel 使用 UUID 作为用户表主键并使用自定义用户表字段》</a>） [&#x2F;v_blue]</p>
<p>那么现在就很简单了，从1开始遍历，遍历到最新的剧集的ID为止，通过分享API拿到数据，然后存储到数据库里。为了避免出现rate limit，加上随机休眠；为了加快遍历速度，还要考虑并发。这两者看起来是矛盾的组合，也确实挺难调和的。同时为了让界面更友好，使用一个简单的进度条来告知进度。</p>
<p>真的是非常简单的，有兴趣的可以参考这里的源代码</p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/tree/master/BagAndDrag'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/tgbot-collection/YYeTsBot/tree/master/BagAndDrag&#39;\]开源地址\[/gt\]</a></p>
<p>ping了一下，人人影视的主站和分享站API都在香港阿里云上，那么用香港的aws去跑是最好的。最终我把这些资源都跑了下来，存到了MySQL中并发布了出去，然后推特发了出去。</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1348614240098086913?s=20">https://twitter.com/BennyThinks/status/1348614240098086913?s=20</a></p>
<p>这么一发布，没想到竟然让我的channel订阅者人数加一个0，Twitter follower翻倍。真是受宠若惊😂。</p>
<p>[v_tips]一点点小发现：人人影视第一部翻译的剧集，是《越狱》。ID是10004 [&#x2F;v_tips]</p>
<h2 id="被机器人轰炸是一种怎样的感觉？"><a href="#被机器人轰炸是一种怎样的感觉？" class="headerlink" title="被机器人轰炸是一种怎样的感觉？"></a>被机器人轰炸是一种怎样的感觉？</h2><p>突然一下子多了这么like，bot的使用量也开始飙升。</p>
<p>最开始为了方便修复bug，我设置了一个“向开发者提交错误信息”的功能，大概是这样子的：</p>
<p><img src="/images/2021012414580636.png"></p>
<p><strong>点一点按钮谁不会嘛，点一点又不会消耗很多精力，作为一个资深的伸手党，这一切不符合预期的结果肯定不是我的错，那我就点一下就好了，一下不好用，那么我就点两下三下。反正既不吃亏也不上当。</strong></p>
<p>也许有一些人是这样想的吧！</p>
<p>结果这次就开始不停地收到各种报错信息，都有什么样子的呢？</p>
<ul>
<li>喜洋洋与灰太狼</li>
<li>战狼，流浪地球</li>
<li>权利的游戏</li>
<li>各种莫名其妙的我也不记得是什么了</li>
<li>ahsjhsads然后瞬间block bot的</li>
</ul>
<p>etc…</p>
<p>第三种打了错别字的还可以理解，剩下的是在难为我胖虎吗？😡🤬</p>
<p>原有的设计是，出现错误报告的时候，我需要登录到vps上，使用一个messenger.py 来回复，但是这样就很麻烦，不仅要ssh还要去container里，而且需要在电脑旁。后来我<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/605086c909d3180e13b10f618cc7043fd2f95922">优化了一下</a>，直接在Telegram里就可以回复，我看到的大概是这样的：</p>
<p><img src="/images/2021012414580984.png"></p>
<p>可是有些用户依旧在汇报这种根本就是无法处理的问题，有的甚至还点两次，非常无奈的我就……我让你点两次试试看！😠</p>
<p><img src="/images/2021012414581266.png"></p>
<p>甚至最后我还开发了<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/3a852eacba56dfc667236ee235ffef98298f77c0">一键生气和一键回怼</a>功能</p>
<p><img src="/images/2021012414581525.png"></p>
<p>然而并无卵用，该点的还是会点……😂这么不相信我的代码质量吗？😱本来还想，要不我弄个黑名单的功能，想了想还是算了，直接<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/dbcf4819dbac7300848be940f386f5e8fda91522">默认关闭了这项功能</a>就可以了。</p>
<p>在这件事情中，我学习到了，总是有一部分人是不会认真读说明的。🤣</p>
<p>气鼓鼓🤨</p>
<p><img src="/images/2021012414581872.png"></p>
<h2 id="人人影视网站间歇性访问问题"><a href="#人人影视网站间歇性访问问题" class="headerlink" title="人人影视网站间歇性访问问题"></a>人人影视网站间歇性访问问题</h2><p>为了方便部署，我的所有Bot是使用<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/BotsRunner">docker-compose</a>启动的，丢在了一台英国的大鸡鸡上。毕竟Bot API Endpoint在荷兰，英国访问过去会比较快。再加上这是大鸡鸡，内存和CPU资源都很充足的。</p>
<p>某天（1月17日），突然发现bot的回应很慢，然后发现是<a target="_blank" rel="noopener" href="https://t.me/mikuri520/682">从英国访问人人影视有点艰难</a>，经常出现connection reset等情况。</p>
<p>看了一下香港和新加坡还是比较稳定的，于是就一个rsync把YYeTs bot迁移到了新加坡。</p>
<p>同时，为了避免某天人人影视真的炸掉，我开发了一个<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/e5ceaa19deef7549899d42f6f3c442e91e8a4b3b">Offline模式</a>（😂被我rebase了之后，时间好像不对了），使用环境变量来控制是否启用。最终数据来源就是上面归档的那些数据。</p>
<p>那么数据存在哪里呢？老早之前就听Nova大佬说<a target="_blank" rel="noopener" href="https://nova.moe/first-touch-with-cf-workers/">Cloudflare worker怎么怎么香</a>。于是我便很<a target="_blank" rel="noopener" href="https://t.me/mikuri520/693">暴力的撸</a>了一个非常原始的页面，有多原始呢？</p>
<p><img src="/images/2021012414581926.jpeg"></p>
<p>直接返回json可还行😂</p>
<p><img src="/images/202101241458206.png"></p>
<p>此时，人人影视专用链接 <code>yyets://</code> 还是能够在客户端里下载的，速度还不错的说。</p>
<p>しかし，此时我还不知道，我用<code>wrangler bulk:put</code>的数据其实是不全的……因为<code>wrangler bulk</code>虽然有10000个kv的限制，但是Cloudflare对于免费用户，每天还是只有1000的限制的。所以其实我以为两天能够导入完整的17517条数据，其实只有2000🤦‍♀️</p>
<h2 id="人人影视网站无法访问"><a href="#人人影视网站无法访问" class="headerlink" title="人人影视网站无法访问"></a>人人影视网站无法访问</h2><p>随后，我又添加了<a target="_blank" rel="noopener" href="https://www.zimuxia.cn/">FIX字幕侠</a>的支持。在搞它的过程中，发现这家伙竟然是拿WordPress搞的！那有WordPress的Public API，还爬个毛线啊，直接把整个<code>wp.posts</code>端回来了……🤔</p>
<p><img src="/images/2021012414582138.png"></p>
<p>しかし。。。好吧，通过插件把Public API禁用了，并且这个插件还有Bug😂。不过这下子也发现了用的是 <a target="_blank" rel="noopener" href="https://lnmp.org/">LNMP一键安装</a>啊。那就只好搞常规的爬虫+Redis了。</p>
<p>搞完FIX的第二天，突然发现<a target="_blank" rel="noopener" href="https://t.me/mikuri520/691">人人影视无法访问了</a>。主站无法访问，分享站的API也挂掉了。当然，服务器还在，还能ping通。那就只好切换到fix啦！</p>
<p><img src="/images/2021012414582245.jpeg"></p>
<p>再后来，我用了很多时间去优化，甚至搞出来了优先级搜索，FIX找不到，再去人人影视搜索。甚至还可以指定字幕组搜索。比如说这样：</p>
<p><img src="/images/2021012414582413.png"></p>
<p>有时发现Bot没有回复，但是进程也没有退出，就是纯粹的卡死了。是由于任务太多，访问网站又很慢，然后pyTelegramBotAPI的线程池满了吗？也许以后可以考虑把爬虫这部分功能集成到celery中。</p>
<p>当下，喜欢简单暴力的我我又用Client API写了一个health check🤦‍♀️</p>
<h2 id="更友好的Worker-Website"><a href="#更友好的Worker-Website" class="headerlink" title="更友好的Worker Website"></a>更友好的Worker Website</h2><p>在人人影视挂掉的当天，我发现了其实人人影视只是部分URL是挂掉的，某些资源还是可以很容易的get回来的。got002.com 也是同理，只是API坏掉了，页面资源还在。</p>
<p>于是我就发挥了我的小偷技能，把这些资源都搞了回来，然后一顿操作猛如虎，把这个仿真的人人影视分享站搞到了Cloudflare Worker上。</p>
<p><img src="/images/2021012414582733.png"></p>
<blockquote>
<p><strong>Dr. Brand:</strong> Lazarus came back from the dead.</p>
<p><strong>Cooper:</strong> Sure, but he had to die in the first place.</p>
</blockquote>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://t.me/mikuri520/694">这个Worker也不再简陋了</a>。甚至还有一个更酷的搜索页面和更短的域名<a target="_blank" rel="noopener" href="https://yyets.dmesg.app/">https://yyets.dmesg.app/</a> ：</p>
<p><img src="/images/202101241458298.png"></p>
<p>我甚至还无聊到加上了资源分享页面访问量的统计😂这个代码写得超烂的，啊！</p>
<p>别说，这个Worker的访问量还真是挺多的。放心，够用的！</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/01/2021012415125085.png"><img src="/images/2021012415125085.png"></a></p>
<p>最近24小时有62.9K的访问量，反正比我博客都多出来好几个0就是了。哦对，这个数据是完整的，因为我有钞能力呀！🦸‍♀️</p>
<p><img src="/images/2021012414583184.png"></p>
<h2 id="那么现在该怎么办"><a href="#那么现在该怎么办" class="headerlink" title="那么现在该怎么办"></a>那么现在该怎么办</h2><p>通过切换到FIX、使用YYeTsOffline作为fallback，糊了一个Worker Website，目前是差不多够用的。</p>
<p>那么以后该怎么办，难道我们真的只能告别人人影视了吗？</p>
<p>由于我现在已经不是人人影视字幕组的成员了，以下内容也只是推测。我本人还是持比较乐观的态度的。</p>
<h3 id="人人影视只是部分页面坏掉了"><a href="#人人影视只是部分页面坏掉了" class="headerlink" title="人人影视只是部分页面坏掉了"></a>人人影视只是部分页面坏掉了</h3><p>这一点我在上面提到了，实测起来只是部分页面“故意坏掉”了，有一些页面还是有一定概率可以返回的，比如说</p>
<ul>
<li>部分资源页面，如 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/resource/41579">http://www.rrys2020.com/resource/41579</a></li>
<li>播出表 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/tv/schedule">http://www.rrys2020.com/tv/schedule</a></li>
<li>排榜榜 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/html/top/week.html">http://www.rrys2020.com/html/top/week.html</a></li>
<li>公告 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/Announcement">http://www.rrys2020.com/Announcement</a></li>
<li>字幕分享 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/subtitle/66221">http://www.rrys2020.com/subtitle/66221</a></li>
<li>收藏 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/user/fav">http://www.rrys2020.com/user/fav</a> 甚至在收藏里还能看到下载地址！</li>
</ul>
<p>你看下面这个图，还能签到呢</p>
<p><img src="/images/2021012414583230.png"></p>
<p>2021年1月30日更新：网站已经ping不通了</p>
<p>Obrien-hk:~ # ping got002.com                                                                                                12:23.35 Sat Jan 30 2021 &gt;&gt;&gt;<br>PING got002.com (47.52.153.161) 56(84) bytes of data.<br>^C<br>— got002.com ping statistics —<br>17 packets transmitted, 0 received, 100% packet loss, time 16389ms</p>
<p>ps1_fortune:2: command not found: fortune<br>Obrien-hk:~ # ping <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">www.rrys2020.com</a>                                                                                          12:23.54 Sat Jan 30 2021 &gt;&gt;&gt;<br>PING <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">www.rrys2020.com</a> (47.52.174.174) 56(84) bytes of data.<br>^C<br>— <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">www.rrys2020.com</a> ping statistics —<br>22 packets transmitted, 0 received, 100% packet loss, time 21482ms</p>
<p>ps1_fortune:2: command not found: fortune</p>
<h3 id="人人影视还在正常翻译新剧吗？"><a href="#人人影视还在正常翻译新剧吗？" class="headerlink" title="人人影视还在正常翻译新剧吗？"></a>人人影视还在正常翻译新剧吗？</h3><p>既然某些页面是坏掉的，那么是不是针对不同等级的用户使用了不同的策略？或者说有另外一个“马甲站”在发布新的资源？毕竟，服务器ping起来没问题，那么看起来就是应用端有一些限制了吧？</p>
<p>我个人看来，还在翻译的，但有没有压制，就不知道了……并且，人人影视客户端已经无法下载 yyets的专用链接了。可能是“tracker”关掉了吧？</p>
<p><img src="/images/2021012414583317.png"></p>
<h2 id="不如这么办……"><a href="#不如这么办……" class="headerlink" title="不如这么办……"></a>不如这么办……</h2><p>尽管我归档了人人影视的资源，但是还是缺少了新鲜的血液。</p>
<h3 id="使用外挂字幕"><a href="#使用外挂字幕" class="headerlink" title="使用外挂字幕"></a>使用外挂字幕</h3><p>目前来看，人人影视依旧还在翻译，字幕也上传到了subhd。那么可以自己下载片源然后外挂字幕了。当然，如果看日剧的话，追新番也还是好着的，这点就很让人开心了。</p>
<h3 id="使用FIX"><a href="#使用FIX" class="headerlink" title="使用FIX"></a>使用FIX</h3><p>FIX的翻译质量也还不错的，作为替代选择很不错哦。</p>
<h3 id="使用bot、Worker"><a href="#使用bot、Worker" class="headerlink" title="使用bot、Worker"></a>使用bot、Worker</h3><p>worker只包含了归档的资源，bot会优先搜索FIX，然后如果没有搜索到才会去搜索Worker。看起来也还是不错的呢。</p>
<h2 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h2><ul>
<li>❌ 人人影视主站 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">http://www.rrys2020.com/</a></li>
<li>❌人人影视资源列表 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/resourcelist">http://www.rrys2020.com/resourcelist</a></li>
<li>❌ 人人影视字幕列表 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/subtitle">http://www.rrys2020.com/subtitle</a></li>
<li>✅ 磁力站（很慢） <a target="_blank" rel="noopener" href="http://www.mag234.com/home.html">http://www.mag234.com/home.html</a></li>
<li>✅ 追新番 <a target="_blank" rel="noopener" href="http://www.zhuixinfan.com/main.php">http://www.zhuixinfan.com/main.php</a></li>
<li>✅ YYeTs资源归档 <a target="_blank" rel="noopener" href="https://yyets.dmesg.app/">https://yyets.dmesg.app/</a></li>
<li>✅ YYeTs Bot <a target="_blank" rel="noopener" href="http://t.me/yyets_bot">http://t.me/yyets_bot</a></li>
<li>✅ FIX 字幕侠 <a target="_blank" rel="noopener" href="https://www.zimuxia.cn/">https://www.zimuxia.cn/</a></li>
</ul>
<h2 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h2><p>由于个人的精力总是有限的，有兴趣的小伙伴可以帮忙开发维护 YYeTs Bot，地址在这里。如果有帮助到你的话，点个star🌟就可以了。如果想要donate😂那……难度可能有点高，但也不是不可能，看下<a target="_blank" rel="noopener" href="https://dmesg.app/donate">导航栏的支持我</a>？</p>
<p>本项目目前需要……</p>
<ul>
<li>整理FIX资源 <code>BagAndDrag</code></li>
<li>添加其他字幕组支持 <code>yyets/fansub.py</code></li>
<li>测试用例 <code>tests/*.py</code></li>
<li>Cloudflare Worker优化 <code>worker/worker-site</code></li>
</ul>
<p>开发的话，其实蛮简单的，比如说对于添加其他字幕组的支持，只需要继承BaseFansub，类名写好，实现search_preview和search_result，然后在FANSUB_ORDER里添加你的类名，就可以了。是否要实现缓存，这都是看你个人情况的……</p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/tgbot-collection/YYeTsBot&#39;\]开源地址\[/gt\]</a></p>
<p> </p>
<p><strong>哦对了，公共资源请不要滥用。比如说爬虫啊什么的，说得像你能爬下来一样🙄️</strong></p>
<h2 id="一点点感慨"><a href="#一点点感慨" class="headerlink" title="一点点感慨"></a>一点点感慨</h2><p>以下内容<a target="_blank" rel="noopener" href="https://t.me/mikuri520/711">发布于我的Channel：</a></p>
<blockquote>
<p>想起来一件趣事。之前看过一部电影《我是传奇》 I Am Legend。</p>
<p>这部电影有两个结局，一个是男主活下来，人类与“僵尸”共存，一个是男主牺牲找到解药，人类幸存。</p>
<p>几年前，和前女友异地感情不顺利的时候，每天在想办法找话题和她聊天保持亲密关系，于是就和她讨论起这个电影，问她更喜欢哪一个结局。</p>
<p>我说，我更喜欢男主牺牲拯救人类的结局。我更喜欢这个结局，不是因为这样会让男主看起来很伟大，是拯救了人类的英雄。</p>
<p>而是我认为第二个结局“僵尸”们看起来是不具备进行高级生产的能力的，尽管从电影中可以看到“僵尸”是有一些感情和智力的，但是我认为这个水平依旧无法达到现代人类所能达到的生产能力水平。</p>
<p>举个例子，人类能够使用自然资源制造出砖块，然后堆砌出墙壁，最终建造房子；然而对于“僵尸”们而言，他们并不具备这种能力，尽管他们的力气很大，但是力气大并不能创造出来力气更大的机器呀。所以从人类发展的角度来讲，我还是更喜欢人类幸存的结局。</p>
<p>她似乎很赞同我的观点。这么多年过去了，也不知道她过得还好不好。前几天还梦到了她🙁</p>
<p>今天提到这里，是因为男主牺牲的结局里，最后一句台词是这样的：</p>
<p><strong>We are his legacy. This is his Legend.</strong></p>
<p>就像我爬下来的数据一样，这些，是人人影视的遗产。这些，是人人影视的传奇。</p>
</blockquote>
<hr>
<p>最萌不过三岛花😘</p>
<p><img src="/images/2021012414583596.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/24/no-yyets/index/" data-id="clhp7rthv0065s2qr4v8jdjku" data-title="没了人人影视，我们该怎么办？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe 如何安全收款并避免盗刷与测卡</a>
          </li>
        
          <li>
            <a href="/2024/07/27/hide-in-cf/index/">隐藏于 Cloudflare 的全球网络之中</a>
          </li>
        
          <li>
            <a href="/2024/07/17/azure-waf/index/">救命！我的 Azure Front Door WAF 规则不生效怎么办！</a>
          </li>
        
          <li>
            <a href="/2024/07/16/azure-fd/index/">使用Azure Front Door 和 Load Balancer</a>
          </li>
        
          <li>
            <a href="/2024/04/30/usdt-trc20-scam/index/">警惕USDT-TRC20 数字货币诈骗</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>