<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>åœŸè±†ä¸å¥½åƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="åœŸè±†ä¸å¥½åƒ">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="åœŸè±†ä¸å¥½åƒ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Bennyå°åœŸè±†">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="åœŸè±†ä¸å¥½åƒ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">åœŸè±†ä¸å¥½åƒ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-no-openssh-server-container/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/17/no-openssh-server-container/index/" class="article-date">
  <time class="dt-published" datetime="2022-01-17T00:00:00.000Z" itemprop="datePublished">2022-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/17/no-openssh-server-container/index/">æ²¡äº‹åˆ«åœ¨å®¹å™¨é‡Œè£…openssh-serverï¼ŒçœŸçš„</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å‡ å¤©å‰ï¼Œè·‘çš„å¥½å¥½çš„CIçªç„¶failï¼ŒæŠ¥é”™ä¿¡æ¯çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œåƒæ˜¯ä½¿ç”¨ä¸Šçš„é—®é¢˜ã€‚</p>
<p><img src="/images/2022011720392372.png"></p>
<p>æœ¬åœ°è·‘äº†ä¸€ä¸‹è¿™ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æ²¡æœ‰å¤ç°ã€‚ä»¥ä¸ºæ˜¯CIå¶å°”æŠ½é£äº†ï¼Œå°±æ²¡ç®¡ã€‚</p>
<p>åæ¥å‘ç°æœ‰ç‚¹ä¸å¯¹ï¼Œæ€ä¹ˆéƒ½è·‘ä¸è¿‡ã€‚ç”šè‡³ç›´æ¥åœ¨developä¸Šè·‘CIéƒ½è·‘ä¸è¿‡ã€‚è¿™å’ŒGraphQLæœ‰ä»€ä¹ˆå…³ç³»å•Šï¼Ÿæ˜æ˜éƒ½èƒ½ç”¨çš„å•Šã€‚è®©å†™è¿™éƒ¨åˆ†ä»£ç çš„åŒäº‹å¸®å¿™çœ‹äº†ä¸‹ï¼Œå‘ç°ä»–ä¹Ÿèƒ½è·‘è¿‡ã€‚å¥‡æ€ªã€‚</p>
<p>ç”±äºæ•´å¥—CIæ˜¯è·‘åœ¨concourseä¸Šçš„ï¼Œäºæ˜¯é€šè¿‡<code>fly hijack</code>è¿›å»ï¼Œåœ¨å¯¹åº”å¤±è´¥çš„stepä¸­æˆåŠŸå¤ç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å†åæ¥åŒäº‹å‘ç°å‡ºé—®é¢˜çš„æ˜¯<code>urllib3/util/retry.py</code>çš„Retry</p>
<p>max_retries &#x3D; Retry(<br>    total&#x3D;1,<br>    backoff_factor&#x3D;0.1,<br>    status_forcelist&#x3D;[500, 502, 503, 504],<br>    allowed_methods&#x3D;None,<br>)</p>
<p>å»æ¯”å¯¹äº†ä¸‹ï¼Œflyè¿›å»çš„å®¹å™¨ä¸­çš„<code>urllib3</code>ç‰ˆæœ¬å’Œæˆ‘æµ‹è¯•çš„ç‰ˆæœ¬ç¡®å®ä¸ä¸€æ ·ã€‚æŠŠflyè¿›å»çš„å®¹å™¨ä¸­çš„<code>urllib3</code>å‡çº§äº†ä¹‹åï¼Œtest caseå°±å¯ä»¥è¿‡äº†ã€‚</p>
<p>å•¥ï¼Ÿè¿™å•¥æƒ…å†µï¼Ÿå…ˆåœ¨<code>requirements.txt</code>ä¸­å†™ä¸Š<code>urllib3==1.26.7</code>ä¸´æ—¶è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚è‡³å°‘åˆ«è€½è¯¯å¤§å®¶è·‘CIå•Šã€‚</p>
<h2 id="å·®å¼‚"><a href="#å·®å¼‚" class="headerlink" title="å·®å¼‚"></a>å·®å¼‚</h2><p>flyè¿›å»çš„å®¹å™¨æ˜¯ç”¨åä¸º<code>builder/Dockerfile</code>æ„å»ºçš„ï¼Œæˆ‘æµ‹è¯•çš„æ˜¯websvcæ˜¯<code>websvc/Dockerfile</code>æ„å»ºçš„ï¼Œä¸¤è€…åŸºæœ¬æ²¡ä»€ä¹ˆå·®åˆ«ã€‚</p>
<p>æˆ‘è‡ªå·±è·‘æµ‹è¯•ç”¨ä¾‹æ˜¯ç”¨çš„websvcï¼Œè€Œè·‘CIç”¨çš„æ˜¯builderã€‚</p>
<p>å¯æ˜¯é—®é¢˜æ¥äº†ï¼ŒäºŒè€…æ˜æ˜ç”¨äº†ä¸€æ ·çš„<code>requirements.txt</code>ï¼Œæ€ä¹ˆä¼šå®‰è£…å‡ºæ¥ä¸ä¸€æ ·çš„libraryï¼Ÿ<code>pip install -r requirements.txt</code> ä¹‹åä¹Ÿæ²¡æœ‰å®‰è£…åˆ«çš„ï¼Œæ€ä¹ˆå°±ç‰ˆæœ¬ä¸ä¸€è‡´äº†ï¼Ÿ</p>
<p>åæ¥ç»è¿‡ä¸€æ­¥ä¸€æ­¥æµ‹è¯•ï¼Œæœ€ç»ˆå‘ç°äº†è¿™èƒŒåçš„åŸå› ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2022/01/2022011720422322.jpeg"><img src="/images/2022011720422322.jpeg"></a></p>
<h2 id="æ ¹æœ¬åŸå› "><a href="#æ ¹æœ¬åŸå› " class="headerlink" title="æ ¹æœ¬åŸå› "></a>æ ¹æœ¬åŸå› </h2><p>åœ¨<code>builder/Dockerfile</code>ä¸­ï¼Œæˆ‘ä»¬å®‰è£…äº†<code>openssh-server</code>ï¼Œå…ˆåˆ«ç®¡ä¸ºå•¥â€¦â€¦</p>
<p><code>openssh-server</code>æœ‰éå¸¸å¤šçš„ä¾èµ–ï¼Œå¦‚ä¸‹å›¾ä¸­é€‰ä¸­çš„åœ°æ–¹ï¼Œå°±æœ‰<code>python3-urllib3</code>ã€‚</p>
<p><img src="/images/2022011720392441.png"></p>
<p>aptä¸­çš„python packageçš„ç‰ˆæœ¬æ˜¯ç›¸å¯¹è€Œè¨€æ¯”è¾ƒè€çš„ï¼Œç»è¿‡æŸ¥çœ‹è¿™ç§æ–¹å¼å®‰è£…çš„urllib3çš„ç‰ˆæœ¬æ˜¯1.22</p>
<p><img src="/images/2022011720392521.png"></p>
<p>åœ¨ <code>requirements.txt</code> ä¸­ï¼Œæˆ‘ä»¬å®‰è£…çš„æ˜¯<code>requests==2.25.1</code>å’Œ<code>gql==3.0.0b0</code>ã€‚è¿™ä¸¤ä¸ªpackageå¯¹urllib3çš„ç‰ˆæœ¬è¦æ±‚æ¯”è¾ƒå®½æ³›ï¼Œé€šè¿‡apt å®‰è£…çš„è¿™ä¸ªç‰ˆæœ¬æ°å·§èƒ½å¤Ÿæ»¡è¶³ã€‚</p>
<p><img src="/images/20220117203926100.png"></p>
<p>websvcè¿™ä¸ªimageç”±äºæ²¡æœ‰é€šè¿‡aptå®‰è£…<code>openssh-server</code>ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰<code>python3-urllib3</code>ã€‚åœ¨ <code>pip install -r requirements.txt</code>æ—¶ï¼Œrequests 2.25.1çš„è¦æ±‚æ˜¯<code>urllib3&gt;=1.21.1,&lt;1.27</code>ï¼Œä¹Ÿå°±å®‰è£…äº†1.26.7ï¼ˆå¯ç”¨çš„ç‰ˆæœ¬ï¼‰</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨æ„å»ºä¹‹åï¼Œbuilderè¿™ä¸ªimageä¸­ urllib3çš„ç‰ˆæœ¬å°±æ˜¯1.22ï¼›è€Œwebsvcæ˜¯1.26.7ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæœ¬æœºæ°¸è¿œæ— æ³•å¤ç°è€Œåªæœ‰åœ¨fly hijackä¹‹åæ‰å¯ä»¥å¤ç°çš„åŸå› </p>
<p>æ‰€ä»¥root causeæ˜¯ï¼Œåœ¨ builderä¸­å®‰è£…äº†<code>openssh-server</code>ï¼ˆå®¹å™¨é‡Œå®‰è£…openssh-serverå¹²å˜›ğŸ¤£ï¼‰</p>
<h2 id="ç›´æ¥åŸå› "><a href="#ç›´æ¥åŸå› " class="headerlink" title="ç›´æ¥åŸå› "></a>ç›´æ¥åŸå› </h2><p>direct causeæ˜¯ <code>gql==3.0.0b0</code> çš„<code>install_requires</code> æ²¡æœ‰è¦æ±‚urllib3çš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯èƒ½æ˜¯graphql-coreï¼Œæˆ–è€…è¯´<code>requiremens.txt</code>åº”è¯¥å†™<code>gql[all]==3.0.0.b0</code>ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººè¿™ä¹ˆå†™å•Šï¼ŒçœŸçš„æ˜¯é†‰äº†ã€‚</p>
<h2 id="é—´æ¥åŸå› "><a href="#é—´æ¥åŸå› " class="headerlink" title="é—´æ¥åŸå› "></a>é—´æ¥åŸå› </h2><p>é‚£ä¸ºå•¥ä¹‹å‰éƒ½ä¸€ç›´æ²¡é—®é¢˜æ€ä¹ˆçªç„¶å°±æŒ‚äº†ï¼Ÿ</p>
<p>ä¸€ç•ªå®éªŒä¹‹åä¹Ÿå‘ç°äº†åŸå› ã€‚ä¹‹å‰Base imageå‡çº§åˆ°äº†Ubuntu 18.04ï¼Œ16.04çš„æ—¶å€™Ubuntuè‡ªå¸¦çš„pythonç‰ˆæœ¬æ˜¯3.5ï¼Œæ‰€ä»¥å“ªæ€•å®‰è£…äº†<code>openssh-server</code>ï¼Œé‚£ä¹Ÿæ˜¯py3.5çš„ï¼Œè€Œæˆ‘ä»¬ç”¨çš„æ˜¯ä»ppaå®‰è£…çš„3.6æ‰€ä»¥æ— å…³è”ã€‚</p>
<p>å‡çº§ä¹‹åï¼Œ18.04è‡ªå¸¦çš„Pythonæ˜¯3.6ï¼Œå³ä½¿é€šè¿‡ppaå®‰è£…å…¶å®ä¹Ÿæ˜¯â€œå…±äº«â€çš„ï¼Œå› æ­¤â€¦</p>
<h2 id="ä¿®å¤æ–¹æ³•"><a href="#ä¿®å¤æ–¹æ³•" class="headerlink" title="ä¿®å¤æ–¹æ³•"></a>ä¿®å¤æ–¹æ³•</h2><p>ä¿®å¤çš„åŠæ³•åŒ…æ‹¬</p>
<ol>
<li>patchæ‰graphqlçš„è°ƒç”¨</li>
<li><code>requirements.txt</code>ä¸­å¼ºåˆ¶å®‰è£…æ–°ç‰ˆæœ¬urllib3</li>
<li>æŠŠ<code>builder/Dockerfile</code>ä¸­<code>openssh-server</code>æ”¹æˆ<code>wget</code>ï¼ˆå®‰è£…<code>openssh-server</code>æ—¶ä¼šé™„å¸¦<code>wget</code>ï¼Œåç»­æˆ‘ä»¬éœ€è¦<code>wget</code>ï¼‰</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>å‡çº§å‡çº§åˆ°Ubuntu 18.04æ˜¯æˆ‘æçš„ï¼Œæˆ‘èƒŒé”…ã€‚å¢ƒå¤–åŠ¿åŠ›å·²ç»å¤Ÿå¿™äº†ï¼Œè¯·ä¸è¦è¯¬é™·å¢ƒå¤–åŠ¿åŠ›ã€‚</li>
<li>Dockerfileå¯ä»¥å†æ›´æ–°ä¸€ä¸‹äº†ï¼ŒæŠŠPPAå»æ‰ï¼Œä¸€äº›é‡å¤çš„å®‰è£…ï¼ˆæŒ‡aptå’Œpipï¼‰å¯ä»¥åªä¿ç•™pipäº†ã€‚openssh-server ä¹Ÿå¯ä»¥å»æ‰ï¼Œå†å²é—ç•™é—®é¢˜ã€‚</li>
<li>ä¸ºå•¥ä¸ç”¨multi-stage buildï¼Ÿä¼°è®¡ä¹Ÿæ˜¯å†å²é—ç•™åŸå› ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/docker-nat-vps.html">æ²¡äº‹åˆ«åœ¨å®¹å™¨é‡Œå®‰è£…openssh-serverï¼ŒçœŸçš„</a>ã€‚é™¤éä½ çŸ¥é“ä½ åœ¨å¹²å˜›ã€‚æˆ–è€…è£…é™ä½ç†Šã€‚</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2022/01/2022011720531128.jpeg"><img src="/images/2022011720531128.jpeg"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/17/no-openssh-server-container/index/" data-id="clhp7rthu0063s2qr5f7yb3gb" data-title="æ²¡äº‹åˆ«åœ¨å®¹å™¨é‡Œè£…openssh-serverï¼ŒçœŸçš„" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-actions-celery/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/08/actions-celery/index/" class="article-date">
  <time class="dt-published" datetime="2022-01-08T00:00:00.000Z" itemprop="datePublished">2022-01-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/what/">what</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/08/actions-celery/index/">ä½¿ç”¨GitHub Actionsè·‘Celery worker</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è‡ªä»æœ‰äº†GitHub Actionsä¹‹åï¼ŒTravisCIã€DockerHub Autobuildç­‰éƒ½å¯ä»¥æ­‡èœäº†ã€‚</p>
<h2 id="é›†æˆæµ‹è¯•"><a href="#é›†æˆæµ‹è¯•" class="headerlink" title="é›†æˆæµ‹è¯•"></a>é›†æˆæµ‹è¯•</h2><p>é€šå¸¸æ¥è¯´æˆ‘ä¼šå†™å¥½Makefileï¼Œactionsé‡Œå®‰è£…å¥½ä¾èµ–ä¹‹åç›´æ¥<code>make test</code>å°±å¯ä»¥äº†ã€‚</p>
<p><img src="/images/2022010813162126.png"></p>
<p>å¯ä»¥åœ¨actionsçš„ç•Œé¢åˆ›å»ºbadgeï¼ŒåŠ åˆ°<code>README.md</code>é‡Œï¼Œå½»åº•å–ä»£TravisCI</p>
<h2 id="è‡ªåŠ¨æ„å»ºDocker-image"><a href="#è‡ªåŠ¨æ„å»ºDocker-image" class="headerlink" title="è‡ªåŠ¨æ„å»ºDocker image"></a>è‡ªåŠ¨æ„å»ºDocker image</h2><p>å¯ä»¥<a target="_blank" rel="noopener" href="https://dmesg.app/github-actions-docker-image.html">ç›´æ¥ç”¨Actionsæ„å»º</a>Multi-Archçš„Docker imageï¼Œç„¶åpushåˆ°docker hubï¼Œå°±æ˜¯ä¸ç»™docker hubäº¤é’±ã€‚ç”šè‡³æˆ‘ä»¬è¿˜å¯ä»¥åŒæ­¥pushåˆ°ghcr.io è™½è¯´ä¹Ÿæ²¡ä»€ä¹ˆäººç”¨å°±æ˜¯äº†ã€‚ç›¸å…³çš„workflowå¯ä»¥å‚è€ƒè¿™ä¸ª</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/builder.yaml">https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/builder.yaml</a></p>
<p>åŸºæœ¬ä¸Šå·²ç»åšåˆ°æ‹¿æ¥é…ç½®å¥½secretså°±èƒ½ç”¨äº†ã€‚</p>
<h2 id="è‡ªåŠ¨éƒ¨ç½²ä»£ç "><a href="#è‡ªåŠ¨éƒ¨ç½²ä»£ç " class="headerlink" title="è‡ªåŠ¨éƒ¨ç½²ä»£ç "></a>è‡ªåŠ¨éƒ¨ç½²ä»£ç </h2><p>imageä¹Ÿæ„å»ºå®Œäº†ï¼Œéƒ¨ç½²çš„è¯å¯ä»¥ç”¨ssh actionï¼Œç›´æ¥sshåˆ°æœºå™¨<code>docker pull</code>ä¸€æ³¢èµ°èµ·ã€‚è®°å¾—æŠŠprivate keyæ”¾åˆ°secreté‡Œå°±å¥½ã€‚å¯ä»¥å‚è€ƒè¿™ä¸ªworkflow</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/upgrade.yml">https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/upgrade.yml</a></p>
<h2 id="å…¶ä»–åº”ç”¨"><a href="#å…¶ä»–åº”ç”¨" class="headerlink" title="å…¶ä»–åº”ç”¨"></a>å…¶ä»–åº”ç”¨</h2><p>GitHub Actionsçš„æœºå™¨æ€§èƒ½è¿˜ä¸é”™ï¼Œ2C 7G RAMï¼Œå¤§æ¦‚æ€»å…±â€¦â€¦å®˜æ–¹è¯´14G SSDï¼Œå…¶å®æœ‰åŠæ³•å¼„å‡ºæ¥æ›´å¤šç£ç›˜ç©ºé—´çš„ã€‚</p>
<p>æ¯ä¸ªjobèƒ½è·‘6å°æ—¶ï¼Œæ¯ä¸ªworkflowèƒ½è·‘72å°æ—¶ã€‚ç¼ºç‚¹æ˜¯æ²¡æœ‰å…¥ç½‘ï¼Œæ‰€æœ‰çš„inbound trafficéƒ½è¢«é˜²ç«å¢™æŒ¡ä½äº†ï¼ˆè€Œä¸”ä¸æ˜¯iptablesæçš„ï¼‰ï¼Œå› æ­¤æƒ³å½“web serverã€æ¢¯å­è¿™ç§éœ€è¦æš´éœ²ç«¯å£çš„å°±ä¸è¡Œäº†ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæ˜¯celery workerè¿™ç§ä¸éœ€è¦æš´éœ²ç«¯å£çš„å°±æ²¡é—®é¢˜ã€‚</p>
<h2 id="é…ç½®WireGuard"><a href="#é…ç½®WireGuard" class="headerlink" title="é…ç½®WireGuard"></a>é…ç½®WireGuard</h2><p>æˆ‘çš„celery workeréœ€è¦è¿æ¥åˆ°brokerï¼Œå› æ­¤éœ€è¦åŠ å¯†çš„é€šé“ã€‚å¯ä»¥ç”¨WireGuardï¼Œå¯ä»¥ç”¨sshéš§é“ï¼Œä»¥åŠå„ç§ç¥å¥‡çš„åŠ å¯†éš§é“ã€‚</p>
<p>sshéš§é“æ¯”è¾ƒç®€å•ï¼Œruné‡Œæ‰§è¡Œä¸€ä¸‹å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<p>ssh -L 6379:localhost:6379 root@server</p>
<p>ä»¥åè®¿é—®æœ¬åœ°çš„6379å°±åƒè®¿é—®æœåŠ¡å™¨çš„6379ä¸€æ ·äº†ã€‚</p>
<p>WireGuardçš„è¯ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œå…ˆå®‰è£… ç›´æ¥<code>sudo apt install -y wireguard-tools</code>å°±å¯ä»¥äº†ã€‚</p>
<p>ç„¶åé…ç½®å¥½peerï¼Œæ¯”å¦‚è¯´æˆ‘ç»™GitHub Actionsçš„peeræ˜¯è¿™æ ·çš„ï¼š</p>
<p>[Interface]<br>PrivateKey &#x3D; 12345241<br>Address &#x3D; 192.168.6.111&#x2F;24</p>
<p>[Peer]<br>PublicKey &#x3D; 322331<br>AllowedIPs &#x3D; 192.168.6.0&#x2F;24<br>Endpoint &#x3D; 1.1.1.1:443<br>PersistentKeepalive &#x3D; 60</p>
<p>è¿™ä¸ªä¸œè¥¿è‚¯å®šä¸èƒ½æ˜æ–‡å†™åˆ°workflowé‡Œï¼Œå› æ­¤éœ€è¦ç”¨åˆ°secretï¼Œåˆå› ä¸ºæ˜¯å¸¦äº†æ¢è¡Œçš„ï¼Œæ‰€ä»¥æœ‰è‡³å°‘ä¸¤ç§åŠæ³•ã€‚</p>
<p>Â </p>
<h3 id="base64æ³•"><a href="#base64æ³•" class="headerlink" title="base64æ³•"></a>base64æ³•</h3><p>è·‘ä¸€ébase64ä¹‹åå¾—åˆ°äº†è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œç„¶åæŠŠè¿™ä¸ªä¸œè¥¿åŠ åˆ°secreté‡Œï¼š</p>
<p>CltJbnRlcmZhY2VdClByaXZhdGVLZXkgPSAxMjM0NTI0MQpBZGRyZXNzID0gMTkyLjE2OC42LjExMS8yNAoKW1BlZXJdClB1YmxpY0tleSA9IDMyMjMzMQpBbGxvd2VkSVBzID0gMTkyLjE2OC42LjAvMjQKRW5kcG9pbnQgPSAxLjEuMS4xOjQ0MwpQZXJzaXN0ZW50S2VlcGFsaXZlID0gNjAK</p>
<p>éœ€è¦åœ¨shell scriptä¸­ç”¨åˆ°è¿™ä¸ªbase64å­—ç¬¦ä¸²ï¼Œechoåˆ°<code>/etc/wireguard/wg0.conf</code> ä¸­ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œ <code>sudo echo $WG &gt; /etc/wireguard/wg0.conf</code> æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º &gt;æ˜¯shellçš„é‡å®šå‘æ“ä½œç¬¦ï¼Œå½“å‰shellè¿˜æ˜¯æ™®é€šç”¨æˆ·ï¼Œè¿™ç§ç”¨æ³•åªæ˜¯echoæœ‰äº†rootè€Œå·²ã€‚æ–¹æ³•ä¹‹ä¸€æ˜¯ç”¨tee</p>
<p>echo $WG |base64 -d | sudo tee -a &#x2F;etc&#x2F;wireguard&#x2F;wg0.conf</p>
<p>teeå®Œä¹‹å<code>wg-quick up wg0</code> ç„¶åpingä¸‹peerå°±å¯ä»¥äº†ã€‚æ•´æ®µyamlæ˜¯è¿™æ ·çš„ï¼š</p>
<p>- name: Set up WireGuard<br>  env:<br>    WG: $<br>  run: |<br>    sudo apt install -y wireguard-tools<br>    echo $WG |base64 -d | sudo tee -a &#x2F;etc&#x2F;wireguard&#x2F;wg0.conf<br>    sudo wg-quick up wg0<br>    ping 192.168.6.1 -c 2</p>
<p>ç¬¬äºŒè¡Œçš„envå¯é€‰ï¼Œè¦ä¸å°±envæˆWGè¿™ä¸ªå˜é‡ï¼Œè¦ä¸å°±ç›´æ¥<code>echo $&#123;&#123;secrets.WG&#125;&#125;</code></p>
<p>æ³¨æ„ï¼š</p>
<p>ç”±äºç”¨äº†base64ï¼Œæ‰€ä»¥workflowçš„æ—¥å¿—ä¸­ä¼šçœ‹åˆ°æ˜æ–‡keyï¼Œå› æ­¤å»ºè®®private repositoryã€‚æ¯•ç«Ÿç”¨äº†teeä¸€ä»½æ ‡å‡†è¾“å‡ºä¸€ä»½æ–‡ä»¶ã€‚å¦‚æœä¸æƒ³private repositoryï¼Œé‚£å°±è¿™æ ·</p>
<p>echo $WG |base64 -d &gt; &#x2F;tmp&#x2F;wg0.conf<br>sudo cp &#x2F;tmp&#x2F;wg0.conf &#x2F;etc&#x2F;wireguard&#x2F;wg0.conf</p>
<p>æˆ–è€…EOFä»€ä¹ˆçš„ï¼Œè‡ªå·±å‘æŒ¥å§ã€‚ç›¸ä¿¡å¹¿å¤§äººæ°‘ç¾¤ä¼—çš„è„‘æ´ã€‚</p>
<h3 id="ç›´æ¥ç”¨secret"><a href="#ç›´æ¥ç”¨secret" class="headerlink" title="ç›´æ¥ç”¨secret"></a>ç›´æ¥ç”¨secret</h3><p>secretä¸­å†™peeré…ç½®æ˜æ–‡ï¼Œç„¶åechoçš„æ—¶å€™åŠ ä¸Š â€œâ€</p>
<p>echo â€œ$â€œ  | sudo tee -a &#x2F;etc&#x2F;wireguard&#x2F;wg0.conf</p>
<h2 id="æ›´å¤šç£ç›˜ç©ºé—´"><a href="#æ›´å¤šç£ç›˜ç©ºé—´" class="headerlink" title="æ›´å¤šç£ç›˜ç©ºé—´"></a>æ›´å¤šç£ç›˜ç©ºé—´</h2><p>GitHub Actionsé»˜è®¤è£…äº†å¾ˆå¤šä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†æˆ‘ä»¬æ˜¯ç”¨ä¸åˆ°çš„ï¼Œå¸è½½æ‰æ‹¿æ¥æäº‹æƒ…å§ï¼Œå¯ä»¥ç”¨ <a target="_blank" rel="noopener" href="https://github.com/easimon/maximize-build-space">https://github.com/easimon/maximize-build-space</a></p>
<p>æˆ‘çš„é…ç½®æ˜¯è¿™æ ·çš„</p>
<p>- name: Maximize build space<br>  uses: easimon&#x2F;maximize-build-space@master<br>  with:<br>    swap-size-mb: 512<br>    remove-dotnet: â€˜trueâ€™<br>    remove-android: â€˜trueâ€™<br>    remove-haskell: â€˜trueâ€™</p>
<h2 id="è·‘celery-worker"><a href="#è·‘celery-worker" class="headerlink" title="è·‘celery worker"></a>è·‘celery worker</h2><p>æˆ‘çš„æœåŠ¡éƒ½æ˜¯æœ‰docker imageçš„ï¼Œæ‰€æœ‰çš„è¿è¡Œæ—¶ä¿¡æ¯éƒ½æ˜¯ç”¨çš„ç¯å¢ƒå˜é‡ã€‚å› æ­¤è¿™æ­¥åŸºæœ¬ä¸Šå°±æ˜¯é…ç½®ä¸€ä¸‹ï¼Œç„¶åè·‘èµ·æ¥å°±è¡Œäº†ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>docker run</code>çš„è¯ä¸è¦åŠ  -d é€‰é¡¹ï¼Œå¦åˆ™è·‘åå°äº†æ•´ä¸ªworkflowç»“æŸï¼ŒVMä¹Ÿå°±æ²¡äº†ã€‚å¯¹åº”<code>docker-compose</code>ä¹Ÿä¸è¦åŠ <code>-d</code>ã€‚</p>
<p><img src="/images/2022010813162376.png"></p>
<p>æ•ˆæœè¿˜æ˜¯å¾ˆåˆºæ¿€çš„ï¼ˆ</p>
<h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p>è®¾ç½®ä¸€ä¸ª6å°æ—¶è·‘ä¸€æ¬¡çš„cronï¼Œè¿™æ ·å°±ä¸ç”¨å†æ“å¿ƒäº†ã€‚</p>
<p>on:<br>  schedule:<br>    - cron: â€˜0 *&#x2F;6 * * *â€˜</p>
<p>cronçš„ç¬¬ä¸€ä¸ªæ•°å­—0ï¼ˆæˆ–è€…æ˜¯0-59çš„å…¶ä»–åˆ†é’Ÿï¼‰éå¸¸é‡è¦ï¼Œå¦‚æœæ˜¯*çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€6ã€12ã€18ã€0ç‚¹çš„æ¯åˆ†é’Ÿéƒ½è·‘ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯240ä¸ªä»»åŠ¡ã€‚ç›¸ä¿¡è¿™æ ·è¿‡ä¸äº†ä½ çš„å·å°±ä¼šé­å—GitHubçš„ç¤¾ä¼šä¸»ä¹‰é“æ‹³ã€‚</p>
<h2 id="è­¦å‘Š"><a href="#è­¦å‘Š" class="headerlink" title="è­¦å‘Š"></a>è­¦å‘Š</h2><p>å¦‚æ­¤è–…ç¾Šæ¯›çš„é£é™©è¿˜æ˜¯æœ‰çš„ï¼Œå»ºè®®è°¨æ…è¡Œäº‹ï¼Œé¿å…å·æ²¡äº†ã€‚</p>
<p>å®Œæ•´workflow <a target="_blank" rel="noopener" href="https://gist.github.com/BennyThink/e95e00f50e20cc56eb5810a1b2feaaad">https://gist.github.com/BennyThink/e95e00f50e20cc56eb5810a1b2feaaad</a></p>
<p>Â </p>
<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>æˆ‘å·æ²¡äº†</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2022/01/2022012620085533.jpeg"><img src="/images/2022012620085533.jpeg"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/08/actions-celery/index/" data-id="clhp7rtdp0001s2qr3nn55tvu" data-title="ä½¿ç”¨GitHub Actionsè·‘Celery worker" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-celery-bot/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/03/celery-bot/index/" class="article-date">
  <time class="dt-published" datetime="2022-01-03T00:00:00.000Z" itemprop="datePublished">2022-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/01/03/celery-bot/index/">åˆ†å¸ƒå¼Telegram Bot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è‡ªå·±å†™ä¸€ä¸ªTelegram Botæ˜¯éå¸¸ç®€å•çš„ï¼Œæ— è®ºæ˜¯ä½¿ç”¨HTTP APIè¿˜æ˜¯MTProtoåè®®ã€‚</p>
<p>æœ€ç®€å•çš„echo botå¤§æ¦‚æ˜¯ä¸‹é¢çš„è¿™ç§æ ·å­</p>
<p>import logging<br>import time</p>
<p>from telebot import apihelper<br>import telebot</p>
<p>logging.basicConfig(level&#x3D;logging.INFO)</p>
<p>bot &#x3D; telebot.TeleBot(â€œ3XIâ€)<br>apihelper.proxy &#x3D; {â€˜httpsâ€™: â€˜socks5h:&#x2F;&#x2F;127.0.0.1:1086â€™}</p>
<p>@bot.message_handler(commands&#x3D;[â€˜startâ€™, â€˜helpâ€™])<br>def send_welcome(message):<br>    logging.info(â€œReceived messageâ€)<br>    bot.reply_to(message, â€œHowdy, how are you doing?â€)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    bot.polling()</p>
<p><img src="/images/2022010320464319.png"></p>
<p>å¾ˆæ£’æ˜¯ä¸æ˜¯ï¼</p>
<p>å½“ä½ çš„botå¼€å§‹æœ‰æ›´å¤šçš„ä¸šåŠ¡ï¼Œæ¯”å¦‚è¯´æŸ¥è¯¢æ•°æ®åº“ï¼Œå»è®¿é—®å…¶ä»–ç½‘ç«™ç„¶åè§£æï¼Œä½ å°±ä¼šå‘ç°è¿™ä¸ªbotä¼¼ä¹æœ‰ç‚¹åŠ›ä¸ä»å¿ƒï¼Œæ‰€æœ‰çš„å“åº”éƒ½æ…¢äº†ä¸€æ‹ã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼Œè¿™ä¸ªbotæ¯æ¬¡éƒ½è¦å»è®¿é—®å¦å¤–ä¸€ä¸ªç½‘ç«™ï¼Œç„¶åè¿”å›ï¼Œå¯æƒœçš„æ˜¯è¿™ä¸ªç½‘ç«™å“åº”å¤ªæ…¢äº†ï¼Œè¦5ç§’æ‰èƒ½è¿”å›</p>
<p>@bot.message_handler(commands&#x3D;[â€˜startâ€™])<br>def send_welcome(message):<br>    logging.info(â€œReceived start messageâ€)<br>    text &#x3D; requests.get(â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/%22).text">http://127.0.0.1:5000/&quot;).text</a><br>    bot.reply_to(message, text)</p>
<p>@bot.message_handler(commands&#x3D;[â€˜helpâ€™])<br>def send_help(message):<br>    logging.info(â€œReceived help messageâ€)<br>    bot.reply_to(message, â€œhelpâ€)</p>
<p>æ­¤æ—¶ä½ å°±ä¼šæƒŠå¥‡åœ°å‘ç°ï¼Œæ‰€æœ‰å…¶ä»–çš„æ“ä½œéƒ½è¢«é˜»å¡äº†ï¼Œç›´åˆ°startç»“æŸã€‚</p>
<p><img src="/images/2022010320470988.png"></p>
<p>è¿™è¦æ€ä¹ˆåŠå‘¢ï¼Ÿä¸€å®šæ˜¯æœ‰åŠæ³•çš„å¯¹å§</p>
<h2 id="å¢å¤§threadæ•°é‡"><a href="#å¢å¤§threadæ•°é‡" class="headerlink" title="å¢å¤§threadæ•°é‡"></a>å¢å¤§threadæ•°é‡</h2><p>æ— è®ºæ˜¯pyrogramè¿˜æ˜¯pytelegrambotapiï¼Œéƒ½æœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹æ•°é‡ã€‚</p>
<p>å¯¹äºpytelegrambotapiæ¥è¯´ï¼Œå‚æ•°æ˜¯<code>num_threads=2</code>ï¼Œæ„é€ botçš„æ—¶å€™å°±å¯ä»¥æŒ‡å®šï¼›</p>
<p>å¯¹äºpyrogramæ¥è¯´ï¼Œå‚æ•°æ˜¯<code>workers: int = Scaffold.WORKERS</code>ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯<code>min(32, os.cpu_count() + 4)</code>ã€‚</p>
<p>é‚£ä¹ˆåªè¦æˆ‘ä»¬åœ¨ä¸€å®šèŒƒå›´å†…å¢åŠ è¿™ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆå°±åº”è¯¥åœ¨ä¸€å®šç¨‹åº¦å†…ä¸ä¼šååº”è¿Ÿé’å¤ªå¤šã€‚æ¯”å¦‚è¯´ï¼š</p>
<p>bot &#x3D; telebot.TeleBot(â€œtokenâ€, num_threads&#x3D;100)</p>
<p>æ˜¯è¿™ä¸ªé“ç†çš„ï¼</p>
<h2 id="ä½¿ç”¨async"><a href="#ä½¿ç”¨async" class="headerlink" title="ä½¿ç”¨async"></a>ä½¿ç”¨async</h2><p>ä½¿ç”¨asyncä¹Ÿå¯ä»¥æ°åˆ°å¥½å¤„çš„è§£å†³æˆ‘ä»¬ä»¥ä¸Šé˜»å¡çš„é—®é¢˜ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨<code>AsyncTeleBot</code></p>
<p>from telebot.async_telebot import AsyncTeleBot<br>bot &#x3D; AsyncTeleBot(â€œTOKENâ€)</p>
<p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¸èƒ½ç›´æ¥ç”¨requestsäº†ï¼Œå› ä¸ºrequestsæ˜¯syncçš„ï¼Œç®€å•èµ·è§æˆ‘ä»¬è¿™ç”¨aiohttpä½œä¸ºæ¼”ç¤ºä¾‹å­</p>
<p>@bot.message_handler(commands&#x3D;[â€˜startâ€™])<br>async def send_welcome(message):<br>    logging.info(â€œReceived start messageâ€)<br>    async with aiohttp.ClientSession() as session:<br>        async with session.get(â€˜<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>â€˜) as response:<br>            html &#x3D; await response.text()<br>    await bot.reply_to(message, html)</p>
<p>@bot.message_handler(commands&#x3D;[â€˜helpâ€™])<br>async def send_help(message):<br>    logging.info(â€œReceived help messageâ€)<br>    await bot.reply_to(message, â€œhelpâ€)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    asyncio.run(bot.polling())</p>
<p>å—¯ï¼Œä¸ä¼šé˜»å¡çš„ã€‚</p>
<p><img src="/images/2022010320471782.png"></p>
<p>è¿™ç§åšæ³•ä¹Ÿæ˜¯ä¸€ç§å¾ˆæµè¡Œçš„åŠæ³•ï¼Œä½†æ˜¯æˆ‘ä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢ã€‚ä¸€ä¸ªæ˜¯å› ä¸ºèœï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å› ä¸ºå¾ˆå¤šåº“éƒ½æ˜¯éasyncçš„ï¼Œåˆ‡æ¢è¿‡å»éš¾åº¦å¯èƒ½æ¯”è¾ƒå¤§ã€‚å°½ç®¡ä¹Ÿæœ‰äº›monkey patchå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰è¿™ç§åšæ³•å¤ªè¿‡äºé­”æ³•ã€‚</p>
<h2 id="æ›´å¤æ‚çš„åœºæ™¯"><a href="#æ›´å¤æ‚çš„åœºæ™¯" class="headerlink" title="æ›´å¤æ‚çš„åœºæ™¯"></a>æ›´å¤æ‚çš„åœºæ™¯</h2><p>é€šå¸¸æ¥è¯´ï¼Œç®€å•åŠ å¤§çº¿ç¨‹æ•°é‡æˆ–è€…ç”¨asyncå³å¯è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯æ¯”å¦‚ä½ çš„åœºæ™¯æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚è¯´æ˜¯ä»YouTubeä¸Šä¸‹è½½è§†é¢‘ï¼Œéœ€è¦å ç”¨å¤§é‡çš„å¸¦å®½ï¼Œå³ä½¿çº¿ç¨‹æ•°é‡è¶³å¤Ÿï¼Œé‚£ä¹ˆå¹¶å‘é‡é«˜çš„æ—¶å€™ï¼Œä¸‹è½½é€Ÿåº¦ä¹Ÿä¼šè¢«é™åˆ¶äºæœ¬æœºçš„å¸¦å®½ã€‚</p>
<p>æ—¢ç„¶MTProtoåè®®æœ€é«˜å…è®¸10ä¸ªå®¢æˆ·ç«¯åŒæ—¶åœ¨çº¿ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•åŒæ—¶åœ¨å¤šå°æœºå™¨ä¸Šç™»å½•ï¼Œç„¶ååˆ†å‘ä»»åŠ¡ï¼Œæ¯ä¸ªæœºå™¨æ¥æ”¶åˆ°ä»»åŠ¡ä¹‹ååªè´Ÿè´£å¤„ç†è‡ªå·±çš„ä»»åŠ¡ï¼Œè¿™æ ·æ•´ä½“çš„ååé‡å°±å¯ä»¥éå¸¸å®¹æ˜“çš„æ°´å¹³æ‰©å±•ã€‚</p>
<h2 id="Celery-åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—"><a href="#Celery-åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="Celery - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—"></a>Celery - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</h2><p>Celery æ˜¯ä¸€ä¸ªç®€å•ã€çµæ´»ä¸”å¯é çš„ï¼Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶ä¸”æä¾›ç»´æŠ¤è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„å¿…éœ€å·¥å…·ã€‚</p>
<p>æ²¡é”™çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤šå°æœºå™¨ä¹‹é—´é€šè¿‡<a target="_blank" rel="noopener" href="https://nova.moe/deploy-wireguard-on-ubuntu-bionic/">WireGuardç»„ä¸€ä¸ªå¤§å†…ç½‘</a>ï¼Œç„¶åé€šè¿‡celeryåˆ†å‘ä»»åŠ¡ã€‚</p>
<p>ä½¿ç”¨Celeryéå¸¸ç®€å•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡å¥½brokerï¼Œæ¯”å¦‚è¯´ä½¿ç”¨rediså§ï¼</p>
<p>from celery import Celery<br>app &#x3D; Celery(â€˜helloâ€™, broker&#x3D;â€™redis:&#x2F;&#x2F;localhost:6379&#x2F;0â€™, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€</p>
<p>@app.task<br>def hello():<br>    return â€˜hello worldâ€™</p>
<p>ç„¶åè¿è¡Œworker</p>
<p>celery -A tasks worker â€“loglevel&#x3D;info</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œceleryè¿æ¥åˆ°äº†redisï¼Œ<code>concurrency</code>æ˜¯8ï¼Œä½¿ç”¨<code>prefork</code></p>
<p><img src="/images/2022010320471965.png"></p>
<p>ä¹‹åæˆ‘ä»¬åªè¦ä½¿ç”¨delayæ–¹æ³•æäº¤ä»»åŠ¡å°±å¯ä»¥äº†</p>
<p>&gt; python3 master [bd0f485] deleted untracked<br>Python 3.9.9 (main, Nov 21 2021, 03:22:47)<br>[Clang 12.0.0 (clang-1200.0.32.29)] on darwin<br>Type â€œhelpâ€, â€œcopyrightâ€, â€œcreditsâ€ or â€œlicenseâ€ for more information.</p>
<blockquote>
<blockquote>
<blockquote>
<p>from tasks import add<br>add.delay(8,1)<br>&lt;AsyncResult: cf06f416-bdf7-4ea9-99bc-7ba136329b7f&gt;</p>
</blockquote>
</blockquote>
</blockquote>
<p>celery workerä¼šæ‹¿åˆ°ä»»åŠ¡ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚å¦‚æœæœ‰å¤šä¸ªworkerå¹¶ä¸”å…¨éƒ¨ç©ºé—²ï¼Œé‚£ä¹ˆå¤§å®¶æ‹¿åˆ°ä»»åŠ¡çš„å‡ ç‡æ˜¯å‡ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯round robinã€‚</p>
<h2 id="celery-pyrogram"><a href="#celery-pyrogram" class="headerlink" title="celery+pyrogram"></a>celery+pyrogram</h2><p>å¥½æäº†ï¼Œé‚£å°±è¿™ä¹ˆæï¼Œç”¨pyrogramåªè¦ç¡®ä¿sessionåå­—ä¸åŒï¼Œé‚£ä¹ˆå°±æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯ã€‚</p>
<p>äºæ˜¯ä½ å…´è‡´å‹ƒå‹ƒçš„å†™å¥½äº†ä»£ç </p>
<p># bot.py<br>from pyrogram import filters<br>from client_init import create_app<br>from tasks import send_hello</p>
<p>app &#x3D; create_app()</p>
<p>@app.on_message(filters.command([â€œ&#x2F;startâ€]))<br>def hello(client, message):<br>    send_hello.delay(message.chat.id)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    app.run()</p>
<h1 id="tasks-py"><a href="#tasks-py" class="headerlink" title="tasks.py"></a>tasks.py</h1><p>from celery import Celery<br>from client_init import create_app</p>
<p>app &#x3D; Celery(â€˜tasksâ€™, broker&#x3D;â€™redis:&#x2F;&#x2F;localhost:6379&#x2F;0â€™, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€)<br>tg_client &#x3D; create_app(â€œdevelopmentâ€)<br>tg_client.start()</p>
<p>@app.task<br>def send_hello(user_id):<br>    tg_client.send_message(user_id, â€œHelloâ€)</p>
<p>ç„¶åå‘é€äº†ä¸€ä¸ª<code>/start</code>ï¼Œå¥‡è¿¹å¹¶æ²¡æœ‰å‘ç”Ÿã€‚äº‹å®å°±åƒç¤¾ä¼šä¸»ä¹‰é“æ‹³ä¸€æ ·ï¼Œæ€»ä¼šæŠŠä½ çš„è„¸æ‰“å¾—å•ªå•ªä½œå“ã€‚</p>
<p><img src="/images/2022010320472117.jpeg"></p>
<p>è¡Œå§ï¼Œè¿™æ˜¯macOS&#x2F;Python.org&#x2F;Celeryçš„é”…ï¼ŒçŒœæµ‹æ˜¯å’Œsubprocessåœ¨ä¸åŒå¹³å°ä¸Šçš„å®ç°æœ‰å…³ã€‚å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯preforkæ¨¡å¼ã€‚</p>
<p>é‚£æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬æ¢åˆ°Linuxè¯•ä¸€ä¸‹çœ‹çœ‹</p>
<p>è™½ç„¶æ²¡æœ‰æŠ¥é”™äº†ï¼Œä½†æ˜¯ä¸ºä½•æ”¶åˆ°äº†æ¶ˆæ¯å´æ²¡æœ‰æ‰§è¡Œï¼Ÿæˆ–è€…è¯´æ‰§è¡Œå¡ä½äº†ï¼Ÿå¤šæ‰“ç‚¹logè¯•è¯•çœ‹ï¼Ÿ</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    print(tg_client.get_me())<br>    tg_client.send_message(user_id, â€œHelloâ€)<br>    logging.info(â€œfinish tasksâ€)</p>
<p><img src="/images/2022010320472226.png"></p>
<p>ä¸ºä»€ä¹ˆï¼Ÿ</p>
<h2 id="ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆclientå¡ä½äº†ï¼Ÿ</h2><p>celeryé»˜è®¤æ˜¯preforkæ¨¡å¼ï¼Œæ„å‘³celeryä¼šforkå‡ºæ¥ä¸€å †å­è¿›ç¨‹æ¥å¹²æ´»ï¼Œç„¶åè‡ªå·±æˆä¸ºåŒ…å·¥å¤´ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æ—¥å¿—ä¸­çœ‹åˆ° ForkPoolWorker-xçš„æ‰§è¡Œæ—¥å¿—çš„åŸå› ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æ˜¯åœ¨file-levelå®šä¹‰çš„<code>tg_client</code>ï¼Œè€Œæ‰§è¡Œä»»åŠ¡çš„workeråœ¨æ”¶åˆ°ä¸‹è½½è¯·æ±‚æ—¶è¦å»è®¿é—®<code>tg_client</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚å†åŠ ä¸Špyrogramæ˜¯å¼‚æ­¥åº“ã€‚æ‰€ä»¥é—®é¢˜å°±æ›´ä¸¥é‡äº†</p>
<p>è§£å†³æ–¹æ¡ˆä¹‹ä¸€æ˜¯ï¼Œæˆ‘ä»¬åœ¨tasksä¸­ä½¿ç”¨<code>with</code>ï¼Œè¿™æ ·ç›¸å½“äºæ¯æ¬¡tasksæ‰§è¡Œéƒ½è¦ç»å†å®Œæˆçš„è¿æ¥æ­¥éª¤ï¼Œå°±å¥½åƒå¼€æœº-å¹²æ´»-å…³æœºä¸€æ ·ã€‚</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    with create_app(â€œdevelopmentâ€) as tg_client:<br>        print(tg_client.get_me())<br>        tg_client.send_message(user_id, â€œHelloâ€)<br>    logging.info(â€œfinish tasksâ€)</p>
<p>ç¬¬ä¸€æ¬¡ä¼šæ¯”è¾ƒæ…¢ï¼Œåç»­ä¼šä½¿ç”¨åˆ°sessionæ–‡ä»¶ï¼Œèƒ½ç¨å¾®å¿«ä¸€ç‚¹ã€‚</p>
<p>å¦‚æœçªç„¶æ¥äº†10ä¸ªå¹¶å‘çš„ä»»åŠ¡â€¦â€¦ğŸ’£é‚£è¿™å°±å®Œè›‹å•¦</p>
<h2 id="soloæ¨¡å¼"><a href="#soloæ¨¡å¼" class="headerlink" title="soloæ¨¡å¼"></a>soloæ¨¡å¼</h2><p>celery workeré™¤äº†preforkæ¨¡å¼ï¼Œè¿˜æœ‰geventã€eventletã€threadså’Œsoloè¿™å››ç§ã€‚<a target="_blank" rel="noopener" href="https://blog.csdn.net/cnweike/article/details/105840936">å®ƒä»¬çš„åŒºåˆ«</a>å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p>1. preforkï¼ˆé»˜è®¤ï¼‰ï¼šworkerä¼šå¼€å¯å¤šä¸ªè¿›ç¨‹æ¥æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡å®ä¾‹ï¼ˆtask instanceï¼‰ï¼Œé€‚åˆäºCPUå¯†é›†å‹åº”ç”¨ï¼›è¿™ä¼šå¼€å¯ä¸€ä¸ªworkerä¸»è¿›ç¨‹ï¼Œå’Œä¸€ç»„å·¥ä½œè¿›ç¨‹ï¼ˆå¦‚æœå¹¶è¡Œåº¦è®¾ç½®ä¸º2ï¼Œå½“ä½¿ç”¨ps -ef | grep celeryçš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°3ä¸ªè¿›ç¨‹ï¼Œå¤šå‡ºæ¥çš„ä¸€ä¸ªå°±æ˜¯ä¸»è¿›ç¨‹ï¼‰ã€‚</p>
<p>celery -A djangogo worker -P prefork -c 2</p>
<p>2. eventletï¼šé€‚ç”¨äºI&#x2F;Oå¯†é›†å‹åº”ç”¨ï¼›åº•å±‚ä½¿ç”¨epollæˆ–è€…libeventæ¥é©±åŠ¨å¤šè·¯å¤ç”¨ã€‚è¦æ³¨æ„ä¸è¦åœ¨è¿™æ ·çš„workerä¸­è¿è¡ŒCPUå¯†é›†å‹çš„ä»»åŠ¡å®ä¾‹ã€‚</p>
<p>celery -A djangogo worker -P eventlet -c 20000</p>
<p>3. geventï¼šç±»ä¼¼äºeventletï¼ŒåŸºäºlibevæˆ–è€…libuväº‹ä»¶å¾ªç¯ã€‚</p>
<p>celery -A djangogo worker -P gevent -c 20000</p>
<p>4.soloï¼šæ¥æ”¶æ§åˆ¶æŒ‡ä»¤åŒè¿è¡Œä»»åŠ¡å®ä¾‹åœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œæ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡å®ä¾‹æ‰§è¡Œæ—¶é—´è¾ƒé•¿ä¼šé˜»å¡æ§åˆ¶æŒ‡ä»¤è¯·æ±‚çš„å“åº”ï¼Œå®¢æˆ·ç«¯éœ€è¦é€‚åº¦å¢åŠ è¶…æ—¶æ—¶é—´è®¾ç½®ã€‚ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨ï¼‰</p>
<p>5. threadsï¼šä»»åŠ¡å®ä¾‹åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™é‡Œçš„çº¿ç¨‹å°±æ˜¯æˆ‘ä»¬é€šå¸¸è®¤çŸ¥ä¸Šçš„çº¿ç¨‹ï¼Œçº¿ç¨‹ç»´æŠ¤é€šå¸¸è¦æ˜æ˜¾å¤§äºåç¨‹ï¼Œæ‰€ä»¥å¹¶è¡Œåº¦çš„è®¾ç½®ä¹Ÿéœ€è¦è€ƒè™‘åˆ°ç»´æŠ¤çš„ä»£ä»·ã€‚</p>
<p>é‚£ä¹ˆç”¨soloæ¨¡å¼ä¼¼ä¹å¯è¡Œ</p>
<p>tg_client &#x3D; create_app(â€œdevelopmentâ€)<br>tg_client.start()</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    # with create_app(â€œdevelopmentâ€) as tg_client:<br>    text &#x3D; requests.get(â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:5000" ).text">http://127.0.0.1:5000&quot;).text</a><br>    tg_client.send_message(user_id, text)<br>    logging.info(â€œfinish tasksâ€)</p>
<h1 id="run-celery"><a href="#run-celery" class="headerlink" title="run celery"></a>run celery</h1><p>celery -A tasks worker â€“loglevel&#x3D;info â€“pool&#x3D;solo</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2022/01/202201032109099.jpeg"><img src="/images/202201032109099.jpeg"></a></p>
<p>è¿™æ ·å½“ç„¶ä¹Ÿè¡Œï¼Œä½†æ˜¯ä¸€ä¸ªå¾ˆä¸¥è‚ƒçš„é—®é¢˜å°±æ˜¯ï¼Œsoloæƒ…å†µä¸‹å¦‚æœå‡½æ•°æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¼šä½¿å¾—åç»­tasksè¢«é˜»å¡ï¼Œä¹Ÿå°±æ˜¯è¯´soloä¸‹concurrencyæ˜¯æ²¡æœ‰ç”¨çš„ã€‚è¿™â€¦â€¦</p>
<h2 id="threadsæ¨¡å¼"><a href="#threadsæ¨¡å¼" class="headerlink" title="threadsæ¨¡å¼"></a>threadsæ¨¡å¼</h2><p>é‚£ä¹ˆç”¨threadsæ¨¡å¼å¦‚ä½•ï¼Ÿåæ­£å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿåªæ˜¯ç½‘ç»œç›¸å…³çš„æ“ä½œï¼Œä¸å¤ªæ¶‰åŠåˆ°è®¡ç®—ã€‚</p>
<p>celery -A tasks worker â€“loglevel&#x3D;info â€“pool&#x3D;threads â€“concurrency&#x3D;20</p>
<p>æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œè™½ç„¶å¯ä»¥å¹¶å‘ï¼Œä½†æ˜¯ä¼¼ä¹åˆåƒpreforkæ¨¡å¼ä¸€æ ·ï¼Œå¡ä½äº†â€¦â€¦</p>
<p>æ ¹æœ¬åŸå› æ˜¯celery tasksæ˜¯é˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œè€Œpyrogramä½œä¸ºå¼‚æ­¥åº“<strong>æ˜¯è¦ä¾èµ–ä¸»çº¿ç¨‹çš„</strong>ã€‚</p>
<p>ä½†æ˜¯æ”¹æ”¹è¿˜èƒ½æŠ¢æ•‘ä¸€ä¸‹</p>
<h3 id="å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram-1-xç‰ˆæœ¬çš„è¯"><a href="#å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram-1-xç‰ˆæœ¬çš„è¯" class="headerlink" title="å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram 1.xç‰ˆæœ¬çš„è¯"></a>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯pyrogram 1.xç‰ˆæœ¬çš„è¯</h3><p>from pyrogram import idle</p>
<p>logging.basicConfig(level&#x3D;logging.INFO)<br>app &#x3D; Celery(â€˜tasksâ€™, broker&#x3D;â€™redis:&#x2F;&#x2F;host.docker.internal:6379&#x2F;0â€™, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€)<br>tg_client &#x3D; create_app(â€œdevelopmentâ€)</p>
<p>@app.task<br>def send_hello(user_id):<br>    logging.info(â€œreceive tasksâ€)<br>    # with create_app(â€œdevelopmentâ€) as tg_client:<br>    text &#x3D; requests.get(â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:5000" ).text">http://127.0.0.1:5000&quot;).text</a><br>    tg_client.send_message(user_id, text)<br>    logging.info(â€œfinish tasksâ€)</p>
<p>def run_celery():<br>    argv &#x3D; [â€œ-Aâ€, â€œtasksâ€, â€˜workerâ€™, â€˜â€“loglevel&#x3D;infoâ€™, â€œâ€“pool&#x3D;threadsâ€, â€œâ€“concurrency&#x3D;200â€]<br>    app.worker_main(argv)</p>
<p>if __name__ &#x3D;&#x3D; â€˜__main__â€˜:<br>    tg_client.start()<br>    threading.Thread(target&#x3D;run_celery, daemon&#x3D;True).start()<br>    idle()<br>    tg_client.stop()</p>
<h1 id="run-celery-1"><a href="#run-celery-1" class="headerlink" title="run celery"></a>run celery</h1><p>python3 tasks.py</p>
<p>è¿™æ ·å°±å¯ä»¥é¡ºåˆ©æ”¶å‘æ¶ˆæ¯å•¦ğŸ˜„</p>
<h2 id="å…¶ä»–æ¨¡å¼"><a href="#å…¶ä»–æ¨¡å¼" class="headerlink" title="å…¶ä»–æ¨¡å¼"></a>å…¶ä»–æ¨¡å¼</h2><p>è‡³äºgeventã€eventletï¼Œåæ­£æˆ‘æ˜¯æ²¡æå‡ºæ¥â€¦â€¦</p>
<h2 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h2><h3 id="ç›‘æ§worker"><a href="#ç›‘æ§worker" class="headerlink" title="ç›‘æ§worker"></a>ç›‘æ§worker</h3><p>åœ¨æœ‰äº†workeråï¼Œæ€»æƒ³åšä¸€äº›ç›‘æ§ä»€ä¹ˆçš„ï¼Œcelery floweræ­£å¥½æ˜¯å¹²è¿™ä»¶äº‹æƒ…çš„</p>
<p>celery -A tasks worker â€“loglevel&#x3D;info</p>
<p>ç”±äºæˆ‘ä»¬çš„tg_clientæ˜¯file-levelï¼Œå¹¶ä¸”ç”±äºflowerå’Œæœ€æ–°ç‰ˆæœ¬çš„celeryä¼¼ä¹æœ‰äº›å…¼å®¹æ€§é—®é¢˜ï¼Œæ²¡åŠæ³•ä¸ç”¨-Aå–§åš£ã€‚å› æ­¤ä¸ºäº†é¿å…æµªè´¹ä¸€ä¸ªclientå¹¶åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¼„ä¸€ä¸ªdummy tasks</p>
<p># flower_tasks.py<br>app &#x3D; Celery(â€˜tasksâ€™, broker&#x3D;BROKER, timezone&#x3D;â€Asia&#x2F;Shanghaiâ€)</p>
<p>ç„¶å</p>
<p>celery -A flower_tasks flower</p>
<p>ç”šè‡³å¯ä»¥æ ¹æ®ä¸ªäººæƒ…å†µä½¿ç”¨<code>--persistent</code>ã€<code>basic auth</code>ä¹‹ç±»çš„ã€‚çœ‹çœ‹è¿™æ•ˆæœï¼ˆ</p>
<p><img src="/images/2022010320472376.jpeg" alt="å›¾åƒ"></p>
<p>è¿˜å¯ä»¥çœ‹åˆ°å“ªäº›ä»»åŠ¡æ˜¯å¤±è´¥çš„ï¼Œä¿®å¤äº†å¥½å‡ ä¸ªbug</p>
<p><img src="/images/2022010320472569.jpeg" alt="å›¾åƒ"></p>
<h3 id="æŒç»­éƒ¨ç½²"><a href="#æŒç»­éƒ¨ç½²" class="headerlink" title="æŒç»­éƒ¨ç½²"></a>æŒç»­éƒ¨ç½²</h3><p>workerè¿™ä¹ˆå¤šï¼Œæ¯æ¬¡æ›´æ–°éƒ½è¦sshä¸Šå»å¾ˆéº»çƒ¦ï¼Œå³ä½¿æ˜¯ç”¨äº†<code>docker-compose</code>ä¹Ÿä¸€æ ·ã€‚æ–¹æ³•ä¹‹ä¸€æ˜¯ç”¨ansibleï¼Œæ–¹æ³•ä¹‹äºŒæ˜¯ç”¨GitHub Actionsã€‚</p>
<p>æˆ‘çš„ç”¨æ³•æ˜¯åœ¨Github Actionsä¸Šsshåˆ°æœºå™¨ï¼Œç„¶åæ‰§è¡Œæˆ‘å†™å¥½çš„<code>Makefile</code>ã€‚<code>Makefile</code>çš„å†…å®¹å¤§æ¦‚å°±æ˜¯<code>docker pull docker-compose up -d</code>ä¹‹ç±»çš„å•¦ã€‚</p>
<p>å¯ä»¥å‚è€ƒè¿™é‡Œ <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/upgrade.yml">https://github.com/tgbot-collection/ytdlbot/blob/master/.github/workflows/upgrade.yml</a></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¤§æ¦‚æœ‰ä¸‰ç§å¯è¡Œçš„æ–¹æ³•ï¼Œä»¥<code>tg_client.get_me()</code>å’Œæˆ‘çš„æ…¢é€Ÿæ¢¯å­ä¸ºä¾‹ï¼š</p>
<ol>
<li>prefork+withï¼Œæ¯æ¬¡éƒ½è¦å¼€æœº-å¹²æ´»-å…³æœºã€‚ç¬¬ä¸€æ¬¡ä¼šæ¯”è¾ƒæ…¢å¤§æ¦‚15-20ç§’ï¼Œåç»­ä¼šå¿«ä¸€ç‚¹ã€‚å‚è€ƒæ—¶é—´2-3s</li>
<li>soloæ¨¡å¼ï¼Œåªèƒ½å¤„ç†ä¸€ä¸ªï¼Œæ¯æ¬¡å¤„ç†å‚è€ƒæ—¶é—´0.5sæˆ–æ›´ä½</li>
<li>threadsæ¨¡å¼ï¼Œåªè¦ä¸æ¶‰åŠåˆ°å¤§é‡è®¡ç®—é‚£ä¹ˆé—®é¢˜å°±ä¸å¤§ï¼Œé‚£ä¹ˆæ¯æ¬¡å¤„ç†å‚è€ƒæ—¶é—´ä¸º0.5sæˆ–æ›´ä½</li>
</ol>
<h2 id="æœ€åâ€¦â€¦"><a href="#æœ€åâ€¦â€¦" class="headerlink" title="æœ€åâ€¦â€¦"></a>æœ€åâ€¦â€¦</h2><p>æ¬¢è¿æµé‡å¤ªå¤šçš„ç›†å‹æ¥è·Ÿæˆ‘ä¸€èµ·åšworkerï¼åé¢æœ‰é™é€Ÿæ¥ï¼</p>
<p>ä¹Ÿå¸Œæœ›æœ‰äººèƒ½å¤Ÿå¸®æˆ‘è§£å†³preforkä¸‹çš„é‚£ä¸ªé—®é¢˜â€¦â€¦ğŸŒš ğŸŒš</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://github.com/pyrogram/pyrogram/issues/480">https://github.com/pyrogram/pyrogram/issues/480</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cnweike/article/details/105840936">https://blog.csdn.net/cnweike/article/details/105840936</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ytdlbot">https://github.com/tgbot-collection/ytdlbot</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/03/celery-bot/index/" data-id="clhp7rtev0015s2qraooceimd" data-title="åˆ†å¸ƒå¼Telegram Bot" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-docker-windows-container/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/25/docker-windows-container/index/" class="article-date">
  <time class="dt-published" datetime="2021-12-25T00:00:00.000Z" itemprop="datePublished">2021-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/what/">what</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/25/docker-windows-container/index/">ä½¿ç”¨Dockerè·‘Windowsï¼</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>æœ¬ç²¾ç¥ç—…äººåˆæ¥é—¹å¦–å•¦ï¼</strong></p>
<hr>
<p>è‡ªä»æœ‰äº†è¿™ç§å®¹å™¨åŒ–æŠ€æœ¯ä¹‹åï¼Œæƒ³è¦åšæµ‹è¯•ï¼Œæ„å»ºç‚¹ä»€ä¹ˆï¼Œæˆ–è€…ç®€å•çš„ä½“éªŒä¸‹æŸä¸ªLinux Distrosçš„cliå°±å˜çš„æ— æ¯”ç®€å•ï¼š</p>
<p>-&lt;255:%&gt;- docker run â€“rm -it ubuntu:20.04 bash<br>Unable to find image â€˜ubuntu:20.04â€™ locally<br>20.04: Pulling from library&#x2F;ubuntu<br>7b1a6ab2e44d: Already exists<br>Digest: sha256:626ffe58f6e7566e00254b638eb7e0f3b11d4da9675088f4781a50ae288f3322<br>Status: Downloaded newer image for ubuntu:20.04</p>
<p>root@aa28b038528e:&#x2F;# lscpu<br>Architecture: x86_64<br>CPU op-mode(s): 32-bit, 64-bit<br>Byte Order: Little Endian</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å®¹å™¨é‡Œä¸€é¡¿æ“ä½œï¼Œç„¶åæ„å»ºå‡ºæ¥ä¸€ä¸ªä¸œè¥¿æ‹¿æ¥ç”¨ï¼Œæ¯”å¦‚ä¹‹å‰åœ¨<a target="_blank" rel="noopener" href="https://dmesg.app/fix-ax3600.html">ç¼–è¯‘LEDEå›ºä»¶</a>æ—¶ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆç©çš„ã€‚</p>
<p>æŸä¸€å¤©ï¼Œæˆ‘çªç„¶æ¥åˆ°è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šä½¿ç”¨pyinstalleræŠŠPythonè„šæœ¬ç¼–è¯‘æˆä¸åŒå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”è¦å°½å¯èƒ½è·‘åœ¨å®¹å™¨å†…ã€‚è¿™æ€ä¹ˆåšï¼Ÿ</p>
<ul>
<li>å‡†å¤‡Windows macOSå’ŒLinuxçš„æœºå™¨ï¼Œç¼–è¯‘ç„¶åæ‹¿æ–‡ä»¶ã€‚å¤ªéº»çƒ¦äº†</li>
<li>pyinstaller äº¤å‰ç¼–è¯‘ï¼Ÿä¸å¥½æ„æ€pyinstallerä¸æ”¯æŒäº¤å‰ç¼–è¯‘ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯1.5ç‰ˆæœ¬ç§»é™¤äº†è¿™ä¸ªåŠŸèƒ½</li>
<li>Linux containerè·‘ä¸€ä¸ªwineï¼Œwineé‡Œè·‘Windowsç‰ˆæœ¬çš„Pythonï¼Ÿé€†å‘å·¥ç¨‹çœŸçš„é è°±å˜›ï¼Ÿä¼šå‡ºç°å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„bugå§</li>
<li>åœ¨dockeré‡Œæƒ³åŠæ³•è·‘ä¸ªWindowsï¼Ÿå“å˜¿ï¼Ÿ</li>
</ul>
<p>å½“ä½ å…´è‡´å‹ƒå‹ƒçš„æ‰“å¼€Docker Hubï¼Œæœç´¢windowså‘ç°ç«Ÿç„¶æœ‰Windowsçš„imageï¼ŒWindows base OS imagesï¼ŒWindows Server Coreï¼Œä¸ç®¡äº†å…ˆè·‘ä¸ºæ•¬ï¼š</p>
<p>-&lt;130:%&gt;- docker run mcr.microsoft.com&#x2F;windows:20H2<br>Unable to find image â€˜mcr.microsoft.com&#x2F;windows:20H2â€™ locally<br>20H2: Pulling from windows<br>docker: no matching manifest for linux&#x2F;amd64 in the manifest list entries.<br>See â€˜docker run â€“helpâ€™.</p>
<p><img src="/images/2021122518122870.jpeg" alt="ooc"></p>
<p>dockerå…¶å®æ˜¯ä½¿ç”¨äº†Linuxå†…æ ¸çš„cgroupç­‰æŠ€æœ¯æ¥å®ç°çš„ï¼Œå®¹å™¨è¿˜æ˜¯ä½¿ç”¨çš„å®¿ä¸»æœºå†…æ ¸ï¼Œå®¹å™¨çš„è¿›ç¨‹å…¶å®å°±æ˜¯è·‘åœ¨å®¿ä¸»æœºä¸Šçš„ï¼Œå®¿ä¸»æœºè¿˜èƒ½çœ‹è§åªä¸è¿‡æœ‰ä¸€å®šéš”ç¦»ã€‚Windowså¹¶ä¸ç”¨Linux Kernelï¼Œé‚£è·‘ä¸ªä»€ä¹ˆå˜›ã€‚ä¸Šé¢è¿™äº›imageçš„OS Archå…¶å®ä¹Ÿæ˜¯windows&#x2F;amd64çš„ã€‚</p>
<p>å¯èƒ½æ›´éœ€è¦çš„æ˜¯è¿™ä¸ª,ç¡®å®å¯ä»¥è·‘Windows containerï¼Œåªä¸è¿‡éœ€è¦Windows hostå•¦ã€‚å¹¶ä¸”1709çš„Windowsåªèƒ½è·‘1709çš„image</p>
<p><img src="/images/2021122518122994.jpeg"></p>
<p>è¿™ä¸å°±åˆå›åˆ°äº†å¼€å¤´å˜›ã€‚</p>
<p>çªç„¶æƒ³èµ·æ¥æœ‰ä¸€ä¸ªå¾ˆç¥å¥‡çš„é¡¹ç›®<a target="_blank" rel="noopener" href="https://github.com/sickcodes/Docker-OSX">Docker-OSX</a>ï¼Œå…¶å®ç°ï¼Œç®€å•è¯´æ˜¯ç”¨KVMè·‘äº†ä¸ªmacOSçš„è™šæ‹Ÿæœºï¼Œå°±åƒé»‘è‹¹æœä¸€æ ·ã€‚é‚£ä¹ˆç†è®ºä¸ŠWindowsä¹Ÿä¸€å®šèƒ½æ‰¾åˆ°åŠæ³•åšåˆ°ã€‚é‚£ä¹ˆå°±ä¸Šqemuï¼ä¸è¡Œæˆ‘ä»¬å°±è½¯ä»¶æ¨¡æ‹Ÿï¼</p>
<p>[v_blue] è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¸œè¥¿å«dind â€“ Docker In Dockerã€‚ [&#x2F;v_blue] å¥—å¨ƒå˜›ï¼Œæˆ‘æœ€å¼ºã€‚</p>
<h2 id="è¿è¡Œç¯å¢ƒæ£€æŸ¥"><a href="#è¿è¡Œç¯å¢ƒæ£€æŸ¥" class="headerlink" title="è¿è¡Œç¯å¢ƒæ£€æŸ¥"></a>è¿è¡Œç¯å¢ƒæ£€æŸ¥</h2><p>æ— è®ºæ˜¯VMï¼Œè¿˜æ˜¯ç‰©ç†æœºå…¶å®éƒ½å¯ä»¥ã€‚</p>
<h2 id="KVMæ”¯æŒ"><a href="#KVMæ”¯æŒ" class="headerlink" title="KVMæ”¯æŒ"></a>KVMæ”¯æŒ</h2><p>å¦‚æœèƒ½æœ‰KVMæ”¯æŒçš„è¯ï¼Œè™šæ‹Ÿæœºåº”è¯¥ä¼šè·‘çš„æ›´æµç•…ã€‚</p>
<p>å¦‚æœä½ æ˜¯VMï¼ŒCPUæ”¯æŒIntel VT-x&#x2F; AMD-vç­‰ï¼Œé‚£ä¹ˆåœ¨è™šæ‹ŸåŒ–è½¯ä»¶çš„è®¾ç½®ä¸­å°±å¯ä»¥çœ‹åˆ°</p>
<p>ESXiæ˜¯è¿™æ ·çš„</p>
<p><img src="/images/2021122518123126.png"></p>
<p>Fusionæ˜¯è¿™æ ·çš„</p>
<p><img src="/images/2021122518123260.png"></p>
<p>å‹¾é€‰ä¹‹åï¼Œ <code>ls /dev/kvm</code> å°±åº”è¯¥æœ‰ç»“æœå•¦</p>
<h2 id="å®¹å™¨å¯ç”¨-privileged-mode"><a href="#å®¹å™¨å¯ç”¨-privileged-mode" class="headerlink" title="å®¹å™¨å¯ç”¨ privileged mode"></a>å®¹å™¨å¯ç”¨ privileged mode</h2><p><code>docker run --privileged xxx</code>å³å¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨å®¹å™¨å†…è®¿é—®å®¿ä¸»æœºçš„<code>/dev/kvm</code>ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨<code>--device</code></p>
<h2 id="åœ¨å®¹å™¨å†…å‡†å¤‡qemuä¸€ç®©ç­"><a href="#åœ¨å®¹å™¨å†…å‡†å¤‡qemuä¸€ç®©ç­" class="headerlink" title="åœ¨å®¹å™¨å†…å‡†å¤‡qemuä¸€ç®©ç­"></a>åœ¨å®¹å™¨å†…å‡†å¤‡qemuä¸€ç®©ç­</h2><p>ä»¥Ubuntu 20.04ä¸ºä¾‹</p>
<p>apt update &amp;&amp; apt install qemu-kvm</p>
<h2 id="å‡†å¤‡ISO"><a href="#å‡†å¤‡ISO" class="headerlink" title="å‡†å¤‡ISO"></a>å‡†å¤‡ISO</h2><p>ä»¥alpineä¸ºä¾‹ï¼Œæ–¹ä¾¿æµ‹è¯•</p>
<p>wget <a target="_blank" rel="noopener" href="https://dl-cdn.alpinelinux.org/alpine/v3.15/releases/x86/_64/alpine-virt-3.15.0-x86/_64.iso">https://dl-cdn.alpinelinux.org/alpine/v3.15/releases/x86\_64/alpine-virt-3.15.0-x86\_64.iso</a></p>
<h2 id="åˆ›å»ºvmå¹¶å¯åŠ¨"><a href="#åˆ›å»ºvmå¹¶å¯åŠ¨" class="headerlink" title="åˆ›å»ºvmå¹¶å¯åŠ¨"></a>åˆ›å»ºvmå¹¶å¯åŠ¨</h2><p>ä¸ºäº†PoCï¼Œæˆ‘ä»¬ç›´æ¥åˆ›å»ºvmç„¶åå¯åŠ¨è¯•è¯•çœ‹ï¼Œ<code>-nographic</code>å› ä¸ºæˆ‘ä»¬åœ¨CLIä¸‹ï¼Œæ‰€ä»¥ä¸å¯ç”¨å›¾å½¢ç•Œé¢ï¼Œ<code>-enable-kvm</code>å› ä¸ºå®¿ä¸»æœºæœ‰kvmæ”¯æŒï¼Œ<code>-cdrom</code>æŒ‡å®šå…‰é©±</p>
<p>qemu-system-x86_64 -nographic -enable-kvm -cdrom &#x2F;root&#x2F;alpine-virt-3.15.0-x86_64.iso</p>
<p>æ„æ–™ä¹‹ä¸­ï¼Œå‡ºç°äº†Alpineçš„å¯åŠ¨ç”»é¢</p>
<p><img src="/images/2021122518123522.png"></p>
<p>å¹¶ä¸”èƒ½çœ‹åˆ°qemué»˜è®¤é…ç½®çš„å†…å­˜å’ŒCPUã€‚è¿™ä¸ªQEMU Virtual CPUæ˜¯ä¸æ˜¯åœ¨æŸäº›VPSä¸­çœ‹åˆ°è¿‡å‘¢ï¼Ÿ</p>
<p><img src="/images/2021122518123780.png"></p>
<p>æƒ³è¦é€€å‡ºqemuï¼Œå…ˆæŒ‰ctrl aï¼Œç„¶åæ¾å¼€ï¼Œè¿…é€ŸæŒ‰x</p>
<h2 id="ä½¿ç”¨VNC"><a href="#ä½¿ç”¨VNC" class="headerlink" title="ä½¿ç”¨VNC"></a>ä½¿ç”¨VNC</h2><p>æ—¢ç„¶æ— å›¾å½¢ç•Œé¢çš„alpineå¯ä»¥ï¼Œé‚£ä¹ˆå®‰è£…ä¸ªUbuntu Desktopä¹Ÿä¸€å®šå¯ä»¥ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦æˆ‘ä»¬ä½¿ç”¨VNCå•¦ã€‚</p>
<p>VNCçš„é»˜è®¤ç«¯å£æ˜¯5900ï¼Œæˆ‘ä»¬è¦åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™åŒæ—¶publishè¿™ä¸ªç«¯å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨VNCå®¢æˆ·ç«¯</p>
<p>docker run â€“rm â€“privileged -p 5900:5900 -it -v $(pwd):&#x2F;root&#x2F; bennythink&#x2F;vmid bash</p>
<p>ç”±äºUbuntu Desktopéœ€è¦æ¯”è¾ƒå¤šçš„å†…å­˜å’ŒCPUï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä¹Ÿå¤šåŠ å‡ ä¸ªå‚æ•°</p>
<p>qemu-system-x86_64 -nographic -enable-kvm -m 4096 -cpu host -smp 2 -cdrom &#x2F;root&#x2F;ubuntu-20.04.3-desktop-amd64.iso.iso -vnc 0.0.0.0:0</p>
<p><code>-m</code>è¡¨ç¤ºå†…å­˜å¤§å°ï¼Œå•ä½æ˜¯MiBï¼Œä¹Ÿå¯ä»¥ <code>-m 2g</code>è¡¨ç¤º2GiBçš„å†…å­˜</p>
<p><code>-cpu</code>è¡¨ç¤ºCPUç±»å‹ï¼Œä¹‹å‰ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°CPUæ˜¯QEMU Virtual CPUï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šCPUï¼Œæ¯”å¦‚ <code>-cpu EPYC</code> è¡¨ç¤ºè™šæ‹Ÿæœºçœ‹åˆ°çš„CPUæ˜¯AMD EPYCï¼Œå½“ç„¶ä¹Ÿè¦å®¡æ—¶åº¦åŠ¿ï¼Œä½ ä¸€ä¸ªx86-64çš„imageï¼Œå°±åˆ«æƒ³ç€ç”¨486äº†ã€‚æœ‰å‡ ä¸ªç‰¹æ®Šçš„å€¼ï¼š<code>host</code>è¡¨ç¤ºä½¿ç”¨å’Œå®¿ä¸»æœºä¸€æ ·çš„CPUï¼Œbaseçš„è¯æ¯”è¾ƒé¸¡è‚‹é¡¾åæ€ä¹‰å°±æ˜¯åŸºç¡€çš„ä»€ä¹ˆæŒ‡ä»¤é›†éƒ½æ²¡æœ‰ï¼Œmaxä¼šæŠŠæ‰€æœ‰çš„æ”¯æŒçš„æŒ‡ä»¤é›†å’Œkvmèƒ½æä¾›çš„æŒ‡ä»¤é›†éƒ½åŠ ä¸Šã€‚</p>
<p><code>-smp</code>å°±æ˜¯å‡ æ ¸å¿ƒçš„CPUå•¦ï¼Œè¿™è¦çœ‹å®¿ä¸»æœºé‡åŠ›è€Œè¡Œã€‚å°±åƒmakeæ—¶è¦é‡åŠ›è€Œè¡Œä¸€æ ·</p>
<p><code>-vnc</code>è¡¨ç¤ºä½¿ç”¨VNCï¼Œ0.0.0.0è¡¨ç¤ºç›‘å¬0.0.0.0ï¼Œå†’å·åçš„0è¡¨ç¤º5900ï¼Œå¦‚æœç”¨<code>0.0.0.0:1</code>ï¼Œé‚£ä¹ˆç›‘å¬çš„ç«¯å£å°±æ˜¯5901å•¦ï¼Œè¦æ³¨æ„å“¦ã€‚è¿™ç§æƒ…å†µä¸‹å¼€å¯çš„VNCæ˜¯æ²¡æœ‰å¯†ç çš„ï¼Œå¦‚æœæƒ³è¦å¯†ç é‚£å°± <code>-vnc 0.0.0.0:0,password</code> ç„¶åè®¾ç½®å¯†ç â€¦â€¦ æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®æ”¾å¼ƒã€‚</p>
<p>ç„¶åä½¿ç”¨VNCå®¢æˆ·ç«¯è¿æ¥å³å¯ï¼Œè¦æ³¨æ„macOSè‡ªå¸¦çš„VNCå®¢æˆ·ç«¯éœ€è¦å¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œå› æ­¤æ˜¯ç”¨ä¸äº†çš„ã€‚ä½¿ç”¨VNC viewerå¯ç ´</p>
<p>brew install â€“cask vnc-viewer</p>
<p>[v_blue]è¾£é¸¡macOSè‡ªå¸¦çš„VNC Clientä¹Ÿè¿ä¸ä¸Š127.0.0.1çš„ï¼Œè¾£é¸¡ã€‚ [&#x2F;v_blue] <img src="/images/2021122518124036.png"></p>
<p>æˆ‘ä»¬å·²ç»èƒ½å¤Ÿçœ‹åˆ°Ubuntuçš„å®‰è£…ç•Œé¢å•¦ï¼Œå¹¶ä¸”åœ¨è¿™å°VMä¸­ï¼Œç½‘ç»œä¹Ÿæ˜¯é€šçš„ï¼ŒQEMUåˆ†é…äº†ä¸€ä¸ª10æ®µIP.å¦‚æœä½ å‘ç°ä¸èƒ½pingï¼Œé‚£ä¹ˆåœ¨hostä¸­ <code>sysctl -w net.ipv4.ping_group_range=&#39;0 2147483647&#39;</code>å°±å¯ä»¥å•¦ã€‚</p>
<p><img src="/images/2021122518124692.png"></p>
<h2 id="åˆ†é…ç£ç›˜"><a href="#åˆ†é…ç£ç›˜" class="headerlink" title="åˆ†é…ç£ç›˜"></a>åˆ†é…ç£ç›˜</h2><p>åƒå¾€å¸¸ä½¿ç”¨è™šæ‹Ÿæœºä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºè™šæ‹Ÿæœºåˆ†é…ä¸€ä¸ªè™šæ‹Ÿç£ç›˜ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿå®‰è£…æ“ä½œç³»ç»Ÿã€‚æ€»ä¸èƒ½æ¯æ¬¡éƒ½ä»å…‰ç›˜å¯åŠ¨å§ã€‚åˆ†é…è™šæ‹Ÿç£ç›˜ä¹Ÿæœ‰å¾ˆå¤šè®²ç©¶ï¼Œæ¯”å¦‚10Gæ˜¯ä¸€ä¸‹å­éƒ½åˆ†é…äº†ï¼Œè¿˜æ˜¯ç”¨å¤šå°‘åˆ†é…å¤šå°‘ï¼Ÿ</p>
<p>qemu-img create -f qcow2 &#x2F;root&#x2F;test.qcow2 16G</p>
<p>-f è¡¨ç¤ºè™šæ‹Ÿç£ç›˜çš„æ ¼å¼ï¼Œæ”¯æŒrawå’Œqcow2ï¼Œrawé¡¾åæ€ä¹‰å°±æ˜¯åŸå§‹çš„ï¼Œå¯¹vmæ¥è¯´å°±æ˜¯ä¸€ä¸ªå—è®¾å¤‡ã€‚å¦‚æœvmæ–‡ä»¶ç³»ç»Ÿæ”¯æŒç©ºæ´ï¼Œé‚£ä¹ˆrawæ˜¯ä¸€ç‚¹ç‚¹å¡«æ»¡çš„ï¼Œrawæ€§èƒ½è¾ƒå¥½ã€‚qcow2æ˜¯qemuæ¨èçš„æ ¼å¼ï¼Œæ”¯æŒåŠ å¯†å¿«ç…§ç­‰ç­‰ï¼Œåˆ«æƒ³äº†å°±è¿™ä¸ªå§ã€‚å½“ç„¶qemuè¿˜æ”¯æŒvmdkã€vdiä¹‹ç±»çš„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ«ç»™ç£ç›˜æ’‘çˆ†äº†ã€‚</p>
<h2 id="å®‰è£…Ubuntu-Desktop"><a href="#å®‰è£…Ubuntu-Desktop" class="headerlink" title="å®‰è£…Ubuntu Desktop"></a>å®‰è£…Ubuntu Desktop</h2><p>åˆ›å»ºå¥½ç£ç›˜ä¹‹åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯å¼€å§‹å¼€vmå®‰è£…Ubuntu</p>
<p>qemu-system-x86_64 -nographic -enable-kvm -m 4096 -cpu host -smp 4 -drive file&#x3D;&#x2F;root&#x2F;test.qcow2 -cdrom &#x2F;root&#x2F;ubuntu-20.04.3-desktop-amd64.iso -vnc 0.0.0.0:0</p>
<p>å®‰è£…è¿‡ç¨‹å’Œæ™®é€šVMæ²¡ä»€ä¹ˆå·®åˆ«ï¼Œå°±æ˜¯â€¦â€¦ æ…¢äº†ç‚¹ã€‚</p>
<h2 id="å¯åŠ¨VM"><a href="#å¯åŠ¨VM" class="headerlink" title="å¯åŠ¨VM"></a>å¯åŠ¨VM</h2><p>å®‰è£…å¥½ä¹‹åï¼Œä¸‹æ¬¡æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯åŠ¨VMäº†ï¼Œå¯ä»¥åˆ æ‰-cdromå‚æ•°</p>
<p>qemu-system-x86_64 -nographic -enable-kvm -m 4096 -cpu host -smp 4 -drive file&#x3D;&#x2F;root&#x2F;test.qcow2 -vnc 0.0.0.0:0</p>
<h2 id="è·‘armâ€¦â€¦"><a href="#è·‘armâ€¦â€¦" class="headerlink" title="è·‘armâ€¦â€¦"></a>è·‘armâ€¦â€¦</h2><p>éƒ½çŸ¥é“qemuæ˜¯ä¸ªæ¨¡æ‹Ÿç¥å™¨ï¼Œæƒ³è¦è·‘armä¹Ÿä¸æ˜¯ä¸å¯èƒ½ï¼Œæ¯”å¦‚è·‘ä¸ªliveCDåšä¸ªæµ‹è¯•ä»€ä¹ˆçš„ï¼š</p>
<p>apt install qemu-system-arm</p>
<p>dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;flash0.img bs&#x3D;1M count&#x3D;64<br>dd if&#x3D;&#x2F;usr&#x2F;share&#x2F;qemu-efi&#x2F;QEMU_EFI.fd of&#x3D;flash0.img conv&#x3D;notrunc<br>dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;flash1.img bs&#x3D;1M count&#x3D;64</p>
<p>qemu-system-aarch64 -m 1024 -cpu cortex-a57 -M virt -nographic -pflash flash0.img -pflash flash1.img -drive if&#x3D;none,file&#x3D;alpine-virt-3.15.0-aarch64.iso,id&#x3D;hd0 -device virtio-blk-device,drive&#x3D;hd0 -net nic -net user</p>
<p>è¿™æ¬¡å¯åŠ¨çš„é€Ÿåº¦å°±ä¼šéå¸¸æ…¢äº†ï¼Œå¦‚æœå¯åŠ¨æˆåŠŸä¹‹åæ²¡æœ‰ç½‘ç»œï¼Œé‚£ä¹ˆè¦å¼€ä¸‹dhcpï¼Œä»¥alpineä¸ºä¾‹</p>
<p>vi &#x2F;etc&#x2F;network&#x2F;interfaces</p>
<p>auto lo<br>iface lo inet loopback<br>auto eth0<br>iface eth0 inet dhcp</p>
<p>ç„¶å<code>ifup eth0</code>å³å¯</p>
<p>å¦‚æœæƒ³è¦å®‰è£…åˆ°æŸä¸ªç£ç›˜ä¸­ï¼Œæ‹¿Ubuntuä¸ºä¾‹</p>
<p>qemu-img create -f qcow2 ubuntu.qcow2 8G</p>
<p>mount -o loop ubuntu-20.04.3-live-server-arm64.iso &#x2F;mnt</p>
<p>cp &#x2F;mnt&#x2F;casper&#x2F;vmlinuz .&#x2F;<br>cp &#x2F;mnt&#x2F;casper&#x2F;initrd .&#x2F;</p>
<p>qemu-system-aarch64 -m 1024 -cpu cortex-a57 -smp cpus&#x3D;4 -M virt -nographic \<br>-kernel .&#x2F;vmlinuz -initrd .&#x2F;initrd \<br>-drive file&#x3D;ubuntu.qcow2,if&#x3D;none,format&#x3D;qcow2,id&#x3D;hd0 -device virtio-blk-device,drive&#x3D;hd0 \<br>-drive file&#x3D;ubuntu-20.04.3-live-server-arm64.iso,if&#x3D;none,format&#x3D;raw,id&#x3D;hd1 -device virtio-blk-device,drive&#x3D;hd1 \<br>-net nic -net user</p>
<p>ä¹‹åå¼€å§‹æ­£å¸¸çš„å®‰è£…æ­¥éª¤ï¼Œä¼šæ¯”è¾ƒæ…¢ï¼Œè€Œä¸”ç”µè„‘èµ·é£ã€‚</p>
<p><img src="/images/2021122518124721.png"></p>
<p>å®‰è£…å¥½å°±å¯ä»¥å»æ‰isoé‚£è¡Œå•ç‹¬å¯åŠ¨äº†ã€‚</p>
<p>å®é™…ä¸Šï¼ŒDocker çš„Multi Arch buildä¹Ÿæ˜¯æ°å·§åˆ©ç”¨äº†QEMUå•¦ã€‚</p>
<h2 id="binfmt"><a href="#binfmt" class="headerlink" title="binfmt"></a>binfmt</h2><p>å¦‚æœåªæ˜¯ç®€å•çš„æƒ³è¦è·‘ä¸‹å¼‚æ„çš„imageçš„è¯ï¼Œå¯ä»¥è¯•è¯•<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Binfmt_misc">binfmt</a>ï¼ŒWindowså’ŒMacçš„Docker Desktopç›´æ¥æ”¯æŒï¼ŒLinuxéœ€è¦å…ˆè¿™æ ·ï¼š</p>
<p>docker run â€“rm â€“privileged docker&#x2F;binfmt:66f9012c56a8316f9244ffd7622d7c21c1f6f28d</p>
<p>ç„¶åè·‘å§</p>
<p>docker run -it â€“platform linux&#x2F;arm64 alpine sh</p>
<h2 id="ä½¿ç”¨å·²æœ‰çš„cloud-image"><a href="#ä½¿ç”¨å·²æœ‰çš„cloud-image" class="headerlink" title="ä½¿ç”¨å·²æœ‰çš„cloud image"></a>ä½¿ç”¨å·²æœ‰çš„cloud image</h2><p>æˆ‘ä»¬å½“ç„¶å¯ä»¥é€‰æ‹©æŠŠOSå®‰è£…åˆ°è™šæ‹Ÿç£ç›˜ä¸­ï¼Œä½†æ˜¯è¿™æ ·è¦éº»çƒ¦ä¸€äº›ï¼Œå®‰è£…è¿‡ç¨‹æ¯”è¾ƒç¹çè€Œä¸”å¾ˆæ…¢ã€‚æœ‰æ²¡æœ‰åŠæ³•ç”¨åˆ«äººå·²ç»å‡†å¤‡å¥½çš„qcow2å‘¢ï¼Ÿ</p>
<p>å½“ç„¶æœ‰å•¦ã€‚å¯¹äºUbuntuæ¥è¯´ï¼Œå¯ä»¥å»ä¸‹è½½cloud imageï¼Œimgç»“å°¾çš„å°±æ˜¯ <a target="_blank" rel="noopener" href="https://cloud-images.ubuntu.com/focal/current/">https://cloud-images.ubuntu.com/focal/current/</a></p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªuser dataæ¥åˆå§‹åŒ–æˆ‘ä»¬çš„å¯†ç </p>
<p>cat &gt;user-data &lt;&lt;EOF<br>#cloud-config<br>password: 123456<br>chpasswd: { expire: False }<br>ssh_pwauth: True<br>EOF</p>
<p>cloud-localds user-data.img user-data</p>
<p>qemu-system-x86_64 -nographic -enable-kvm -m 2048 -cpu host -smp 4 -drive file&#x3D;&#x2F;root&#x2F;focal-server-cloudimg-amd64.img -drive file&#x3D;user-data.img,format&#x3D;raw</p>
<p>ç­‰å¾…å¯åŠ¨ï¼Œç”¨æˆ·åubuntuå¯†ç 123456</p>
<p>ä¹‹åä½ çš„æ‰€æœ‰æ›´æ”¹å®é™…ä¸Šéƒ½ä¼šå†™å…¥åˆ°è¿™ä¸ªimgæ–‡ä»¶ä¸­ï¼Œä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™å°±ä¸ç”¨user-dataå•¦ã€‚</p>
<p>é‚£è¿™ä¸ªimgåªæœ‰2Gï¼Œä¸å¤Ÿç”¨æ€ä¹ˆåŠï¼Ÿ<code>qemu-img</code>æ‰©å®¹ï¼</p>
<p>root@e769eaf9e4ab:~# qemu-img resize focal-server-cloudimg-amd64.img +5G<br>Image resized.</p>
<p>root@e769eaf9e4ab:~# qemu-img info focal-server-cloudimg-amd64.img<br>image: focal-server-cloudimg-amd64.img<br>file format: qcow2<br>virtual size: 7.2 GiB (7730102272 bytes)<br>disk size: 601 MiB<br>cluster_size: 65536<br>Format specific information:<br>compat: 0.10<br>refcount bits: 16</p>
<p>ç„¶åâ€¦â€¦ å¦‚æœæœ‰LVMï¼Œé‚£å°±å¥½åŠäº†ï¼Œå¦‚æœæ²¡LVMï¼Œé‚£å°±liveCDæ‰©å®¹å§ã€‚æ‰€ä»¥å»ºè®®ä¸€å¼€å§‹å°±<code>qemu-img resize</code>å¥½ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://github.com/kholia/OSX-KVM">https://github.com/kholia/OSX-KVM</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.ihomura.cn/2020/11/12/%E5%9C%A8qemu-system%E4%B8%8A%E8%B7%91arm-Debian/">https://blog.ihomura.cn/2020/11/12/%E5%9C%A8qemu-system%E4%B8%8A%E8%B7%91arm-Debian/</a></p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/repository/docker/bennythink/vmid">https://hub.docker.com/repository/docker/bennythink/vmid</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/12/25/docker-windows-container/index/" data-id="clhp7rtfy002ds2qr20ke2194" data-title="ä½¿ç”¨Dockerè·‘Windowsï¼" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-docker-nat-vps/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/24/docker-nat-vps/index/" class="article-date">
  <time class="dt-published" datetime="2021-12-24T00:00:00.000Z" itemprop="datePublished">2021-12-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/what/">what</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/24/docker-nat-vps/index/">ä½¿ç”¨dockerå¼€NATå°é¸¡</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>äººä»¬å¸¸è¯´ï¼Œã€Œç²¾ç¥ç—…äººæ€è·¯å¹¿ï¼Œæ™ºéšœå„¿ç«¥æ¬¢ä¹å¤šã€ã€‚åƒæˆ‘è¿™ç§ç—…å¾—ä¸è½»çš„äººï¼Œè‡ªç„¶å°±åœ¨æƒ³æœ‰æ²¡æœ‰åŠæ³•æ‹¿dockeræ¥å¼€NATå°é¸¡å‘¢ï¼Ÿ</p>
<p>Dockerä½œä¸ºä¸€ç§å®¹å™¨åŒ–æŠ€æœ¯ï¼Œé€šè¿‡cgroupå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šåšåˆ°èµ„æºéš”ç¦»ï¼Œè™½ç„¶ä¸ç®—è™šæ‹ŸåŒ–ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å‹‰å¼ºå¼€NATå°é¸¡ç©ç©ã€‚æŠ€æœ¯è¦ç‚¹å¤§æ¦‚æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°é¸¡é‡Œéœ€è¦sshï¼Œè€Œä¸”éœ€è¦ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹</li>
<li>éœ€è¦æ˜ å°„ç«¯å£</li>
<li>éœ€è¦é™åˆ¶CPUã€å†…å­˜ç­‰èµ„æº</li>
<li>åˆ¶ä½œå„ç§OSçš„image</li>
</ul>
<h2 id="å®¹å™¨sshd"><a href="#å®¹å™¨sshd" class="headerlink" title="å®¹å™¨sshd"></a>å®¹å™¨sshd</h2><p>Nå¤šå¹´å‰ï¼Œå½“æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°Dockeræ—¶ï¼Œæˆ‘æ›¾ç»åœ¨ç½‘ç»œä¸Šæœç´¢â€œå¦‚ä½•sshåˆ°å®¹å™¨å†…â€ã€‚</p>
<p>ï¼ˆâ•¯â€µâ–¡â€²ï¼‰â•¯ï¸µâ”´â”€â”´ å®¹å™¨ä¸€èˆ¬ä¸æ˜¯è¿™ä¹ˆç”¨çš„å•¦ã€‚</p>
<p>ä½†æ—¢ç„¶å¼€NATå°é¸¡ï¼Œå°±å¿…ç„¶è¦sshè¿›å»äº†ã€‚é€šå¸¸æ¥è¯´å°±æ˜¯åœ¨å®¹å™¨é‡Œå®‰è£…é…ç½®sshdæˆ–è€…dropbearï¼Œç„¶åæŠŠç«¯å£publishå°±å¯ä»¥äº†ã€‚ç›´æ¥&amp;å¯ä¸å¤ªå¥½ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ã€‚å¯ä»¥ç”¨Go port of supervisorï¼Œ<a target="_blank" rel="noopener" href="https://github.com/ochinchina/supervisord">https://github.com/ochinchina/supervisord</a></p>
<h2 id="æ˜ å°„ç«¯å£"><a href="#æ˜ å°„ç«¯å£" class="headerlink" title="æ˜ å°„ç«¯å£"></a>æ˜ å°„ç«¯å£</h2><p>è¿™ä¸ªå°±ç®€å•äº†ï¼Œè·‘å®¹å™¨çš„æ—¶å€™ç›´æ¥ -på°±å¥½äº†ï¼Œç”±äºæ˜¯NATå°é¸¡ï¼Œç›´æ¥è®©dockeréšæœºåˆ†é…ç«¯å£å²‚ä¸æ˜¯æ›´å¥½ï¼</p>
<p>docker run -p 22 image</p>
<h2 id="é™åˆ¶èµ„æº"><a href="#é™åˆ¶èµ„æº" class="headerlink" title="é™åˆ¶èµ„æº"></a>é™åˆ¶èµ„æº</h2><p>é™åˆ¶CPUå’ŒRAMæ¯”è¾ƒå®¹æ˜“ï¼Œrunçš„æ—¶å€™åŠ ä¸Š<code>-cpus</code> å’Œ<code>-m</code>å°±å¯ä»¥äº†</p>
<p>é™åˆ¶ç£ç›˜æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡ <a target="_blank" rel="noopener" href="https://www.lizi.tw/web/21084.html">https://www.lizi.tw/web/21084.html</a></p>
<h2 id="OS-image"><a href="#OS-image" class="headerlink" title="OS image"></a>OS image</h2><p>è¿™ä¸ªå…¶å®å°±æ˜¯ä¸ªæ‰‹å·¥æ´»ï¼Œå†™å¥½Dockerfileï¼Œå¸¦å¥½sshdï¼Œç„¶åbuildå°±å¯ä»¥äº†ã€‚</p>
<p>ç„¶ååˆ°äº†çœŸæ­£è¦å¼€å°é¸¡çš„æ—¶å€™ï¼Œä¸€é¡¿æŸ¥ä¹‹å‰çš„å‘½ä»¤ï¼Œä¸åœåœ°docker run xxxï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„ã€é¼ æ ‡ç‚¹ç‚¹ç‚¹çš„æ–¹æ¡ˆå‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯æœ‰çš„ï¼</p>
<p>æ¬¢è¿ä½¿ç”¨æˆ‘forkä¹‹åé­”æ”¹çš„Docker Webï¼ŒçœŸæ­£å®ç°äº†é¼ æ ‡ç‚¹ç‚¹ç‚¹å³å¯å¼€NATå°é¸¡çš„åŠŸèƒ½ï¼</p>
<p><a target="_blank" rel="noopener" href="https://github.com/BennyThink/EasyDockerWeb">https://github.com/BennyThink/EasyDockerWeb</a></p>
<p>cloneå›æ¥ï¼Œ<code>yarn &amp;&amp; yarn start</code>ï¼Œç„¶å<code>fab prepare</code>ï¼ˆæå‰<code>pip3 install fabric3</code>ï¼‰å³å¯ï¼Œé»˜è®¤ç”¨æˆ·åå¯†ç æ˜¯admin&#x2F;admin</p>
<p>åœ¨Imageä¸‹é¢å¯ä»¥é€‰æ‹©æ‰€æœ‰æˆ‘æ„å»ºå¥½çš„imageï¼Œç”¨æˆ·åå¯†ç å‡ä¸ºroot&#x2F;root</p>
<p><img src="/images/2021122418282111.png"></p>
<p>æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Kaliï¼Œç„¶åç»™è¿™ä¸ªå°é¸¡å¼€80å’Œ443ç«¯å£ï¼Œå¹¶æ˜ å°„åˆ°å®¿ä¸»æœºçš„éšæœºç«¯å£ï¼Œ512Må†…å­˜ï¼Œ0.5ä¸ªCPU</p>
<p>ç‚¹å‡»ç¡®è®¤ï¼Œä½ çš„NATå°é¸¡å°±å¼€å¥½äº†ï¼</p>
<p><img src="/images/2021122418282317.png"></p>
<p>ç‚¹å‡»ç¡®è®¤</p>
<p><img src="/images/2021122418282426.png"></p>
<p>ä½ çš„å°é¸¡å¥½äº†ï¼Œèµ¶å¿«sshä¸€ä¸‹ï¼Ÿ</p>
<p><img src="/images/2021122418282671.png"></p>
<p>é€‰æ‹©Debian Sidï¼Œ80-90ç«¯å£</p>
<p><img src="/images/2021122418282799.png"></p>
<p><img src="/images/2021122418282996.png"></p>
<p>å¤šä¹ˆäº¦å¯èµ›è‰‡ï¼å°±æ˜¯è¿™ä¹ˆæ„‰å¿«ï¼bugå¤šä¹Ÿä¸ä¿®ï¼Œèƒ½å¼€å°é¸¡å°±æŒºå¥½</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/12/24/docker-nat-vps/index/" data-id="clhp7rtf7001os2qr8q4a2yh9" data-title="ä½¿ç”¨dockerå¼€NATå°é¸¡" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hysteria/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/03/hysteria/index/" class="article-date">
  <time class="dt-published" datetime="2021-12-03T00:00:00.000Z" itemprop="datePublished">2021-12-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gfw/">gfw</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/03/hysteria/index/">ä¸€èµ·æ¥æ­‡æ–¯åº•é‡Œï¼ˆhysteriaï¼‰å§ï¼</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æ²¡ç–¯ï¼ŒçœŸæ²¡ç–¯ã€‚</p>
<p>Hysteria æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ï¼Œä¸“ä¸ºæ¶åŠ£ç½‘ç»œç¯å¢ƒè¿›è¡Œä¼˜åŒ–çš„ç½‘ç»œå·¥å…·ï¼ˆåŒè¾¹åŠ é€Ÿï¼‰ï¼Œæ¯”å¦‚å«æ˜Ÿç½‘ç»œã€æ‹¥æŒ¤çš„å…¬å…± Wi-Fiã€åœ¨ä¸­å›½è¿æ¥å›½å¤–æœåŠ¡å™¨ç­‰ã€‚</p>
<p>ğŸ˜‚åœ¨æˆ‘ç­‰äººçœ‹æ¥ï¼Œè¿™çœ‹èµ·æ¥æ˜¯å¾ˆé€‚åˆåšæ¢¯å­çš„ã€‚</p>
<p>æµ‹äº†ä¸€ä¸‹ï¼Œé€Ÿåº¦ç¡®å®éå¸¸æ£’</p>
<p>ä½¿ç”¨shadowsocks&#x2F;trojançš„é€Ÿåº¦</p>
<p><img src="/images/2021120317392893.png"></p>
<p>ä½¿ç”¨hysteria</p>
<p><img src="/images/2021120317393067.png"></p>
<p>é€Ÿåº¦è¶³è¶³æå‡äº†10å€ï¼Œè·‘æ»¡äº†æœ¬åœ°å¸¦å®½</p>
<p>é…ç½®èµ·æ¥å¾ˆç®€å•ğŸ˜‚å°±ä»¥è‡ªç­¾åè¯ä¹¦ä¸ºä¾‹äº†</p>
<h2 id="é…ç½®æœåŠ¡ç«¯"><a href="#é…ç½®æœåŠ¡ç«¯" class="headerlink" title="é…ç½®æœåŠ¡ç«¯"></a>é…ç½®æœåŠ¡ç«¯</h2><h3 id="è‡ªç­¾åè¯ä¹¦"><a href="#è‡ªç­¾åè¯ä¹¦" class="headerlink" title="è‡ªç­¾åè¯ä¹¦"></a>è‡ªç­¾åè¯ä¹¦</h3><p>openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 3650 -out certificate.pem</p>
<h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>å»GitHub Releaseå¯ä»¥æ‰¾åˆ°ï¼Œæˆ‘çš„æ˜¯OpenVZçš„ğŸ¤ï¼Œä¸‹è½½äº†non-tunç‰ˆæœ¬çš„ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/HyNetwork/hysteria/releases">https://github.com/HyNetwork/hysteria/releases</a></p>
<h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h3><p>config.json</p>
<p>{<br>    â€œlistenâ€: â€œ:443â€,<br>    â€œcertâ€: â€œ&#x2F;etc&#x2F;hysteria&#x2F;certificate.pemâ€,<br>    â€œkeyâ€: â€œ&#x2F;etc&#x2F;hysteria&#x2F;key.pemâ€,<br>    â€œup_mbpsâ€: 300,<br>    â€œdown_mbpsâ€: 300,<br>    â€œobfsâ€: â€œdankdhsawjâ€<br>}</p>
<p>å¯é€‰çš„Â obfsÂ é€‰é¡¹ä½¿ç”¨æä¾›çš„å¯†ç å¯¹åè®®è¿›è¡Œæ··æ·†ï¼Œè¿™æ ·åè®®å°±ä¸å®¹æ˜“è¢«æ£€æµ‹å‡ºæ˜¯ Hysteria&#x2F;QUICï¼Œå¯ä»¥ç”¨æ¥ç»•è¿‡é’ˆå¯¹æ€§çš„ DPI å±è”½æˆ–è€… QoSã€‚ å¦‚æœæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å¯†ç ä¸åŒ¹é…å°±ä¸èƒ½å»ºç«‹è¿æ¥ï¼Œå› æ­¤è¿™ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„å¯†ç éªŒè¯ã€‚</p>
<p><code>up_mbps</code>Â å’ŒÂ <code>down_mbps</code>ç”¨æ¥é™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯æœ€å¤§ä¸‹è½½é€Ÿåº¦å’Œä¸Šä¼ é€Ÿåº¦ï¼Œå¯é€‰</p>
<h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>hysteria server</p>
<p>å³å¯ã€‚ä½¿ç”¨<code>-config</code>å‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„</p>
<p>hysteria -config &#x2F;etc&#x2F;hysteria&#x2F;config.json server</p>
<h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><p>iOSå¯ä»¥ä½¿ç”¨shadowrocketï¼Œæ··æ·†å­—æ®µå†™obfsçš„å€¼ï¼Œå¯†ç ç•™ç©ºï¼Œå…è®¸ä¸å®‰å…¨å‹¾é€‰</p>
<p>shadowrocketæµ‹é€Ÿä¼šæ˜¾ç¤ºè¶…å¸‚ï¼Œå»¶è¿Ÿæµ‹è¯•æ–¹æ³•æ”¹æˆCONNECTå°±å¥½äº†ï¼Œå¯èƒ½æ˜¯ä¸ªbug</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>{<br>    â€œserverâ€: â€œ1.1.1.1:443â€,<br>    â€œobfsâ€: â€œ1231â€,<br>    â€œup_mbpsâ€: 300,<br>    â€œdown_mbpsâ€: 300,<br>    â€œsocks5â€: {<br>        â€œlistenâ€: â€œ127.0.0.1:1080â€<br>    },<br>    â€œinsecureâ€: true<br>}</p>
<p>ç„¶åç›´æ¥è¿è¡Œ<code>hysteria</code>å°±å¯ä»¥ï¼Œä¹‹åå¯ä»¥ç”¨proxychainsä¹‹ç±»çš„å·¥å…·äº†ã€‚å¦‚æœ‰éœ€è¦ä¹Ÿå¯ä»¥æ·»åŠ httpå­—æ®µ</p>
<p>â€œhttpâ€: {</p>
<p>â€œlistenâ€: â€œ127.0.0.1:8080â€</p>
<p>}</p>
<h2 id="systemdè‡ªåŠ¨å¯åŠ¨"><a href="#systemdè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="systemdè‡ªåŠ¨å¯åŠ¨"></a>systemdè‡ªåŠ¨å¯åŠ¨</h2><p><code>/lib/systemd/system/hysteria.service</code></p>
<p>å¦‚æœæ˜¯systemdçš„è¯ï¼Œå†™ä¸ªå•å…ƒæ–‡ä»¶</p>
<p>[Unit]<br>Description&#x3D;Hysteria<br>After&#x3D;network.target network-online.target nss-lookup.target</p>
<p>[Service]<br>Restart&#x3D;on-failure<br>Type&#x3D;simple<br>ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;hysteria -config &#x2F;etc&#x2F;hysteria&#x2F;config.json server</p>
<p>[Install]<br>WantedBy&#x3D;multi-user.target</p>
<p>systemctl daemon-reload # é‡æ–°åŠ è½½<br>systemctl enable hysteria # å¼€æœºè‡ªå¯<br>systemctl start hysteria # å¯åŠ¨</p>
<h2 id="ğŸ¤ä¸“å±é…ç½®"><a href="#ğŸ¤ä¸“å±é…ç½®" class="headerlink" title="ğŸ¤ä¸“å±é…ç½®"></a>ğŸ¤ä¸“å±é…ç½®</h2><p>è¿™ä¸ªå°é¸¡ï¼Œæ˜¯ä»<a target="_blank" rel="noopener" href="https://dmesg.app/super-cheap-3-5-three-years-united-states-vps-science-internet-special.html">sentrisé‚£é‡Œå¼„æ¥çš„</a>ï¼Œè¿™ä¹ˆå¤šå¹´æ²¡æƒ³åˆ°ç«Ÿç„¶æ²¡å€’é—­æ²¡è·‘è·¯ã€‚</p>
<p>ç”±äºå°é¸¡é…ç½®å ªå¿§ï¼Œ<a target="_blank" rel="noopener" href="https://t.me/mikuri520/1230">æˆ‘æƒ³åŠæ³•ç»™ææˆäº†Alpine</a>ï¼Œæ¯•ç«ŸAlpineæ˜¯å‡ºäº†åçš„å°ï¼Œçœå†…å­˜ä¹Ÿæ˜¯å¿…ç„¶çš„ã€‚</p>
<p><img src="/images/2021120317393327.jpeg"></p>
<p>å› ä¸ºæ˜¯Alpineæ‰€ä»¥è‡ªç„¶ä¹Ÿå°±æ˜¯OpenRCäº†ã€‚</p>
<h3 id="hysteriaé¢å¤–é…ç½®"><a href="#hysteriaé¢å¤–é…ç½®" class="headerlink" title="hysteriaé¢å¤–é…ç½®"></a>hysteriaé¢å¤–é…ç½®</h3><p>ç”±äºå°é¸¡å†…å­˜å°‘ï¼Œå¿…é¡»é¢å¤–é…ç½®ä¸‹ï¼Œè¦ä¸ç„¶æ€»æ˜¯è¢«OOM Kill</p>
<p>â€œrecv_window_connâ€: 2097152,<br>â€œrecv_window_clientâ€: 8388608,</p>
<p>è¿™æ ·ä¼šå‡å°‘OOMçš„å¯èƒ½æ€§</p>
<h3 id="OpenRCå¯åŠ¨é¡¹"><a href="#OpenRCå¯åŠ¨é¡¹" class="headerlink" title="OpenRCå¯åŠ¨é¡¹"></a>OpenRCå¯åŠ¨é¡¹</h3><p>å¦‚æœæ˜¯OpenRCâ€¦â€¦<code>/etc/init.d/hysteria</code></p>
<p>#!&#x2F;sbin&#x2F;openrc-run</p>
<p>name&#x3D;â€hysteriaâ€<br>command&#x3D;â€&#x2F;usr&#x2F;sbin&#x2F;hysteriaâ€<br>command_args&#x3D;â€-config &#x2F;etc&#x2F;hysteria&#x2F;config.json serverâ€<br>command_background&#x3D;â€yesâ€<br>pidfile&#x3D;â€&#x2F;run&#x2F;hysteria.pidâ€</p>
<p>depend() {<br>    after sshd<br>}</p>
<p>ç„¶å</p>
<p>chmod +x &#x2F;etc&#x2F;init.d&#x2F;hysteria<br>rc-update add hysteria # å¼€æœºè‡ªå¯åŠ¨<br>rc-service hysteria start # å¯åŠ¨</p>
<p>éå¸¸ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœè¿›ç¨‹æŒ‚æ‰äº†ï¼ŒOpenRCæ˜¯æ²¡ä»€ä¹ˆåŠæ³•ç»™æ‹‰èµ·æ¥çš„ã€‚å¯ä»¥åŠæ³•æ˜¯ç”¨supervisorï¼Œå¯ä»¥ä½¿ç”¨Goç‰ˆæœ¬çš„ <a target="_blank" rel="noopener" href="https://github.com/ochinchina/supervisord">https://github.com/ochinchina/supervisord</a></p>
<p>ç„¶è€Œè¿™ä¸ªå†…å­˜å ç”¨æœ‰ç‚¹å¯æ€•ï¼Œæ¯•ç«Ÿæˆ‘æ•´ä¸ªåªæœ‰64Mçš„å†…å­˜å•Šï¼Œè¿™ä¸€ä¸ªç”¨äº†22.5%ï¼Œ14Mäº†ã€‚</p>
<p><img src="/images/2021120317393477.png"></p>
<p>é‚£å°±åªèƒ½é­”æ”¹crontabï¼Œ10ç§’ä¸€æ¬¡ï¼Œæœ€å¤š20ç§’æ‹‰èµ·ï¼ˆ</p>
<p># åˆ›å»ºä¸€ä¸ªshellè„šæœ¬ &#x2F;usr&#x2F;bin&#x2F;restart</p>
<p>#!&#x2F;bin&#x2F;sh<br>echo Restartingâ€¦</p>
<p>for svc in $(rc-status â€“crashed); do<br>  rc-service $svc â€“ â€“nodeps restart<br>done</p>
<h1 id="åŠ xæƒé™"><a href="#åŠ xæƒé™" class="headerlink" title="åŠ xæƒé™"></a>åŠ xæƒé™</h1><p>chmod+x &#x2F;usr&#x2F;bin&#x2F;restart</p>
<h1 id="crontabä¸­"><a href="#crontabä¸­" class="headerlink" title="crontabä¸­"></a>crontabä¸­</h1><p>* * * * * for i in {1..6}; do &#x2F;usr&#x2F;bin&#x2F;restart &amp; sleep 10; done</p>
<p>ğŸ˜‚æ„Ÿè§‰è¿˜è¡Œï¼ˆï¼ˆï¼ˆ</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/12/03/hysteria/index/" data-id="clhp7rtgr003xs2qr2ien8kns" data-title="ä¸€èµ·æ¥æ­‡æ–¯åº•é‡Œï¼ˆhysteriaï¼‰å§ï¼" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-dyd-e12a3/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/07/dyd-e12a3/index/" class="article-date">
  <time class="dt-published" datetime="2021-11-07T00:00:00.000Z" itemprop="datePublished">2021-11-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/07/dyd-e12a3/index/">å¦‚ä½•æ§åˆ¶å¾·ä¸šDYD E12A3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>8æœˆä»½çš„æ—¶å€™ä¹°äº†ä¸ªé™¤æ¹¿å™¨ï¼Œè¿™ä¸œè¥¿å¯ä»¥è”ç½‘ï¼Œç”¨ä»–ä»¬è‡ªå·±çš„APPè¿›è¡Œæ§åˆ¶ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æŒ‰å®ä½“æŒ‰é’®æ§åˆ¶ï¼Œè¯´å¥½å¬ç‚¹å«æ²¡ç½‘ä¹Ÿèƒ½ç”¨ğŸ˜‚</p>
<p>æˆ‘ä¸€ç›´ä¸å–œæ¬¢ç”¨è£…è¿™ç§APPï¼Œé‚£ä¹ˆæ—¢ç„¶å¦‚æ­¤ï¼Œå°±è¦æä¸€æ³¢è¿™ä¸ªå¾·ä¸šæ™ºèƒ½APPäº†ã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ol>
<li>å…ˆæ‹¿åˆ°é™¤æ¹¿å™¨çš„IPåœ°å€ï¼Œ å…ˆnmapä¸€æ³¢çœ‹çœ‹ï¼Œä¹Ÿè®¸æœ‰ä»€ä¹ˆéšè—çš„æ¥å£</li>
<li>åœ¨è·¯ç”±å™¨ä¸Šç”¨tcpdumpæŠ“è¿™ä¸ªIPåœ°å€çš„åŒ…ï¼Œåˆå›åˆ°äº†æˆ‘æå°ç±³æ‘„åƒå¤´çš„æ—¶å€™ï¼ˆè¿™ä¸ªä¹Ÿè®¸ä»¥åä¼šå†™æ–‡ç« è®²è®²æˆ‘éƒ½åšäº†å“ªäº›å¥‡è‘©çš„äº‹æƒ…ï¼‰</li>
<li>åœ¨iOSä¸ŠæŠ“åŒ…ï¼Œçœ‹çœ‹éƒ½å‘äº†ä»€ä¹ˆè¯·æ±‚æ§åˆ¶å¼€å¯å’Œå…³é—­ï¼Œä¹Ÿè®¸æ˜¯ç®€å•çš„http</li>
</ol>
<h2 id="é™¤æ¹¿å™¨IP"><a href="#é™¤æ¹¿å™¨IP" class="headerlink" title="é™¤æ¹¿å™¨IP"></a>é™¤æ¹¿å™¨IP</h2><p>åœ¨è·¯ç”±å™¨çš„DHCPåˆ†é…è®°å½•ä¸­å¯ä»¥çœ‹åˆ°æˆ‘æœ‰ä¸€ä¸ªå« MiCO çš„è®¾å¤‡ï¼ŒIPåœ°å€æ˜¯<code>192.168.7.119</code>ã€‚å…¨éƒ¨TCP 65535ç«¯å£éƒ½æ‰«äº†ä¸€æ³¢ï¼Œå‘ç°åªå¼€äº†ä¸€ä¸ª53ç«¯å£ã€‚éš¾é“è¿™ä¸œè¥¿æ˜¯DNSï¼Ÿå’±ä¹Ÿä¸çŸ¥é“ï¼Œå› ä¸ºæ‰€æœ‰çš„DNSè¯·æ±‚éƒ½ä¼šè¢«æ‹¦æˆªåˆ°è·¯ç”±å™¨ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥æµ‹è¯•ã€‚</p>
<h2 id="è·¯ç”±å™¨æŠ“åŒ…"><a href="#è·¯ç”±å™¨æŠ“åŒ…" class="headerlink" title="è·¯ç”±å™¨æŠ“åŒ…"></a>è·¯ç”±å™¨æŠ“åŒ…</h2><p>æœ‰ç‚¹æ‡’ï¼Œè¿˜è¦å…ˆætcpdumpï¼Œå†åŠ ä¸Šå¥½åƒä¸å¤ªä¼šç”¨tcpdumpï¼Œå—¯å…ˆä¸ç®¡è¿™ä¸ª</p>
<h2 id="iOSæŠ“åŒ…"><a href="#iOSæŠ“åŒ…" class="headerlink" title="iOSæŠ“åŒ…"></a>iOSæŠ“åŒ…</h2><p>åœ¨iOSä¸ŠæŠ“åŒ…ï¼Œæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”è¾ƒç®€å•çš„ç”¨streamï¼Œåœ¨APPé‡Œè®¾ç½®ä¸€ä¸‹å°±å¯ä»¥è§£å¯†HTTPSäº†ã€‚ä¸è¿‡ç¼ºç‚¹æ˜¯streamåªèƒ½æŠ“httpså’Œhttpçš„ï¼Œå…¶ä»–åè®®çœ‹ä¸åˆ°</p>
<p>æŠ“åŒ…ä¹‹åå¯ä»¥åˆ†äº«haræ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸ªjsonã€‚æŠ“åŒ…ç»“æœä¸­æœ‰è¿™æ ·å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://api.deye.com.cn/v3/enduser/userInfo/">https://api.deye.com.cn/v3/enduser/userInfo/</a></li>
<li><code>Authorization JWT xxxx</code> çœ‹æ¥æ˜¯Json Web Tokenåšçš„è®¤è¯</li>
<li>æ¥å£åŒ…å« <code>userInfo, device_list, refresh_token, auth, mqttinfo</code>ç­‰ã€‚</li>
</ul>
<p>éšæ‰‹æ‹¿æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªapiçœ‹äº†ä¸€ä¸‹ï¼Œä»¤äººç—´å‘†æƒŠå‘†çš„äº‹æƒ…å‘ç”Ÿäº†</p>
<p><img src="/images/2021110719210916.png"></p>
<p>è¿™ç«Ÿç„¶æ˜¯ä¸ªDjango WebAppï¼Œå¹¶ä¸”è¿˜å¼€å¯äº†DEBUGæ¨¡å¼ï¼Œè¿™â€¦â€¦ğŸ˜“</p>
<p>ç®€å•æ•´ç†äº†ä¸‹æœ‰è¿™ä¹ˆå‡ ä¸ªæ¥å£æ¯”è¾ƒç®¡ç”¨</p>
<h3 id="ç™»å½•æ¥å£"><a href="#ç™»å½•æ¥å£" class="headerlink" title="ç™»å½•æ¥å£"></a>ç™»å½•æ¥å£</h3><p><a target="_blank" rel="noopener" href="https://api.deye.com.cn/v3/enduser/login/">https://api.deye.com.cn/v3/enduser/login/</a></p>
<p>bodyé‡Œæäº¤ <code>loginname</code>ã€<code>password</code>ã€<code>appid</code>ï¼ˆä»»æ„å­—ç¬¦ä¸²å°±å¯ä»¥ï¼‰ã€<code>extend</code>ï¼ˆjson stringï¼‰ï¼ŒPOSTæ–¹æ³•ï¼Œä¼šåœ¨è¿”å›çš„æ•°æ®ä¸­æ‹¿åˆ°<code>token</code>å’Œ<code>clientid</code></p>
<p>{<br>    â€œmetaâ€: {<br>        â€œcodeâ€: 0,<br>        â€œmessageâ€: â€œsignup ok.â€<br>    },<br>    â€œdataâ€: {<br>        â€œtokenâ€: â€œxxxxxâ€,<br>        â€œclientidâ€: â€œ123456â€<br>    }<br>}</p>
<p>è¿™ä¸ª<code>TOKEN</code>å°±æ˜¯åç»­çš„JWT TOKEN</p>
<p>æ³¨æ„è¿™ä¸ªç™»å½•æ˜¯å•ç‚¹ç™»å½•çš„ï¼ä½†æ˜¯TOKENä¸€ç›´æœ‰æ•ˆå°±æ˜¯äº†ã€‚</p>
<h3 id="è·å–è®¾å¤‡åˆ—è¡¨"><a href="#è·å–è®¾å¤‡åˆ—è¡¨" class="headerlink" title="è·å–è®¾å¤‡åˆ—è¡¨"></a>è·å–è®¾å¤‡åˆ—è¡¨</h3><p><a target="_blank" rel="noopener" href="https://api.deye.com.cn/v3/enduser/deviceList/?app=new">https://api.deye.com.cn/v3/enduser/deviceList/?app=new</a></p>
<p>GETè¯·æ±‚ï¼Œæºå¸¦JWT TOKENï¼Œä¼šè¿”å›å½“å‰å¸å·ç»‘å®šçš„æ‰€æœ‰è®¾å¤‡</p>
<pre><code>&#123;
    &quot;meta&quot;: &#123;
        &quot;code&quot;: 0,
        &quot;message&quot;: &quot;device list by user.&quot;
    &#125;,
    &quot;data&quot;: \[
        &#123;
            &quot;online&quot;: true,
            &quot;product\_icon&quot;: &quot;https://deye-cloud.oss-cn-shanghai.aliyuncs.com/profile/1597889707825.png&quot;,
            &quot;product\_id&quot;: &quot;c2c34567df&quot;,
            &quot;product\_name&quot;: &quot;DYD-E12A3&quot;,
            &quot;device\_id&quot;: &quot;609&quot;,
            &quot;mac&quot;: &quot;04xxxx&quot;,
            &quot;payload&quot;: &quot;1411xxxxxhiddenxxxx&quot;,
            &quot;role&quot;: 1,
            &quot;gatewaytype&quot;: 0,
            &quot;device\_name&quot;: &quot;ä¸å†æ½®æ¹¿&quot;,
            &quot;product\_type&quot;: &quot;dehumidifier&quot;,
            &quot;is\_combo&quot;: false,
            &quot;protocol\_version&quot;: &quot;wifi\_V2.4&quot;
        &#125;
    \]
&#125;
</code></pre>
<p>æ¯”è¾ƒå…³é”®çš„ä¿¡æ¯æœ‰<code>product_idï¼Œproduct_nameï¼Œdevice_id</code>ç­‰ã€‚<code>Payload</code>è¿˜ä¸çŸ¥é“æ˜¯ä¸ªå•¥çœ‹èµ·æ¥åƒæ˜¯ä¸€æ®µhex</p>
<h3 id="MQTT-info"><a href="#MQTT-info" class="headerlink" title="MQTT info"></a>MQTT info</h3><p><a target="_blank" rel="noopener" href="https://api.deye.com.cn/v3/enduser/mqttInfo/">https://api.deye.com.cn/v3/enduser/mqttInfo/</a></p>
<p>åŒæ ·æ˜¯GETè¯·æ±‚ï¼Œä¼šè¿”å›å¦‚ä¸‹æ•°æ®</p>
<p>{<br>    â€œmetaâ€: {<br>        â€œcodeâ€: 0,<br>        â€œmessageâ€: â€œmqtt infoâ€<br>    },<br>    â€œdataâ€: {<br>        â€œloginnameâ€: â€œff123&#x2F;123abcâ€,<br>        â€œclientidâ€: â€œapp_123abcâ€,<br>        â€œendpointâ€: â€œff123â€,<br>        â€œpasswordâ€: â€œ123456â€,<br>        â€œmqtthostâ€: â€œff123.mqtt.iot.gz.baidubce.comâ€,<br>        â€œmqttportâ€: 1883,<br>        â€œsslportâ€: 1884<br>    }<br>}</p>
<p>çœ‹æ¥ç”¨æˆ·åå’Œå¯†ç éƒ½æœ‰äº†ï¼Œå¹¶ä¸”ç”¨çš„æ˜¯MQTTåè®®ï¼Œè¿™æ˜¯ä¸ªå•¥ï¼Ÿ</p>
<h3 id="MQTTåè®®"><a href="#MQTTåè®®" class="headerlink" title="MQTTåè®®"></a>MQTTåè®®</h3><p>[v_blue] å›½å†…æœ‰ä¸€å®¶åšMQTTåè®®çš„å…¬å¸ï¼Œå«EMQï¼Œæ–‡æ¡£å†™çš„éå¸¸ä¸é”™ï¼</p>
<p><a target="_blank" rel="noopener" href="https://www.emqx.com/zh/blog/what-is-the-mqtt-protocol">https://www.emqx.com/zh/blog/what-is-the-mqtt-protocol</a> [&#x2F;v_blue] ç®€å•çš„æ¥è¯´ï¼ŒMQTTä¸»è¦å°±æ˜¯ä¸€ç§é€‚åˆç‰©è”ç½‘ç­‰å¤„ç†èƒ½åŠ›æ¯”è¾ƒå·®ã€å†…å­˜æ¯”è¾ƒå°ã€ç½‘ç»œç¯å¢ƒå¤æ‚ä¸å¯é çš„ç»ˆç«¯è®¾å¤‡ç”¨çš„åè®®ã€‚</p>
<p>è¿™ä¸œè¥¿ç®€å•çš„è¯´æœ‰ç‚¹åƒæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå±äºpublish&#x2F;subscribeçš„æ¨¡å¼ï¼Œä½†æ˜¯è®¾è®¡éå¸¸ç®€å•ã€‚ç›—ä¸ªå›¾æ˜¯è¿™æ ·çš„</p>
<p><img src="/images/202111071921094.png"></p>
<p>publisherå‘newsè¿™ä¸ªtopicå‘é€æ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…äº†newsçš„ç”¨æˆ·éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚</p>
<p>å½“ç„¶äº†æ¯ä¸ªç”¨æˆ·æ—¢å¯ä»¥æ˜¯publisherä¹Ÿå¯ä»¥æ˜¯subscriberã€‚</p>
<p>è¿™ä¸ªæ¶ˆæ¯ï¼Œå›¾ç‰‡ä¸­çš„some msgå°±æ˜¯payloadï¼Œæ ¼å¼ä¸€èˆ¬æœ‰jsonï¼Œplaintextï¼Œbase64å’Œhex</p>
<p>é‚£æ—¢ç„¶å¦‚æ­¤ï¼Œè‚¯å®šæ˜¯æˆ‘çš„iPhoneå‘äº†MQTTåè®®çš„æ•°æ®ï¼Œçœ‹æ¥åªèƒ½ç»§ç»­æŠ“åŒ…äº†</p>
<h2 id="WiresharkæŠ“åŒ…iOS"><a href="#WiresharkæŠ“åŒ…iOS" class="headerlink" title="WiresharkæŠ“åŒ…iOS"></a>WiresharkæŠ“åŒ…iOS</h2><p>æƒ³è¦æŠ“åˆ°iOSå…¨éƒ¨é€šä¿¡çš„æ•°æ®ï¼Œé‚£æœ€å¥½çš„åŠæ³•æ˜¯ç”¨Wiresharkäº†ã€‚å½“ç„¶æˆ‘è¿™é‡Œä¸æ˜¯è¯´åœ¨iOSä¸Šè£…Wiresharkï¼Œæƒ³å•¥å‘¢ï¼ŒApp Storeå¯æ²¡æœ‰Wiresharkã€‚</p>
<p>å…·ä½“æ¥è¯´å…¶å®å¾ˆç®€å•ï¼Œè®©iPhoneçš„å…¨éƒ¨æµé‡èµ°ä½ çš„ç”µè„‘ï¼Œç”µè„‘æŠ“åŒ…å°±å¯ä»¥äº†ã€‚Windowsæœ¬æœ¬çš„è¯ï¼Œåªèƒ½æƒ³åŠæ³•å¼€ä¸ªçƒ­ç‚¹ï¼Œç„¶åæŠ“æ— çº¿ç½‘å¡äº†ï¼Œè¿™ä¸ªæ“ä½œè¿‡äºç®€å•ï¼Œæˆ‘å°±ä¸è¯´äº†ã€‚</p>
<p>macOSçš„è¯ï¼Œè¿™æ ·ä¹Ÿè¡Œï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ç§æ›´æ–¹ä¾¿çš„ã€å¼€å‘iOS APPæ—¶ç”¨åˆ°çš„åŠæ³•ğŸ¤”</p>
<h3 id="è·å–iPhone-UDID"><a href="#è·å–iPhone-UDID" class="headerlink" title="è·å–iPhone UDID"></a>è·å–iPhone UDID</h3><p>æŠŠiPhoneç”¨çº¿è¿æ¥åˆ°ç”µè„‘ï¼Œæ‰“å¼€Apple Musicï¼Œå°±å¯ä»¥çœ‹åˆ°UDIDï¼Œä¸€å¤§é•¿ä¸²ï¼Œåˆ«è®¤é”™äº†ä¸æ˜¯åºåˆ—å·ã€‚iPhoneè®°å¾—è§£é”ã€‚</p>
<p><img src="/images/202111071921105.png"></p>
<h2 id="åˆ›å»ºè™šæ‹Ÿç½‘å¡"><a href="#åˆ›å»ºè™šæ‹Ÿç½‘å¡" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç½‘å¡"></a>åˆ›å»ºè™šæ‹Ÿç½‘å¡</h2><p>è¿™ä¸€æ­¥éœ€è¦<code>rvictl</code>è¿™ä¸ªå‘½ä»¤ï¼Œå¦‚æœä½ ä¸å¼€å‘iOS APPï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡è¿™ä¸ªå‘½ä»¤æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤åŒ…å«åœ¨Xcodeä¹‹ä¸­ã€‚</p>
<p>å½“ç„¶è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬è¦ä¸ºäº†è¿™ä¹ˆä¸€ç‚¹å°äº‹å®‰è£…10G+çš„Xcodeã€‚è¿™å°±åƒä½ çˆ¸çˆ¸æƒ³è¦æ¶ä½ å¹¶ä¸éœ€è¦æ‹¿å‡ºé¸¡æ¯›æ¸å­ï¼Œä»–åªè¦æ‹èµ·æ‹³å¤´å°±å¤Ÿäº†ã€‚åŒç†ï¼Œæˆ‘ä»¬åªè¦Xcodeçš„ä¸€å°éƒ¨åˆ†å°±å¯ä»¥äº†ã€‚å½“ç„¶äº†ï¼Œæ•´ä¸ªXcodeè¿˜æ˜¯è¦ä¸‹è½½çš„ï¼Œçˆ¸çˆ¸æ¯•ç«Ÿè¿˜è¦ä»ç®±å­é‡Œæ‹¿å‡ºæ¥é¸¡æ¯›æ¸å­å“å”¬å“å”¬ä½ å˜›ã€‚</p>
<p>åœ¨Appleå®˜ç½‘ä¸‹è½½é€‚åˆä½ çš„ç‰ˆæœ¬çš„Xcodeä¹‹åï¼Œè§£å‹ç¼©ï¼Œç„¶åè¿›åˆ°Xcode.appä¸­ï¼ˆå³é”®-æ˜¾ç¤ºåŒ…å†…å®¹ï¼‰ï¼Œæ‰¾åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<p>Xcode.app&#x2F;Contents&#x2F;Resources&#x2F;Packages&#x2F;MobileDevice.pkg<br>Xcode.app&#x2F;Contents&#x2F;Resources&#x2F;Packages&#x2F;MobileDeviceDevelopment.pkg</p>
<p>å®‰è£…è¿™ä¸¤ä¸ªå°±å¯ä»¥äº†ã€‚</p>
<p>å¦‚æœä½ ä¸æƒ³ä¸‹è½½10G+çš„Xcodeçš„è¯ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç”¨æˆ‘çš„ï¼ŒCatalina 10.15.7ï¼ŒXcode 12.4</p>
<p><a target="_blank" rel="noopener" href="https://www.dropbox.com/sh/4sdl3zyx1m0sw08/AADNcp8WdFEBtNHdUjkiIQmIa?dl=0">https://www.dropbox.com/sh/4sdl3zyx1m0sw08/AADNcp8WdFEBtNHdUjkiIQmIa?dl=0</a></p>
<p>å®‰è£…å®Œæˆå <code>sudo rvictl -s UDID</code>å³å¯çœ‹åˆ°success</p>
<p>æƒ³è¦åœæ­¢å¯ä»¥ç”¨<code>sudo rvictl -x UDID</code></p>
<p>å¦‚æœå¤±è´¥ï¼Œå¯èƒ½éœ€è¦å…ˆè¿è¡Œ</p>
<p>sudo launchctl load -w &#x2F;Library&#x2F;Apple&#x2F;System&#x2F;Library&#x2F;LaunchDaemons&#x2F;com.apple.rpmuxd.plist</p>
<p>ä¹‹åä¼šå¤šå‡ºæ¥ä¸€ä¸ª<code>rvi0</code>çš„ç½‘å¡ï¼ŒWiresharkæ‰“å¼€ï¼Œå¼€å§‹å§ï¼</p>
<h2 id="åˆ†æMQTTåè®®"><a href="#åˆ†æMQTTåè®®" class="headerlink" title="åˆ†æMQTTåè®®"></a>åˆ†æMQTTåè®®</h2><p>é¦–å…ˆæˆ‘ä»¬è¦åœ¨wiresharkçš„è®¾ç½®ä¸­å¼€å¯MQTTåè®®ï¼Œè¿™æ ·Wiresharkä¼šè§£æå‡ºæ¥ï¼Œæ›´æ–¹ä¾¿æˆ‘ä»¬çœ‹ã€‚ç„¶åéœ€è¦è¿‡æ»¤ä¸€ä¸‹</p>
<p>mqtt and ip.addr&#x3D;&#x3D;192.168.7.116</p>
<h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><p>å°±åƒåœ¨æ•™ç§‘ä¹¦ä¸­è¯´çš„ä¸€æ ·ï¼Œå¾·ä¸šæ™ºèƒ½å…ˆæ˜¯è¿æ¥åˆ°äº†MQTTæœåŠ¡å™¨</p>
<ul>
<li>Cliend ID: å…¶å®æ˜¯ä»»æ„ä¸€ä¸ªéšæœºå°½é‡ä¸å¯èƒ½é‡å¤çš„å­—ç¬¦ä¸²å°±å¯ä»¥äº†ï¼Œå¾·ä¸šæ™ºèƒ½è¿™é‡Œæ˜¯loginæ¥å£ä¸­çš„clientidå’Œæ—¶é—´æˆ³çš„æ‹¼æ¥</li>
<li>usernameå¯ä»¥ä»mqttinfoæ¥å£ä¸­è·å¾—ï¼Œæ ¼å¼å…¶å®æ˜¯<code>endpoint/clientid</code></li>
<li>å¯†ç ä»æ¥å£ä¸­è·å¾—</li>
<li>hostå½“ç„¶ä¹Ÿæ˜¯æ¥å£ä¸­è·å¾—äº†ï¼Œçœ‹èµ·æ¥æ˜¯ç™¾åº¦äº‘å“¦</li>
</ul>
<p><img src="/images/2021110719211336.png"></p>
<h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><p>éšåå¾·ä¸šæ™ºèƒ½è®¢é˜…äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œåˆ†åˆ«ä¸º</p>
<h4 id="status-x2F-hex"><a href="#status-x2F-hex" class="headerlink" title="status&#x2F;hex"></a>status&#x2F;hex</h4><p><code>endpoint/product_id/device_id/status/hex</code></p>
<h4 id="online-x2F-json"><a href="#online-x2F-json" class="headerlink" title="online&#x2F;json"></a>online&#x2F;json</h4><p><code>endpoint/product_id/device_id/online/json</code></p>
<p>{<br>    â€œtypeâ€: â€œonlineâ€,<br>    â€œdataâ€: {<br>        â€œonlineâ€: true<br>    }<br>}</p>
<p>çœ‹èµ·æ¥æ˜¯å¾·ä¸šæ™ºèƒ½åœ¨è·å–å½“å‰é™¤æ¹¿å™¨çš„çŠ¶æ€ï¼Œç„¶åAPPåŠ¨æ€æ˜¾ç¤ºæŒ‰é’®ç±»åˆ«</p>
<h3 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h3><p>publishè¯æ˜å¾·ä¸šæ™ºèƒ½å‘æŸä¸ªtopicå‘å¸ƒäº†æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™éå¸¸æœ‰å¯èƒ½æ˜¯åœ¨æ§åˆ¶é™¤æ¹¿å™¨ï¼Œè¿™å°±éœ€è¦ä¸€ç‚¹ç‚¹å°è¯•äº†</p>
<h4 id="publish-online-x2F-json"><a href="#publish-online-x2F-json" class="headerlink" title="publish online&#x2F;json"></a>publish online&#x2F;json</h4><p>å¾·ä¸šæ™ºèƒ½å‘<code>online/json</code>å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯ï¼Œå†…å®¹æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶</p>
<p><img src="/images/2021110719211557.png"></p>
<p><code>7b2274797065223a226f6e6c696e65222c2264617461223a7b226f6e6c696e65223a747275657d7d</code> éšä¾¿æ‰¾ä¸ªç½‘ç«™è½¬æ¢ä¸€ä¸‹ï¼Œå‘ç°ç«Ÿç„¶æ˜¯å¦‚ä¸‹ç»“æœ</p>
<p><img src="/images/2021110719211664.png"></p>
<p>å°è¯•åœ¨MQTTXä¸­è¿æ¥åˆ°è¿™å°è®¾å¤‡çš„MQTTæœåŠ¡å™¨ï¼Œç„¶åä»¥hexæ ¼å¼å‘å¸ƒæ¶ˆæ¯åˆ°topicï¼Œé™¤æ¹¿å™¨æ²¡æœ‰å“åº”</p>
<h4 id="publish-command-x2F-hex"><a href="#publish-command-x2F-hex" class="headerlink" title="publish command&#x2F;hex"></a>publish command&#x2F;hex</h4><p>ä»åå­—ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªéå¸¸åƒåœ¨æ§åˆ¶é™¤æ¹¿å™¨</p>
<p><img src="/images/2021110719211711.png"></p>
<p>è€Œä¸”messageæ˜¯16è¿›åˆ¶çš„<code>0001</code>ï¼Œä¼šè®©äººè”æƒ³æ˜¯ä¸æ˜¯<code>0001</code>æ˜¯å¼€ï¼Œ<code>0000</code>æ˜¯å…³ï¼Ÿ</p>
<p>åœ¨MQTTXä¸­è®¾ç½®ä¸€æ³¢ï¼Œå‘é€ï¼Œé™¤æ¹¿å™¨å¹¶æ²¡æœ‰å¼€â€¦â€¦</p>
<p>å†å¾€ä¸‹çœ‹ï¼Œè¿˜æœ‰ä¸€ä¸²ç¥å¥‡çš„æ•°å­— <code>080203403c0000000000</code>ï¼ŒMQTTXä¸­å°è¯•ä¸€ä¸‹ï¼Œå¥‡è¿¹å‡ºç°äº†ï¼Œé™¤æ¹¿å™¨å¼€äº†ã€‚ğŸ§</p>
<p>å†æŠ“ä¸ªåŒ…ï¼Œå°±ä¼šå‘ç°<code>080202403c0000000000</code>æ˜¯å…³æœºä»£ç ã€‚</p>
<p>å°½ç®¡ä¿ºä¹Ÿä¸çŸ¥é“è¿™ç¥ç§˜ä»£ç æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯è¿™å°±åƒæ˜¯ä¼æ‹‰å¤«ç»å¸¸è¯´çš„â€œæˆ‘çˆ±ä¸­å›½â€ï¼Œâ€œå’±ä»¬ä¸­å›½çœŸæ˜¯å¤ªæ£’äº†â€ä¸€æ ·ï¼Œç›´æ¥æ‹¿å»ç”¨å°±èƒ½è¿‡ä¸Šå¿ƒæƒ³äº‹æˆçš„ç”Ÿæ´»ã€‚</p>
<h2 id="Pythonå®ç°"><a href="#Pythonå®ç°" class="headerlink" title="Pythonå®ç°"></a>Pythonå®ç°</h2><p>å·²ç»çŸ¥é“äº†ç¥ç§˜ä»£ç å’Œtopicï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°è£…ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ä½¿ç”¨paho.mqtt.python</p>
<p>server.publish(â€œendpoint&#x2F;product_id&#x2F;device_id&#x2F;command&#x2F;hexâ€, â€œ080203403c0000000000â€)</p>
<p><img src="/images/2021110719211899.png" alt="å›¾åƒ"></p>
<p>å—¯ï¼Ÿï¼Ÿæ²¡å¼€å•Šï¼Œå’‹å›äº‹ï¼Ÿå®Œå…¨æ²¡æ•ˆæœã€‚ç½‘ç»œä¸å¥½å—ï¼Œå†è¯•ä¸€æ¬¡ï¼Œè¿˜æ˜¯å¦‚æ­¤</p>
<p>è«éè´¢å¯Œå¯†ç ç¥ç§˜ä»£ç å¤±çµäº†ï¼Ÿæ‰“å¼€MQTTXè®¢é˜…è¿™ä¸ªtopicï¼Œå‘ç°å¥½åƒä¸å¯¹ï¼Œæ€ä¹ˆæ˜¯é‚£ä¹ˆä¸€é•¿ä¸²æ•°å­—â€¦â€¦</p>
<p>ä»”ç»†æƒ³ä¸€ä¸‹â€¦â€¦</p>
<p><img src="/images/2021110719211868.png"></p>
<p>å™¢è¦hexæ ¼å¼ï¼Œå¯æ˜¯è¿™ä¸ªåº“å¹¶æ²¡æœ‰é¢å¤–å‚æ•°è®¾ç½®payloadçš„æ ¼å¼å•Š</p>
<p><img src="/images/2021110719211862.jpeg" alt="è¿™ä¸ªè¦æ…Œé—®é¢˜å¾ˆå¤§- æ–—å›¾è¡¨æƒ…åŒ…- æ–—å›¾ç¥å™¨- adoutu.com"></p>
<p>ä¸æ…Œä¸æ…Œï¼Œç»è¿‡æˆ‘çš„æ‘¸ç€çŸ³å¤´è¿‡æ²³ã€ç„¶åæ¬èµ·çŸ³å¤´ç ¸è‡ªå·±çš„è„šçš„è‰°è‹¦æ¢ç´¢çš„ç»å†ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘<code>struct.pack</code> ä»€ä¹ˆçš„ï¼Œç›´æ¥å‘é€è¿™æ ·çš„æ¶ˆæ¯å°±å¯ä»¥å•¦</p>
<p>codecs.decode(bâ€080203403c0000000000â€,â€hexâ€)</p>
<h1 id="å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨base64"><a href="#å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨base64" class="headerlink" title="å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨base64"></a>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨base64</h1><p>base64.b64decode(â€œCAICQDwAAAAAAA&#x3D;&#x3D;â€)</p>
<h2 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h2><p>é‚£ä¹ˆè¦ç´ å·²ç»é½å…¨äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸Šclickã€requestsç­‰ï¼Œå†™ä¸ªsetup.pyï¼Œåšæˆconsole applicationï¼Œç›´æ¥<code>pip install deye</code>ç„¶åå°±å¯ä»¥å•¦ï¼åŒ…å«ç™»å½•åŠŸèƒ½ï¼Œç™»å½•ä¹‹åä¼šæŠŠä¿¡æ¯å†™åˆ° <code>~/.deye.dbm</code>ä¸­</p>
<p>å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªè§†é¢‘</p>
<p>[video width&#x3D;â€1624â€ height&#x3D;â€1162â€ mp4&#x3D;â€<a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/11/2021110719385795.mp4%22/]/[/video/]">https://dmesg.app/wp-content/uploads/2021/11/2021110719385795.mp4&quot;\]\[/video\]</a></p>
<h2 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h2><ol>
<li>è¿™ä¸ªPython packageçš„bugå¾ˆå¤šï¼æˆ‘çŸ¥é“ï¼å› ä¸ºæˆ‘ä¸å¤ªä¼šç”¨click</li>
<li>æˆ‘å¹¶æ²¡æœ‰ä»€ä¹ˆæ‰“ç®—æ·»åŠ å…¶ä»–è®¾å¤‡çš„æƒ³æ³•ï¼Œä¹Ÿä¸æƒ³æ·»åŠ æ›´å¤šçš„commandã€‚å› ä¸ºæ—¢æ²¡æœ‰æ—¶é—´ã€ä¹Ÿæ²¡æœ‰é’±è´­å…¥æ›´å¤šå¾·ä¸šçš„è®¾å¤‡ï¼Œä¸è¿‡æ¥å£å·²ç»å†™å¥½äº†å°±æ˜¯â€¦â€¦æŒ‰ç…§åŸæœ¬çš„æƒ³æ³•ï¼Œæ˜¯æƒ³æŠŠè¿™ä¸ªæ¥å…¥ç±³å®¶çš„ï¼Œå¯æ˜¯ä¸€æƒ³è¿™ä¸ªå·¥ä½œé‡++</li>
<li>èŠ±äº†å¥½å‡ ä¸ªå°æ—¶ï¼Œå†™å®Œäº†ï¼ŒæŠŠä¸éœ€è¦çš„æ–‡ä»¶ä¸¢åˆ°å›æ”¶ç«™ï¼Œæ¸…ç©ºã€‚å‘ç°å†™å¥½çš„æ–‡ç« ä¹Ÿè¢«æˆ‘é¡ºå¸¦ç€åˆ äº†â€¦â€¦ğŸ¤¬æƒ³å˜´è‡ªå·±</li>
</ol>
<p>ä»£ç å¼€æºåœ¨è¿™é‡Œ <a target="_blank" rel="noopener" href="https://github.com/BennyThink/deye">https://github.com/BennyThink/deye</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/07/dyd-e12a3/index/" data-id="clhp7rtg0002fs2qrfxypg7sl" data-title="å¦‚ä½•æ§åˆ¶å¾·ä¸šDYD E12A3" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-fix-ax3600/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/01/fix-ax3600/index/" class="article-date">
  <time class="dt-published" datetime="2021-11-01T00:00:00.000Z" itemprop="datePublished">2021-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>â–º<a class="article-category-link" href="/categories/it/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/01/fix-ax3600/index/">å°ç±³AX3600æ•‘ç –</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å¤©ä¸‹è‹¦ç§¦ä¹…çŸ£ï¼æˆ‘ä¹Ÿå› ä¸ºAX56Uç—›è‹¦ä¸å·²ã€‚ä¸çŸ¥é“æ˜¯å›ºä»¶çš„åŸå› è¿˜æ˜¯ä»€ä¹ˆåŸå› ï¼Œå†…ç½‘å»¶è¿Ÿå‡ åƒæ¯«ç§’ã€‚</p>
<p><img src="/images/2021110120064369.jpeg"></p>
<p>äºŒè¯ä¸è¯´ä¾¿å‡ºèµ„ä¸Šé—²é±¼ä¸Šæ·˜äº†ä¸€ä¸ªAX3600ã€‚æ²¡ä¹°AX6000å› ä¸º6000æœ‰äº›ç¼©æ°´ï¼ŒCPUã€é—ªå­˜éƒ½ç¼©æ°´äº†ï¼ŒèƒŒæ¿å¸¦å®½åªæœ‰1Gbpsã€‚é…¸å¥¶å€’æ˜¯å¯¹è¿™ä¸ªå¤§å®¶ä¼™æœ‰äº›å¥½å¥‡ã€‚</p>
<p><img src="/images/2021110120064461.jpeg"></p>
<p>åˆ·æœºè¿‡ç¨‹å°±æŒ‰ç…§æ•™ç¨‹æ¥ï¼Œå…ˆé™çº§å°ç±³çš„å›ºä»¶ï¼Œå¼€SSHï¼Œç„¶ååˆ·qdskï¼Œå†åˆ·qdskï¼Œç„¶ååˆ·openwrtã€‚çœ‹ç€openwrtæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘å°±æƒ³ç€åˆ·è‡ªå·±ç¼–è¯‘çš„å›ºä»¶ï¼Œæ¯•ç«Ÿè‡ªå·±çš„å›ºä»¶åŠŸèƒ½æœ€ç²¾ç®€ï¼</p>
<h2 id="ç¼–è¯‘ç¯å¢ƒ"><a href="#ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒ"></a>ç¼–è¯‘ç¯å¢ƒ</h2><p>æˆ‘ç”¨çš„æ˜¯è¿™ä¸ªrepo <a target="_blank" rel="noopener" href="https://github.com/coolsnowwolf/lede">https://github.com/coolsnowwolf/lede</a></p>
<p>ç¼–è¯‘è¿™ç§äº‹ï¼Œå½“ç„¶è¦æ‰¾ä¸ªå¤šCPUå¤šå†…å­˜çš„è®¾å¤‡å•¦ã€‚è€Œä¸”å½“ç„¶è¦ç”¨dockerå•¦ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åªè¦build artifactsï¼å†™ä¸€ä¸ªDockerfileè£…å¥½æ‰€æœ‰å·¥å…·é“¾ï¼Œéœ€è¦çš„æ—¶å€™commit ä¸€ä¸‹å°±å¥½ã€‚</p>
<p>è¿™ä¸ªDockerfileæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ã€‚åˆ†äº«ä¸€ä¸ªå·²ç»buildå¥½çš„base imageï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œä¸‹è½½ï¼Œå·²ç»åŠ å¥½äº†ç§‘å­¦ä¸Šç½‘çš„æºï¼Œé€‚åˆåœ¨æµ·å¤–VPSä¸Šè·‘èµ·ï¼š</p>
<p>docker pull bennythink&#x2F;lede</p>
<h1 id="æˆ–è€…"><a href="#æˆ–è€…" class="headerlink" title="æˆ–è€…"></a>æˆ–è€…</h1><p>docker pull ghcr.io&#x2F;bennythink&#x2F;lede</p>
<p>å¦‚ä½•ä½¿ç”¨ï¼Ÿç›´æ¥</p>
<p>docker run â€“rm -it bennythink&#x2F;lede bash</p>
<p>ç„¶åçœ‹steps.txtå°±å¥½äº†ï¼Œæ„å»ºç»“æŸdocker cpï¼Œæˆ–è€…ç›´æ¥ -våˆ°&#x2F;lede&#x2F;binä¹Ÿå¯ä»¥ã€‚</p>
<p>å¦å¤–æˆ‘è¿˜æœ‰ä¸€ä¸ªå·²ç»buildå¥½äº†çš„imageï¼Œå¤§å°æ˜¯22Gï¼Œå¦‚æœä½ ä¹Ÿæ˜¯AX3600ï¼Œé‚£ä¹ˆå¯ä»¥æ‹‰ä¸‹æ¥è¯•è¯•ï¼Œåº”è¯¥ç¼–è¯‘å¾ˆå¿«ï¼Œæ¯•ç«Ÿä¸ç”¨ä¸‹è½½å„ç§ä¾èµ–</p>
<p>docker pull ghcr.io&#x2F;bennythink&#x2F;lede:eff9437-20211101</p>
<p><a target="_blank" rel="noopener" href="https://github.com/users/BennyThink/packages/container/package/lede">https://github.com/users/BennyThink/packages/container/package/lede</a></p>
<h2 id="æ‹†æœºæ•‘ç –"><a href="#æ‹†æœºæ•‘ç –" class="headerlink" title="æ‹†æœºæ•‘ç –"></a>æ‹†æœºæ•‘ç –</h2><p>åˆ·å®Œè‡ªå·±ç¼–è¯‘çš„å›ºä»¶å°±å˜ç –äº†ï¼Œå°ç±³æ•‘ç –å·¥å…·ä¹Ÿæ²¡ä¿®å¥½â€¦â€¦</p>
<p>äºæ˜¯åªèƒ½ä¹°äº†TTLå·¥å…·ã€‚</p>
<p>å…ˆè¦æ‹†æœºï¼ŒAX3600éå¸¸ä¸å¥½æ‹†ï¼Œå¹¶ä¸”æ‹†æœºå‰æ²¡æœ‰äººå‘Šè¯‰ä½ åº•éƒ¨å››è§’é˜²æ»‘è´´çº¸å’Œè¯´æ˜è´´çº¸ä¸‹é¢æœ‰èºä¸ã€‚</p>
<p>å‡†å¤‡å¥½TTLå·¥å…·ï¼Œæˆ‘ç”¨çš„æ˜¯FT232ï¼ŒAX3600å·¦ä¾§æœ‰å››ä¸ªå£ï¼Œæ ¹æ®è¯´æ˜åˆ†åˆ«æ˜¯VCCï¼ŒGNDï¼ŒRXï¼ŒTXã€‚FT232çš„TXè¦æ¥è·¯ç”±å™¨çš„RXï¼ŒRXè¦æ¥TXï¼ŒGNDæ¥GNDï¼ŒVCCä¸æ¥ï¼Œè°ƒåˆ°1.8v</p>
<p><img src="/images/2021110120064522.jpeg"></p>
<p>ç”¨æœé‚¦çº¿è¿æ¥å°±å¯ä»¥</p>
<p>ç„¶åç”µè„‘è¿™é‡Œï¼Œå¦‚æœæ˜¯macOS&#x2F;Linuxçš„è¯ï¼Œç›´æ¥ç”¨screenå°±å¥½ï¼Œé€šè¿‡lsusb&#x2F;lspciæˆ–è€…ç³»ç»Ÿä¿¡æ¯-USBå¯ä»¥çœ‹åˆ°è®¾å¤‡åç§°ï¼Œä¹‹åå°†è·¯ç”±å™¨é€šç”µå¼€æœºï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥äº†</p>
<p>screen -L &#x2F;dev&#x2F;cu.usbserial-A50285BI 115200 â€“L</p>
<p>Windows éœ€è¦ç”¨Puttyï¼Œåœ¨è®¾å¤‡ç®¡ç†å™¨ä¸­ç¡®è®¤COMå£</p>
<h2 id="è¿›å…¥uboot"><a href="#è¿›å…¥uboot" class="headerlink" title="è¿›å…¥uboot"></a>è¿›å…¥uboot</h2><p>æ­£å¸¸æ¥è¯´è·¯ç”±å™¨å¯åŠ¨åå°±ä¼šè¿›å…¥ubootï¼Œé»˜è®¤æœ‰5ç§’å»¶è¿Ÿï¼ŒæŒ‰å›è½¦é”®å°±å¯ä»¥ä¸­æ–­å¼•å¯¼ï¼Œç„¶åå°±å¯ä»¥è¿›å…¥ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢æ•‘ç –å•¦ã€‚</p>
<p>å¦‚æœscreenæç¤ºno ttyã€device busyä»€ä¹ˆçš„ï¼Œå¯èƒ½æ˜¯æœé‚¦çº¿æ²¡æ’è¿›ï¼Œå†æ£€æŸ¥çœ‹çœ‹</p>
<h2 id="å‡†å¤‡tftp"><a href="#å‡†å¤‡tftp" class="headerlink" title="å‡†å¤‡tftp"></a>å‡†å¤‡tftp</h2><p>macOSè‡ªå¸¦ä¸€ä¸ªtftpï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨</p>
<p>sudo launchctl load -w &#x2F;System&#x2F;Library&#x2F;LaunchDaemons&#x2F;tftp.plist</p>
<p>æŠŠåç¼€æ˜¯ubiçš„nand factoryå¤åˆ¶åˆ°<code>/private/tftpboot</code>ä¸­ï¼ˆéœ€è¦sudoï¼‰</p>
<p>åœæ­¢å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤</p>
<p>sudo launchctl unload -w &#x2F;System&#x2F;Library&#x2F;LaunchDaemons&#x2F;tftp.plist</p>
<h2 id="ubootåˆ·åˆ†åŒº"><a href="#ubootåˆ·åˆ†åŒº" class="headerlink" title="ubootåˆ·åˆ†åŒº"></a>ubootåˆ·åˆ†åŒº</h2><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><p>ç½‘çº¿è¿æ¥ç”µè„‘å’Œè·¯ç”±å™¨LANï¼Œç”µè„‘è®¾ç½®IP 192.168.31.100ï¼Œç„¶ååœ¨ubootä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<p>setenv serverip 192.168.31.100<br>setenv ipaddr 192.168.31.1</p>
<h3 id="åŠ è½½å›ºä»¶"><a href="#åŠ è½½å›ºä»¶" class="headerlink" title="åŠ è½½å›ºä»¶"></a>åŠ è½½å›ºä»¶</h3><p>ç„¶ååŠ è½½å›ºä»¶åˆ°å†…å­˜ä¸­</p>
<p>tftpboot 1.ubi</p>
<p>æ­¤æ—¶èƒ½çœ‹åˆ°å±å¹•ä¸Šåœ¨èµ°è¿›åº¦æ¡ï¼Œå¦‚æœä½ æ²¡èµ°ï¼Œæç¤ºtftp server diedæˆ–è€…å¡ä½äº†ï¼Œé‚£å¤šåŠæ˜¯tftpæœåŠ¡å™¨æ²¡é…ç½®å¥½ã€‚</p>
<p>å¤§æ¦‚èƒ½çœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š</p>
<blockquote>
<p><strong>Load address: 0x44000000</strong></p>
<p>done</p>
<p>Bytes transferred &#x3D; 31457280 (<strong>1e00000 hex</strong>)</p>
<p>ipq807x_eth_halt: done</p>
</blockquote>
<p>è¿›åº¦æ¡èµ°å®Œä¹‹åï¼Œä¼šç•™ä¸‹ä¸€ä¸ªæ•°å­—ï¼Œbyte transferred 31457280ï¼ˆ<strong>1e00000 hex</strong>ï¼‰ä¹Ÿå°±æ˜¯å›ºä»¶çš„å¤§å°ï¼ŒåŒæ—¶æœ€å¼€å§‹load addressè¿˜ä¼šå‘Šè¯‰ä½ å›ºä»¶çš„èµ·å§‹åœ°å€ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>0x44000000</code>ã€‚è¿™ä¸¤ä¸ªæ•°å€¼å¾ˆé‡è¦ï¼Œè¦è®°ä¸‹æ¥</p>
<h3 id="è·å–åˆ†åŒºä¿¡æ¯"><a href="#è·å–åˆ†åŒºä¿¡æ¯" class="headerlink" title="è·å–åˆ†åŒºä¿¡æ¯"></a>è·å–åˆ†åŒºä¿¡æ¯</h3><p>ç”¨<code>smeminfo</code>å¯ä»¥è·å–åˆ†åŒºä¿¡æ¯</p>
<blockquote>
<p>IPQ807x# smeminfo</p>
<p>flash_type: 0x2</p>
<p>flash_index: 0x0</p>
<p>flash_chip_select: 0x0</p>
<p>flash_block_size: 0x20000</p>
<p>flash_density: 0x100000</p>
<p>partition table offset 0x0</p>
<p>No.: Name Attributes Start Size</p>
<p>0: 0:SBL1 0x0000ffff 0x0 0x100000</p>
<p>1: 0:MIBIB 0x0000ffff 0x100000 0x100000</p>
<p>2: 0:QSEE 0x0000ffff 0x200000 0x300000</p>
<p>3: 0:DEVCFG 0x0000ffff 0x500000 0x80000</p>
<p>4: 0:RPM 0x0000ffff 0x580000 0x80000</p>
<p>5: 0:CDT 0x0000ffff 0x600000 0x80000</p>
<p>6: 0:APPSBLENV 0x0000ffff 0x680000 0x80000</p>
<p>7: 0:APPSBL 0x0000ffff 0x700000 0x100000</p>
<p>8: 0:ART 0x0000ffff 0x800000 0x80000</p>
<p>9: bdata 0x0000ffff 0x880000 0x80000</p>
<p>10: crash 0x0000ffff 0x900000 0x80000</p>
<p>11: crash_syslog 0x0000ffff 0x980000 0x80000</p>
<p>12: rootfs 0x0000ffff <strong>0xa00000 0x23c0000</strong></p>
<p>13: rootfs_1 0x0000ffff <strong>0x2dc0000 0x8000000</strong></p>
<p>14: overlay 0x0000ffff 0xadc0000 0x1ec0000</p>
<p>15: rsvd0 0x0000ffff 0xcc80000 0x80000</p>
<p>16: 0:WIFIFW 0x0000ffff 0xcd00000 0x900000</p>
<p>IPQ807x#</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦å…³æ³¨12å’Œ13åˆ†åŒºçš„èµ·å§‹å’Œç»“æŸåœ°å€ï¼Œè¿™ä¸¤ä¸ªéå¸¸é‡è¦ï¼Œæ¯ä¸ªäººéƒ½å¯èƒ½ä¸åŒã€‚</p>
<p>ç”±äºæˆ‘æäº†åŒç³»ç»Ÿï¼ˆç±»ä¼¼Androidçš„A&#x2F;Båˆ†åŒºï¼‰ï¼Œå› æ­¤èƒ½çœ‹åˆ°rootfså’Œrootfs_1ã€‚å½“å‰æˆ‘è¦åˆ·çš„åˆ†åŒºæ˜¯13åˆ†åŒºã€‚</p>
<h3 id="æ¸…é™¤åˆ†åŒºå†…å®¹"><a href="#æ¸…é™¤åˆ†åŒºå†…å®¹" class="headerlink" title="æ¸…é™¤åˆ†åŒºå†…å®¹"></a>æ¸…é™¤åˆ†åŒºå†…å®¹</h3><p>ä¿é™©èµ·è§ï¼Œå…ˆç»™rootfsæŠ¹æ‰ï¼Œè‡ªå·±å¯¹åº”èµ·å§‹ç»“æŸåœ°å€</p>
<p>nand erase 0xa00000 0x23c0000<br>nand erase 0x2dc0000 0x8000000</p>
<h3 id="å†™å…¥å›ºä»¶"><a href="#å†™å…¥å›ºä»¶" class="headerlink" title="å†™å…¥å›ºä»¶"></a>å†™å…¥å›ºä»¶</h3><p>å†™åˆ°rootfs_1ä¸­ï¼Œä½¿ç”¨<code>nand write</code>å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å›ºä»¶å†…å­˜åœ°å€ï¼Œåˆ†åŒºèµ·å§‹åœ°å€ï¼Œå›ºä»¶å¤§å°ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œå†™åˆ°rootfs_1ä¹Ÿå°±æ˜¯</p>
<p>nand write 0x44000000 0x2dc0000 0x1e00000</p>
<p>å†™åˆ°rootfså°±æ˜¯</p>
<p>nand write 0x44000000 0xa00000 0x1e00000</p>
<p>ç„¶åæ–­ç”µå¼€æœºï¼Œå°±ä¼šå‘ç°ç¥å¥‡çš„æ•‘å›æ¥å•¦ï¼</p>
<h2 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h2><p>ä¹‹åæˆ‘æƒ³ç”¨<code>ubiformat</code>ç»™å°ç±³çš„å›ºä»¶åˆ·åˆ°rootfs</p>
<p>ubiformat &#x2F;dev&#x2F;mtd12 -y -f &#x2F;tmp&#x2F;xiaomi1.1.12.ubi</p>
<p>ä½†æ˜¯å‘ç°åˆ·å®Œæ— æ³•åˆ‡æ¢</p>
<p>fw_setenv flag_last_success 0<br>fw_setenv flag_boot_rootfs 0</p>
<p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤åˆ‡ä¸è¿‡å»ï¼Œå³ä½¿åœ¨ubootä¸­<code>nand write</code>ä¼¼ä¹ä¹Ÿä¸è¡Œã€‚æ— æ‰€è°“å•¦ï¼Œåæ­£éƒ½ç”¨openwrtçš„ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶å€™åœ¨openwrtä¸­åˆ·è‡ªå·±ç¼–è¯‘çš„sysupgradeå°±æ²¡é—®é¢˜ï¼Œå¯èƒ½æ˜¯æˆ‘ç¬¬ä¸€æ¬¡é€‰çš„æ˜¯nand-factoryæ‰€ä»¥å˜ç –äº†å§â€¦â€¦</p>
<h2 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h2><h3 id="Wi-Fiæ–­æµ"><a href="#Wi-Fiæ–­æµ" class="headerlink" title="Wi-Fiæ–­æµ"></a>Wi-Fiæ–­æµ</h3><p>åœ¨æˆ‘çš„MBP16ä¸Šï¼Œå­˜åœ¨Wi-Fiæ–­æµé—®é¢˜ï¼Œå…·ä½“è¡¨ç°æ˜¯Wi-Fiè¿æ¥ä¿¡å·æ»¡æ ¼ï¼Œä½†æ˜¯å´æ— æ³•pingé€šä»»ä½•åœ°å€ï¼Œå…³é—­Wi-Fiå†å¼€æ‰å¯ä»¥ã€‚</p>
<p>å…¶ä»–è®¾å¤‡æ²¡é—®é¢˜ï¼Œæ€€ç–‘æ˜¯MBP16æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å…¼å®¹æ€§é—®é¢˜ï¼Ÿ</p>
<h3 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h3><p>æ„Ÿè§‰ä¼¼ä¹openwrtå­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œä»€ä¹ˆä¹Ÿæ²¡å¹²å°±å‰©è¿™ä¹ˆç‚¹äº†ã€‚å½“ç„¶æˆ‘æ‡‚ï¼Œå†…å­˜è¿™ä¸œè¥¿ç”¨èµ·æ¥äº†æ‰å¥½ï¼Œè¦ä¸ç„¶é—²ç½®å°±æ˜¯æµªè´¹ï¼Œåªè¦å°½é‡å°‘ç”¨swapå°±å¥½ï¼Œæ¯•ç«Ÿè·¯ç”±å™¨ä¸Šçš„swapé‚£å¯æ˜¯é—ªå­˜ï¼Œä¸ä»…æ…¢è¿˜ä¼šç£¨æŸã€‚</p>
<p>æ„Ÿè°¢ç¾¤å‹æŒ‡æ•™ï¼Œopenwrté»˜è®¤å¼€äº†zramï¼Œä¹Ÿå°±æ˜¯æŠŠå†…å­˜çš„ä¸€éƒ¨åˆ†æ‹¿æ¥å‹ç¼©ç”¨ï¼Œé»˜è®¤æ˜¯ç³»ç»Ÿç®¡ç†å¤§å°ï¼Œäºæ˜¯è¿™é‡Œæˆ‘çœ‹åˆ°è™šæ‹Ÿå†…å­˜202Mï¼Œå…¶å®å°±æ˜¯ä»RAMä¸­æ‹¿å‡ºæ¥çš„ã€‚åœ¨ç³»ç»Ÿ-ç³»ç»Ÿä¸­å¦‚æœæ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªå€¼å¹¶é‡å¯ï¼Œä¸Šé¢çš„å†…å­˜æ•°å€¼å°±æ­£å¸¸äº†ã€‚</p>
<p><img src="/images/2021110120064567.png"></p>
<p>è‡³å°‘å†…ç½‘å‡ åƒæ¯«ç§’çš„å»¶è¿Ÿä¿®å¥½äº†ï¼</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://www.right.com.cn/FORUM/thread-6119565-1-1.html">https://www.right.com.cn/FORUM/thread-6119565-1-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-5044604-1-1.html">https://www.right.com.cn/forum/thread-5044604-1-1.html</a></p>
<p>è­¦å‘Šï¼šä¼¼ä¹ç”±äºä»€ä¹ˆå¥‡æ€ªçš„åŸå› ï¼Œå°ç±³è®¾å¤‡çš„æ”¯æŒè¢«åˆ é™¤äº†ï¼Œå¯ä»¥çœ‹è¿™ä¸ªcommit <a target="_blank" rel="noopener" href="https://github.com/coolsnowwolf/lede/commit/edbd8d2e9839357f3a4f0a06174d243f362b1544">https://github.com/coolsnowwolf/lede/commit/edbd8d2e9839357f3a4f0a06174d243f362b1544</a></p>
<p>git reset â€“hard 20a437026ae6fb7834063dbc56685b11023f06c9 å¯è§£å†³</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/01/fix-ax3600/index/" data-id="clhp7rtgb002us2qr6rqlgnt1" data-title="å°ç±³AX3600æ•‘ç –" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-telegram-sticker/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/26/telegram-sticker/index/" class="article-date">
  <time class="dt-published" datetime="2021-10-26T00:00:00.000Z" itemprop="datePublished">2021-10-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/26/telegram-sticker/index/">ä½¿ç”¨Telegram æ–—å›¾</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>äººç±»çš„æœ¬è´¨å°±æ˜¯æ–—å›¾æœºã€‚</p>
</blockquote>
<p>æƒ³è¦åœ¨Telegramä¸Šæ–—å›¾ï¼Œé‚£ä¹ˆå¿…ç„¶å°±è¦ç”¨åˆ°MTProtoäº†ã€‚å¯¹äºpyrogramæ¥è¯´ï¼Œé‚£æ˜¯éå¸¸ç®€å•çš„ï¼</p>
<p>@app.on_message(filters.incoming)<br>def sticker_handler(client: â€œClientâ€, message: â€œtypes.Messageâ€):<br>    chat_id &#x3D; message.chat.id<br>    sticker &#x3D; â€œCAACAgUAAxkBAAEHooZhc87afMQjB-c10tBfkdcH1VSAWwACjwEAAjMDHAiv-7CBCwXTrR4Eâ€<br>    client.send_chat_action(chat_id, â€œtypingâ€)<br>    message.reply_sticker(sticker, quote&#x3D;True)</p>
<p>stickerå¯ä»¥ä¸ºè¡¨æƒ…åŒ…çš„æ–‡ä»¶è·¯å¾„ã€HTTP URLã€æˆ–è€…æ˜¯æ–‡ä»¶IDã€‚</p>
<p>å¦‚æœ‰éœ€è¦å¯ä»¥å¯¹filtersè¿›è¡Œå„ç§å®šåˆ¶ï¼Œæ¯”å¦‚è¯´æˆ‘è¦æŸä¸ªç”¨æˆ·ç»™æˆ‘å‘æŸä¸ªç‰¹å®šè¡¨æƒ…åŒ…æ—¶æ‰æ–—å›¾ï¼Œé‚£ä¹ˆfilterå¤§æ¦‚å¯ä»¥è¿™æ ·å†™</p>
<p>@app.on_message(filters.sticker &amp; filters.incoming &amp; filters.user(user_id))</p>
<p>ç„¶ååˆ¤æ–­ä¸€ä¸‹</p>
<p>if message.sticker.file_unique_id &#x3D;&#x3D; â€œabcdâ€:<br>    client.send_chat_action(chat_id, â€œtypingâ€)<br>    message.reply_sticker(sticker, quote&#x3D;True)</p>
<p>[v_blue]</p>
<p>å°æç¤ºï¼šå¦‚ä½•è·å–user_id? è¯•è¯•è¿™ä¸ªbotå‘¢ï¼Ÿ <a target="_blank" rel="noopener" href="https://t.me/blog_update_bot">https://t.me/blog_update_bot</a> [&#x2F;v_blue] é‚£ä¹ˆè¿™ä¸ªstickerçš„IDæ€ä¹ˆè·å–å‘¢ï¼Ÿç¬¨åŠæ³•æ˜¯ï¼Œæ‰¾ä¸ªå°å·å¸®å¿™å‘ä¸ªè¡¨æƒ…å°±å¥½äº†ã€‚</p>
<p>æˆ‘çš„Telegramé‡Œæ˜æ˜æ·»åŠ äº†é‚£ä¹ˆå¤šè¡¨æƒ…åŒ…ï¼Œå¦‚æœèƒ½ä¸€é”®ä½¿ç”¨å°±å¥½äº†ã€‚æ—¢ç„¶MTProtoæ˜¯å…¬å¼€çš„ï¼Œé‚£ä¹ˆä¹Ÿä¸€å®šæœ‰åŠæ³•ã€‚</p>
<h2 id="Raw-Functions"><a href="#Raw-Functions" class="headerlink" title="Raw Functions"></a>Raw Functions</h2><p>pyrogramå°è£…äº†è®¸å¤šæ˜“äºä½¿ç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä¸Šé¢çš„å‘stickerï¼Œæœ€å¸¸ç”¨çš„å›å¤æ¶ˆæ¯ç­‰ç­‰ã€‚ä½†æ˜¯å®é™…ä¸Šè¿™äº›éƒ½åˆ©ç”¨äº†Raw Functionã€‚å¾ˆå¤šåŠŸèƒ½å¹¶æ²¡æœ‰å°è£…æˆé«˜å±‚çš„ Pythonæ–¹æ³•ï¼Œéå¸¸ä¸å¹¸çš„æ˜¯ï¼Œè·å–sticker setä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p>
<p>æƒ³è¦ä½¿ç”¨raw functionsä¹Ÿå¾ˆç®€å•å•¦</p>
<p>from pyrogram.raw import functions<br>app.send(<br>    functions.account.UpdateProfile(<br>    first_name&#x3D;â€Danâ€, last_name&#x3D;â€TÃ¨sâ€,<br>    about&#x3D;â€Bio written from Pyrogramâ€)<br>)</p>
<h2 id="è·å–å…¨éƒ¨å·²æ·»åŠ çš„sticker"><a href="#è·å–å…¨éƒ¨å·²æ·»åŠ çš„sticker" class="headerlink" title="è·å–å…¨éƒ¨å·²æ·»åŠ çš„sticker"></a>è·å–å…¨éƒ¨å·²æ·»åŠ çš„sticker</h2><p>è·å–å…¨éƒ¨stickerçš„å‡½æ•°æ˜¯ <code>functions.messages.GetAllStickers</code></p>
<p>äºæ˜¯ä½ å…´è‡´å‹ƒå‹ƒå†™å¥½äº†ä»£ç ï¼Œå¹¶ä¸”çŒœæµ‹çŒœæµ‹sendæ–¹æ³•ä¼šæœ‰è¿”å›å€¼</p>
<p><img src="/images/2021102621070689.png"></p>
<p>è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿè¿™ä¸ªå‚æ•°hashæ˜¯ä»€ä¹ˆï¼Ÿè¦æ€ä¹ˆå†™ï¼Ÿ</p>
<p><img src="/images/2021102621070739.jpeg"></p>
<p>å…¶å®è¿™ä¸ªhashæ˜¯ä¸ºäº†èŠ‚çº¦åŒæ–¹çš„èµ„æºçš„ï¼Œæœ‰ç‚¹åƒetagã€‚å…·ä½“å¯ä»¥çœ‹è¿™é‡Œ <a target="_blank" rel="noopener" href="https://core.telegram.org/api/offsets#hash-generation">https://core.telegram.org/api/offsets#hash-generation</a></p>
<p>æˆ‘ä»¬è¿™éšä¾¿ä¼ å…¥ä¸€ä¸ªæ•°å­—å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªæ¥å£è·å–åˆ°çš„æ•°æ®å¤§æ¦‚æ˜¯è¿™ç§ç»“æ„ï¼š</p>
<p><img src="/images/2021102621070847.png"> [v_error]çœ‹åˆ°ä¸Šé¢çš„hash 50617â€¦.äº†å—ï¼ŒæŒ‰é“ç†åº”è¯¥ä¼ å…¥è¿™ä¸ªçš„å“¦ï¼Œå°±ä¼šæœ‰ç±»ä¼¼304 Not Modifiedçš„æ•ˆæœ[&#x2F;v_error]</p>
<h2 id="è·å–sticker-set"><a href="#è·å–sticker-set" class="headerlink" title="è·å–sticker set"></a>è·å–sticker set</h2><p>ä¸Šé¢çš„<code>all_stickers</code>å°±åŒ…å«äº†è¿™ä¸ªç”¨æˆ·æ‰€æ”¶è—çš„æ‰€æœ‰stickerï¼Œæ¯ä¸€ä¸ªsticker setéƒ½æ˜¯listçš„ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>ç„¶åæˆ‘ä»¬çœ‹ä¸‹è·å–sticker setçš„API</p>
<p><code>functions.messages.GetStickerSet</code></p>
<p>æ¥å—ä¸€ä¸ªç¥å¥‡çš„å‚æ•° <code>stickerset: &quot;raw.base.InputStickerSet&quot;</code></p>
<p>å¾ˆå¤šäººå¯èƒ½ä¼šé—®ï¼Œè¿™æ˜¯å•¥å‚æ•°ç±»å‹å•Šï¼Œæ€ä¹ˆæ„é€ ï¼Ÿ</p>
<p>è¦ä»raw_typesé‡Œå»æå•¦ï¼Œtype hintå·²ç»ç»™äº†æç¤ºæ˜¯ <code>raw.base.InputStickerSet</code></p>
<p>from pyrogram.raw import types as raw_types<br>raw_types.InputStickerSetID</p>
<p><code>InputStickerSetID</code>æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>id</code>ï¼Œä¸€ä¸ªæ˜¯<code>access_hash</code></p>
<p>é‚£è¿™ä¸ªå°±ä¸ç”¨æˆ‘å¤šè¯´äº†å§ï¼Œæ¯ä¸€ä¸ªsetéƒ½æœ‰è¿™ä¸¤ä¸ªå‚æ•°</p>
<p><img src="/images/2021102621070967.png"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½æ‹¿åˆ°ä¸€ä¸ªstickerçš„å…¨éƒ¨ä¿¡æ¯äº†ï¼æ•°æ®ç»“æ„å¤§è‡´å¦‚ä¸‹</p>
<p>setå­—æ®µï¼Œè¡¨ç¤ºsticker setçš„åŸºæœ¬ä¿¡æ¯ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·</p>
<p>packså’Œdocumentsï¼Œè¡¨ç¤ºå•ä¸ªstickerçš„ä¿¡æ¯</p>
<p>packsçš„ç»“æ„æ¯”è¾ƒç®€å•ï¼Œçœ‹èµ·æ¥åƒæ˜¯ä¸ªç´¢å¼•ä¸€æ ·</p>
<p><img src="/images/2021102621071087.png"></p>
<p>documentsçš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼ŒåŒ…å«äº†ç¼©ç•¥å›¾ç­‰ä¿¡æ¯</p>
<p><img src="/images/2021102621071241.png"></p>
<p>é‚£çœ‹èµ·æ¥è¿™ä¸ªdocumentå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„äº†ï¼é‚£ä¹ˆç»§ç»­ç”¨<code>functions.messages.send_xxx</code></p>
<p>æƒ³æƒ³å°±ç—›è‹¦ï¼Œæœ‰æ²¡æœ‰åŠæ³•åˆ©ç”¨pyrogramçš„send_stickersnå‘¢ï¼Ÿ</p>
<p>é‚£ä¸€å¤§é•¿ä¸²<code>file_id</code>æ˜¯ä»€ä¹ˆå•Šï¼Ÿ</p>
<h2 id="è½¬æ¢ä¸ºfile-id"><a href="#è½¬æ¢ä¸ºfile-id" class="headerlink" title="è½¬æ¢ä¸ºfile_id"></a>è½¬æ¢ä¸ºfile_id</h2><p>è¦ä½¿ç”¨å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥â€”â€”å‘¼å‘¼æ‹‰â€”â€”é»‘ä»™é­”å…‰æ‰èƒ½æŠŠstickerå˜åˆ°file_idï¼</p>
<p>å…·ä½“æ€ä¹ˆåšæˆ‘æ•™ç»™ä½ ä»¬å°±å¥½äº†ï¼ä¸ç”¨æ¢ç´¢å…¶ä¸­åŸç†â€¦â€¦åæ­£å°±æ˜¯çœ‹pyrogramçš„<code>send_sticker</code>æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œç„¶åé€†ç€æ¥å˜›ğŸ˜</p>
<p>from pyrogram.file_id import FileId, FileType</p>
<p>file_id &#x3D; FileId(file_type&#x3D;FileType.STICKER,<br>    dc_id&#x3D;doc.dc_id,<br>    file_reference&#x3D;doc.file_reference,<br>    media_id&#x3D;doc.id,<br>    access_hash&#x3D;doc.access_hash,<br>    sticker_set_id&#x3D;set_id,<br>    sticker_set_access_hash&#x3D;set_hash).encode()</p>
<p><code>set_id</code>æ˜¯<code>set_access_hash</code>æ˜¯sticker setçš„ï¼Œ<code>media_id</code>å’Œ<code>access_hash</code>æ˜¯è¿™ä¸ªstickerçš„ï¼Œä¸è¦æé”™äº†å“¦ã€‚</p>
<p>ç„¶åç”Ÿæˆçš„ä¸€é•¿ä¸²å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥å–‚ç»™ <code>send_sticker</code>å•¦ã€‚</p>
<p>å»ºè®®äº‹å…ˆæŠŠæ‰€æœ‰çš„stickerçš„file_idéƒ½è·‘å‡ºæ¥ï¼Œç„¶åéšæœºä»é‡Œé¢é€‰å°±å¥½äº†ï½è¦ä¸ç„¶å®¹æ˜“è§¦å‘rate limitå¯¼è‡´Durové€ä½ é£æœºç¥¨ã€‚</p>
<h2 id="æ¬¢ä¹æ–—å›¾"><a href="#æ¬¢ä¹æ–—å›¾" class="headerlink" title="æ¬¢ä¹æ–—å›¾"></a>æ¬¢ä¹æ–—å›¾</h2><p>ä¸ºäº†æ–—å›¾æ›´å¿«ä¹ï¼Œæˆ‘ä»¬ä¹Ÿè¦æçš„æ›´æ¬¢ä¹æ›´éšæœºï¼</p>
<p>é‚£ä¹ˆæœ€ç®€å•çš„åŠæ³•ï¼Œå…¶å®å°±randomä¸€ä¸‹å°±å¥½äº†ï¼Œå…ˆéšæœºé€‰stickerï¼Œç„¶åå†è‡ªå®šä¹‰å›å¤æ¦‚ç‡ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦ä¸€åŠæ¦‚ç‡å›å¤ï¼Œé‚£å°±â€¦â€¦</p>
<p>if random.choice([1, 0]):<br>    client.send_chat_action(chat_id, â€œtypingâ€)<br>    message.reply_sticker(â€œsticker file_idâ€, quote&#x3D;True)</p>
<p>æˆ–è€…æ¯”å¦‚æˆ‘æƒ³è¦79%çš„æ¦‚ç‡å›å¤ï¼Œé‚£å°±â€¦â€¦</p>
<p>random.randint(1, 100) &lt;&#x3D; 79</p>
<p>è¦æƒ³è¦æ¯æ¬¡éƒ½éšæœºçš„å›å¤æ¦‚ç‡ï¼Œé‚£å…¶å®ä¹Ÿä¸éš¾</p>
<p>rand1 &#x3D; random.randint(1, 100)<br>rand2 &#x3D; random.randint(1, 100)<br>if rand1 &gt; rand2:<br>    pass</p>
<p>å½“ç„¶å•¦ï¼Œä¸Šè¿°ç®—æ³•ä»æ•´ä½“ä¸Šæ¥è®²ï¼Œå›å¤æ¦‚ç‡æ˜¯50%çš„,æ ·æœ¬æ•°é‡è¶Šå¤§å°±ä¼šè¶Šè¿‘äº50%ã€‚æ¯•ç«Ÿå˜›ï¼Œè¦ä¹ˆå‘è¦ä¹ˆä¸å‘ï¼Œè¿™èŒƒå›´è¿˜æ˜¯ä¸€æ ·çš„â€¦â€¦é‚£è‚¯å®š50%å•¦ã€‚</p>
<h2 id="æ–—å›¾ç»“æœ"><a href="#æ–—å›¾ç»“æœ" class="headerlink" title="æ–—å›¾ç»“æœ"></a>æ–—å›¾ç»“æœ</h2><p>è‡ªç„¶æ˜¯éå¸¸å¼€å¿ƒäº†ï¼Œ24å°æ—¶éšæ—¶å›å¤ï¼å°ä¼™ä¼´éƒ½æƒŠå‘¼æˆ‘ç«Ÿç„¶å¤§åŠå¤œä¸ç¡è§‰ï¼</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/26/telegram-sticker/index/" data-id="clhp7rtlc009ks2qr64r6f6g7" data-title="ä½¿ç”¨Telegram æ–—å›¾" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-cat/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/02/cat/index/" class="article-date">
  <time class="dt-published" datetime="2021-10-02T00:00:00.000Z" itemprop="datePublished">2021-10-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/02/cat/index/">å¤šå›¾æ€çŒ«</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>6æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘çš„å¿ƒæƒ…éå¸¸å·®åŠ²ï¼Œç”šè‡³ä¸€åº¦æ€€ç–‘è‡ªå·±æœ‰è½»åº¦ä¸­åº¦æŠ‘éƒç—‡ã€‚é‚£æ®µæ—¶é—´å°±ç»å¸¸å‡ºå»æ•£æ­¥ï¼Œæ¼«æ— ç›®çš„çš„èµ°å•Šèµ°ï¼Œèµ°ç´¯äº†ä¹Ÿå°±ä¸ä¼šå†æƒ³å…¶ä»–äº‹æƒ…äº†ã€‚</p>
<p>æœ‰ä¸€æ¬¡ï¼Œåœ¨å¤–é¢åƒé¥­çš„æ—¶å€™ï¼Œåº—å®¶æœ‰ä¸€åªå°çŒ«ç‰¹åˆ«å¯çˆ±ï¼Œçœ¼ç›å¤§å¤§çš„ï¼Œä¸ä»…ä¼šå–µå–µå«ï¼Œè¿˜ç»™æ‘¸ã€‚</p>
<p><img src="/images/2021100221421248.png"></p>
<p>6æœˆåº•åœ¨å¤–é¢æ•£æ­¥çš„æ—¶å€™ï¼Œé‡åˆ°ä¸€åªç‹¸èŠ±çŒ«ï¼Œè§åˆ°æˆ‘å°±è¹­è¹­ç„¶åå–µå–µå«ã€‚çœ‹èµ·æ¥å°çŒ«çŒ«å¾ˆä¹–ï¼Œä¹ŸæŒºå¥åº·çš„ï¼Œå°±æ˜¯æœ‰ç‚¹ç˜¦ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/10/2021100221482722.png"><img src="/images/2021100221482722.png"></a></p>
<p>çŒœæµ‹å®ƒä¼°è®¡æ˜¯é¥¿äº†ï¼Œåœ¨å’¨è¯¢äº†æœ‹å‹çš„æ„è§ä¹‹åå»è¶…å¸‚ä¹°äº†ç«è…¿è‚ å’ŒçŸ¿æ³‰æ°´ã€‚</p>
<p>å°çŒ«è¿˜æŒºä¹–çš„ï¼Œä¸ä»…è®©äººå–‚ï¼Œè¿˜ä¸ä¸Šçˆªå­ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/10/2021100221485431.png"><img src="/images/2021100221485431.png"></a></p>
<p>éƒ½è¯´ç‹¸èŠ±çŒ«æ²¡è‰¯å¿ƒï¼Œè¿™åªåƒå®Œå°±è·‘äº†ï¼Œéƒ½æ²¡è®©æˆ‘å¤šæ‘¸ä¸€ä¼šã€‚</p>
<p>åæ¥è¿‡å‡ å¤©çš„æ—¶å€™ï¼Œçœ‹åˆ°å®ƒåœ¨è·¯ä¸Šå’Œå°æœ‹å‹ç©ï¼Œæ‰“æ»šå–èŒå‘¢ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/10/2021100221492553.png"><img src="/images/2021100221492553.png"></a></p>
<p>å†åæ¥æˆ‘å°±å†ä¹Ÿæ²¡è§è¿‡è¿™åªçŒ«äº†ã€‚</p>
<p>7æœˆåº•çš„æ—¶å€™ï¼Œåœ¨æˆ‘è¿™è¾¹æ¥¼ä¸‹é‡åˆ°äº†ä¸€åªå°ç‹¸èŠ±ï¼Œå¾ˆä¹–ï¼Œç»™æ‘¸ã€‚æ¥¼é‡Œè§åˆ°è¿‡çŒ«ç²®ï¼Œå¯èƒ½æ˜¯åˆ«çš„ä½æˆ·å–‚è¿‡ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/10/2021100221495428.png"><img src="/images/2021100221495428.png"></a></p>
<p>çœ‹èµ·æ¥å’Œä¹‹å‰çš„é‚£åªå¾ˆåƒï¼Œä¸è¿‡èŠ±è‰²æœ‰äº›å·®è·ï¼Œå°¾å·´ä¹Ÿä¸ä¸€æ ·ï¼Œè‚¯å®šä¸æ˜¯åŒä¸€åªã€‚è¿™åªå°ç‹¸èŠ±æœ‰ç‚¹è”«ï¼Œå–‚åƒçš„ä¹Ÿä¸åƒã€‚</p>
<p>åæ¥æˆ‘å°±å¹²è„†ä¹°äº†çŒ«ç²®ï¼Œæ‰“ç®—ä¸‹ç­ä¹‹åæ²¡äº‹å¹²çš„æ—¶å€™å–‚çŒ«çŒ«ã€‚</p>
<p>åˆ«è¯´è¿˜çœŸçš„å¸å¼•è¿‡æ¥äº†å‡ åªçŒ«</p>
<p><img src="/images/2021100221430673.png"></p>
<p>ä¸‰åªå¥¶ç‰›çŒ«ï¼Œä¸€åªæ©˜çŒ«ï¼Œéƒ½ååˆ†æ€•ç”Ÿã€‚è§åˆ°äººå°±è·‘é‚£ç§ã€‚å–‚äº†åŠä¸ªæœˆäº†ï¼Œè§åˆ°æˆ‘è¿˜æ˜¯è·‘ã€‚</p>
<p>è€Œä¸”è¿™åªæ©˜çŒ«ï¼Œåˆ«çœ‹å®ƒæ˜¯ä½“å‹æœ€å¤§çš„ï¼Œä½†æ˜¯å´æ˜¯è¿™å‡ åªçŒ«é‡Œåœ°ä½æœ€ä½ä¸‹ã€æœ€èƒ†å°çš„ã€‚æ¯æ¬¡éƒ½è¦ç­‰å…¶ä»–çš„çŒ«çŒ«åƒé¥±äº†å®ƒæ‰å»åƒã€‚ä¸è¿‡è¿™åªçŒ«ä¹Ÿç®—æ˜¯è¿™å‡ åªé‡Œæ¯”è¾ƒä¸æ€•ç”Ÿçš„äº†ï¼Œæˆ‘ç”šè‡³è¶ç€å®ƒåƒé£Ÿçš„æ—¶å€™å»æ‘¸è¿‡å®ƒçš„å¤´ï¼Œä¸è¿‡è¿˜æ˜¯ä¸€ä¸‹å­èº²å¼€äº†ã€‚</p>
<p>åœ¨æœ‰ä¸€æ¬¡å–‚å®ƒä»¬çš„æ—¶å€™ï¼Œæˆ‘è¿˜è¢«è¿™åªå¥¶ç‰›çŒ«ç»™æŠ“åˆ°äº†ã€‚æˆ‘ä¹Ÿæ˜¯ä½œæ­»å•Šã€‚å½“æ—¶å†…å¿ƒéå¸¸æ…Œï¼Œåœ¨æƒ³ç€è¦ä¸è¦å»åŒ»é™¢ã€‚ä½†æ˜¯å¾ˆå¿«å°±äº†è§£åˆ°äº†å…¶å®è¿™æ ·æ…Œå¼ æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œæˆ‘å¯ä»¥ç›´æ¥åæ—¥è§‚å¯Ÿæ³•å°±å¥½äº†ã€‚</p>
<blockquote>
<p>The worst thing we can do in a situation like this is panic.</p>
</blockquote>
<p>åæ¥ä¸€ä¸ªå¤šæœˆè¿™å‡ åªçŒ«è¿˜åœ¨éª—åƒéª—å–ï¼Œæˆ‘ä¹Ÿå°±æ²¡äº‹äº†ã€‚</p>
<p>7æœˆä¸­ï¼Œè¿™åªç‹¸èŠ±çŒ«å°±ç»å¸¸å‡ºç°äº†ã€‚é¡ºå¸¦ç€å¶å°”è¿˜æœ‰ä¸€åªç™½è‰²çš„çŒ«ä¹Ÿè·‘å‡ºæ¥è¹­åƒè¹­å–ã€‚åŸºæœ¬ä¸Šæ¯æ™šå°±ä¼šå‡†æ—¶å‡ºç°ï¼Œæœ‰ä¸€æ¬¡å»å…¬å¸å¿«åˆ°å…«ç‚¹æ‰å›æ¥ï¼Œå‘ç°å¥¹è¿˜åœ¨é‚£ç­‰æˆ‘å‘¢ã€‚</p>
<p><img src="/images/2021100221431375.png"></p>
<p>æœ‰ä¸€æ¬¡çœ‹åˆ°ä¸€å¯¹æƒ…ä¾£ç»™è¿™åªç™½çŒ«æŠ±èµ·æ¥å¸¦èµ°äº†ï¼Œæˆ‘å¼€å§‹æ€€ç–‘è¿™åªå°ç™½æ˜¯ä¸æ˜¯æ•£å…»çš„ã€‚æ•£å…»çŒ«ä¹Ÿå¤ªå¿ƒå¤§äº†å§ï¼Œå¾ˆå®¹æ˜“èµ°ä¸¢çš„ã€‚</p>
<p>è¿™ä¿©è¿˜ç»å¸¸ä¸€èµ·ç©ï¼Œç»å¸¸æ‰“æ¥æ‰“å»çš„ã€‚å°ç™½çŒ«æ‰“ä¸è¿‡ç‹¸èŠ±çŒ«ï¼Œä½†æ˜¯è¿˜å–œæ¬¢æ’©é—²ã€‚</p>
<p>è¿™åªå°ç‹¸èŠ±çŒ«å¾ˆä¹–ï¼Œç”šè‡³è¿˜ç¿»è¿‡æ¥ï¼Œæ‘¸è‚šå­ä¹Ÿæ— åæŠ—ã€‚æ¯•ç«Ÿå¯èƒ½å¥¹çš„çŒ«ç”Ÿæ•™ä¼šäº†å¥¹ä¸€ä¸ªé“ç†ï¼Œåªè¦å–èŒå°±èƒ½æœ‰å¥½åƒçš„ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/10/2021100221534286.png"><img src="/images/2021100221534286.png"></a></p>
<p><img src="/images/2021100221432560.png"></p>
<p>å“æˆ‘è¿™æ‰‹ä¸Šå…¨æ˜¯å–‚çŒ«çŒ«æ—¶è¢«èšŠå­å’¬çš„å•Šâ€¦â€¦è…¿ä¸Šä¹Ÿå…¨æ˜¯ã€‚</p>
<p>æƒ¬æ„ï¼ŒçœŸä¼šæ‰¾åœ°æ–¹</p>
<p><img src="/images/2021100221433046.png"></p>
<p>åæ¥åˆ°äº†9æœˆï¼Œæˆ‘ä¸‹å®šå†³å¿ƒè¦ç»‘æ¶å°çŒ«çŒ«ã€‚</p>
<p>æŠ±åˆ°åŒ»é™¢å‰å‡ å¤©å‘ç°å¥¹çš„è‚šå­æœ‰ç‚¹å¤§ï¼Œæ˜¯ä¸æ˜¯æ€€å­•äº†ã€‚æ¯•ç«Ÿå’Œå¥¹æ‰“é—¹çš„é‚£ä¸ªæ˜¯å…¬çŒ«ï¼Œçœ‹èµ·æ¥ä¹Ÿæ˜¯é€‚é¾„é’å¹´çŒ«â€¦â€¦æ€€å­•äº†ä¹Ÿä¸è¦ç´§ï¼Œå°±ç”Ÿä¸‹æ¥å§ï¼Œé—®é¢˜ä¸å¤§ï¼Œæˆ‘ç”šè‡³éƒ½è”ç³»å¥½äº†å°çŒ«å´½é”€èµƒäººé€‰â€¦â€¦ğŸ¤ª</p>
<p>9æœˆ4æ—¥æ˜ŸæœŸå…­åšå¥½äº†ç»‘æ¶çš„å‡†å¤‡ï¼Œå‘ç°ä¹‹å‰çš„å‡†å¤‡çš„çº¸ç®±å¤ªå°äº†ï¼ŒæŠ±è¿›å»å¥¹å°±è·‘ã€‚äºæ˜¯ä¸Šæ¥¼æ¢é•¿è¢–ï¼Œä¸€è·¯æŠ±ç€èµ°åˆ°äº†åŒ»é™¢ï¼ŒæœŸé—´å°çŒ«çŒ«æœ‰ç‚¹ç´§å¼ ï¼Œç”¨çˆªå­æŠ“ç€æˆ‘çš„æ‰‹è‡‚ï¼Œä¸è¿‡åŸºæœ¬æ²¡æœ‰åæŠ—ã€‚</p>
<p><img src="/images/2021100221433394.jpeg"></p>
<p>åœ¨åŒ»é™¢ï¼Œå¥¹ç”¨è¿™ç§å¹½æ€¨çš„çœ¼ç¥çœ‹ç€æˆ‘ã€‚</p>
<p>å¸¦å›å®¶äº†ä¹‹åï¼Œè‡ªå·±å°±ä¼šç”¨çŒ«ç ‚ç›†ï¼Œéƒ½ä¸ç”¨æ•™ï¼Œå¥½è¯„å¦‚æ½®ã€‚</p>
<p><img src="/images/2021100221433496.jpeg"></p>
<p>å½“æ™šå°±è¿™ä¸ªå§¿åŠ¿äº†ï¼Œå€’æ˜¯æ²¡æŠŠè‡ªå·±å½“å¤–äººå•Šã€‚</p>
<p><img src="/images/2021100221433517.jpeg"></p>
<p>å°¾å·´å¯çœŸé•¿å•Šã€‚</p>
<hr>
<p>å°çŒ«å’ªæ•´ä½“è¿˜æ˜¯æŒºä¹–çš„ï¼Œèº«ä½“ä¹Ÿå¾ˆå¥åº·ã€‚æ€€å­•é‚£ä¸ªäº‹ï¼Œåæ¥åšäº†Bè¶…ï¼Œå¹¶æ²¡æœ‰æ€€ã€‚å¯èƒ½æ˜¯ä¹‹å‰å–‚çŒ«ç²®å–‚çš„å¤ªå¤šäº†ï¼Œå†åŠ ä¸Šä¹Ÿä¸æ˜¯ä»€ä¹ˆç‰¹å¥½çš„çŒ«ç²®ï¼Œç›´æ¥åƒèƒ–ã€‚</p>
<p>è¿™ä¹ˆä¹–çš„æµæµªçŒ«çœŸçš„æ˜¯ç¬¬ä¸€æ¬¡è§ã€‚åˆ°åº•æœ‰å¤šä¹–å‘¢ï¼Œæˆ‘ç»™å¥¹æ¸…ç†è€³æœµå¥¹éƒ½ä¸å¸¦å“ˆäººçš„ï¼Œä¸€åŠ¨ä¸åŠ¨ä»»æˆ‘è¹‚èºã€‚</p>
<p>å¥¹ä¹Ÿæœ‰å¾ˆå‡¶çš„æ—¶å€™ï¼Œåœ¨ç©é€—çŒ«æ£’æ—¶æ‰‘å’¬éå¸¸è¿…çŒ›ï¼Œå¯èƒ½æµæµªç”Ÿæ´»æ•™ä¼šäº†å¥¹å¾ˆå¤šç”Ÿå­˜æŠ€å·§å§ã€‚</p>
<p>æœ‰çš„æ—¶å€™ä¹Ÿåœ¨æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œå¥¹æ˜¯ä¸æ˜¯è¢«åˆ«äººå¼ƒå…»äº†ã€‚ä¸è¿‡è¿™éƒ½ä¸é‡è¦ï¼Œç°åœ¨å·²ç»ä¸ä¼šå†ç»å†è¿‡å»é¥¥ä¸€é¡¿é¥±ä¸€é¡¿çš„ç”Ÿæ´»å•¦ï¼Œä¹Ÿä¸ç”¨å†åƒå»‰ä»·çŒ«ç²®å•¦ã€‚æˆ‘çš„å°çŒ«çŒ«å½“ç„¶è¦åƒæœ€å¥½çš„ã€‚</p>
<p>è¿™å°çŒ«å’ªè¿˜æ²¡æœ‰åˆ†ç¦»ç„¦è™‘ã€‚å½“ç„¶æ‰€æœ‰çš„çŒ«éƒ½ä¼šè¹¦è¿ªè·‘é…·ï¼Œè¿™åªä¹Ÿä¸ä¾‹å¤–â€¦â€¦å“¦å¯èƒ½çœ¼ç¥è¿˜æ˜¯è„‘å­æœ‰ç‚¹ä¸å¥½ç”¨ï¼ŒåŸ‹å±çš„æ—¶å€™æ€»æ˜¯åŸ‹äº†ä¸ªç©ºæ°”ï¼Œä¸è¿‡ä¹Ÿæ˜¯æ­£å¸¸ç°è±¡äº†ã€‚</p>
<p>å“ï¼Œåªæ˜¯æœ‰äº›åæ‚”ï¼Œæ€ä¹ˆæ²¡æœ‰æŠŠä¸€å¼€å§‹é‡è§çš„é‚£åªç‹¸èŠ±çŒ«å¸¦èµ°ã€‚ğŸ˜­ç°åœ¨å·²ç»å‡ ä¸ªæœˆæ²¡è§åˆ°äº†ï¼Œå†¬å¤©ä¹Ÿå¿«åˆ°æ¥äº†ï¼Œæ„Ÿè§‰å‡¶å¤šå‰å°‘ã€‚é‚£åªç™½è‰²çš„å°çŒ«ï¼Œå¦‚æœèƒ½å†é‡è§çš„è¯ï¼Œæˆ‘ä¹Ÿç»™å¸¦èµ°å§ã€‚</p>
<p>å›½åº†å‡æœŸæŠŠé…¸å¥¶äº¤ç»™äº†æœ‹å‹ç…§çœ‹å‡ å¤©ã€‚å› ä¸ºæœ‰é…¸å¥¶ï¼Œæˆ‘ä¹Ÿä¸ä¼šå†éš¾è¿‡ï¼Œä¸ä¼šå†æŠ‘éƒå•¦ã€‚é©¬ä¸Šå°±è¦å›å»å•¦ï¼Œè¿˜æœ‰24å°æ—¶ä¸åˆ°ï¼Œç­‰æˆ‘ï¼Œæˆ‘å†ä¹Ÿä¸ä¼šç¦»å¼€ä½ äº†ï¼Œæˆ‘ä¿è¯ğŸ™â¤ï¸</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/02/cat/index/" data-id="clhp7rtet0010s2qrfomr5yle" data-title="å¤šå›¾æ€çŒ«" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps è¿æ¥åˆ°è™šæ‹Ÿæœºå¹¶é…ç½®CPUè‡ªåŠ¨ç¼©æ”¾</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">ä½¿ç”¨ Cloudflare Workerè·å–å›¾ç‰‡å…ƒæ•°æ®</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">å°† Cloudflare Workers è¿ç§»åˆ° Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-apiæ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ ClickHouse ä½œä¸ºæ—¥å¿—ç³»ç»Ÿ</a>
          </li>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe å¦‚ä½•å®‰å…¨æ”¶æ¬¾å¹¶é¿å…ç›—åˆ·ä¸æµ‹å¡</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Bennyå°åœŸè±†<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>