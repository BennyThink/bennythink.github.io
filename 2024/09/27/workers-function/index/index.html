<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>å°† Cloudflare Workers è¿ç§»åˆ° Azure Function | åœŸè±†ä¸å¥½åƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="WebP Cloud Servicesä½¿ç”¨ Cloudflare Workersè¿›è¡Œå›æºæ¥ä¿è¯åŸç«™æœåŠ¡å™¨IPä¸æ³„æ¼ã€‚æœ¬ç€é™æœ¬å¢æ•ˆçš„ç†å¿µï¼Œæˆ‘ä»¬è¿™æ¬¡å‡†å¤‡å°†éƒ¨åˆ†å›æºè¯·æ±‚è¿ç§»åˆ° Azure Functionã€‚ Azure Function åŒæ ·ä¹Ÿæ˜¯ç”± Azure æä¾›çš„serverlessæœåŠ¡ï¼Œè¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ Pythonã€NodeJSã€Javaå’Œäº²å„¿å­ .NETã€PowerShellï¼Œå’Œ Cloudfl">
<meta property="og:type" content="article">
<meta property="og:title" content="å°† Cloudflare Workers è¿ç§»åˆ° Azure Function">
<meta property="og:url" content="http://example.com/2024/09/27/workers-function/index/index.html">
<meta property="og:site_name" content="åœŸè±†ä¸å¥½åƒ">
<meta property="og:description" content="WebP Cloud Servicesä½¿ç”¨ Cloudflare Workersè¿›è¡Œå›æºæ¥ä¿è¯åŸç«™æœåŠ¡å™¨IPä¸æ³„æ¼ã€‚æœ¬ç€é™æœ¬å¢æ•ˆçš„ç†å¿µï¼Œæˆ‘ä»¬è¿™æ¬¡å‡†å¤‡å°†éƒ¨åˆ†å›æºè¯·æ±‚è¿ç§»åˆ° Azure Functionã€‚ Azure Function åŒæ ·ä¹Ÿæ˜¯ç”± Azure æä¾›çš„serverlessæœåŠ¡ï¼Œè¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ Pythonã€NodeJSã€Javaå’Œäº²å„¿å­ .NETã€PowerShellï¼Œå’Œ Cloudfl">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/2024092621330760.png">
<meta property="og:image" content="http://example.com/images/2024092621330965.png">
<meta property="og:image" content="http://example.com/images/2024092621331055.png">
<meta property="og:image" content="http://example.com/images/2024092621331135.png">
<meta property="og:image" content="http://example.com/images/2024092621331236.png">
<meta property="og:image" content="http://example.com/images/202409262133137.png">
<meta property="og:image" content="http://example.com/images/2024092621331341.png">
<meta property="og:image" content="http://example.com/images/2024092621331482.png">
<meta property="og:image" content="http://example.com/images/2024092621331673.png">
<meta property="article:published_time" content="2024-09-27T00:00:00.000Z">
<meta property="article:modified_time" content="2024-09-27T22:37:09.722Z">
<meta property="article:author" content="Bennyå°åœŸè±†">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/2024092621330760.png">
  
    <link rel="alternate" href="/atom.xml" title="åœŸè±†ä¸å¥½åƒ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">åœŸè±†ä¸å¥½åƒ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-workers-function/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/27/workers-function/index/" class="article-date">
  <time class="dt-published" datetime="2024-09-27T00:00:00.000Z" itemprop="datePublished">2024-09-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/azure/">azure</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      å°† Cloudflare Workers è¿ç§»åˆ° Azure Function
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>WebP Cloud Services<a target="_blank" rel="noopener" href="https://blog.webp.se/cloudflare-workers-origin-zh/">ä½¿ç”¨ Cloudflare Workersè¿›è¡Œå›æºæ¥ä¿è¯åŸç«™æœåŠ¡å™¨IPä¸æ³„æ¼</a>ã€‚æœ¬ç€é™æœ¬å¢æ•ˆçš„ç†å¿µï¼Œæˆ‘ä»¬è¿™æ¬¡å‡†å¤‡å°†éƒ¨åˆ†å›æºè¯·æ±‚è¿ç§»åˆ° Azure Functionã€‚</p>
<p>Azure Function åŒæ ·ä¹Ÿæ˜¯ç”± Azure æä¾›çš„serverlessæœåŠ¡ï¼Œè¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ Pythonã€NodeJSã€Javaå’Œäº²å„¿å­ .NETã€PowerShellï¼Œå’Œ Cloudflare Workersä¸€æ ·ï¼Œæ¯ä¸ªæœˆå‰100ä¸‡è¯·æ±‚å…è´¹ï¼Œå…·ä½“ä¿¡æ¯å¯ä»¥å‚è€ƒä»·æ ¼è¡¨</p>
<p>æˆ‘ä»¬çš„å›æºä»£ç æ˜¯ä½¿ç”¨ JavaScriptå†™çš„ï¼Œè™½ç„¶è¿™ä¸ªè¯­è¨€æŒºæ‰­æ›²çš„ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿è¿ç§»ï¼Œå°±ä¸å˜å•¦ï¼</p>
<h1 id="åˆ›å»º-Azure-è´¦å·"><a href="#åˆ›å»º-Azure-è´¦å·" class="headerlink" title="åˆ›å»º Azure è´¦å·"></a>åˆ›å»º Azure è´¦å·</h1><p>ä½ éœ€è¦æœ‰ä¸€ä¸ªæ´»è·ƒè®¢é˜…çš„Azureè´¦å·â€¦â€¦</p>
<h1 id="åˆ›å»º-Function"><a href="#åˆ›å»º-Function" class="headerlink" title="åˆ›å»º Function"></a>åˆ›å»º Function</h1><p>æœç´¢æ æœç´¢ Function Appï¼Œç‚¹å‡» Create æŒ‰é’®ï¼Œä¼šå‘ç° Azure æä¾›äº†äº”ç§é€‰é¡¹ã€‚é€‰æ‹©ç¬¬ä¸€ä¸ª Consumption</p>
<p><img src="/images/2024092621330760.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åº æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<h3 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><p>è¿›å…¥é…ç½®é¡µé¢ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªèµ„æºç»„ï¼Œéœ€è¦é€‰æ‹©çš„æ˜¯ Runtimeï¼Œè¿™é‡Œé€‰æ‹© nodejsï¼Œç„¶å Regioné€‰æ‹©ç¦»ç”¨æˆ·æœ€æ¥è¿‘çš„åœ°æ–¹ã€‚è¿™é‡Œå’Œ Cloudflare Workersä¸ä¸€æ ·ï¼ŒCloudflare Workersæ˜¯åœ¨å…¨çƒéƒ¨ç½²çš„ï¼Œä¼šåœ¨ç¦»ç”¨æˆ·æœ€è¿‘çš„èŠ‚ç‚¹æ‰§è¡Œï¼›Azure è¿™é‡Œæ˜¯åœ¨å›ºå®šçš„èŠ‚ç‚¹æ‰§è¡Œï¼Œæ‰€ä»¥å¯¹äºå¤§é™†ç”¨æˆ·æ¥è¯´ï¼Œæ—¥éŸ©æ¸¯æ–°æ˜¯æ¯”è¾ƒä¸é”™çš„ä½ç½®ã€‚</p>
<p><img src="/images/2024092621330965.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åº æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<h3 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h3><p>é»˜è®¤å°±è¡Œï¼Œè¦æ˜¯çœ‹é»˜è®¤çš„åå­—ä¸å–œæ¬¢ï¼Œå¯ä»¥è‡ªå·±æ”¹æ‰</p>
<h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><p>è¿™é‡Œè¦é€‰æ‹©Enable public accessï¼Œè¦ä¸ç„¶è®¿é—®ä¸äº†ã€‚</p>
<p><img src="/images/2024092621331055.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åº, Teams æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<h3 id="å…¶ä»–é€‰é¡¹"><a href="#å…¶ä»–é€‰é¡¹" class="headerlink" title="å…¶ä»–é€‰é¡¹"></a>å…¶ä»–é€‰é¡¹</h3><p>Monitoring æƒ³å¼€å°±å¼€ï¼Œä¸ºäº†çœé’±å¯ä»¥å…³æ‰ã€‚å½“ç„¶åç»­ä¹Ÿå¯ä»¥é‡æ–°å¼€å¯ï¼›</p>
<p>Deploymentæ˜¯é…ç½®CDçš„åœ°æ–¹ï¼Œå¯ä»¥ä»¥åå†é…ç½®</p>
<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>éƒ¨ç½²å®Œæˆä¹‹å Azure ä¼šæä¾›ä¸€ä¸ªURLï¼Œæ‰“å¼€ä¹‹ååº”è¯¥æ˜¯è¿™æ ·çš„</p>
<p><img src="/images/2024092621331135.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åº, ç½‘ç«™ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<h2 id="å‡†å¤‡å¼€å‘ç¯å¢ƒ"><a href="#å‡†å¤‡å¼€å‘ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡å¼€å‘ç¯å¢ƒ"></a>å‡†å¤‡å¼€å‘ç¯å¢ƒ</h2><p>ä¸åƒ Cloudflare Workers é‚£ä¹ˆç›´æ¥ï¼Œå¼€å‘ Azure Functions æœ€å¥½ç”¨ VS Codeã€‚å› ä¸ºç”¨ Azure Functions æ‰©å±•ä¼šå¾ˆæ–¹ä¾¿ã€‚</p>
<p>ç„¶åæŒ‰F1å¼¹å‡ºçª—å£ Azure Functions â€“ Create New Projectï¼Œè¯­è¨€å°±é€‰æ‹© JavaScriptï¼Œæ„¿æ„åšç±»å‹ä½“æ“ä¹Ÿå¯ä»¥é€‰æ‹© TypeScriptï¼Œæˆ–è€…ä»»ä½•ä½ ç†Ÿæ‚‰çš„è¯­è¨€éƒ½å¯ä»¥ã€‚</p>
<p><img src="/images/2024092621331236.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<p>Triggerä¸ºå¦‚ä½•è§¦å‘Functionsï¼Œè¿™ä¸ªåœºæ™¯ä¸‹é€‰æ‹©HTTP Triggerå°±å¯ä»¥äº†</p>
<p><img src="/images/202409262133137.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<h2 id="ç†Ÿæ‚‰å¼€å‘ç¯å¢ƒ"><a href="#ç†Ÿæ‚‰å¼€å‘ç¯å¢ƒ" class="headerlink" title="ç†Ÿæ‚‰å¼€å‘ç¯å¢ƒ"></a>ç†Ÿæ‚‰å¼€å‘ç¯å¢ƒ</h2><h3 id="ç›®å½•ä¸æ–‡ä»¶"><a href="#ç›®å½•ä¸æ–‡ä»¶" class="headerlink" title="ç›®å½•ä¸æ–‡ä»¶"></a>ç›®å½•ä¸æ–‡ä»¶</h3><ul>
<li><code>src/functions/fetchImage.js</code> è¿™ä¸ªå°±æ˜¯ä½ çš„ä»£ç </li>
<li><code>host.json</code>ï¼šé…ç½®</li>
</ul>
<h3 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>F1 â€“ Deploy to Function Appï¼Œé€‰æ‹©è®¢é˜…-åˆšåˆšåˆ›å»ºçš„function</p>
<p>éƒ¨ç½²æˆåŠŸä¹‹åï¼Œæµè§ˆå™¨è®¿é—®ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://blog-fun-post.azurewebsites.net/api/fetchimage">https://blog-fun-post.azurewebsites.net/api/fetchimage</a></p>
<p>å°±å¯ä»¥çœ‹åˆ° Hello Worldä¿¡æ¯äº†ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li><code>api</code>æ˜¯è·¯ç”±å‰ç¼€ï¼Œå¯ä»¥è‡ªå®šä¹‰çš„</li>
<li><code>fetchimage</code>æ˜¯ä»£ç é‡Œå†™å¥½çš„è·¯ç”±ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤ä»£ç é‡Œå®šä¹‰çš„name</li>
</ul>
<p>Azure ä¸Šå¯ä»¥çœ‹åˆ°å·²ç»éƒ¨ç½²å¥½çš„ä»£ç </p>
<p><img src="/images/2024092621331341.png" alt="å›¾ç‰‡åŒ…å« å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<p>ç‚¹è¿›å»ç»ˆäºæœ‰äº†å’Œ Cloudflare Workersä¸€æ ·çš„åœ¨çº¿ç¼–è¾‘é¡µé¢ï¼ˆä¸è¿‡å¯èƒ½æ˜¯åªè¯»çš„ï¼Œå’Œé€‰æ‹©çš„è¯­è¨€æœ‰å…³ï¼‰</p>
<p><img src="/images/2024092621331482.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<h3 id="æœ¬åœ°è°ƒè¯•"><a href="#æœ¬åœ°è°ƒè¯•" class="headerlink" title="æœ¬åœ°è°ƒè¯•"></a>æœ¬åœ°è°ƒè¯•</h3><p>æ¯æ¬¡æ”¹ä»£ç éƒ½éƒ¨ç½²ä¸€æ¬¡ç¡®å®ä¸æ˜¯å¥½åŠæ³•ã€‚è¿™ä¸ªæ—¶å€™å°±è¦ç”¨æœ¬åœ°è°ƒè¯•å•¦ï¼Œç”±äºæˆ‘ä»¬æ˜¯ç”¨ HTTP triggerçš„ï¼Œè°ƒè¯•èµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿ã€‚å“¦å¯¹äº†ï¼Œè°ƒè¯• JavaScript åº”ç”¨å¾—æœ‰nodejs</p>
<p>æ‰“å¼€ <code>fetchImage.js</code> æŒ‰ä¸‹F5ï¼Œè¿™é‡Œé€‰æ‹© Connect Storage Accountï¼ˆå…¶å®é€‰æ‹© emulatorç»•è¿‡å»ä¹Ÿè¡Œï¼Œæ²¡å…³ç³»ï¼‰</p>
<p><img src="/images/2024092621331673.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p>
<p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œå¯èƒ½éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–ï¼Œå®‰è£…å®Œæˆä¹‹åå°±ä¼šçœ‹åˆ°æ§åˆ¶å°è¾“å‡ºäº†ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯</p>
<p>Azure Functions Core Tools<br>Core Tools Version: 4.0.6280 Commit hash: N&#x2F;A +421f0144b42047aa289ce691dc6db4fc8b6143e6 (64-bit)<br>Function Runtime Version: 4.834.3.22875<br>[2024-09-26T12:27:04.937Z] Debugger listening on ws:&#x2F;&#x2F;127.0.0.1:9229&#x2F;882fb0c8-1957-4070-a6be-9cfd3250d77b<br>[2024-09-26T12:27:04.938Z] For help, see: <a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/inspector">https://nodejs.org/en/docs/inspector</a><br>[2024-09-26T12:27:05.003Z] Worker process started and initialized.<br>[2024-09-26T12:27:05.058Z] Debugger attached.<br>Functions:<br>fetchImage: [GET,POST] <a target="_blank" rel="noopener" href="http://localhost:7071/api/fetchImage">http://localhost:7071/api/fetchImage</a><br>For detailed output, run func with â€“verbose flag.</p>
<p>æµè§ˆå™¨è®¿é—®<code>http://localhost:7071/api/fetchImag</code>e å°±å¯ä»¥äº†ï¼Œæ”¹äº†ä»£ç ä¹Ÿä¼šè‡ªåŠ¨çƒ­åŠ è½½ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰“æ–­ç‚¹ã€‚</p>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>ä¸€ä¸ªæœ€ç®€å•çš„ Functions ä»£ç æ˜¯è¿™æ ·çš„</p>
<p>const { app } &#x3D; require(â€˜@azure&#x2F;functionsâ€™);</p>
<p>app.http(â€˜fetchâ€™, {<br>    methods: [â€˜GETâ€™, â€˜POSTâ€™],<br>    authLevel: â€˜anonymousâ€™,<br>    handler: async (request, context) &#x3D;&gt; {<br>        context.log(`Http function processed request for url â€œ${request.url}â€`);<br>        return { body: `Hello hello hello` };<br>    },<br>});</p>
<ul>
<li><code>app.http</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åå­—ï¼Œè¦å”¯ä¸€ï¼Œå¹¶ä¸”é»˜è®¤æ˜¯è·¯ç”±</li>
<li><code>methods</code>è¡¨ç¤ºæ¥å—çš„è¯·æ±‚æ–¹æ³•</li>
<li><code>handler</code>æ˜¯å¤„ç†è¯·æ±‚çš„åœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>request</code>ï¼Œå¯ä»¥ç”¨æ¥è·å–è¯·æ±‚ä½“ä¹‹ç±»çš„ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªæ˜¯<code>context</code>ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬æ—¥å¿—åŠŸèƒ½ã€ç»‘å®šæ•°æ®ã€ç¯å¢ƒä¿¡æ¯ç­‰ã€‚</li>
<li><code>return</code> ç”¨äºè¿”å›å“åº”ï¼Œ<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-reference-node?tabs=javascript,windows,azure-cli&pivots=nodejs-model-v4">æŒ‰ç…§æ–‡æ¡£</a> <code>context.res</code> ä¹Ÿåº”è¯¥å¯ä»¥ï¼Œä½†æ˜¯åœ¨æˆ‘è¿™é‡Œä¸è¡Œï¼Œå¯èƒ½<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42548199/azure-function-not-returning-response-through-context-res">éœ€è¦é¢å¤–é…ç½®ä¸€ä¸‹</a>ã€‚è¿”å›ä¸€ä¸ªobjectï¼Œç¼–è¾‘å™¨ä¼šè‡ªåŠ¨è¡¥å…¨ï¼Œæ¯”å¦‚body, status,headers ç­‰</li>
</ul>
<h2 id="å®šä¹‰è·¯ç”±"><a href="#å®šä¹‰è·¯ç”±" class="headerlink" title="å®šä¹‰è·¯ç”±"></a>å®šä¹‰è·¯ç”±</h2><h3 id="è·¯ç”±å‰ç¼€"><a href="#è·¯ç”±å‰ç¼€" class="headerlink" title="è·¯ç”±å‰ç¼€"></a>è·¯ç”±å‰ç¼€</h3><p>é»˜è®¤ï¼Œfunctionsçš„ä»£ç éƒ½æ˜¯ åœ¨ <code>/api</code> è¿™ä¸ªè·¯ç”±ä¸‹çš„ï¼Œåœ¨ <code>host.json</code> é‡Œå¯ä»¥è¿›è¡Œé…ç½®</p>
<p>â€œextensionsâ€: {<br>    â€œhttpâ€: {<br>      â€œroutePrefixâ€: â€œâ€<br>    }<br>  }</p>
<p>è¿™æ ·å°±æ²¡æœ‰ <code>api</code> è¿™ä¸ªå‰ç¼€äº†ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥éšä¾¿æ”¹ï¼</p>
<h3 id="è·¯ç”±åç§°"><a href="#è·¯ç”±åç§°" class="headerlink" title="è·¯ç”±åç§°"></a>è·¯ç”±åç§°</h3><p>é»˜è®¤è·¯ç”±åç§°æ˜¯<code>app.http</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚</p>
<p>app.http(â€˜fetchâ€™, {<br>    methods: [â€˜GETâ€™, â€˜POSTâ€™],<br>    authLevel: â€˜anonymousâ€™,<br>    handler: handler,<br>});</p>
<p>é‚£ä¹ˆè·¯ç”±å°±æ˜¯ <code>fetch</code> ï¼Œå¦‚æœè¦è‡ªå®šä¹‰å¯ä»¥é¢å¤–ä¼ å…¥ä¸€ä¸ª <code>route</code>ã€‚éœ€è¦æ³¨æ„ä¸å¯ä»¥æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œä¹Ÿä¸å¯ä»¥æ˜¯<code>/</code>å¼€å¤´çš„</p>
<p>app.http(â€˜fetchâ€™, {<br>    methods: [â€˜GETâ€™, â€˜POSTâ€™],<br>    authLevel: â€˜anonymousâ€™,<br>    handler: handler,<br>    route: â€œsomethingâ€<br>});</p>
<h2 id="æ ¹è®¿é—®"><a href="#æ ¹è®¿é—®" class="headerlink" title="æ ¹è®¿é—®"></a>æ ¹è®¿é—®</h2><p>å¦‚æœä½ å¸Œæœ›åº”ç”¨åœ¨ <a href="https://example.com/">https://example.com</a> ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦<code>/api</code> ä¹Ÿä¸éœ€è¦è·¯ç”±åç§°ï¼Œé‚£ä¹ˆå°±è¦ç»¼åˆä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œé…ç½®å‰ç¼€ï¼Œç„¶å <code>route: &quot;/&quot;</code>ä¸èƒ½ç•™ç©ºğŸ˜‚ï¼Œå¦‚æœç•™ç©ºå°±ä¼šå‡ºç°azureé»˜è®¤çš„é¡µé¢ [v_tips]åˆä¸€ä¸ªäººç”Ÿå°æŠ€å·§ğŸ« [&#x2F;v_tips]</p>
<h2 id="è¿ç§»ä»£ç "><a href="#è¿ç§»ä»£ç " class="headerlink" title="è¿ç§»ä»£ç "></a>è¿ç§»ä»£ç </h2><p>æˆ‘ä»¬çš„Cloudflare Workersä»£ç æ˜¯è¿™ä¹ˆå†™çš„ï¼Œéå¸¸ç®€å•</p>
<p>async function handleProxy(post_body) {<br>    const headers &#x3D; {<br>        â€œAcceptâ€: post_body.accept,<br>        â€œUser-Agentâ€: post_body.user_agent<br>    };</p>
<pre><code>const response = await fetch(post\_body.origin\_url, &#123;
    method: post\_body.request\_name,
    headers: headers
&#125;);

if (response.ok) &#123;
    const res = new Response(response.body, &#123;
        status: response.status,
        statusText: response.statusText,
        headers: response.headers
    &#125;);
    return res;
&#125; else &#123;
    return new Response(response.statusText || &quot;Unknown Error&quot;, &#123;
        status: response.status,
        statusText: response.statusText
    &#125;);
&#125;
</code></pre>
<p>}</p>
<p>export default {<br>    async fetch(request, env, ctx) {<br>        try {<br>            const post_body &#x3D; await request.json();<br>            return handleProxy(post_body);<br>        } catch (error) {<br>            return new Response(â€œInvalid JSON dataâ€, { status: 400 });<br>        }<br>    },<br>};</p>
<p>åŸºæœ¬ä¸Šè¦æ”¹çš„åœ°æ–¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å…¥å£å‚æ•°ä½ç½®è°ƒæ¢</li>
<li>æ”¹æ”¹å‡½æ•°åå­—ä¹‹ç±»çš„</li>
</ol>
<p>ä¹Ÿå°±æ˜¯æ”¹ä¸€ä¸‹é‚£ä¸ª<code>default</code></p>
<p>async function handler(request, context) {<br>    try {<br>        const body &#x3D; await request.json();<br>        return handleProxy(body);<br>    } catch (error) {<br>        console.error(â€˜JSON parsing error:â€™, error);<br>        return new Response(â€˜Invalid JSON dataâ€™, { status: 400 });<br>    }<br>}</p>
<p>å¥½äº†ä½ çš„å‡½æ•°å†™å¥½äº†ï¼Œå¯ä»¥éƒ¨ç½²äº†ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œé™¤äº†é…ç½®ç¯å¢ƒé‚£é‡Œéº»çƒ¦ç‚¹ï¼Œåˆ«çš„éƒ½å¾ˆå®¹æ˜“ï¼Œæ¯•ç«Ÿå¤§å®¶éƒ½æ˜¯nodejs 20,è‡ªå¸¦äº†<code>fetch</code>å’Œ<code>Response</code></p>
<p>ç”šè‡³å¯ä»¥é€šè¿‡è¿è¡Œæ—¶ä¿¡æ¯ä¸åŒï¼Œä½¿ç”¨ä¸åŒçš„å…¥å£å‡½æ•°ï¼Œè¿›è€Œåšåˆ°ç”¨ä¸€å¥—ä»£ç ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>Functionæä¾›çš„è¯­è¨€æ¯”Cloudflare Workerså¤š</li>
<li>å¤§å®¶éƒ½æ˜¯JavaScriptï¼Œè¿ç§»å¾ˆç®€å•ã€‚ä¸ºäº†ç±»å‹å®‰å…¨ä¹Ÿå¯ä»¥ä½¿ç”¨ TypeScript</li>
<li>Functionæ˜¯åŒºåŸŸæ€§éƒ¨ç½²ï¼›Workersæ˜¯å…¨çƒéƒ¨ç½²ä¸”å°±è¿‘æ‰§è¡Œ</li>
<li>Function æƒ³è¦åšåˆ°å°±è¿‘æ‰§è¡Œï¼Œå¯èƒ½å¾—éœ€è¦é…åˆ FrontDoor + å¤šåœ°éƒ¨ç½²ï¼Œæƒ³æƒ³å°±å¤´ç–¼</li>
<li>Functionæä¾›çš„è®¡åˆ’æŒºå¤šçš„</li>
<li>Functionä¹Ÿåº”è¯¥å¯ä»¥æ‹¿æ¥åšä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„äº‹æƒ…</li>
<li>Azureçš„çº¿è·¯å¾ˆå¥½ï¼Œå¯¹å¤§é™†è®¿é—®éå¸¸å‹å¥½ï¼Œè€ŒCloudflareåˆ™æ˜¯é™é€ŸCDNäº†</li>
<li>Azureçš„åŠŸèƒ½å¥½å¤šï¼ˆä»·æ ¼ä¹Ÿå¾ˆç¾ä¸½ï¼‰ï¼Œè¿˜å¾…ä»¥åæ…¢æ…¢å­¦ä¹ å°è¯•</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/27/workers-function/index/" data-id="cm1lb077g0000s4jfgb3g1yfv" data-title="å°† Cloudflare Workers è¿ç§»åˆ° Azure Function" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/09/28/worker-image-metadata/index/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ä½¿ç”¨ Cloudflare Workerè·å–å›¾ç‰‡å…ƒæ•°æ®
        
      </div>
    </a>
  
  
    <a href="/2024/09/21/one-api-clickhouse/index/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">one-api/new-apiæ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ ClickHouse ä½œä¸ºæ—¥å¿—ç³»ç»Ÿ</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/12/aca-php/index/">ç”¨ Azure Container Apps è¿è¡ŒPHPç½‘ç«™</a>
          </li>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps è¿æ¥åˆ°è™šæ‹Ÿæœºå¹¶é…ç½®CPUè‡ªåŠ¨ç¼©æ”¾</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">ä½¿ç”¨ Cloudflare Workerè·å–å›¾ç‰‡å…ƒæ•°æ®</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">å°† Cloudflare Workers è¿ç§»åˆ° Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-apiæ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ ClickHouse ä½œä¸ºæ—¥å¿—ç³»ç»Ÿ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Bennyå°åœŸè±†<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>