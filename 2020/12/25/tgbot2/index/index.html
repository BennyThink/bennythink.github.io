<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>[Telegram botç³»åˆ—]2: å›é¡¾ä¸Media Groupã€åª’ä½“æ–‡ä»¶ã€Next Stepã€éƒ¨ç½²ç»´æŠ¤ | åœŸè±†ä¸å¥½åƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="ä¸‰å¹´å‰ï¼Œæˆ‘å¼€å§‹äº†å†™è¿™ä¸€ç³»åˆ—ï¼Œæ²¡æƒ³åˆ°è¿‡äº†3å¹´ï¼Œç«Ÿç„¶ä¹Ÿæ²¡å‡ ä¸ªäººå»çœ‹ï¼è¿ä¸ªæ§åœºçš„éƒ½æ²¡æœ‰ è¿™ä¸‰å¹´ï¼ŒTelegramä¹Ÿè¿æ¥äº†ä¸€äº›æ›´æ–°ï¼Œè¿™ç¯‡æ–‡ç« å½“ç„¶ä¸ä¼šæŒ¨ä¸ªä»‹ç»æ¯ä¸€ä¸ªæ–°ç‰¹æ€§ä»¥åŠç›¸å…³çš„ç”¨æ³•äº†ï¼Œæˆ‘åªä¼šæŠŠè‡ªå·±å¼€å‘è¿‡ç¨‹ä¸­æåˆ°çš„åœ°æ–¹è®°å½•ä¸€ä¸‹ã€‚å®˜æ–¹æ–‡æ¡£å†™çš„æŒºæ¸…æ¥šäº†ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ç‚¹éƒ½ä»‹ç»çš„å¾ˆè¯¦ç»†ğŸ˜‚ å‰ä¸¤ç¯‡ [Telegram bot ç³»åˆ—]0ï¼šç”¨ Python å†™ä¸€ä¸ª Telegram Bot ç®€å•çš„å›è¯ bot [Tel">
<meta property="og:type" content="article">
<meta property="og:title" content="[Telegram botç³»åˆ—]2: å›é¡¾ä¸Media Groupã€åª’ä½“æ–‡ä»¶ã€Next Stepã€éƒ¨ç½²ç»´æŠ¤">
<meta property="og:url" content="http://example.com/2020/12/25/tgbot2/index/index.html">
<meta property="og:site_name" content="åœŸè±†ä¸å¥½åƒ">
<meta property="og:description" content="ä¸‰å¹´å‰ï¼Œæˆ‘å¼€å§‹äº†å†™è¿™ä¸€ç³»åˆ—ï¼Œæ²¡æƒ³åˆ°è¿‡äº†3å¹´ï¼Œç«Ÿç„¶ä¹Ÿæ²¡å‡ ä¸ªäººå»çœ‹ï¼è¿ä¸ªæ§åœºçš„éƒ½æ²¡æœ‰ è¿™ä¸‰å¹´ï¼ŒTelegramä¹Ÿè¿æ¥äº†ä¸€äº›æ›´æ–°ï¼Œè¿™ç¯‡æ–‡ç« å½“ç„¶ä¸ä¼šæŒ¨ä¸ªä»‹ç»æ¯ä¸€ä¸ªæ–°ç‰¹æ€§ä»¥åŠç›¸å…³çš„ç”¨æ³•äº†ï¼Œæˆ‘åªä¼šæŠŠè‡ªå·±å¼€å‘è¿‡ç¨‹ä¸­æåˆ°çš„åœ°æ–¹è®°å½•ä¸€ä¸‹ã€‚å®˜æ–¹æ–‡æ¡£å†™çš„æŒºæ¸…æ¥šäº†ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ç‚¹éƒ½ä»‹ç»çš„å¾ˆè¯¦ç»†ğŸ˜‚ å‰ä¸¤ç¯‡ [Telegram bot ç³»åˆ—]0ï¼šç”¨ Python å†™ä¸€ä¸ª Telegram Bot ç®€å•çš„å›è¯ bot [Tel">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/2020122516061518.png">
<meta property="og:image" content="http://example.com/images/2020122516061860.png">
<meta property="og:image" content="http://example.com/images/2020122516243648.jpeg">
<meta property="og:image" content="http://example.com/images/2020122516062048.png">
<meta property="article:published_time" content="2020-12-25T00:00:00.000Z">
<meta property="article:modified_time" content="2023-05-15T18:16:50.973Z">
<meta property="article:author" content="Bennyå°åœŸè±†">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/2020122516061518.png">
  
    <link rel="alternate" href="/atom.xml" title="åœŸè±†ä¸å¥½åƒ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">åœŸè±†ä¸å¥½åƒ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-tgbot2/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/25/tgbot2/index/" class="article-date">
  <time class="dt-published" datetime="2020-12-25T00:00:00.000Z" itemprop="datePublished">2020-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      [Telegram botç³»åˆ—]2: å›é¡¾ä¸Media Groupã€åª’ä½“æ–‡ä»¶ã€Next Stepã€éƒ¨ç½²ç»´æŠ¤
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ä¸‰å¹´å‰ï¼Œæˆ‘å¼€å§‹äº†å†™è¿™ä¸€ç³»åˆ—ï¼Œæ²¡æƒ³åˆ°è¿‡äº†3å¹´ï¼Œç«Ÿç„¶ä¹Ÿæ²¡å‡ ä¸ªäººå»çœ‹ï¼è¿ä¸ªæ§åœºçš„éƒ½æ²¡æœ‰</p>
<p>è¿™ä¸‰å¹´ï¼ŒTelegramä¹Ÿè¿æ¥äº†ä¸€äº›æ›´æ–°ï¼Œè¿™ç¯‡æ–‡ç« å½“ç„¶ä¸ä¼šæŒ¨ä¸ªä»‹ç»æ¯ä¸€ä¸ªæ–°ç‰¹æ€§ä»¥åŠç›¸å…³çš„ç”¨æ³•äº†ï¼Œæˆ‘åªä¼šæŠŠè‡ªå·±å¼€å‘è¿‡ç¨‹ä¸­æåˆ°çš„åœ°æ–¹è®°å½•ä¸€ä¸‹ã€‚å®˜æ–¹æ–‡æ¡£å†™çš„æŒºæ¸…æ¥šäº†ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ç‚¹éƒ½ä»‹ç»çš„å¾ˆè¯¦ç»†ğŸ˜‚</p>
<p>å‰ä¸¤ç¯‡</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/tgbot0.html">[Telegram bot ç³»åˆ—]0ï¼šç”¨ Python å†™ä¸€ä¸ª Telegram Bot ç®€å•çš„å›è¯ bot</a></p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/tgbot1.html">[Telegram bot ç³»åˆ—]1ï¼šrequests åº“ã€Inline Keyboardã€Reply Keyboard ä¸å…¶ä»–ç»†èŠ‚</a></p>
<h2 id="å›é¡¾ï¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªTelegram-Bot"><a href="#å›é¡¾ï¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªTelegram-Bot" class="headerlink" title="å›é¡¾ï¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªTelegram Bot"></a>å›é¡¾ï¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªTelegram Bot</h2><h3 id="å¼€å‘è¯­è¨€"><a href="#å¼€å‘è¯­è¨€" class="headerlink" title="å¼€å‘è¯­è¨€"></a>å¼€å‘è¯­è¨€</h3><p>çˆ±ç”¨å•¥ç”¨å•¥ï¼ŒPythonã€Goç­‰éƒ½æ²¡é—®é¢˜çš„ï¼Œç”šè‡³ç›´æ¥curléƒ½æ˜¯å¯ä»¥çš„ã€‚æ¯•ç«ŸRestfulï¼Œæ€ä¹ˆéƒ½å¯ä»¥ã€‚</p>
<h3 id="å¼€å‘æ–¹å¼"><a href="#å¼€å‘æ–¹å¼" class="headerlink" title="å¼€å‘æ–¹å¼"></a>å¼€å‘æ–¹å¼</h3><p>æƒ³è¦å¼€å‘Telegram Botï¼Œä»é€”å¾„ä¸Šæ¥è¯´æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨Bot APIï¼ŒRESTæ¥å£ï¼Œå…¥å£åœ¨è·å…°ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒå®¹æ˜“ã€‚</p>
<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨MTProtoåè®®ï¼Œè¿™ä¸ªä¼šæ¯”è¾ƒå›°éš¾ï¼Œéœ€è¦æœ‰ä¸€å®šçš„å¼‚æ­¥ç¼–ç¨‹åŸºç¡€ã€‚è‘—åçš„<a target="_blank" rel="noopener" href="https://github.com/LonamiWebs/Telethon">telethon</a>å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚</p>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨ç¬¬ä¸€ç§å°±è¶³å¤Ÿæ»¡è¶³éœ€æ±‚äº†ï¼Œæœ¬ç³»åˆ—ä¹Ÿä¼šä¸€ç›´ä»¥ç¬¬ä¸€ç§æ–¹æ³•ä¸ºä¸»ã€‚</p>
<h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>å¯¹äºBotè€Œè¨€ï¼Œæœ€é‡è¦çš„äº‹æƒ…å°±æ˜¯â€œäº‹ä»¶â€ï¼Œæ¯”å¦‚è¯´å½“ç”¨æˆ·å‘é€ä¸€ä¸ªçº¯æ–‡æœ¬çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯¹äºBotæ¥è¯´å°±æ˜¯ä¸€ç§ç±»å‹çš„äº‹ä»¶ï¼›å½“ç”¨æˆ·å‘é€äº†ä¸€ä¸ªå›¾ç‰‡ï¼Œè¿™åˆæ˜¯å¦å¤–ä¸€ç§äº‹ä»¶ï¼›ç”¨æˆ·ç¼–è¾‘äº†æ¶ˆæ¯ï¼Œåˆ é™¤äº†æ¶ˆæ¯ï¼Œä¹ŸåŒæ ·å¯¹åº”ä¸åŒçš„äº‹ä»¶ã€‚ç”šè‡³ï¼Œå½“ç”¨æˆ·ç‚¹å‡»InlineKeyBoardButtonï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šäº‹ä»¶ã€‚</p>
<p>å› æ­¤ï¼Œå¼€å‘ä¸€ä¸ªbotï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ä¼ å…¥çš„äº‹ä»¶ä¸åŒæ¥è¿›è¡Œå„ç§æ“ä½œï¼Œç„¶åç»™ç”¨æˆ·åæ‹¬ï¼Œæ¯”å¦‚å›å¤æ¶ˆæ¯ï¼Œå‘é€æ–‡ä»¶ï¼Œæ•´ä½“çš„æµç¨‹å·®ä¸å¤šå°±æ˜¯è¿™æ ·çš„ã€‚</p>
<p>Telegram Botäº‹ä»¶ç±»å‹æŒºå¤šçš„ï¼Œå¤§æ¦‚ä¸€å…±æœ‰è¿™äº›ç±»å‹ï¼š</p>
<p>&#x2F;&#x2F; Handler: func(*Message)<br>OnText &#x3D; â€œ\atextâ€<br>OnPhoto &#x3D; â€œ\aphotoâ€<br>OnAudio &#x3D; â€œ\aaudioâ€<br>OnAnimation &#x3D; â€œ\aanimationâ€<br>OnDocument &#x3D; â€œ\adocumentâ€<br>OnSticker &#x3D; â€œ\astickerâ€<br>OnVideo &#x3D; â€œ\avideoâ€<br>OnVoice &#x3D; â€œ\avoiceâ€<br>OnVideoNote &#x3D; â€œ\avideo_noteâ€<br>OnContact &#x3D; â€œ\acontactâ€<br>OnLocation &#x3D; â€œ\alocationâ€<br>OnVenue &#x3D; â€œ\avenueâ€<br>OnEdited &#x3D; â€œ\aeditedâ€<br>OnPinned &#x3D; â€œ\apinnedâ€<br>OnChannelPost &#x3D; â€œ\achan_postâ€<br>OnEditedChannelPost &#x3D; â€œ\achan_edited_postâ€<br>OnDice &#x3D; â€œ\adiceâ€<br>OnInvoice &#x3D; â€œ\ainvoiceâ€<br>OnPayment &#x3D; â€œ\apaymentâ€</p>
<p>&#x2F;&#x2F; Will fire when bot is added to a group.<br>OnAddedToGroup &#x3D; â€œ\aadded_to_groupâ€</p>
<p>&#x2F;&#x2F; Group events:<br>OnUserJoined &#x3D; â€œ\auser_joinedâ€<br>OnUserLeft &#x3D; â€œ\auser_leftâ€<br>OnNewGroupTitle &#x3D; â€œ\anew_chat_titleâ€<br>OnNewGroupPhoto &#x3D; â€œ\anew_chat_photoâ€<br>OnGroupPhotoDeleted &#x3D; â€œ\achat_photo_delâ€</p>
<p>&#x2F;&#x2F; Migration happens when group switches to<br>&#x2F;&#x2F; a supergroup. You might want to update<br>&#x2F;&#x2F; your internal references to this chat<br>&#x2F;&#x2F; upon switching as its ID will change.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(from, to int64)<br>OnMigration &#x3D; â€œ\amigrationâ€</p>
<p>&#x2F;&#x2F; Will fire on callback requests.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*Callback)<br>OnCallback &#x3D; â€œ\acallbackâ€</p>
<p>&#x2F;&#x2F; Will fire on incoming inline queries.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*Query)<br>OnQuery &#x3D; â€œ\aqueryâ€</p>
<p>&#x2F;&#x2F; Will fire on chosen inline results.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*ChosenInlineResult)<br>OnChosenInlineResult &#x3D; â€œ\achosen_inline_resultâ€</p>
<p>&#x2F;&#x2F; Will fire on ShippingQuery.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*ShippingQuery)<br>OnShipping &#x3D; â€œ\ashipping_queryâ€</p>
<p>&#x2F;&#x2F; Will fire on PreCheckoutQuery.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*PreCheckoutQuery)<br>OnCheckout &#x3D; â€œ\apre_checkout_queryâ€</p>
<p>&#x2F;&#x2F; Will fire on Poll.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*Poll)<br>OnPoll &#x3D; â€œ\apollâ€</p>
<p>&#x2F;&#x2F; Will fire on PollAnswer.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*PollAnswer)<br>OnPollAnswer &#x3D; â€œ\apoll_answerâ€</p>
<p>çœ‹åˆ°åå­—å°±çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå°±ä¸è¯´äº†ã€‚</p>
<h3 id="è¿è¡Œæ–¹å¼"><a href="#è¿è¡Œæ–¹å¼" class="headerlink" title="è¿è¡Œæ–¹å¼"></a>è¿è¡Œæ–¹å¼</h3><p>è¦ä¹ˆä½¿ç”¨pollingæ–¹å¼ï¼Œå®šæœŸè½®è¯¢API Serverï¼Œè¦ä¹ˆè®¾ç½®webhookï¼Œå‘ç”Ÿäº‹ä»¶æ—¶Telegramä¼šå‘è®¾ç½®çš„åœ°å€å‘é€POSTè¯·æ±‚ï¼Œè¯·æ±‚çš„BODYé‡Œä¼šæœ‰å¯¹åº”çš„æ•°æ®ç»“æ„ã€‚</p>
<h2 id="Media-Group"><a href="#Media-Group" class="headerlink" title="Media Group"></a>Media Group</h2><p>Telegramç›®å‰å·²ç»æ”¯æŒå°†å›¾ç‰‡ã€æ–‡ä»¶ã€è§†é¢‘ç­‰ä½œä¸ºä¸€ç»„å‘é€ï¼Œæ¯”å¦‚è¯´æˆ‘å‘é€äº†3å¼ ç…§ç‰‡ä¸ºä¸€ç»„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBot æ‰€æ”¶åˆ°çš„äº‹ä»¶å°±æ˜¯ä¸‰ä¸ªonPhotoï¼Œç„¶åè¿™ä¸‰ä¸ªäº‹ä»¶æœ‰ä¸€ä¸ªå…±åŒçš„å­—æ®µ<code>media_group_id</code>ï¼Œè‡³äº<code>caption</code>è½åœ¨ç¬¬å‡ ä¸ªäº‹ä»¶é‡Œï¼Ÿä¸çŸ¥é“ï¼Œéå†å®Œå°±çŸ¥é“äº†ã€‚</p>
<p>åˆ’é‡ç‚¹ï¼šè¿™ä¸‰ä¸ªäº‹ä»¶å‡ ä¹æ˜¯åŒæ—¶åˆ°è¾¾çš„ã€‚æ‰€ä»¥æœ‰äº›éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æå–å‡ºè¿™ç»„ç…§ç‰‡é‡Œçš„file_idå’Œcaptionï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯å…±äº«ä¸€ä¸ªå…¨å±€çš„å­—å…¸ï¼Œä»¥<code>user_id</code>å’Œ<code>media_group_id</code>ä½œä¸ºkeyï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘ç”¨é”çš„æœºåˆ¶æ¥è®©è¿™ä¸‰ä¸ªäº‹ä»¶å˜æˆä¸²è¡Œçš„ã€‚ä¸€ä¸ªä¾‹å­<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/TeleTweet/blob/master/teletweet/bot.py#L125">å¯ä»¥çœ‹è¿™é‡Œ</a></p>
<h2 id="ä¸‹è½½åª’ä½“æ–‡ä»¶"><a href="#ä¸‹è½½åª’ä½“æ–‡ä»¶" class="headerlink" title="ä¸‹è½½åª’ä½“æ–‡ä»¶"></a>ä¸‹è½½åª’ä½“æ–‡ä»¶</h2><p>å¯¹äºTelegramè€Œè¨€ï¼Œæ— è®ºæ˜¯æ–‡ä»¶ï¼Œè¿˜æ˜¯å›¾ç‰‡ã€è§†é¢‘ï¼Œéƒ½æœ‰ä¸€ä¸ª<code>file_id</code>ç”¨äºå”¯ä¸€ä»£è¡¨è¿™ä¸ªæ–‡ä»¶ã€‚å½“ç„¶ï¼Œæ¯ä¸ªç±»å‹ä¼šæœ‰ä¸€äº›ç»†å¾®çš„ä¸åŒï¼Œæ¯”å¦‚è§†é¢‘æ–‡ä»¶ä¼šåŒ…å«åˆ†è¾¨ç‡ï¼Œå›¾ç‰‡ä¼šæœ‰é¢„è§ˆå›¾ï¼Œæ–‡ä»¶ä¼šæœ‰mime-typeã€‚</p>
<p>æƒ³è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰æ­¥</p>
<ol>
<li>æ‹¿åˆ°å¯¹åº”çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´æƒ³è¦ä¸‹è½½å›¾ç‰‡ï¼Œé‚£ä¹ˆå°±æ˜¯<code>message.photo</code>ï¼Œæƒ³è¦ä¸‹è½½è§†é¢‘ï¼Œé‚£ä¹ˆå°±æ˜¯<code>message.video</code></li>
<li>æ‹¿åˆ°file_idï¼Œå‚è€ƒä¸‹å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œæ‹¿åˆ°å¯¹åº”çš„<code>file_id</code>ï¼Œæ¯”å¦‚è¯´<code>message.video.file_id</code></li>
<li>è¿›è¡Œä¸‹è½½ï¼Œä¿å­˜åˆ°æœ¬åœ°</li>
</ol>
<p>å…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼Œç”¨å…¶ä»–è¯­è¨€ä¹Ÿå·®ä¸å¤šï¼Œå¥—è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>
<p>def download_file_from_id(file_id):<br>    file_info &#x3D; bot.get_file(file_id)<br>    content &#x3D; bot.download_file(file_info.file_path)</p>
<pre><code>temp = tempfile.NamedTemporaryFile(delete=False)
temp.write(content)
return temp
</code></pre>
<p>def get_file_id(message) -&gt; str:<br>    if message.photo:<br>        object_type &#x3D; â€œphotoâ€<br>    elif message.video:<br>        object_type &#x3D; â€œvideoâ€<br>    elif message.document:<br>        object_type &#x3D; â€œdocumentâ€<br>    else:<br>        object_type &#x3D; â€œâ€</p>
<pre><code>try:
    file\_id = getattr(message, object\_type)\[-1\].file\_id
except Exception:
    file\_id = getattr(message, object\_type).file\_id
return file\_id
</code></pre>
<p>éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œ<code>message.photo</code>çš„ç»“æœæ˜¯ä¸€ä¸ªlistï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯é¢„è§ˆå›¾ï¼Œæœ€åä¸€ä¸ªå…ƒç´ æ˜¯æ­£å¸¸å¤§å°ï¼ˆ720Pï¼‰çš„å›¾ç‰‡</p>
<p>å¦å¤–æ›´éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼šTelegramå¯¹äºBotå¯ä»¥ä¸Šä¼ ã€ä¸‹è½½çš„æ–‡ä»¶ã€å›¾ç‰‡ç­‰å¤§å°æœ‰é™åˆ¶ï¼Œå…·ä½“å¯ä»¥æŸ¥æ–‡æ¡£æ‰¾æ‰¾ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·å‘é€äº†ä¸€ä¸ª2Gçš„æ–‡ä»¶ï¼Œbotè¿™è¾¹å¾ˆæœ‰å¯èƒ½æ˜¯æ— æ³•ä¸‹è½½çš„â€¦â€¦ä½†æ˜¯Botå¯ä»¥è½¬å‘å•Šï¼è¦å¤„ç†è¿™ç§æƒ…å†µï¼Œåªèƒ½ç”¨client apiäº†ï¼Œbotæ”¶åˆ°è¿™ç§ç±»å‹çš„æ–‡ä»¶ï¼Œè½¬å‘ç»™ä¸€ä¸ªæ­£å¸¸ç”¨æˆ·ï¼Œæ­£å¸¸ç”¨æˆ·å¤„ç†å®Œï¼Œå°†ç»“æœå‘ç»™botï¼Œbotå†è½¬å‘ç»™åˆå§‹ç”¨æˆ·ã€‚</p>
<p>è¿™ç§æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œå¦‚æœç¡®ä¿æ•´ä¸ªé“¾æ¡æ˜¯å®Œæ•´çš„ï¼Œå¯ä»¥<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/NCMBot">å‚è€ƒNCMBotçš„ä»£ç </a>ã€‚ä¸€å®šè¦å¼•èµ·æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›ç”¨æˆ·çš„éšç§è®¾ç½®ä¸­ä¸å…è®¸ä»»ä½•äººæŸ¥çœ‹è½¬å‘ä¿¡æ¯ï¼Œå› æ­¤ä¸å¯ä»¥ä¾èµ–forwarded_messageè¿™ä¸ªå­—æ®µï¼botä¸€å®šè¦æƒ³åŠæ³•è‡ªå·±è®°å½•ä¸‹æ¥æŸæ¡æ¶ˆæ¯ï¼ˆæ–‡ä»¶ï¼‰çš„å¯¹åº”çš„åˆå§‹ç”¨æˆ·æ˜¯è°ã€‚</p>
<h2 id="Next-Step"><a href="#Next-Step" class="headerlink" title="Next Step"></a>Next Step</h2><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªwizardæ€§è´¨çš„ä¸€æ­¥ä¸€æ­¥çš„å‘å¯¼ï¼Œç®€å•çš„è¯ï¼Œç±»ä¼¼ä¸‹å›¾è¿™ç§æ•ˆæœï¼š</p>
<p><img src="/images/2020122516061518.png"></p>
<p><img src="/images/2020122516061860.png"></p>
<p>BotFatherä¹Ÿæ˜¯è¿™æ ·è®¾è®¡çš„ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ç§â€œNext Stepâ€çš„æ¦‚å¿µï¼Œè¦ä¸€æ­¥ä¸€æ­¥æ¥æ‰å¯ä»¥ã€‚å¦‚æœä½¿ç”¨pytelegrambotapiçš„è¯ï¼Œé‚£ä¹ˆå°±å¾ˆç®€å•äº†ï¼Œç›´æ¥ä½¿ç”¨<code>bot.register_next_step_handler</code>å°±å¯ä»¥äº†ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<p>@bot.message_handler(commands&#x3D;[â€˜sign_inâ€™])<br>def sign_in_handler(message):<br>    bot.send_message(message.chat.id, â€œnext stepâ€, parse_mode&#x3D;â€™markdownâ€™)<br>    bot.register_next_step_handler(message, next_step_add_auth)</p>
<p>def next_step_add_auth(message):<br>    bot.send_chat_action(message.chat.id, â€˜typingâ€™)<br>    bot.send_message(message.chat.id, â€œthis stepâ€, parse_mode&#x3D;â€™markdownâ€™)</p>
<p>å¦‚æœwrapperä¸æ”¯æŒnext stepï¼Œé‚£å°±åªèƒ½è‡ªå·±è®¾è®¡ä¸€ä¸ªçŠ¶æ€æœºäº†ã€‚éœ€è¦è®¾è®¡ä¸€ä¸ªä¸´æ—¶çš„æ•°æ®ç»“æ„ï¼Œè‡³å°‘è¦è¡¨æ˜ç”¨æˆ·çš„ä¸‹ä¸€æ­¥æ“ä½œåº”è¯¥æ˜¯ä»€ä¹ˆï¼Œç„¶åæ‹¦æˆªå¯¹åº”çš„äº‹ä»¶ï¼Œåšdispatchã€‚</p>
<p>å…·ä½“<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/KeepMeBot/blob/93244cdae53a77a3232ece9e4e5e053418d386ac/handler.go#L63">å¯ä»¥çœ‹è¿™é‡Œ</a>ï¼Œå¤ªé•¿äº†å°±ä¸è´´äº†</p>
<h2 id="éƒ¨ç½²ç»´æŠ¤"><a href="#éƒ¨ç½²ç»´æŠ¤" class="headerlink" title="éƒ¨ç½²ç»´æŠ¤"></a>éƒ¨ç½²ç»´æŠ¤</h2><p>ä¹‹å‰å¼€å‘çš„botï¼Œæ¯æ¬¡ä¸Šçº¿éƒ½è¦å†™ä¸€ä¸ªsystemd serviceæ–‡ä»¶ï¼Œç„¶å<code>systemctl daemon-reload</code>ï¼Œå¾ˆéº»çƒ¦ï¼Œè¿ç§»åˆ°å…¶ä»–æœºå™¨ä¹Ÿå¾ˆéº»çƒ¦ã€‚åæ¥æ¸æ¸å¼€å§‹ç”¨dockerï¼Œå°±å¾ˆæ–¹ä¾¿äº†ã€‚ç›´æ¥æŠŠä¸€å †botéƒ½ä¸¢åˆ°ä¸€ä¸ª<code>docker-compose.yml</code>ä¸­ï¼Œä¸€ä¸ª<code>up</code>å°±å¯ä»¥äº†ã€‚è¿ç§»æœåŠ¡å™¨æ—¶åªè¦rsyncèµ°ï¼Œé‡æ–°upå°±å¯ä»¥ã€‚å…·ä½“å¯ä»¥çœ‹<a target="_blank" rel="noopener" href="https://dmesg.app/dev-deploy-bot.html">ã€Šæˆ‘æ˜¯å¦‚ä½•ä¼˜é›…çš„å¼€å‘ã€éƒ¨ç½²å¹¶ç®¡ç†å¤šä¸ª Telegram Bot çš„ã€‹</a></p>
<h3 id="Dockerfileä¸docker-image"><a href="#Dockerfileä¸docker-image" class="headerlink" title="Dockerfileä¸docker image"></a>Dockerfileä¸docker image</h3><p>ä¹‹å‰ï¼Œä¸çŸ¥é“åœ¨å“ªçœ‹åˆ°çš„æ–‡ç« ï¼Œè¯´docker imageçš„layeræœ‰é™åˆ¶ï¼Œä¸èƒ½è¶…è¿‡127å±‚(è¿˜æ˜¯å¤šå°‘å±‚çš„)ï¼Œå±‚è¶Šå°‘è¶Šå¥½ã€‚å› æ­¤å¾ˆå¤šäººå¯èƒ½éƒ½æœ‰ä¸€ä¸ªç–¯ç‹‚ä¸€è¡Œå¼çš„ä¹ æƒ¯ï¼ŒæŠŠæ‰€æœ‰æ“ä½œå…¨éƒ½ä¸€ä¸ªRUNè§£å†³äº†ï¼Œä¸åœçš„ç”¨&amp;&amp;å’Œ\ã€‚</p>
<p>ä¸€ä¸ªéå¸¸å…¸å‹çš„ä¾‹å­å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<p>FROM python:alpine</p>
<p>RUN apk update \<br>&amp;&amp; apk add git ffmpeg flac â€“no-cache \<br>&amp;&amp; git clone <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ExpressBot">https://github.com/tgbot-collection/ExpressBot</a> \<br>&amp;&amp; pip3 install â€“no-cache-dir -r &#x2F;ExpressBot&#x2F;requirements.txt</p>
<p>WORKDIR &#x2F;ExpressBot</p>
<p>CMD [â€œpython3â€, â€œexpressbot&#x2F;main.pyâ€]</p>
<p>ç°åœ¨æƒ³æƒ³ï¼Œè¿™â„¢ï¸çš„æ˜¯è°è¯´çš„ï¼Œå‡ºæ¥è®©æˆ‘æš´æ‰“ä¸€é¡¿ï¼Œå¯çœŸæ˜¯å®³äººä¸æµ…å‘ï¼</p>
<p>ç°åœ¨docker engineçš„layeræ˜¯å¦æœ‰å±‚æ•°é™åˆ¶æˆ‘ä¸äº†è§£ï¼Œä½†æ˜¯å±‚è¶Šå°‘è¶Šå¥½ï¼Œè¿™ç‚¹è¦æ€ä¹ˆç†è§£ï¼Ÿ</p>
<p>æ¯”å¦‚è¯´ï¼Œæœ‰äººçœ‹åˆ°å®˜ç½‘æ–‡æ¡£<a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices">Best practices for writing Dockerfiles</a>é‡Œè¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p><strong>Minimize</strong> the number of layers</p>
<p>In older versions of Docker, it was <strong>important</strong> that you minimized the numberå§æ§½è¿™â„¢ï¸ä»€ä¹ˆç©æ„è¿™ä¹Ÿå¤ªé•¿äº†å§çœ‹ä¸ä¸‹å»äº†å•Šï¼Œèƒ½ä¸èƒ½æ¥ä¸ªä¸­æ–‡ï¼Œå•Šå¥½å›°ã€‚è¡Œå§ï¼Œåæ­£æœ‰ä¸€ä¸ªminimizeï¼Œè¿˜è¯´ importantï¼Œé‚£ç›´æ¥æ— æ¡ä»¶ä¸€å±‚è¾¾äººä¸å°±å¾—äº†ã€‚</p>
</blockquote>
<p>æ„šä»¥ä¸ºï¼Œå®«ä¸­ä¹‹äº‹ æŠ€æœ¯å­¦ä¹ ä¸­æ˜¯éå¸¸å¿Œè®³è¿™ç§å›«å›µåæ£çš„é˜…è¯»æ–¹å¼çš„ã€‚</p>
<h3 id="å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨RUN"><a href="#å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨RUN" class="headerlink" title="å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨RUN"></a>å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨RUN</h3><p>ä¸ºä»€ä¹ˆè¦å­˜åœ¨layerï¼Œä¸€ä¸ªæœ€ç›´è§‚çš„åŸå› å°±æ˜¯ï¼Œå¤§å®¶å¯ä»¥å…±ç”¨åŒæ ·çš„layerï¼Œè¿™æ ·pullèµ·æ¥ä¹Ÿå¿«å¾ˆå¤šå•Šã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯ï¼Œå¦‚æœæŸä¸€ä¸ªlayerå·²ç»æœ‰äº†ï¼Œé‚£ä¹ˆåœ¨build imageçš„æ—¶å€™ï¼Œç›´æ¥æ‹¿æ¥ç”¨ä¸å°±å¥½äº†ï¼Ÿæ¯•ç«Ÿå®‰è£…ä¸œè¥¿å¾ˆæ…¢å•Šï¼Œæœ‰äº›å¯èƒ½è¿˜æ˜¯è¦å»ç¼–è¯‘çš„ï¼Œå°±æ›´æ…¢äº†ã€‚</p>
<p>å†™Dockerfileä¸è¦æ€•å¤šåˆ›å»ºlayerï¼Œä¸è¦æ€»æ˜¯ä¸€å±‚è¾¾äººï¼ˆè¿™é‡Œä½¿ç”¨äº†å¤¸å¼ çš„ä¿®è¾æ‰‹æ³•ï¼Œ<code>FROM</code>ä¹Ÿæ˜¯è¦ä¸€å±‚çš„ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ä¸€ä¸ª<code>RUN</code>æŒ‡ä»¤ï¼‰</p>
<p>æ€ä¹ˆæ¥äº†è§£è¿™ä¸ªäº‹æƒ…å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆè¦çŸ¥é“ï¼Œdockeråªæœ‰<code>RUN</code>ã€<code>COPY</code>ã€<code>ADD</code>è¿™ä¸‰ä¸ªå‘½ä»¤ä¼šåˆ›å»ºæ–°çš„layerã€‚</p>
<p>å…¶æ¬¡ï¼Œä»¥Pythonä¸ºä¾‹ï¼Œä¸€ä¸ªPythonç¨‹åºçš„è¿è¡Œç¯å¢ƒå¤§æ¦‚å¯ä»¥è¿™æ ·åˆ’åˆ†ï¼š</p>
<ol>
<li>åŸºç¡€çš„æ“ä½œç³»ç»Ÿ</li>
<li>æŸç‰ˆæœ¬çš„Pythonè§£é‡Šå™¨åŠå¯¹åº”çš„ä¸€äº›ç³»ç»Ÿçº§ä½¿ç”¨aptå®‰è£…çš„åº“ï¼Œæ¯”å¦‚gccï¼Œgitï¼Œå„ç§libæ¯”å¦‚è¯´libssl</li>
<li>å¯¹åº”çš„Pythonç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚è¯´flaskï¼Œrequests</li>
<li>ä»£ç </li>
</ol>
<p>é‚£ä¹ˆå…·ä½“åˆ†æä¸€ä¸‹ï¼Œå°±å¯ä»¥å‘ç°ï¼Œ1å’Œ2æ˜¯åŸºæœ¬ä¸ä¼šå˜çš„ï¼Œ3å˜çš„æ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ä¸ä¼šå¾ˆé¢‘ç¹ï¼Œ4æ˜¯ç»å¸¸å˜åŒ–çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„Dockerfileå°±åº”è¯¥åŒæ ·ä¿è¯1å’Œ2ä½œä¸ºä¸€å±‚ï¼Œ3ä½œä¸º1å±‚ï¼Œ4ä½œä¸ºä¸€å±‚ã€‚</p>
<p>å…¶æ¬¡è¦çŸ¥é“ï¼Œdockeråœ¨buildçš„æ—¶å€™ï¼Œé»˜è®¤ä¼šä½¿ç”¨ç¼“å­˜çš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½å±‚çš„ç¼“å­˜å¤±æ•ˆäº†ï¼Œé‚£ä¹ˆåé¢çš„å…¨éƒ¨éƒ½è¦é‡æ–°è·‘ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘åªæ”¹ä»£ç ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ˜¯4ï¼Œé‚£ä¹ˆ123éƒ½ä¼šä½¿ç”¨ç¼“å­˜ï¼Œ4é‡æ–°è·‘ä¸€æ¬¡ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä¿®æ”¹äº†2ï¼Œé‚£ä¹ˆ234éƒ½è¦é‡æ–°è·‘ï¼Œå³ä½¿æˆ‘æ²¡æœ‰ä¿®æ”¹3å’Œ4ã€‚å“¦å¯¹äº†ï¼Œ2020å¹´äº†ï¼Œæ²¡æœ‰äººä¼šå‚»åˆ°ç”¨æ–‡ä»¶çš„è®¿é—®æ—¶é—´ã€ä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­ä½ æœ‰æ²¡æœ‰æ”¹è¿™ä¸ªæ–‡ä»¶ã€‚dockerä½¿ç”¨çš„æ˜¯checksum(SHA256)å•¦ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œåº”è¯¥æŠŠ<strong>åŒæ ·å˜åŒ–é¢‘ç‡çš„å‘½ä»¤æ”¾åœ¨ä¸€èµ·ä½œä¸ºä¸€æ¡RUN</strong>ï¼Œç„¶åæŠŠ<strong>ä¸å¸¸å˜åŒ–çš„æ”¾åœ¨ä¸Šé¢ï¼Œç»å¸¸å˜åŒ–çš„æ”¾åœ¨ä¸‹é¢</strong>ï¼Œè¿™æ ·æ‰æ˜¯æœ€ä¼˜è§£ã€‚</p>
<p>é‚£ä¹ˆå¯¹åº”å¦‚ä¸ŠDockerfileï¼Œå°±å¯ä»¥è¿™æ ·ä¼˜åŒ–ä¸€ä¸‹ï¼š</p>
<p>FROM python:alpine</p>
<h1 id="å®‰è£…ä¸ªå•¥gitï¼Œdocker-buildçš„æ—¶å€™contextæ˜¯å¹²å•¥çš„ï¼Ÿdockerhubåœ¨buildçš„æ—¶å€™ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯cloneä½ çš„repo"><a href="#å®‰è£…ä¸ªå•¥gitï¼Œdocker-buildçš„æ—¶å€™contextæ˜¯å¹²å•¥çš„ï¼Ÿdockerhubåœ¨buildçš„æ—¶å€™ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯cloneä½ çš„repo" class="headerlink" title="å®‰è£…ä¸ªå•¥gitï¼Œdocker buildçš„æ—¶å€™contextæ˜¯å¹²å•¥çš„ï¼Ÿdockerhubåœ¨buildçš„æ—¶å€™ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯cloneä½ çš„repo"></a>å®‰è£…ä¸ªå•¥gitï¼Œdocker buildçš„æ—¶å€™contextæ˜¯å¹²å•¥çš„ï¼Ÿdockerhubåœ¨buildçš„æ—¶å€™ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯cloneä½ çš„repo</h1><p>RUN apk update &amp;&amp; apk add â€“no-cache ffmpeg flac # åŠ ä¸Šâ€“no-cache</p>
<h1 id="æ‹·è´æˆ‘ä»¬çš„requirements-txtåˆ°ä¸´æ—¶ç›®å½•ï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥æ‹·è´go-mod"><a href="#æ‹·è´æˆ‘ä»¬çš„requirements-txtåˆ°ä¸´æ—¶ç›®å½•ï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥æ‹·è´go-mod" class="headerlink" title="æ‹·è´æˆ‘ä»¬çš„requirements.txtåˆ°ä¸´æ—¶ç›®å½•ï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥æ‹·è´go.mod"></a>æ‹·è´æˆ‘ä»¬çš„requirements.txtåˆ°ä¸´æ—¶ç›®å½•ï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥æ‹·è´go.mod</h1><p>COPY requirements.txt &#x2F;tmp&#x2F;requirements.txt</p>
<h1 id="å®‰è£…-Pythonçš„åº“ï¼Œç„¶ååˆ æ‰å®ƒï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥ç”¨go-mod-download"><a href="#å®‰è£…-Pythonçš„åº“ï¼Œç„¶ååˆ æ‰å®ƒï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥ç”¨go-mod-download" class="headerlink" title="å®‰è£… Pythonçš„åº“ï¼Œç„¶ååˆ æ‰å®ƒï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥ç”¨go mod download"></a>å®‰è£… Pythonçš„åº“ï¼Œç„¶ååˆ æ‰å®ƒï¼Œå¦‚æœæ˜¯goï¼Œå¯ä»¥ç”¨go mod download</h1><h1 id="å¦‚æœè¦å®‰è£…çš„ä¸œè¥¿å¾ˆå°‘ï¼Œè¿requirements-txtä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆç›´æ¥pip-install-a-b-c-dä¹Ÿå¯ä»¥"><a href="#å¦‚æœè¦å®‰è£…çš„ä¸œè¥¿å¾ˆå°‘ï¼Œè¿requirements-txtä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆç›´æ¥pip-install-a-b-c-dä¹Ÿå¯ä»¥" class="headerlink" title="å¦‚æœè¦å®‰è£…çš„ä¸œè¥¿å¾ˆå°‘ï¼Œè¿requirements.txtä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆç›´æ¥pip install a b c dä¹Ÿå¯ä»¥"></a>å¦‚æœè¦å®‰è£…çš„ä¸œè¥¿å¾ˆå°‘ï¼Œè¿requirements.txtä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆç›´æ¥pip install a b c dä¹Ÿå¯ä»¥</h1><p>RUN pip install â€“no-cache-dir -r &#x2F;tmp&#x2F;requirements.txt &amp;&amp; rm &#x2F;tmp&#x2F;requirements.txt</p>
<h1 id="æŠŠå½“å‰ç›®å½•æ‹·è´åˆ°å®¹å™¨é‡Œçš„-x2F-ExpressBot-éšè—ç›®å½•å¦‚-git-ä¹Ÿä¼šè¢«æ‹·è´"><a href="#æŠŠå½“å‰ç›®å½•æ‹·è´åˆ°å®¹å™¨é‡Œçš„-x2F-ExpressBot-éšè—ç›®å½•å¦‚-git-ä¹Ÿä¼šè¢«æ‹·è´" class="headerlink" title="æŠŠå½“å‰ç›®å½•æ‹·è´åˆ°å®¹å™¨é‡Œçš„&#x2F;ExpressBot éšè—ç›®å½•å¦‚.git ä¹Ÿä¼šè¢«æ‹·è´"></a>æŠŠå½“å‰ç›®å½•æ‹·è´åˆ°å®¹å™¨é‡Œçš„&#x2F;ExpressBot éšè—ç›®å½•å¦‚.git ä¹Ÿä¼šè¢«æ‹·è´</h1><p>COPY . &#x2F;ExpressBot</p>
<p>WORKDIR &#x2F;ExpressBot</p>
<p>CMD [â€œpython3â€, â€œexpressbot&#x2F;main.pyâ€]</p>
<p>è¿™æ ·å°±å¯ä»¥ç”¨åˆ°cacheå•¦</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2020/12/2020122516243648.jpeg"><img src="/images/2020122516243648.jpeg"></a></p>
<p>å…·ä½“æ”¹è¿›éƒ½å†™åˆ°äº†æ³¨é‡Šé‡Œäº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>.git</code>ä¹Ÿä¼šè¢«æ‹·è´ï¼Œå¯¹äºä¸€ä¸ªæœ‰å¾ˆå¤šcommitçš„é¡¹ç›®æ¥è¯´â€¦â€¦è¿˜æ˜¯æ•´ä¸ª<code>.dockerignore</code>å§ï¼</p>
<p>è¿™æ ·ä¸€æ³¢æ“ä½œä¸‹æ¥ï¼Œç¡®å®æ˜¯å¤šäº†å‡ å±‚ï¼Œä½†æ˜¯ä¸‹æ¬¡æˆ‘æ”¹ä»£ç ï¼Œdocker hubå°±ä¸ç”¨å…¨éƒ¨é‡æ–°è·‘äº†ï¼Œä¸€ä¸ªç®€å•çš„COPYå°±å®Œäº‹ã€‚</p>
<p>å‘ƒï¼Œå½“ç„¶ï¼Œbuild ruleä¹Ÿè¦å¼€å¯build cachingå“¦</p>
<p><img src="/images/2020122516062048.png"></p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#minimize-the-number-of-layers">Best practices for writing Dockerfiles</a></p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>ç¥å¤§å®¶åœ£è¯å¿«ä¹ğŸ…å¸Œæœ›ä½ çš„åœ£è¯è€äººæ²¡æœ‰åœ¨æ‰“ç”µåŠ¨</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/xbox/status/1342213462521380864?s=21">https://twitter.com/xbox/status/1342213462521380864?s=21</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/25/tgbot2/index/" data-id="clhp7rtm5009qs2qrbn1ydxkk" data-title="[Telegram botç³»åˆ—]2: å›é¡¾ä¸Media Groupã€åª’ä½“æ–‡ä»¶ã€Next Stepã€éƒ¨ç½²ç»´æŠ¤" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/12/31/2020-conclusion/index/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          2020å¹´ç»ˆæ€»ç»“
        
      </div>
    </a>
  
  
    <a href="/2020/10/30/dev-deploy-bot/index/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">æˆ‘æ˜¯å¦‚ä½•ä¼˜é›…çš„å¼€å‘ã€éƒ¨ç½²å¹¶ç®¡ç†å¤šä¸ªTelegram Botçš„ï¼Ÿ</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/25/lede-shadowtls/index/">åœ¨LEDE/OpenWRTä¸Šä½¿ç”¨ShadowTLS</a>
          </li>
        
          <li>
            <a href="/2023/05/01/zero-trust-private-dns/index/">Cloudflare Zero Trust æ·»åŠ ç§æœ‰è§£æDNS</a>
          </li>
        
          <li>
            <a href="/2023/04/29/cloudflare-access-gfwed-server/index/">ä½¿ç”¨Cloudflare Zero Trustè¿æ¥è¢«å¢™çš„æœåŠ¡å™¨</a>
          </li>
        
          <li>
            <a href="/2023/04/22/zero-trust-login-method/index/">Cloudflare Zero Trust App Launcherã€Access GroupåŠæ·»åŠ æ–°çš„ç™»å½•éªŒè¯æ–¹å¼</a>
          </li>
        
          <li>
            <a href="/2023/04/20/zero-trust-access-web/index/">ä½¿ç”¨Cloudflare Zero Trustä¿æŠ¤ä½ çš„Webåº”ç”¨</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Bennyå°åœŸè±†<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>